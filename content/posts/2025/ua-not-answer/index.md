---
title: "【案例分享】外线呼入，SIP分机为何无响应？"
date: "2025-07-15 19:39:57"
draft: false
type: posts
tags:
- 案例分享
- 无法应答
categories:
- all
---

# 案例分享

最近有客户反馈，自己的话机最近一两周都没有收到来电了，感觉很奇怪，他自己呼叫400号码，然后转分机，也接不通。

## 组网结构

```mermaid
flowchart LR
ua1(分机)
fw1(防火墙)
uas1(SIP服务器)

ua1 --> fw1
fw1 --> uas1
```

## 排查思路

1. 首先排查服务端，从日志来看，分机的注册是正常的，每隔30多秒就注册一次。 
2. 然后排查呼叫信令图，发现发送给分机的INVITE， 分机那边没有任何反应 
3. 接着请求客户远程协助，在分机上抓包，发现只能抓到注册包，没有INVITE的回应。
4. 询问客户，他们公司有没有使用防火墙，客户说有。
5. 然后让客户检查他们防火墙的设置，关闭SIP ALG功能，但是也无效
6. 然后让客户找网络负责人，在防火墙上抓包，发现防火墙收到了INVITE，但是没有转发给内部分机, 原因未知
7. 最后找防火墙厂商，发现是防火墙的UDP组包没有开启，开启UDP分片重组后，呼入电话能正常进线



## 总结

此刻，我回想起曾经写的 [UDP分片导致SIP消息丢失](https://wdd.js.org/opensips/ch7/big-udp-msg/)

没想到，在防火墙上也遇到了同样的问题。