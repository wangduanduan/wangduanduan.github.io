<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>1.8 TCP参数 | 洞香春</title>
<meta name=keywords content="all"><meta name=description content="The following parameters allows to tweak the TCP behaviour.
1. disable_tcp
Global parameter to disable TCP support in the SIP server. Default value
is &rsquo;no'.
Example of usage:
  disable_tcp=yes

2. tcp_accept_aliases
If a message received over a tcp connection has &ldquo;alias&rdquo; in its via a new
tcp alias port will be created for the connection the message came from
(the alias port will be set to the via one)."><meta name=author content="Eddie Wang"><link rel=canonical href=https://wdd.js.org/kamailio/56/tcp-params/><link crossorigin=anonymous href=/assets/css/stylesheet.821c51435cba3e33e49e590a06514c54c32ac7957095ffcc1e0f390c47cf3228.css integrity="sha256-ghxRQ1y6PjPknlkKBlFMVMMqx5Vwlf/MHg85DEfPMig=" rel="preload stylesheet" as=style><link rel=icon href=https://wdd.js.org/cowboy.ico><link rel=icon type=image/png sizes=16x16 href=https://wdd.js.org/cowboy.ico><link rel=icon type=image/png sizes=32x32 href=https://wdd.js.org/cowboy.ico><link rel=apple-touch-icon href=https://wdd.js.org/cowboy.ico><link rel=mask-icon href=https://wdd.js.org/cowboy.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://wdd.js.org/kamailio/56/tcp-params/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:url" content="https://wdd.js.org/kamailio/56/tcp-params/"><meta property="og:site_name" content="洞香春"><meta property="og:title" content="1.8 TCP参数"><meta property="og:description" content="The following parameters allows to tweak the TCP behaviour.
1. disable_tcp Global parameter to disable TCP support in the SIP server. Default value is ’no'.
Example of usage:
disable_tcp=yes 2. tcp_accept_aliases If a message received over a tcp connection has “alias” in its via a new tcp alias port will be created for the connection the message came from (the alias port will be set to the via one)."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="kamailio"><meta property="article:tag" content="All"><meta property="og:image" content="https://wdd.js.org/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://wdd.js.org/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="1.8 TCP参数"><meta name=twitter:description content="The following parameters allows to tweak the TCP behaviour.
1. disable_tcp
Global parameter to disable TCP support in the SIP server. Default value
is &rsquo;no'.
Example of usage:
  disable_tcp=yes

2. tcp_accept_aliases
If a message received over a tcp connection has &ldquo;alias&rdquo; in its via a new
tcp alias port will be created for the connection the message came from
(the alias port will be set to the via one)."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"新朋友 - kamailio学习笔记","item":"https://wdd.js.org/kamailio/"},{"@type":"ListItem","position":2,"name":"Kamailio 5.6 Wiki","item":"https://wdd.js.org/kamailio/56/"},{"@type":"ListItem","position":3,"name":"1.8 TCP参数","item":"https://wdd.js.org/kamailio/56/tcp-params/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"1.8 TCP参数","name":"1.8 TCP参数","description":"The following parameters allows to tweak the TCP behaviour.\n1. disable_tcp Global parameter to disable TCP support in the SIP server. Default value is \u0026rsquo;no'.\nExample of usage:\ndisable_tcp=yes 2. tcp_accept_aliases If a message received over a tcp connection has \u0026ldquo;alias\u0026rdquo; in its via a new tcp alias port will be created for the connection the message came from (the alias port will be set to the via one).\n","keywords":["all"],"articleBody":"The following parameters allows to tweak the TCP behaviour.\n1. disable_tcp Global parameter to disable TCP support in the SIP server. Default value is ’no'.\nExample of usage:\ndisable_tcp=yes 2. tcp_accept_aliases If a message received over a tcp connection has “alias” in its via a new tcp alias port will be created for the connection the message came from (the alias port will be set to the via one).\nBased on draft-ietf-sip-connect-reuse-00.txt, but using only the port (host aliases are dangerous, involve extra DNS lookups and the need for them is questionable)\nSee force_tcp_alias for more details.\nNote: For NAT traversal of TCP clients it is better to not use tcp_accept_aliases but just use nathelper module and fix_nated_[contact|register] functions.\nDefault is “no” (off)\ntcp_accept_aliases= yes|no 3. tcp_accept_haproxy Enable the internal TCP stack to expect a PROXY-protocol-formatted header as the first message of the connection. Both the human-readable (v1) and binary-encoded (v2) variants of the protocol are supported. This option is typically useful if you are behind a TCP load-balancer, such as HAProxy or an AWS’ ELB, and allows the load-balancer to provide connection information regarding the upstream client. This enables the use of IP-based ACLs, even behind a load-balancer.\nPlease note that enabling this option will reject any inbound TCP connection that does not conform to the PROXY-protocol spec.\nFor reference: A PROXY protocol - https://www.haproxy.org/download/1.8/doc/proxy-protocol.txt\nDefault value is no.\ntcp_accept_haproxy=yes 4. tcp_accept_hep3 Enable internal TCP receiving stack to accept HEP3 packets. This option has to be set to yes on a Kamailio instance acting as Homer SIPCapture server that is supposed to receive HEP3 packets over TCP/TLS.\nDefault value is no.\ntcp_accept_hep3=yes 5. tcp_accept_no_cl Control whether to throw or not error when there is no Content-Length header for requests received over TCP. It is required to be set to yes for XCAP traffic sent over HTTP/1.1 which does not use Content-Length header, but splits large bodies in many chunks. The module sanity can be used then to restrict this permission to HTTP traffic only, testing in route block in order to stay RFC3261 compliant about this mandatory header for SIP requests over TCP.\nDefault value is no.\ntcp_accept_no_cl=yes 6. tcp_accept_unique If set to 1, reject duplicate connections coming from same source IP and port.\nDefault set to 0.\ntcp_accept_unique = 1 7. tcp_async Alias name: tcp_buf_write\nIf enabled, all the tcp writes that would block / wait for connect to finish, will be queued and attempted latter (see also tcp_conn_wq_max and tcp_wq_max).\nNote: It also applies for TLS.\ntcp_async = yes | no (default yes) 8. tcp_children Number of children processes to be created for reading from TCP connections. If no value is explicitly set, the same number of TCP children as UDP children (see “children” parameter) will be used.\nExample of usage:\ntcp_children=4 9. tcp_clone_rcvbuf Control if the received buffer should be cloned from the TCP stream, needed by functions working inside the SIP message buffer (such as msg_apply_changes()).\nDefault is 0 (don’t clone), set it to 1 for cloning.\nExample of usage:\ntcp_clone_rcvbuf=1 10. tcp_connection_lifetime ⭐️ Lifetime in seconds for TCP sessions. TCP sessions which are inactive for longer than tcp_connection_lifetime will be closed by Kamailio. Default value is defined is 120. Setting this value to 0 will close the TCP connection pretty quick ;-).\nNote: As many SIP clients are behind NAT/Firewalls, the SIP proxy should not close the TCP connection as it is not capable of opening a new one.\nExample of usage:\ntcp_connection_lifetime=3605 11. tcp_connection_match If set to 1, try to be more strict in matching outbound TCP connections, attempting to lookup first the connection using also local port, not only the local IP and remote IP+port.\nDefault is 0.\ntcp_connection_match=1 12. tcp_connect_timeout ⭐️ Time in seconds before an ongoing attempt to establish a new TCP connection will be aborted. Lower this value for faster detection of TCP connection problems. The default value is 10s.\nExample of usage:\ntcp_connect_timeout=5 13. tcp_conn_wq_max Maximum bytes queued for write allowed per connection. Attempting to queue more bytes would result in an error and in the connection being closed (too slow). If tcp_buf_write is not enabled, it has no effect.\ntcp_conn_wq_max = bytes (default 32 K) 14. tcp_crlf_ping Enable SIP outbound TCP keep-alive using PING-PONG (CRLFCRLF - CRLF).\ntcp_crlf_ping = yes | no default: yes 15. tcp_defer_accept Tcp accepts will be delayed until some data is received (improves performance on proxies with lots of opened tcp connections). See linux tcp(7) TCP_DEFER_ACCEPT or freebsd ACCF_DATA(0). For now linux and freebsd only.\nWARNING: the linux TCP_DEFER_ACCEPT is buggy (\u003c=2.6.23) and doesn’t work exactly as expected (if no data is received it will retransmit syn acks for ~ 190 s, irrespective of the set timeout and then it will silently drop the connection without sending a RST or FIN). Try to use it together with tcp_syncnt (this way the number of retrans. SYNACKs can be limited =\u003e the timeout can be controlled in some way).\nOn FreeBSD:\ntcp_defer_accept = yes | no (default no) On Linux:\ntcp_defer_accept = number of seconds before timeout (default disabled) 16. tcp_delayed_ack Initial ACK for opened connections will be delayed and sent with the first data segment (see linux tcp(7) TCP_QUICKACK). For now linux only.\ntcp_delayed_ack = yes | no (default yes when supported) 17. tcp_fd_cache If enabled FDs used for sending will be cached inside the process calling tcp_send (performance increase for sending over tcp at the cost of slightly slower connection closing and extra FDs kept open)\ntcp_fd_cache = yes | no (default yes) 18. tcp_keepalive Enables keepalive for tcp (sets SO_KEEPALIVE socket option)\ntcp_keepalive = yes | no (default yes) 19. tcp_keepcnt ⭐️ Number of keepalives sent before dropping the connection (TCP_KEEPCNT socket option). Linux only.\ntcp_keepcnt = number (not set by default) 20. tcp_keepidle ⭐️ Time before starting to send keepalives, if the connection is idle (TCP_KEEPIDLE socket option). Linux only.\ntcp_keepidle = seconds (not set by default) 21. tcp_keepintvl ⭐️ Time interval between keepalive probes, when the previous probe failed (TCP_KEEPINTVL socket option). Linux only.\ntcp_keepintvl = seconds (not set by default) 22. tcp_linger2 Lifetime of orphaned sockets in FIN_WAIT2 state (overrides tcp_fin_timeout on, see linux tcp(7) TCP_LINGER2). Linux only.\ntcp_linger2 = seconds (not set by default) 23. tcp_max_connections ⭐️ Maximum number of tcp connections (if the number is exceeded no new tcp connections will be accepted). Default is defined in tcp_init.h: #define DEFAULT_TCP_MAX_CONNECTIONS 2048\nExample of usage:\ntcp_max_connections=4096 24. tcp_no_connect ⭐️ Stop outgoing TCP connects (also stops TLS) by setting tcp_no_connect to yes.\nYou can do this any time, even even if Kamailio is already started (in this case using the command “kamcmd cfg.set_now_int tcp no_connect 1”).\n25. tcp_poll_method Poll method used (by default the best one for the current OS is selected). For available types see io_wait.c and poll_types.h: none, poll, epoll_lt, epoll_et, sigio_rt, select, kqueue, /dev/poll\nExample of usage:\ntcp_poll_method=select 26. tcp_rd_buf_size Buffer size used for tcp reads. A high buffer size increases performance on server with few connections and lot of traffic on them, but also increases memory consumption (so for lots of connection is better to use a low value). Note also that this value limits the maximum message size (SIP, HTTP) that can be received over tcp.\nThe value is internally limited to 16MByte, for higher values recompile Kamailio with higher limit in tcp_options.c (search for “rd_buf_size” and 16777216). Further, you may need to increase the private memory, and if you process the message stateful you may also have to increase the shared memory.\nDefault: 4096, can be changed at runtime.\ntcp_rd_buf_size=65536 27. tcp_reuse_port ⭐️ Allows reuse of TCP ports. This means, for example, that the same TCP ports on which Kamailio is listening on, can be used as source ports of new TCP connections when acting as an UAC. Kamailio must have been compiled in a system implementing SO_REUSEPORT (Linux \u003e 3.9.0, FreeBSD, OpenBSD, NetBSD, MacOSX). This parameter takes effect only if also the system on which Kamailio is running on supports SO_REUSEPORT.\ntcp_reuse_port = yes (default no) 28. tcp_script_mode Specify if connection should be closed (set to CONN_ERROR) if processing the received message results in error (that can also be due to negative return code from a configuration script main route block). If set to 1, the processing continues with the connection open.\nDefault 0 (close connection)\ntcp_script_mode = 1 29. tcp_send_timeout ⭐️ Time in seconds after a TCP connection will be closed if it is not available for writing in this interval (and Kamailio wants to send something on it). Lower this value for faster detection of broken TCP connections. The default value is 10s.\nExample of usage:\ntcp_send_timeout=3 30. tcp_source_ipv4, tcp_source_ipv6 Set the source IP for all outbound TCP connections. If setting of the IP fails, the TCP connection will use the default IP address.\ntcp_source_ipv4 = IPv4 address tcp_source_ipv6 = IPv6 address 31. tcp_syncnt Number of SYN retransmissions before aborting a connect attempt (see linux tcp(7) TCP_SYNCNT). Linux only.\ntcp_syncnt = number of syn retr. (default not set) 32. tcp_wait_data Specify how long to wait (in milliseconds) to wait for data on tcp connections in certain cases. Now applies when reading on tcp connection for haproxy protocol.\nDefault: 5000ms (5secs)\ntcp_wait_data = 10000 33. tcp_wq_blk_size Block size used for tcp async writes. It should be big enough to hold a few datagrams. If it’s smaller than a datagram (in fact a tcp write()) size, it will be rounded up. It has no influenced on the number of datagrams queued (for that see tcp_conn_wq_max or tcp_wq_max). It has mostly debugging and testing value (can be ignored).\nDefault: 2100 (~ 2 INVITEs), can be changed at runtime.\n34. tcp_wq_max Maximum bytes queued for write allowed globally. It has no effect if tcp_buf_write is not enabled.\ntcp_wq_max = bytes (default 10 Mb) ","wordCount":"1629","inLanguage":"en","image":"https://wdd.js.org/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","author":{"@type":"Person","name":"Eddie Wang"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://wdd.js.org/kamailio/56/tcp-params/"},"publisher":{"@type":"Organization","name":"洞香春","logo":{"@type":"ImageObject","url":"https://wdd.js.org/cowboy.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://wdd.js.org/ accesskey=h title="洞香春 (Alt + H)"><img src=https://wdd.js.org/cowboy.ico alt aria-label=logo height=35>洞香春</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://wdd.js.org/books/ title=读书><span>读书</span></a></li><li><a href=https://wdd.js.org/freeswitch/ title=FreeSWITCH><span>FreeSWITCH</span></a></li><li><a href=https://wdd.js.org/kamailio/ title=Kamailio><span>Kamailio</span></a></li><li><a href=https://wdd.js.org/opensips/ title=OpenSIPS><span>OpenSIPS</span></a></li><li><a href=https://wdd.js.org/vim/ title=VIM><span>VIM</span></a></li><li><a href=https://wdd.js.org/categories/ title=分类><span>分类</span></a></li><li><a href=https://wdd.js.org/fe/ title=前端><span>前端</span></a></li><li><a href=https://wdd.js.org/search/ title=搜索><span>搜索</span></a></li><li><a href=https://wdd.js.org/tags/ title=标签><span>标签</span></a></li><li><a href=https://wdd.js.org/archives/ title=归档><span>归档</span></a></li><li><a href=https://wdd.js.org/about/ title=我><span>我</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://wdd.js.org/>Home</a>&nbsp;»&nbsp;<a href=https://wdd.js.org/kamailio/>新朋友 - kamailio学习笔记</a>&nbsp;»&nbsp;<a href=https://wdd.js.org/kamailio/56/>Kamailio 5.6 Wiki</a></div><h1 class="post-title entry-hint-parent">1.8 TCP参数</h1><div class=post-meta>8 min&nbsp;·&nbsp;Eddie Wang&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/kamailio/56/tcp-params/index.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#1-disable_tcp aria-label="1. disable_tcp">1. disable_tcp</a></li><li><a href=#2-tcp_accept_aliases aria-label="2. tcp_accept_aliases">2. tcp_accept_aliases</a></li><li><a href=#3-tcp_accept_haproxy aria-label="3. tcp_accept_haproxy">3. tcp_accept_haproxy</a></li><li><a href=#4-tcp_accept_hep3 aria-label="4. tcp_accept_hep3">4. tcp_accept_hep3</a></li><li><a href=#5-tcp_accept_no_cl aria-label="5. tcp_accept_no_cl">5. tcp_accept_no_cl</a></li><li><a href=#6-tcp_accept_unique aria-label="6. tcp_accept_unique">6. tcp_accept_unique</a></li><li><a href=#7-tcp_async aria-label="7. tcp_async">7. tcp_async</a></li><li><a href=#8-tcp_children aria-label="8. tcp_children">8. tcp_children</a></li><li><a href=#9-tcp_clone_rcvbuf aria-label="9. tcp_clone_rcvbuf">9. tcp_clone_rcvbuf</a></li><li><a href=#10-tcp_connection_lifetime- aria-label="10. tcp_connection_lifetime ⭐️">10. tcp_connection_lifetime ⭐️</a></li><li><a href=#11-tcp_connection_match aria-label="11. tcp_connection_match">11. tcp_connection_match</a></li><li><a href=#12-tcp_connect_timeout- aria-label="12. tcp_connect_timeout ⭐️">12. tcp_connect_timeout ⭐️</a></li><li><a href=#13-tcp_conn_wq_max aria-label="13. tcp_conn_wq_max">13. tcp_conn_wq_max</a></li><li><a href=#14-tcp_crlf_ping aria-label="14. tcp_crlf_ping">14. tcp_crlf_ping</a></li><li><a href=#15-tcp_defer_accept aria-label="15. tcp_defer_accept">15. tcp_defer_accept</a></li><li><a href=#16-tcp_delayed_ack aria-label="16. tcp_delayed_ack">16. tcp_delayed_ack</a></li><li><a href=#17-tcp_fd_cache aria-label="17. tcp_fd_cache">17. tcp_fd_cache</a></li><li><a href=#18-tcp_keepalive aria-label="18. tcp_keepalive">18. tcp_keepalive</a></li><li><a href=#19-tcp_keepcnt- aria-label="19. tcp_keepcnt ⭐️">19. tcp_keepcnt ⭐️</a></li><li><a href=#20-tcp_keepidle- aria-label="20. tcp_keepidle ⭐️">20. tcp_keepidle ⭐️</a></li><li><a href=#21-tcp_keepintvl- aria-label="21. tcp_keepintvl ⭐️">21. tcp_keepintvl ⭐️</a></li><li><a href=#22-tcp_linger2 aria-label="22. tcp_linger2">22. tcp_linger2</a></li><li><a href=#23-tcp_max_connections- aria-label="23. tcp_max_connections ⭐️">23. tcp_max_connections ⭐️</a></li><li><a href=#24-tcp_no_connect- aria-label="24. tcp_no_connect ⭐️">24. tcp_no_connect ⭐️</a></li><li><a href=#25-tcp_poll_method aria-label="25. tcp_poll_method">25. tcp_poll_method</a></li><li><a href=#26-tcp_rd_buf_size aria-label="26. tcp_rd_buf_size">26. tcp_rd_buf_size</a></li><li><a href=#27-tcp_reuse_port- aria-label="27. tcp_reuse_port ⭐️">27. tcp_reuse_port ⭐️</a></li><li><a href=#28-tcp_script_mode aria-label="28. tcp_script_mode">28. tcp_script_mode</a></li><li><a href=#29-tcp_send_timeout- aria-label="29. tcp_send_timeout ⭐️">29. tcp_send_timeout ⭐️</a></li><li><a href=#30-tcp_source_ipv4-tcp_source_ipv6 aria-label="30. tcp_source_ipv4, tcp_source_ipv6">30. tcp_source_ipv4, tcp_source_ipv6</a></li><li><a href=#31-tcp_syncnt aria-label="31. tcp_syncnt">31. tcp_syncnt</a></li><li><a href=#32-tcp_wait_data aria-label="32. tcp_wait_data">32. tcp_wait_data</a></li><li><a href=#33-tcp_wq_blk_size aria-label="33. tcp_wq_blk_size">33. tcp_wq_blk_size</a></li><li><a href=#34-tcp_wq_max aria-label="34. tcp_wq_max">34. tcp_wq_max</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p>The following parameters allows to tweak the TCP behaviour.</p><h1 id=1-disable_tcp>1. disable_tcp<a hidden class=anchor aria-hidden=true href=#1-disable_tcp>#</a></h1><p>Global parameter to disable TCP support in the SIP server. Default value
is &rsquo;no'.</p><p>Example of usage:</p><pre><code>  disable_tcp=yes
</code></pre><h1 id=2-tcp_accept_aliases>2. tcp_accept_aliases<a hidden class=anchor aria-hidden=true href=#2-tcp_accept_aliases>#</a></h1><p>If a message received over a tcp connection has &ldquo;alias&rdquo; in its via a new
tcp alias port will be created for the connection the message came from
(the alias port will be set to the via one).</p><p>Based on draft-ietf-sip-connect-reuse-00.txt, but using only the port
(host aliases are dangerous, involve extra DNS lookups and the need for
them is questionable)</p><p>See force_tcp_alias for more details.</p><p>Note: For NAT traversal of TCP clients it is better to not use
tcp_accept_aliases but just use nathelper module and
fix_nated_[contact|register] functions.</p><p>Default is &ldquo;no&rdquo; (off)</p><pre><code> tcp_accept_aliases= yes|no
</code></pre><h1 id=3-tcp_accept_haproxy>3. tcp_accept_haproxy<a hidden class=anchor aria-hidden=true href=#3-tcp_accept_haproxy>#</a></h1><p>Enable the internal TCP stack to expect a PROXY-protocol-formatted
header as the first message of the connection. Both the human-readable
(v1) and binary-encoded (v2) variants of the protocol are supported.
This option is typically useful if you are behind a TCP load-balancer,
such as HAProxy or an AWS&rsquo; ELB, and allows the load-balancer to provide
connection information regarding the upstream client. This enables the
use of IP-based ACLs, even behind a load-balancer.</p><p>Please note that enabling this option will reject any inbound TCP
connection that does not conform to the PROXY-protocol spec.</p><p>For reference: A PROXY protocol -
<a href=https://www.haproxy.org/download/1.8/doc/proxy-protocol.txt>https://www.haproxy.org/download/1.8/doc/proxy-protocol.txt</a></p><p>Default value is <strong>no</strong>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>tcp_accept_haproxy<span style=color:#f92672>=</span>yes
</span></span></code></pre></div><h1 id=4-tcp_accept_hep3>4. tcp_accept_hep3<a hidden class=anchor aria-hidden=true href=#4-tcp_accept_hep3>#</a></h1><p>Enable internal TCP receiving stack to accept HEP3 packets. This option
has to be set to <strong>yes</strong> on a Kamailio instance acting as Homer
SIPCapture server that is supposed to receive HEP3 packets over TCP/TLS.</p><p>Default value is <strong>no</strong>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>tcp_accept_hep3<span style=color:#f92672>=</span>yes
</span></span></code></pre></div><h1 id=5-tcp_accept_no_cl>5. tcp_accept_no_cl<a hidden class=anchor aria-hidden=true href=#5-tcp_accept_no_cl>#</a></h1><p>Control whether to throw or not error when there is no Content-Length
header for requests received over TCP. It is required to be set to
<strong>yes</strong> for XCAP traffic sent over HTTP/1.1 which does not use
Content-Length header, but splits large bodies in many chunks. The
module <strong>sanity</strong> can be used then to restrict this permission to HTTP
traffic only, testing in route block in order to stay RFC3261 compliant
about this mandatory header for SIP requests over TCP.</p><p>Default value is <strong>no</strong>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>tcp_accept_no_cl<span style=color:#f92672>=</span>yes
</span></span></code></pre></div><h1 id=6-tcp_accept_unique>6. tcp_accept_unique<a hidden class=anchor aria-hidden=true href=#6-tcp_accept_unique>#</a></h1><p>If set to 1, reject duplicate connections coming from same source IP and
port.</p><p>Default set to 0.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>tcp_accept_unique <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span></code></pre></div><h1 id=7-tcp_async>7. tcp_async<a hidden class=anchor aria-hidden=true href=#7-tcp_async>#</a></h1><p><strong>Alias name:</strong> <strong>tcp_buf_write</strong></p><p>If enabled, all the tcp writes that would block / wait for connect to
finish, will be queued and attempted latter (see also tcp_conn_wq_max
and tcp_wq_max).</p><p><strong>Note:</strong> It also applies for TLS.</p><pre><code>tcp_async = yes | no (default yes)
</code></pre><h1 id=8-tcp_children>8. tcp_children<a hidden class=anchor aria-hidden=true href=#8-tcp_children>#</a></h1><p>Number of children processes to be created for reading from TCP
connections. If no value is explicitly set, the same number of TCP
children as UDP children (see &ldquo;children&rdquo; parameter) will be used.</p><p>Example of usage:</p><pre><code>  tcp_children=4
</code></pre><h1 id=9-tcp_clone_rcvbuf>9. tcp_clone_rcvbuf<a hidden class=anchor aria-hidden=true href=#9-tcp_clone_rcvbuf>#</a></h1><p>Control if the received buffer should be cloned from the TCP stream,
needed by functions working inside the SIP message buffer (such as
msg_apply_changes()).</p><p>Default is 0 (don&rsquo;t clone), set it to 1 for cloning.</p><p>Example of usage:</p><pre><code>  tcp_clone_rcvbuf=1
</code></pre><h1 id=10-tcp_connection_lifetime->10. tcp_connection_lifetime ⭐️<a hidden class=anchor aria-hidden=true href=#10-tcp_connection_lifetime->#</a></h1><p>Lifetime in seconds for TCP sessions. TCP sessions which are inactive
for longer than <strong>tcp_connection_lifetime</strong> will be closed by Kamailio.
Default value is defined is 120. Setting this value to 0 will close the
TCP connection pretty quick ;-).</p><p>Note: As many SIP clients are behind NAT/Firewalls, the SIP proxy should
not close the TCP connection as it is not capable of opening a new one.</p><p>Example of usage:</p><pre><code>  tcp_connection_lifetime=3605
</code></pre><h1 id=11-tcp_connection_match>11. tcp_connection_match<a hidden class=anchor aria-hidden=true href=#11-tcp_connection_match>#</a></h1><p>If set to 1, try to be more strict in matching outbound TCP connections,
attempting to lookup first the connection using also local port, not
only the local IP and remote IP+port.</p><p>Default is 0.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>tcp_connection_match<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span></code></pre></div><h1 id=12-tcp_connect_timeout->12. tcp_connect_timeout ⭐️<a hidden class=anchor aria-hidden=true href=#12-tcp_connect_timeout->#</a></h1><p>Time in seconds before an ongoing attempt to establish a new TCP
connection will be aborted. Lower this value for faster detection of TCP
connection problems. The default value is 10s.</p><p>Example of usage:</p><pre><code>  tcp_connect_timeout=5
</code></pre><h1 id=13-tcp_conn_wq_max>13. tcp_conn_wq_max<a hidden class=anchor aria-hidden=true href=#13-tcp_conn_wq_max>#</a></h1><p>Maximum bytes queued for write allowed per connection. Attempting to
queue more bytes would result in an error and in the connection being
closed (too slow). If tcp_buf_write is not enabled, it has no effect.</p><pre><code>tcp_conn_wq_max = bytes (default 32 K)
</code></pre><h1 id=14-tcp_crlf_ping>14. tcp_crlf_ping<a hidden class=anchor aria-hidden=true href=#14-tcp_crlf_ping>#</a></h1><p>Enable SIP outbound TCP keep-alive using PING-PONG (CRLFCRLF - CRLF).</p><pre><code>tcp_crlf_ping = yes | no default: yes
</code></pre><h1 id=15-tcp_defer_accept>15. tcp_defer_accept<a hidden class=anchor aria-hidden=true href=#15-tcp_defer_accept>#</a></h1><p>Tcp accepts will be delayed until some data is received (improves
performance on proxies with lots of opened tcp connections). See linux
tcp(7) TCP_DEFER_ACCEPT or freebsd ACCF_DATA(0). For now linux and
freebsd only.</p><p>WARNING: the linux TCP_DEFER_ACCEPT is buggy (&lt;=2.6.23) and doesn&rsquo;t
work exactly as expected (if no data is received it will retransmit syn
acks for ~ 190 s, irrespective of the set timeout and then it will
silently drop the connection without sending a RST or FIN). Try to use
it together with tcp_syncnt (this way the number of retrans. SYNACKs can
be limited => the timeout can be controlled in some way).</p><p>On FreeBSD:</p><pre><code>tcp_defer_accept =  yes | no (default no)
</code></pre><p>On Linux:</p><pre><code>tcp_defer_accept =  number of seconds before timeout (default disabled)
</code></pre><h1 id=16-tcp_delayed_ack>16. tcp_delayed_ack<a hidden class=anchor aria-hidden=true href=#16-tcp_delayed_ack>#</a></h1><p>Initial ACK for opened connections will be delayed and sent with the
first data segment (see linux tcp(7) TCP_QUICKACK). For now linux only.</p><pre><code>tcp_delayed_ack  = yes | no (default yes when supported)
</code></pre><h1 id=17-tcp_fd_cache>17. tcp_fd_cache<a hidden class=anchor aria-hidden=true href=#17-tcp_fd_cache>#</a></h1><p>If enabled FDs used for sending will be cached inside the process
calling tcp_send (performance increase for sending over tcp at the cost
of slightly slower connection closing and extra FDs kept open)</p><pre><code>tcp_fd_cache = yes | no (default yes)
</code></pre><h1 id=18-tcp_keepalive>18. tcp_keepalive<a hidden class=anchor aria-hidden=true href=#18-tcp_keepalive>#</a></h1><p>Enables keepalive for tcp (sets SO_KEEPALIVE socket option)</p><pre><code>tcp_keepalive = yes | no (default yes)
</code></pre><h1 id=19-tcp_keepcnt->19. tcp_keepcnt ⭐️<a hidden class=anchor aria-hidden=true href=#19-tcp_keepcnt->#</a></h1><p>Number of keepalives sent before dropping the connection (TCP_KEEPCNT
socket option). Linux only.</p><pre><code>tcp_keepcnt = number (not set by default)
</code></pre><h1 id=20-tcp_keepidle->20. tcp_keepidle ⭐️<a hidden class=anchor aria-hidden=true href=#20-tcp_keepidle->#</a></h1><p>Time before starting to send keepalives, if the connection is idle
(TCP_KEEPIDLE socket option). Linux only.</p><pre><code>tcp_keepidle  = seconds (not set by default)
</code></pre><h1 id=21-tcp_keepintvl->21. tcp_keepintvl ⭐️<a hidden class=anchor aria-hidden=true href=#21-tcp_keepintvl->#</a></h1><p>Time interval between keepalive probes, when the previous probe failed
(TCP_KEEPINTVL socket option). Linux only.</p><pre><code>tcp_keepintvl = seconds (not set by default)
</code></pre><h1 id=22-tcp_linger2>22. tcp_linger2<a hidden class=anchor aria-hidden=true href=#22-tcp_linger2>#</a></h1><p>Lifetime of orphaned sockets in FIN_WAIT2 state (overrides
tcp_fin_timeout on, see linux tcp(7) TCP_LINGER2). Linux only.</p><pre><code>tcp_linger2 = seconds (not set by default)
</code></pre><h1 id=23-tcp_max_connections->23. tcp_max_connections ⭐️<a hidden class=anchor aria-hidden=true href=#23-tcp_max_connections->#</a></h1><p>Maximum number of tcp connections (if the number is exceeded no new tcp
connections will be accepted). Default is defined in tcp_init.h: #define
DEFAULT_TCP_MAX_CONNECTIONS 2048</p><p>Example of usage:</p><pre><code>  tcp_max_connections=4096
</code></pre><h1 id=24-tcp_no_connect->24. tcp_no_connect ⭐️<a hidden class=anchor aria-hidden=true href=#24-tcp_no_connect->#</a></h1><p>Stop outgoing TCP connects (also stops TLS) by setting tcp_no_connect to
yes.</p><p>You can do this any time, even even if Kamailio is already started (in
this case using the command &ldquo;kamcmd cfg.set_now_int tcp no_connect 1&rdquo;).</p><h1 id=25-tcp_poll_method>25. tcp_poll_method<a hidden class=anchor aria-hidden=true href=#25-tcp_poll_method>#</a></h1><p>Poll method used (by default the best one for the current OS is
selected). For available types see io_wait.c and poll_types.h: none,
poll, epoll_lt, epoll_et, sigio_rt, select, kqueue, /dev/poll</p><p>Example of usage:</p><pre><code>  tcp_poll_method=select
</code></pre><h1 id=26-tcp_rd_buf_size>26. tcp_rd_buf_size<a hidden class=anchor aria-hidden=true href=#26-tcp_rd_buf_size>#</a></h1><p>Buffer size used for tcp reads. A high buffer size increases performance
on server with few connections and lot of traffic on them, but also
increases memory consumption (so for lots of connection is better to use
a low value). Note also that this value limits the maximum message size
(SIP, HTTP) that can be received over tcp.</p><p>The value is internally limited to 16MByte, for higher values recompile
Kamailio with higher limit in tcp_options.c (search for &ldquo;rd_buf_size&rdquo;
and 16777216). Further, you may need to increase the private memory, and
if you process the message stateful you may also have to increase the
shared memory.</p><p>Default: 4096, can be changed at runtime.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>tcp_rd_buf_size<span style=color:#f92672>=</span><span style=color:#ae81ff>65536</span>
</span></span></code></pre></div><h1 id=27-tcp_reuse_port->27. tcp_reuse_port ⭐️<a hidden class=anchor aria-hidden=true href=#27-tcp_reuse_port->#</a></h1><p>Allows reuse of TCP ports. This means, for example, that the same TCP
ports on which Kamailio is listening on, can be used as source ports of
new TCP connections when acting as an UAC. Kamailio must have been
compiled in a system implementing SO_REUSEPORT (Linux > 3.9.0, FreeBSD,
OpenBSD, NetBSD, MacOSX). This parameter takes effect only if also the
system on which Kamailio is running on supports SO_REUSEPORT.</p><pre><code>tcp_reuse_port = yes (default no)
</code></pre><h1 id=28-tcp_script_mode>28. tcp_script_mode<a hidden class=anchor aria-hidden=true href=#28-tcp_script_mode>#</a></h1><p>Specify if connection should be closed (set to CONN_ERROR) if processing
the received message results in error (that can also be due to negative
return code from a configuration script main route block). If set to 1,
the processing continues with the connection open.</p><p>Default 0 (close connection)</p><pre><code>tcp_script_mode = 1
</code></pre><h1 id=29-tcp_send_timeout->29. tcp_send_timeout ⭐️<a hidden class=anchor aria-hidden=true href=#29-tcp_send_timeout->#</a></h1><p>Time in seconds after a TCP connection will be closed if it is not
available for writing in this interval (and Kamailio wants to send
something on it). Lower this value for faster detection of broken TCP
connections. The default value is 10s.</p><p>Example of usage:</p><pre><code>  tcp_send_timeout=3
</code></pre><h1 id=30-tcp_source_ipv4-tcp_source_ipv6>30. tcp_source_ipv4, tcp_source_ipv6<a hidden class=anchor aria-hidden=true href=#30-tcp_source_ipv4-tcp_source_ipv6>#</a></h1><p>Set the source IP for all outbound TCP connections. If setting of the IP
fails, the TCP connection will use the default IP address.</p><pre><code>tcp_source_ipv4 = IPv4 address
tcp_source_ipv6 = IPv6 address
</code></pre><h1 id=31-tcp_syncnt>31. tcp_syncnt<a hidden class=anchor aria-hidden=true href=#31-tcp_syncnt>#</a></h1><p>Number of SYN retransmissions before aborting a connect attempt (see
linux tcp(7) TCP_SYNCNT). Linux only.</p><pre><code>tcp_syncnt = number of syn retr. (default not set)
</code></pre><h1 id=32-tcp_wait_data>32. tcp_wait_data<a hidden class=anchor aria-hidden=true href=#32-tcp_wait_data>#</a></h1><p>Specify how long to wait (in milliseconds) to wait for data on tcp
connections in certain cases. Now applies when reading on tcp connection
for haproxy protocol.</p><p>Default: 5000ms (5secs)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>tcp_wait_data <span style=color:#f92672>=</span> <span style=color:#ae81ff>10000</span>
</span></span></code></pre></div><h1 id=33-tcp_wq_blk_size>33. tcp_wq_blk_size<a hidden class=anchor aria-hidden=true href=#33-tcp_wq_blk_size>#</a></h1><p>Block size used for tcp async writes. It should be big enough to hold a
few datagrams. If it&rsquo;s smaller than a datagram (in fact a tcp write())
size, it will be rounded up. It has no influenced on the number of
datagrams queued (for that see tcp_conn_wq_max or tcp_wq_max). It has
mostly debugging and testing value (can be ignored).</p><p>Default: 2100 (~ 2 INVITEs), can be changed at runtime.</p><h1 id=34-tcp_wq_max>34. tcp_wq_max<a hidden class=anchor aria-hidden=true href=#34-tcp_wq_max>#</a></h1><p>Maximum bytes queued for write allowed globally. It has no effect if
tcp_buf_write is not enabled.</p><pre><code>tcp_wq_max = bytes (default 10 Mb)
</code></pre></div><footer class=post-footer><ul class=post-tags><li><a href=https://wdd.js.org/tags/all/>All</a></li></ul></footer><script src=https://giscus.app/client.js data-repo=wangduanduan/wangduanduan.github.io data-repo-id="MDEwOlJlcG9zaXRvcnkxMTkyMjMyNjA=" data-category=Announcements data-category-id=DIC_kwDOBxsz3M4CAjBq data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=zh-CN crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2025 <a href=https://wdd.js.org/>洞香春</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>