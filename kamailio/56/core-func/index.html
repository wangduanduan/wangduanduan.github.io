<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>1.14 核心函数 | 洞香春</title>
<meta name=keywords content="all"><meta name=description content="Functions exported by core that can be used in route blocks.
1. add_local_rport ⭐️
Add rport parameter to local generated Via header &ndash; see RFC3581. In
effect for forwarded SIP requests.
Example of usage:
add_local_rport();
2. avpflags
3. break
&lsquo;break&rsquo; statement can be used to end a &lsquo;case&rsquo; block in a &lsquo;switch&rsquo;
statement or exit from a &lsquo;while&rsquo; statement.
4. drop ⭐️
Stop the execution of the configuration script and alter the implicit
action which is done afterwards."><meta name=author content="Eddie Wang"><link rel=canonical href=https://wdd.js.org/kamailio/56/core-func/><link crossorigin=anonymous href=/assets/css/stylesheet.821c51435cba3e33e49e590a06514c54c32ac7957095ffcc1e0f390c47cf3228.css integrity="sha256-ghxRQ1y6PjPknlkKBlFMVMMqx5Vwlf/MHg85DEfPMig=" rel="preload stylesheet" as=style><link rel=icon href=https://wdd.js.org/cowboy.ico><link rel=icon type=image/png sizes=16x16 href=https://wdd.js.org/cowboy.ico><link rel=icon type=image/png sizes=32x32 href=https://wdd.js.org/cowboy.ico><link rel=apple-touch-icon href=https://wdd.js.org/cowboy.ico><link rel=mask-icon href=https://wdd.js.org/cowboy.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://wdd.js.org/kamailio/56/core-func/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:url" content="https://wdd.js.org/kamailio/56/core-func/"><meta property="og:site_name" content="洞香春"><meta property="og:title" content="1.14 核心函数"><meta property="og:description" content="Functions exported by core that can be used in route blocks.
1. add_local_rport ⭐️ Add rport parameter to local generated Via header – see RFC3581. In effect for forwarded SIP requests.
Example of usage:
add_local_rport(); 2. avpflags 3. break ‘break’ statement can be used to end a ‘case’ block in a ‘switch’ statement or exit from a ‘while’ statement.
4. drop ⭐️ Stop the execution of the configuration script and alter the implicit action which is done afterwards."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="kamailio"><meta property="article:tag" content="All"><meta property="og:image" content="https://wdd.js.org/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://wdd.js.org/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="1.14 核心函数"><meta name=twitter:description content="Functions exported by core that can be used in route blocks.
1. add_local_rport ⭐️
Add rport parameter to local generated Via header &ndash; see RFC3581. In
effect for forwarded SIP requests.
Example of usage:
add_local_rport();
2. avpflags
3. break
&lsquo;break&rsquo; statement can be used to end a &lsquo;case&rsquo; block in a &lsquo;switch&rsquo;
statement or exit from a &lsquo;while&rsquo; statement.
4. drop ⭐️
Stop the execution of the configuration script and alter the implicit
action which is done afterwards."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"新朋友 - kamailio学习笔记","item":"https://wdd.js.org/kamailio/"},{"@type":"ListItem","position":2,"name":"Kamailio 5.6 Wiki","item":"https://wdd.js.org/kamailio/56/"},{"@type":"ListItem","position":3,"name":"1.14 核心函数","item":"https://wdd.js.org/kamailio/56/core-func/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"1.14 核心函数","name":"1.14 核心函数","description":"Functions exported by core that can be used in route blocks.\n1. add_local_rport ⭐️ Add rport parameter to local generated Via header \u0026ndash; see RFC3581. In effect for forwarded SIP requests.\nExample of usage:\nadd_local_rport(); 2. avpflags 3. break \u0026lsquo;break\u0026rsquo; statement can be used to end a \u0026lsquo;case\u0026rsquo; block in a \u0026lsquo;switch\u0026rsquo; statement or exit from a \u0026lsquo;while\u0026rsquo; statement.\n4. drop ⭐️ Stop the execution of the configuration script and alter the implicit action which is done afterwards.\n","keywords":["all"],"articleBody":"Functions exported by core that can be used in route blocks.\n1. add_local_rport ⭐️ Add rport parameter to local generated Via header – see RFC3581. In effect for forwarded SIP requests.\nExample of usage:\nadd_local_rport(); 2. avpflags 3. break ‘break’ statement can be used to end a ‘case’ block in a ‘switch’ statement or exit from a ‘while’ statement.\n4. drop ⭐️ Stop the execution of the configuration script and alter the implicit action which is done afterwards.\nIf the function is called in a ‘branch_route’ then the branch is discarded (implicit action for ‘branch_route’ is to forward the request).\nIf the function is called in the default ‘onreply_route’ then you can drop any response. If the function is called in a named ‘onreply_route’ (transaction stateful) then any provisional reply is discarded. (Implicit action for ‘onreply_route’ is to send the reply upstream according to Via header.)\nExample of usage:\nonreply_route { if(status==\"200\") { drop(); # this works } } onreply_route[FOOBAR] { if(status==\"200\") { drop(); # this is ignored } } 5. exit ⭐️ Stop the execution of the configuration script – it has the same behaviour as return(0). It does not affect the implicit action to be taken after script execution.\nroute { if (route(2)) { xlog(\"L_NOTICE\",\"method $rm is INVITE\\n\"); } else { xlog(\"L_NOTICE\",\"method is $rm\\n\"); }; } route[2] { if (is_method(\"INVITE\")) { return(1); } else if (is_method(\"REGISTER\")) { return(-1); } else if (is_method(\"MESSAGE\")) { sl_send_reply(\"403\",\"IM not allowed\"); exit; }; } 6. error 7. exec 8. force_rport ⭐️ Force_rport() adds the rport parameter to the first Via header of the received message. Thus, Kamailio will add the received port to the top most Via header in the SIP message, even if the client does not indicate support for rport. This enables subsequent SIP messages to return to the proper port later on in a SIP transaction.\nThis is useful for NAT traversal, to enforce symmetric response signaling.\nThe rport parameter is defined in RFC 3581.\nNote: there is also a force_rport parameter which changes the global behavior of the SIP proxy.\nExample of usage:\nforce_rport(); 9. add_rport ⭐️ Alias for force_rport();\n10. force_send_socket Force to send the message from the specified socket (it _must_ be one of the sockets specified with the “listen” directive). If the protocol doesn’t match (e.g. UDP message “forced” to a TCP socket) the closest socket of the same protocol is used.\nThis function does not support pseudo-variables, use the set_send_socket function from the corex module instead.\nExample of usage:\nforce_send_socket(10.10.10.10:5060); force_send_socket(udp:10.10.10.10:5060); 11. force_tcp_alias Alias name: add_tcp_alias\nforce_tcp_alias(port)\nadds a tcp port alias for the current connection (if tcp). Useful if you want to send all the traffic to port_alias through the same connection this request came from [it could help for firewall or nat traversal]. With no parameters adds the port from the message via as the alias. When the “aliased” connection is closed (e.g. it’s idle for too much time), all the port aliases are removed.\n12. forward Forward the SIP request to destination stored in $du in stateless mode.\nExample of usage:\n$du = \"sip:10.0.0.10:5060;transport=tcp\"; forward(); 13. isavpflagset 14. isflagset ⭐️ Test if a flag is set for current processed message (if the flag value is 1). The value of the parameter can be in range of 0..31.\nFor more see:\nKamailio - Flag Operations Example of usage:\nif(isflagset(3)) { log(\"flag 3 is set\\n\"); }; Kamailio also supports named flags. They have to be declared at the beginning of the config file with:\nflags flag1_name[:position], flag2_name ... Example:\nflags test, a:1, b:2 ; route{ setflag(test); if (isflagset(a)){ # equiv. to isflagset(1) .... } resetflag(b); # equiv. to resetflag(2) 15. is_int ⭐️ Checks if a pseudo variable argument contains integer value.\nif(is_int(\"$avp(foobar)\")) { log(\"foobar contains an integer\\n\"); } 16. log Write text message to standard error terminal or syslog. You can specify the log level as first parameter.\nFor more see: http://www.kamailio.org/dokuwiki/doku.php/tutorials:debug-syslog-messages\nExample of usage:\nlog(\"just some text message\\n\"); 17. prefix Add the string parameter in front of username in R-URI.\nExample of usage:\nprefix(\"00\"); 18. resetavpflag 19. resetflag 20. return ⭐️ The return() function allows you to return any integer value from a called route() block. You can test the value returned by a route using $retcode or $? variable.\nreturn(0) is same as exit();\nIn bool expressions:\nNegative is FALSE Positive is TRUE If no value is specified, it returns 1. If return is used in the top level route is equivalent with exit [val]. If no return is at the end of the routing block, the return code is the value of the last executed action, therefore it is highly recommended to return an explicit value (e.g., return(1)) to avoid unexpected config execution.\nExample usage:\nroute { if (route(2)) { xlog(\"L_NOTICE\",\"method $rm is INVITE\\n\"); } else { xlog(\"L_NOTICE\",\"method $rm is REGISTER\\n\"); }; } route[2] { if (is_method(\"INVITE\")) { return(1); } else if (is_method(\"REGISTER\")) { return(-1); } else { return(0); }; } See also the FAQ for how the function return code is evaluated:\nFrequently Asked Questions 21. revert_uri ⭐️ Set the R-URI to the value of the R-URI as it was when the request was received by server (undo all changes of R-URI).\nExample of usage:\nrevert_uri(); 22. rewritehostport ⭐️ Alias name: sethostport, sethp\nRewrite the domain part and port of the R-URI with the value of function’s parameter. Other parts of the R-URI like username and URI parameters remain unchanged.\nExample of usage:\nrewritehostport(\"1.2.3.4:5080\"); 23. rewritehostporttrans ⭐️ Alias name: sethostporttrans, sethpt\nRewrite the domain part and port of the R-URI with the value of function’s parameter. Also allows to specify the transport parameter. Other parts of the R-URI like username and URI parameters remain unchanged.\nExample of usage:\nrewritehostporttrans(\"1.2.3.4:5080\"); 24. rewritehost ⭐️ Alias name: sethost, seth\nRewrite the domain part of the R-URI with the value of function’s parameter. Other parts of the R-URI like username, port and URI parameters remain unchanged.\nExample of usage:\nrewritehost(\"1.2.3.4\"); 25. rewriteport ⭐️ Alias name: setport, setp\nRewrites/sets the port part of the R-URI with the value of function’s parameter.\nExample of usage:\nrewriteport(\"5070\"); 26. rewriteuri ⭐️ Alias name: seturi\nRewrite the request URI.\nExample of usage:\nrewriteuri(\"sip:test@kamailio.org\"); 27. rewriteuserpass ⭐️ Alias name: setuserpass, setup\nRewrite the password part of the R-URI with the value of function’s parameter.\nExample of usage:\nrewriteuserpass(\"my_secret_passwd\"); 28. rewriteuser ⭐️ Alias name: setuser, setu\nRewrite the user part of the R-URI with the value of function’s parameter.\nExample of usage:\nrewriteuser(\"newuser\"); 29. route ⭐️ Execute route block given in parameter. Parameter may be name of the block or a string valued expression.\nExamples of usage:\nroute(REGISTER_REQUEST); route(@received.proto + \"_proto_\" + $var(route_set)); 30. selval ⭐️ Select a value based on conditional expression.\nPrototype:\nselval(evalexpr, valexp1, valexpr2) This is a core statement that return the 2nd parameter if the 1st parameter is evaluated to true, or 3rd parameter if the 1st parameter is evaluated to false. It can be considered a core function that is equivalent of ternary condition/operator\nExample:\n$var(x) = selval($Ts mod 2, \"true/\" + $ru, \"false/\" + $rd); The first parameter is a conditional expression, like those used for IF, the 2nd and 3rd parameters can be expressions like those used in the right side of assignments.\n31. set_advertised_address ⭐️ Same as advertised_address but it affects only the current message. It has priority if advertised_address is also set.\nExample of usage:\nset_advertised_address(\"kamailio.org\"); 32. set_advertised_port ⭐️ Same as advertised_port but it affects only the current message. It has priority over advertised_port.\nExample of usage:\nset_advertised_port(5080); 33. set_forward_no_connect The message will be forwarded only if there is already an existing connection to the destination. It applies only to connection oriented protocols like TCP and TLS (TODO: SCTP), for UDP it will be ignored. The behavior depends in which route block the function is called:\nnormal request route: affects stateless forwards and tm. For tm it affects all the branches and the possible retransmissions (in fact there are no retransmission for TCP/TLS). onreply_route[0] (stateless): equivalent to set_reply_*() (it’s better to use set_reply_* though) onreply_route[!=0] (tm): ignored branch_route: affects the current branch only (all messages sent on this branch, like possible retransmissions and CANCELs). onsend_route: like branch route Example of usage:\nroute { ... if (lookup()) { //requests to local users. They are usually behind NAT so it does not make sense to try //to establish a new TCP connection set_forward_no_connect(); t_relay(); } ... } 34. set_forward_close Try to close the connection (the one on which the message is sent out) after forwarding the current message. Can be used in same route blocks as set_forward_no_connect().\nNote: Use with care as you might not receive the replies anymore as the connection is closed.\n35. set_reply_no_connect Like set_forward_no_connect(), but for replies to the current message (local generated replies and replies forwarded by tm). The behavior depends in which route block the function is called:\nnormal request route: affects all replies sent back on the transaction (either local or forwarded) and all local stateless replies (sl_reply()). onreply_route: affects the current reply (so the send_flags set in the onreply_route will be used if the reply for which they were set is the winning final reply or it’s a provisional reply that is forwarded) branch_route: ignored. onsend_route: ignored Example of usage:\nroute[4] { //requests from local users. There are usually behind NAT so it does not make sense to try //to establish a new TCP connection for the replies set_reply_no_connect(); // do authentication and call routing ... } 36. set_reply_close Like set_reply_no_connect, but closes the TCP connection after sending. Can be used in same route blocks as set_reply_no_connect.\nExample of usage:\nroute { ... if (...caller-is-not-registered...) { // reject unregistered client // if request was received via TCP/TLS close the connection, as // this may trigger re-registration of the client. set_reply_close(); sl_send_reply(\"403\",\"REGISTER first\"); exit; } ... } 37. setavpflag 38. setflag ⭐️ Set a flag for current processed message. The value of the parameter can be in range of 0..31. The flags are used to mark the message for special processing (e.g., accounting) or to keep some state (e.g., message authenticated).\nFor more see:\nKamailio - Flag Operations Example of usage:\nsetflag(3); 39. strip ⭐️ Strip the first N-th characters from username of R-URI (N is the value of the parameter).\nExample of usage:\nstrip(3); 40. strip_tail Strip the last N-th characters from username of R-URI (N is the value of the parameter).\nExample of usage:\nstrip_tail(3); 41. udp_mtu_try_proto(proto) proto - TCP|TLS|SCTP|UDP - like udp_mtu_try_proto global parameter but works on a per packet basis and not globally. Example:\nif($rd==\"10.10.10.10\") udp_mtu_try_proto(SCTP); 42. userphone Add “user=phone” parameter to R-URI.\n","wordCount":"1760","inLanguage":"en","image":"https://wdd.js.org/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","author":{"@type":"Person","name":"Eddie Wang"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://wdd.js.org/kamailio/56/core-func/"},"publisher":{"@type":"Organization","name":"洞香春","logo":{"@type":"ImageObject","url":"https://wdd.js.org/cowboy.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://wdd.js.org/ accesskey=h title="洞香春 (Alt + H)"><img src=https://wdd.js.org/cowboy.ico alt aria-label=logo height=35>洞香春</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://wdd.js.org/books/ title=读书><span>读书</span></a></li><li><a href=https://wdd.js.org/freeswitch/ title=FreeSWITCH><span>FreeSWITCH</span></a></li><li><a href=https://wdd.js.org/golang/ title=Golang><span>Golang</span></a></li><li><a href=https://wdd.js.org/kamailio/ title=Kamailio><span>Kamailio</span></a></li><li><a href=https://wdd.js.org/kamailio/56/ title="Kamailio 5.6 wiki"><span>Kamailio 5.6 wiki</span></a></li><li><a href=https://wdd.js.org/network/ title=Network><span>Network</span></a></li><li><a href=https://wdd.js.org/opensips/ title=OpenSIPS><span>OpenSIPS</span></a></li><li><a href=https://wdd.js.org/vim/ title=VIM><span>VIM</span></a></li><li><a href=https://wdd.js.org/categories/ title=分类><span>分类</span></a></li><li><a href=https://wdd.js.org/fe/ title=前端><span>前端</span></a></li><li><a href=https://wdd.js.org/search/ title=搜索><span>搜索</span></a></li><li><a href=https://wdd.js.org/tags/ title=标签><span>标签</span></a></li><li><a href=https://wdd.js.org/archives/ title=归档><span>归档</span></a></li><li><a href=https://wdd.js.org/about/ title=我><span>我</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://wdd.js.org/>Home</a>&nbsp;»&nbsp;<a href=https://wdd.js.org/kamailio/>新朋友 - kamailio学习笔记</a>&nbsp;»&nbsp;<a href=https://wdd.js.org/kamailio/56/>Kamailio 5.6 Wiki</a></div><h1 class="post-title entry-hint-parent">1.14 核心函数</h1><div class=post-meta>9 min&nbsp;·&nbsp;Eddie Wang&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/kamailio/56/core-func/index.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#1-add_local_rport- aria-label="1. add_local_rport ⭐️">1. add_local_rport ⭐️</a></li><li><a href=#2-avpflags aria-label="2. avpflags">2. avpflags</a></li><li><a href=#3-break aria-label="3. break">3. break</a></li><li><a href=#4-drop- aria-label="4. drop ⭐️">4. drop ⭐️</a></li><li><a href=#5-exit- aria-label="5. exit ⭐️">5. exit ⭐️</a></li><li><a href=#6-error aria-label="6. error">6. error</a></li><li><a href=#7-exec aria-label="7. exec">7. exec</a></li><li><a href=#8-force_rport- aria-label="8. force_rport ⭐️">8. force_rport ⭐️</a></li><li><a href=#9-add_rport- aria-label="9. add_rport ⭐️">9. add_rport ⭐️</a></li><li><a href=#10-force_send_socket aria-label="10. force_send_socket">10. force_send_socket</a></li><li><a href=#11-force_tcp_alias aria-label="11. force_tcp_alias">11. force_tcp_alias</a></li><li><a href=#12-forward aria-label="12. forward">12. forward</a></li><li><a href=#13-isavpflagset aria-label="13. isavpflagset">13. isavpflagset</a></li><li><a href=#14-isflagset- aria-label="14. isflagset ⭐️">14. isflagset ⭐️</a></li><li><a href=#15-is_int- aria-label="15. is_int ⭐️">15. is_int ⭐️</a></li><li><a href=#16-log aria-label="16. log">16. log</a></li><li><a href=#17-prefix aria-label="17. prefix">17. prefix</a></li><li><a href=#18-resetavpflag aria-label="18. resetavpflag">18. resetavpflag</a></li><li><a href=#19-resetflag aria-label="19. resetflag">19. resetflag</a></li><li><a href=#20-return- aria-label="20. return ⭐️">20. return ⭐️</a></li><li><a href=#21-revert_uri- aria-label="21. revert_uri ⭐️">21. revert_uri ⭐️</a></li><li><a href=#22-rewritehostport- aria-label="22. rewritehostport ⭐️">22. rewritehostport ⭐️</a></li><li><a href=#23-rewritehostporttrans- aria-label="23. rewritehostporttrans ⭐️">23. rewritehostporttrans ⭐️</a></li><li><a href=#24-rewritehost- aria-label="24. rewritehost ⭐️">24. rewritehost ⭐️</a></li><li><a href=#25-rewriteport- aria-label="25. rewriteport ⭐️">25. rewriteport ⭐️</a></li><li><a href=#26-rewriteuri- aria-label="26. rewriteuri ⭐️">26. rewriteuri ⭐️</a></li><li><a href=#27-rewriteuserpass- aria-label="27. rewriteuserpass ⭐️">27. rewriteuserpass ⭐️</a></li><li><a href=#28-rewriteuser- aria-label="28. rewriteuser ⭐️">28. rewriteuser ⭐️</a></li><li><a href=#29-route- aria-label="29. route ⭐️">29. route ⭐️</a></li><li><a href=#30-selval- aria-label="30. selval ⭐️">30. selval ⭐️</a></li><li><a href=#31-set_advertised_address- aria-label="31. set_advertised_address ⭐️">31. set_advertised_address ⭐️</a></li><li><a href=#32-set_advertised_port- aria-label="32. set_advertised_port ⭐️">32. set_advertised_port ⭐️</a></li><li><a href=#33-set_forward_no_connect aria-label="33. set_forward_no_connect">33. set_forward_no_connect</a></li><li><a href=#34-set_forward_close aria-label="34. set_forward_close">34. set_forward_close</a></li><li><a href=#35-set_reply_no_connect aria-label="35. set_reply_no_connect">35. set_reply_no_connect</a></li><li><a href=#36-set_reply_close aria-label="36. set_reply_close">36. set_reply_close</a></li><li><a href=#37-setavpflag aria-label="37. setavpflag">37. setavpflag</a></li><li><a href=#38-setflag- aria-label="38. setflag ⭐️">38. setflag ⭐️</a></li><li><a href=#39-strip- aria-label="39. strip ⭐️">39. strip ⭐️</a></li><li><a href=#40-strip_tail aria-label="40. strip_tail">40. strip_tail</a></li><li><a href=#41-udp_mtu_try_protoproto aria-label="41. udp_mtu_try_proto(proto)">41. udp_mtu_try_proto(proto)</a></li><li><a href=#42-userphone aria-label="42. userphone">42. userphone</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p>Functions exported by core that can be used in route blocks.</p><h1 id=1-add_local_rport->1. add_local_rport ⭐️<a hidden class=anchor aria-hidden=true href=#1-add_local_rport->#</a></h1><p>Add <strong>rport</strong> parameter to local generated Via header &ndash; see RFC3581. In
effect for forwarded SIP requests.</p><p>Example of usage:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#a6e22e>add_local_rport</span>();
</span></span></code></pre></div><h1 id=2-avpflags>2. avpflags<a hidden class=anchor aria-hidden=true href=#2-avpflags>#</a></h1><h1 id=3-break>3. break<a hidden class=anchor aria-hidden=true href=#3-break>#</a></h1><p>&lsquo;break&rsquo; statement can be used to end a &lsquo;case&rsquo; block in a &lsquo;switch&rsquo;
statement or exit from a &lsquo;while&rsquo; statement.</p><h1 id=4-drop->4. drop ⭐️<a hidden class=anchor aria-hidden=true href=#4-drop->#</a></h1><p>Stop the execution of the configuration script and alter the implicit
action which is done afterwards.</p><p>If the function is called in a &lsquo;branch_route&rsquo; then the branch is
discarded (implicit action for &lsquo;branch_route&rsquo; is to forward the
request).</p><p>If the function is called in the default &lsquo;onreply_route&rsquo; then you can
drop any response. If the function is called in a named &lsquo;onreply_route&rsquo;
(transaction stateful) then any provisional reply is discarded.
(Implicit action for &lsquo;onreply_route&rsquo; is to send the reply upstream
according to Via header.)</p><p>Example of usage:</p><pre><code>  onreply_route {
      if(status==&quot;200&quot;) {
          drop(); # this works
      }
  }

  onreply_route[FOOBAR] {
      if(status==&quot;200&quot;) {
          drop(); # this is ignored
      }
  }
</code></pre><h1 id=5-exit->5. exit ⭐️<a hidden class=anchor aria-hidden=true href=#5-exit->#</a></h1><p>Stop the execution of the configuration script &ndash; it has the same
behaviour as return(0). It does not affect the implicit action to be
taken after script execution.</p><pre><code>route {
  if (route(2)) {
    xlog(&quot;L_NOTICE&quot;,&quot;method $rm is INVITE\n&quot;);
  } else {
    xlog(&quot;L_NOTICE&quot;,&quot;method is $rm\n&quot;);
  };
}

route[2] {
  if (is_method(&quot;INVITE&quot;)) {
    return(1);
  } else if (is_method(&quot;REGISTER&quot;)) {
    return(-1);
  } else if (is_method(&quot;MESSAGE&quot;)) {
    sl_send_reply(&quot;403&quot;,&quot;IM not allowed&quot;);
    exit;
  };
}
</code></pre><h1 id=6-error>6. error<a hidden class=anchor aria-hidden=true href=#6-error>#</a></h1><h1 id=7-exec>7. exec<a hidden class=anchor aria-hidden=true href=#7-exec>#</a></h1><h1 id=8-force_rport->8. force_rport ⭐️<a hidden class=anchor aria-hidden=true href=#8-force_rport->#</a></h1><p>Force_rport() adds the rport parameter to the first Via header of the
received message. Thus, Kamailio will add the received port to the top
most Via header in the SIP message, even if the client does not indicate
support for rport. This enables subsequent SIP messages to return to the
proper port later on in a SIP transaction.</p><p>This is useful for NAT traversal, to enforce symmetric response
signaling.</p><p>The rport parameter is defined in RFC 3581.</p><p>Note: there is also a force_rport parameter which changes the global
behavior of the SIP proxy.</p><p>Example of usage:</p><pre><code>  force_rport();
</code></pre><h1 id=9-add_rport->9. add_rport ⭐️<a hidden class=anchor aria-hidden=true href=#9-add_rport->#</a></h1><p>Alias for force_rport();</p><h1 id=10-force_send_socket>10. force_send_socket<a hidden class=anchor aria-hidden=true href=#10-force_send_socket>#</a></h1><p>Force to send the message from the specified socket (it _must_ be one
of the sockets specified with the &ldquo;listen&rdquo; directive). If the protocol
doesn&rsquo;t match (e.g. UDP message &ldquo;forced&rdquo; to a TCP socket) the closest
socket of the same protocol is used.</p><p>This function does not support pseudo-variables, use the set_send_socket
function from the corex module instead.</p><p>Example of usage:</p><pre><code>    force_send_socket(10.10.10.10:5060);
    force_send_socket(udp:10.10.10.10:5060);
</code></pre><h1 id=11-force_tcp_alias>11. force_tcp_alias<a hidden class=anchor aria-hidden=true href=#11-force_tcp_alias>#</a></h1><p><strong>Alias name:</strong> <strong>add_tcp_alias</strong></p><p>force_tcp_alias(port)</p><p>adds a tcp port alias for the current connection (if tcp). Useful if you
want to send all the traffic to port_alias through the same connection
this request came from [it could help for firewall or nat traversal].
With no parameters adds the port from the message via as the alias. When
the &ldquo;aliased&rdquo; connection is closed (e.g. it&rsquo;s idle for too much time),
all the port aliases are removed.</p><h1 id=12-forward>12. forward<a hidden class=anchor aria-hidden=true href=#12-forward>#</a></h1><p>Forward the SIP request to destination stored in $du in stateless mode.</p><p>Example of usage:</p><pre><code>  $du = &quot;sip:10.0.0.10:5060;transport=tcp&quot;;
  forward();
</code></pre><h1 id=13-isavpflagset>13. isavpflagset<a hidden class=anchor aria-hidden=true href=#13-isavpflagset>#</a></h1><h1 id=14-isflagset->14. isflagset ⭐️<a hidden class=anchor aria-hidden=true href=#14-isflagset->#</a></h1><p>Test if a flag is set for current processed message (if the flag value
is 1). The value of the parameter can be in range of 0..31.</p><p>For more see:</p><ul><li><a href=../../tutorials/kamailio-flag-operations.md>Kamailio - Flag Operations</a></li></ul><p>Example of usage:</p><pre><code>  if(isflagset(3)) {
      log(&quot;flag 3 is set\n&quot;);
  };
</code></pre><p>Kamailio also supports named flags. They have to be declared at the
beginning of the config file with:</p><pre><code> flags  flag1_name[:position],  flag2_name ...
</code></pre><p>Example:</p><pre><code>     flags test, a:1, b:2 ;
     route{
            setflag(test);
            if (isflagset(a)){ # equiv. to isflagset(1)
              ....
            }
            resetflag(b);  # equiv. to resetflag(2)
</code></pre><h1 id=15-is_int->15. is_int ⭐️<a hidden class=anchor aria-hidden=true href=#15-is_int->#</a></h1><p>Checks if a pseudo variable argument contains integer value.</p><pre><code>if(is_int(&quot;$avp(foobar)&quot;)) {
  log(&quot;foobar contains an integer\n&quot;);
}
</code></pre><h1 id=16-log>16. log<a hidden class=anchor aria-hidden=true href=#16-log>#</a></h1><p>Write text message to standard error terminal or syslog. You can specify
the log level as first parameter.</p><p>For more see:
<a href=http://www.kamailio.org/dokuwiki/doku.php/tutorials:debug-syslog-messages>http://www.kamailio.org/dokuwiki/doku.php/tutorials:debug-syslog-messages</a></p><p>Example of usage:</p><pre><code>  log(&quot;just some text message\n&quot;);
</code></pre><h1 id=17-prefix>17. prefix<a hidden class=anchor aria-hidden=true href=#17-prefix>#</a></h1><p>Add the string parameter in front of username in R-URI.</p><p>Example of usage:</p><pre><code>  prefix(&quot;00&quot;);
</code></pre><h1 id=18-resetavpflag>18. resetavpflag<a hidden class=anchor aria-hidden=true href=#18-resetavpflag>#</a></h1><h1 id=19-resetflag>19. resetflag<a hidden class=anchor aria-hidden=true href=#19-resetflag>#</a></h1><h1 id=20-return->20. return ⭐️<a hidden class=anchor aria-hidden=true href=#20-return->#</a></h1><p>The return() function allows you to return any integer value from a
called route() block. You can test the value returned by a route using
<a href=pseudovariables.md#$rc><code>$retcode</code></a> or <code>$?</code> variable.</p><p><code>return(0)</code> is same as <a href=#exit><code>exit()</code></a>;</p><p>In bool expressions:</p><ul><li>Negative is FALSE</li><li>Positive is TRUE</li></ul><p>If no value is specified, it returns 1. If return is used in the top level route
is equivalent with exit <code>[val]</code>. If no <code>return</code> is at the end of the routing block,
the return code is the value of the last executed action, therefore it is highly
recommended to return an explicit value (e.g., <code>return(1)</code>) to avoid unexpected
config execution.</p><p>Example usage:</p><pre><code>route {
  if (route(2)) {
    xlog(&quot;L_NOTICE&quot;,&quot;method $rm is INVITE\n&quot;);
  } else {
    xlog(&quot;L_NOTICE&quot;,&quot;method $rm is REGISTER\n&quot;);
  };
}

route[2] {
  if (is_method(&quot;INVITE&quot;)) {
    return(1);
  } else if (is_method(&quot;REGISTER&quot;)) {
    return(-1);
  } else {
    return(0);
  };
}
</code></pre><p>See also the FAQ for how the function return code is evaluated:</p><ul><li><a href=../tutorials/../../tutorials/faq/main.md#how-is-the-function-return-code-evaluated>Frequently Asked Questions</a></li></ul><h1 id=21-revert_uri->21. revert_uri ⭐️<a hidden class=anchor aria-hidden=true href=#21-revert_uri->#</a></h1><p>Set the R-URI to the value of the R-URI as it was when the request was
received by server (undo all changes of R-URI).</p><p>Example of usage:</p><pre><code>  revert_uri();
</code></pre><h1 id=22-rewritehostport->22. rewritehostport ⭐️<a hidden class=anchor aria-hidden=true href=#22-rewritehostport->#</a></h1><p><strong>Alias name:</strong> <strong>sethostport, sethp</strong></p><p>Rewrite the domain part and port of the R-URI with the value of
function&rsquo;s parameter. Other parts of the R-URI like username and URI
parameters remain unchanged.</p><p>Example of usage:</p><pre><code>  rewritehostport(&quot;1.2.3.4:5080&quot;);
</code></pre><h1 id=23-rewritehostporttrans->23. rewritehostporttrans ⭐️<a hidden class=anchor aria-hidden=true href=#23-rewritehostporttrans->#</a></h1><p><strong>Alias name:</strong> <strong>sethostporttrans, sethpt</strong></p><p>Rewrite the domain part and port of the R-URI with the value of
function&rsquo;s parameter. Also allows to specify the transport parameter.
Other parts of the R-URI like username and URI parameters remain
unchanged.</p><p>Example of usage:</p><pre><code>  rewritehostporttrans(&quot;1.2.3.4:5080&quot;);
</code></pre><h1 id=24-rewritehost->24. rewritehost ⭐️<a hidden class=anchor aria-hidden=true href=#24-rewritehost->#</a></h1><p><strong>Alias name:</strong> <strong>sethost, seth</strong></p><p>Rewrite the domain part of the R-URI with the value of function&rsquo;s
parameter. Other parts of the R-URI like username, port and URI
parameters remain unchanged.</p><p>Example of usage:</p><pre><code>  rewritehost(&quot;1.2.3.4&quot;);
</code></pre><h1 id=25-rewriteport->25. rewriteport ⭐️<a hidden class=anchor aria-hidden=true href=#25-rewriteport->#</a></h1><p><strong>Alias name:</strong> <strong>setport, setp</strong></p><p>Rewrites/sets the port part of the R-URI with the value of function&rsquo;s
parameter.</p><p>Example of usage:</p><pre><code>  rewriteport(&quot;5070&quot;);
</code></pre><h1 id=26-rewriteuri->26. rewriteuri ⭐️<a hidden class=anchor aria-hidden=true href=#26-rewriteuri->#</a></h1><p><strong>Alias name:</strong> <strong>seturi</strong></p><p>Rewrite the request URI.</p><p>Example of usage:</p><pre><code>  rewriteuri(&quot;sip:test@kamailio.org&quot;);
</code></pre><h1 id=27-rewriteuserpass->27. rewriteuserpass ⭐️<a hidden class=anchor aria-hidden=true href=#27-rewriteuserpass->#</a></h1><p><strong>Alias name:</strong> <strong>setuserpass, setup</strong></p><p>Rewrite the password part of the R-URI with the value of function&rsquo;s
parameter.</p><p>Example of usage:</p><pre><code>  rewriteuserpass(&quot;my_secret_passwd&quot;);
</code></pre><h1 id=28-rewriteuser->28. rewriteuser ⭐️<a hidden class=anchor aria-hidden=true href=#28-rewriteuser->#</a></h1><p><strong>Alias name:</strong> <strong>setuser, setu</strong></p><p>Rewrite the user part of the R-URI with the value of function&rsquo;s
parameter.</p><p>Example of usage:</p><pre><code>  rewriteuser(&quot;newuser&quot;);
</code></pre><h1 id=29-route->29. route ⭐️<a hidden class=anchor aria-hidden=true href=#29-route->#</a></h1><p>Execute route block given in parameter. Parameter may be name of the
block or a string valued expression.</p><p>Examples of usage:</p><pre><code>  route(REGISTER_REQUEST);
  route(@received.proto + &quot;_proto_&quot; + $var(route_set));
</code></pre><h1 id=30-selval->30. selval ⭐️<a hidden class=anchor aria-hidden=true href=#30-selval->#</a></h1><p>Select a value based on conditional expression.</p><p>Prototype:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#a6e22e>selval</span>(evalexpr, valexp1, valexpr2)
</span></span></code></pre></div><p>This is a core statement that return the 2nd parameter if the 1st
parameter is evaluated to true, or 3rd parameter if the 1st parameter is
evaluated to false. It can be considered a core function that is
equivalent of ternary condition/operator</p><p>Example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>$</span><span style=color:#a6e22e>var</span>(x) <span style=color:#f92672>=</span> <span style=color:#a6e22e>selval</span>(<span style=color:#960050;background-color:#1e0010>$</span>Ts mod <span style=color:#ae81ff>2</span>, <span style=color:#e6db74>&#34;true/&#34;</span> <span style=color:#f92672>+</span> <span style=color:#960050;background-color:#1e0010>$</span>ru, <span style=color:#e6db74>&#34;false/&#34;</span> <span style=color:#f92672>+</span> <span style=color:#960050;background-color:#1e0010>$</span>rd);
</span></span></code></pre></div><p>The first parameter is a conditional expression, like those used for IF,
the 2nd and 3rd parameters can be expressions like those used in the
right side of assignments.</p><h1 id=31-set_advertised_address->31. set_advertised_address ⭐️<a hidden class=anchor aria-hidden=true href=#31-set_advertised_address->#</a></h1><p>Same as <code>advertised_address</code> but it affects only the current message. It
has priority if <code>advertised_address</code> is also set.</p><p>Example of usage:</p><pre><code>  set_advertised_address(&quot;kamailio.org&quot;);
</code></pre><h1 id=32-set_advertised_port->32. set_advertised_port ⭐️<a hidden class=anchor aria-hidden=true href=#32-set_advertised_port->#</a></h1><p>Same as <code>advertised_port</code> but it affects only the current message. It
has priority over <code>advertised_port</code>.</p><p>Example of usage:</p><pre><code>  set_advertised_port(5080);
</code></pre><h1 id=33-set_forward_no_connect>33. set_forward_no_connect<a hidden class=anchor aria-hidden=true href=#33-set_forward_no_connect>#</a></h1><p>The message will be forwarded only if there is already an existing
connection to the destination. It applies only to connection oriented
protocols like TCP and TLS (TODO: SCTP), for UDP it will be ignored. The
behavior depends in which route block the function is called:</p><ul><li>normal request route: affects stateless forwards and tm. For tm it
affects all the branches and the possible retransmissions (in fact
there are no retransmission for TCP/TLS).</li></ul><ul><li><code>onreply_route[0]</code> (stateless): equivalent to <code>set_reply_*()</code> (it&rsquo;s
better to use <code>set_reply_*</code> though)</li></ul><ul><li><code>onreply_route[!=0]</code> (tm): ignored</li></ul><ul><li>branch_route: affects the current branch only (all messages sent on
this branch, like possible retransmissions and CANCELs).</li></ul><ul><li>onsend_route: like branch route</li></ul><p>Example of usage:</p><pre><code>  route {
    ...
    if (lookup()) {
      //requests to local users. They are usually behind NAT so it does not make sense to try
      //to establish a new TCP connection
      set_forward_no_connect();
      t_relay();
    }
    ...
  }
</code></pre><h1 id=34-set_forward_close>34. set_forward_close<a hidden class=anchor aria-hidden=true href=#34-set_forward_close>#</a></h1><p>Try to close the connection (the one on which the message is sent out)
after forwarding the current message. Can be used in same route blocks
as <code>set_forward_no_connect()</code>.</p><p>Note: Use with care as you might not receive the replies anymore as the
connection is closed.</p><h1 id=35-set_reply_no_connect>35. set_reply_no_connect<a hidden class=anchor aria-hidden=true href=#35-set_reply_no_connect>#</a></h1><p>Like <code>set_forward_no_connect()</code>, but for replies to the current message
(local generated replies and replies forwarded by tm). The behavior
depends in which route block the function is called:</p><ul><li>normal request route: affects all replies sent back on the
transaction (either local or forwarded) and all local stateless
replies (<code>sl_reply()</code>).</li></ul><ul><li><code>onreply_route</code>: affects the current reply (so the send_flags set in
the <code>onreply_route</code> will be used if the reply for which they were set
is the winning final reply or it&rsquo;s a provisional reply that is
forwarded)</li></ul><ul><li>branch_route: ignored.</li></ul><ul><li>onsend_route: ignored</li></ul><p>Example of usage:</p><pre><code>  route[4] {
    //requests from local users. There are usually behind NAT so it does not make sense to try
    //to establish a new TCP connection for the replies
    set_reply_no_connect();
    // do authentication and call routing
    ...
  }
</code></pre><h1 id=36-set_reply_close>36. set_reply_close<a hidden class=anchor aria-hidden=true href=#36-set_reply_close>#</a></h1><p>Like <code>set_reply_no_connect</code>, but closes the TCP connection after sending.
Can be used in same route blocks as <code>set_reply_no_connect</code>.</p><p>Example of usage:</p><pre><code>  route {
    ...
    if (...caller-is-not-registered...) {
      // reject unregistered client
      // if request was received via TCP/TLS close the connection, as
      // this may trigger re-registration of the client.
      set_reply_close();
      sl_send_reply(&quot;403&quot;,&quot;REGISTER first&quot;);
      exit;
    }
    ...
  }
</code></pre><h1 id=37-setavpflag>37. setavpflag<a hidden class=anchor aria-hidden=true href=#37-setavpflag>#</a></h1><h1 id=38-setflag->38. setflag ⭐️<a hidden class=anchor aria-hidden=true href=#38-setflag->#</a></h1><p>Set a flag for current processed message. The value of the parameter can
be in range of 0..31. The flags are used to mark the message for special
processing (e.g., accounting) or to keep some state (e.g., message
authenticated).</p><p>For more see:</p><ul><li><a href=../../tutorials/kamailio-flag-operations.md>Kamailio - Flag Operations</a></li></ul><p>Example of usage:</p><pre><code>  setflag(3);
</code></pre><h1 id=39-strip->39. strip ⭐️<a hidden class=anchor aria-hidden=true href=#39-strip->#</a></h1><p>Strip the first N-th characters from username of R-URI (N is the value
of the parameter).</p><p>Example of usage:</p><pre><code>  strip(3);
</code></pre><h1 id=40-strip_tail>40. strip_tail<a hidden class=anchor aria-hidden=true href=#40-strip_tail>#</a></h1><p>Strip the last N-th characters from username of R-URI (N is the value of
the parameter).</p><p>Example of usage:</p><pre><code>strip_tail(3);
</code></pre><h1 id=41-udp_mtu_try_protoproto>41. udp_mtu_try_proto(proto)<a hidden class=anchor aria-hidden=true href=#41-udp_mtu_try_protoproto>#</a></h1><ul><li>proto - <code>TCP|TLS|SCTP|UDP</code> - like <code>udp_mtu_try_proto</code> global
parameter but works on a per packet basis and not globally.</li></ul><p>Example:</p><pre><code>if($rd==&quot;10.10.10.10&quot;)
    udp_mtu_try_proto(SCTP);
</code></pre><h1 id=42-userphone>42. userphone<a hidden class=anchor aria-hidden=true href=#42-userphone>#</a></h1><p>Add &ldquo;user=phone&rdquo; parameter to R-URI.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://wdd.js.org/tags/all/>All</a></li></ul></footer><script src=https://giscus.app/client.js data-repo=wangduanduan/wangduanduan.github.io data-repo-id="MDEwOlJlcG9zaXRvcnkxMTkyMjMyNjA=" data-category=Announcements data-category-id=DIC_kwDOBxsz3M4CAjBq data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=zh-CN crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2025 <a href=https://wdd.js.org/>洞香春</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>