<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>1.7 DNS 参数 | 洞香春</title>
<meta name=keywords content="all"><meta name=description content="Note: See also file doc/tutorials/dns.txt for details about Kamailio&rsquo;s
DNS client.
Kamailio has an internal DNS resolver with caching capabilities. If this
caching resolver is activated (default setting) then the system&rsquo;s stub
resolver won&rsquo;t be used. Thus, also local name resolution configuration
like /etc/hosts entries will not be used. If the DNS cache is
deactivated (use_dns_cache=no), then system&rsquo;s resolver will be used. The
DNS failover functionality in the tm module references directly records
in the DNS cache (which saves a lot of memory) and hence DNS based
failover only works if the internal DNS cache is enabled."><meta name=author content="Eddie Wang"><link rel=canonical href=https://wdd.js.org/kamailio/56/dns-params/><link crossorigin=anonymous href=/assets/css/stylesheet.821c51435cba3e33e49e590a06514c54c32ac7957095ffcc1e0f390c47cf3228.css integrity="sha256-ghxRQ1y6PjPknlkKBlFMVMMqx5Vwlf/MHg85DEfPMig=" rel="preload stylesheet" as=style><link rel=icon href=https://wdd.js.org/cowboy.ico><link rel=icon type=image/png sizes=16x16 href=https://wdd.js.org/cowboy.ico><link rel=icon type=image/png sizes=32x32 href=https://wdd.js.org/cowboy.ico><link rel=apple-touch-icon href=https://wdd.js.org/cowboy.ico><link rel=mask-icon href=https://wdd.js.org/cowboy.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://wdd.js.org/kamailio/56/dns-params/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:url" content="https://wdd.js.org/kamailio/56/dns-params/"><meta property="og:site_name" content="洞香春"><meta property="og:title" content="1.7 DNS 参数"><meta property="og:description" content="Note: See also file doc/tutorials/dns.txt for details about Kamailio’s DNS client.
Kamailio has an internal DNS resolver with caching capabilities. If this caching resolver is activated (default setting) then the system’s stub resolver won’t be used. Thus, also local name resolution configuration like /etc/hosts entries will not be used. If the DNS cache is deactivated (use_dns_cache=no), then system’s resolver will be used. The DNS failover functionality in the tm module references directly records in the DNS cache (which saves a lot of memory) and hence DNS based failover only works if the internal DNS cache is enabled."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="kamailio"><meta property="article:tag" content="All"><meta property="og:image" content="https://wdd.js.org/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://wdd.js.org/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="1.7 DNS 参数"><meta name=twitter:description content="Note: See also file doc/tutorials/dns.txt for details about Kamailio&rsquo;s
DNS client.
Kamailio has an internal DNS resolver with caching capabilities. If this
caching resolver is activated (default setting) then the system&rsquo;s stub
resolver won&rsquo;t be used. Thus, also local name resolution configuration
like /etc/hosts entries will not be used. If the DNS cache is
deactivated (use_dns_cache=no), then system&rsquo;s resolver will be used. The
DNS failover functionality in the tm module references directly records
in the DNS cache (which saves a lot of memory) and hence DNS based
failover only works if the internal DNS cache is enabled."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"新朋友 - kamailio学习笔记","item":"https://wdd.js.org/kamailio/"},{"@type":"ListItem","position":2,"name":"Kamailio 5.6 Wiki","item":"https://wdd.js.org/kamailio/56/"},{"@type":"ListItem","position":3,"name":"1.7 DNS 参数","item":"https://wdd.js.org/kamailio/56/dns-params/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"1.7 DNS 参数","name":"1.7 DNS 参数","description":"Note: See also file doc/tutorials/dns.txt for details about Kamailio\u0026rsquo;s DNS client.\nKamailio has an internal DNS resolver with caching capabilities. If this caching resolver is activated (default setting) then the system\u0026rsquo;s stub resolver won\u0026rsquo;t be used. Thus, also local name resolution configuration like /etc/hosts entries will not be used. If the DNS cache is deactivated (use_dns_cache=no), then system\u0026rsquo;s resolver will be used. The DNS failover functionality in the tm module references directly records in the DNS cache (which saves a lot of memory) and hence DNS based failover only works if the internal DNS cache is enabled.\n","keywords":["all"],"articleBody":"Note: See also file doc/tutorials/dns.txt for details about Kamailio’s DNS client.\nKamailio has an internal DNS resolver with caching capabilities. If this caching resolver is activated (default setting) then the system’s stub resolver won’t be used. Thus, also local name resolution configuration like /etc/hosts entries will not be used. If the DNS cache is deactivated (use_dns_cache=no), then system’s resolver will be used. The DNS failover functionality in the tm module references directly records in the DNS cache (which saves a lot of memory) and hence DNS based failover only works if the internal DNS cache is enabled.\nDNS resolver comparison internal resolver system resolver Caching of resolved records yes no* NAPTR/SRV lookups with correct weighting yes yes DNS based failover yes no * Of course you can use the resolving name servers configured in /etc/resolv.conf as caching nameservers.\nIf the internal resolver/cache is enabled you can add/remove records by hand (using kamcmd or xmlrpc) using the DNS RPCs, e.g. dns.add_a, dns.add_srv, dns.delete_a a.s.o. For more info on DNS RPCs see http://www.kamailio.org/docs/docbooks/devel/rpc_list/rpc_list.html#dns.add_a\nNote: During startup of Kamailio, before the internal resolver is loaded, the system resolver will be used (it will be used for queries done from module register functions or modparams fixups, but not for queries done from mod_init() or normal fixups).\nNote: The dns cache uses the DNS servers configured on your server (/etc/resolv.conf), therefore even if you use the internal resolver you should have a working DNS resolving configuration on your server.\nKamailio also allows you to finetune the DNS resolver settings.\nThe maximum time a dns request can take (before failing) is (if dns_try_ipv6 is yes, multiply it again by 2; if SRV and NAPTR lookups are enabled, it can take even longer!):\n(dns_retr_time*(dns_retr_no+1)*dns_servers_no)*(search_list_domains) Note: During DNS lookups, the process which performs the DNS lookup blocks. To minimize the blocked time the following parameters can be used (max 2s):\ndns_try_ipv6=no dns_retr_time=1 dns_retr_no=1 dns_use_search_list=no 1. dns This parameter controls if the SIP server will try doing a DNS lookup on the address in the Via header of a received sip request to decide if adding a received= parameter to the Via is necessary. Note that Vias containing DNS names (instead of IPs) should have received= added, so turning dns to yes is not recommended.\nDefault is no.\n2. rev_dns This parameter controls if the SIP server will try doing a reverse DNS lookup on the source IP of a sip request to decide if adding a received= parameter to the Via is necessary (if the Via contains a DNS name instead of an IP address, the result of the reverse dns on the source IP will be compared with the DNS name in the Via). See also dns (the effect is cumulative, both can be turned on and in that case if the DNS lookup test fails the reverse DNS test will be tried). Note that Vias containing DNS names (instead of IPs) should have received= added, so turning rev_dns to yes is not recommended.\nDefault is no.\n3. dns_cache_del_nonexp Alias name: dns_cache_delete_nonexpired\ndns_cache_del_nonexp = yes | no (default: no) allow deletion of non-expired records from the cache when there is no more space left for new ones. The last-recently used entries are deleted first. 4. dns_cache_rec_pref dns_cache_rec_pref = number (default 0) dns cache record preference, determines how new DNS records are stored internally in relation to existing entries. Possible values: 0 - do not check duplicates 1 - prefer old records 2 - prefer new records 3 - prefer records with longer lifetime 5. dns_cache_flags dns_cache_flags = number (default 0) - dns cache specific resolver flags, used for overriding the default behaviour (low level). Possible values: 1 - ipv4 only: only DNS A requests are performed, even if Kamailio also listens on ipv6 addresses. 2 - ipv6 only: only DNS AAAA requests are performed. Ignored if dns_try_ipv6 is off or Kamailio doesn't listen on any ipv6 address. 4 - prefer ipv6: try first to resolve a host name to an ipv6 address (DNS AAAA request) and only if this fails try an ipv4 address (DNS A request). By default the ipv4 addresses are preferred. 6. dns_cache_gc_interval Interval in seconds after which the dns cache is garbage collected (default: 120 s)\ndns_cache_gc_interval = number 7. dns_cache_init If off, the dns cache is not initialized at startup and cannot be enabled at runtime, this saves some memory.\ndns_cache_init = on | off (default on) 8. dns_cache_max_ttl dns_cache_max_ttl = time in seconds (default MAXINT) 9. dns_cache_mem Maximum memory used for the dns cache in KB (default 500 K)\ndns_cache_mem = number 10. dns_cache_min_ttl dns_cache_min_ttl = time in seconds (default 0) 11. dns_cache_negative_ttl Tells how long to keep negative DNS responses in cache. If set to 0, disables caching of negative responses. Default is 60 (seconds).\n12. dns_naptr_ignore_rfc If the DNS lookup should ignore the remote side’s protocol preferences, as indicated by the Order field in the NAPTR records and mandated by RFC 2915.\ndns_naptr_ignore_rfc = yes | no (default yes) 13. dns_retr_no Number of dns retransmissions before giving up. Default value is system specific, depends also on the ‘/etc/resolv.conf’ content (usually 4).\nExample of usage:\ndns_retr_no=3 14. dns_retr_time Time in seconds before retrying a dns request. Default value is system specific, depends also on the ‘/etc/resolv.conf’ content (usually 5s).\nExample of usage:\ndns_retr_time=3 15. dns_search_full_match When name was resolved using dns search list, check the domain added in the answer matches with one from the search list (small performance hit, but more safe)\ndns_search_full_match = yes | no (default yes) 16. dns_servers_no How many dns servers from the ones defined in ‘/etc/resolv.conf’ will be used. Default value is to use all of them.\nExample of usage:\ndns_servers_no=2 17. dns_srv_lb Alias name: dns_srv_loadbalancing\nEnable dns srv weight based load balancing (see doc/tutorials/dns.txt)\ndns_srv_lb = yes | no (default no) 18. dns_try_ipv6 Can be ‘yes’ or ’no’. If it is set to ‘yes’ and a DNS lookup fails, it will retry it for ipv6 (AAAA record). Default value is ’no’.\nNote: If dns_try_ipv6 is off, no hostname resolving that would result in an ipv6 address would succeed - it doesn’t matter if an actual DNS lookup is to be performed or the host is already an ip address. Thus, if the proxy should forward requests to IPv6 targets, this option must be turned on!\nExample of usage:\ndns_try_ipv6=yes 19. dns_try_naptr Enable NAPTR support according to RFC 3263 (see doc/tutorials/dns.txt for more info)\ndns_try_naptr = yes | no (default no) 20. dns_sctp_pref, dns_tcp_pref, dns_tls_pref, dns_udp_pref Alias name: dns_sctp_preference, dns_tcp_preference, dns_tls_preference, dns_udp_preference\nSet preference for each protocol when doing naptr lookups. By default dns_udp_pref=30, dns_tcp_pref=20, dns_tls_pref=10 and dns_sctp_pref=20. To use the remote site preferences set all dns_*_pref to the same positive value (e.g. dns_udp_pref=1, dns_tcp_pref=1, dns_tls_pref=1, dns_sctp_pref=1). To completely ignore NAPTR records for a specific protocol, set the corresponding protocol preference to -1 (or any other negative number). (see doc/tutorials/dns.txt for more info)\ndns_{udp,tcp,tls,sctp}_pref = number 21. dns_use_search_list Can be ‘yes’ or ’no’. If set to ’no’, the search list in ‘/etc/resolv.conf’ will be ignored (=\u003e fewer lookups =\u003e gives up faster). Default value is ‘yes’.\nHINT: even if you don’t have a search list defined, setting this option to ’no’ will still be “faster”, because an empty search list is in fact search \"\" (so even if the search list is empty/missing there will still be 2 dns queries, eg. foo+’.’ and foo+\"\"+’.’)\nExample of usage:\ndns_use_search_list=no 22. use_dns_cache Tells if DNS responses are cached - this means that the internal DNS resolver (instead of the system’s stub resolver) will be used. If set to “off”, disables caching of DNS responses and, as side effect, DNS failover. Default is “on”. Settings can be changed also during runtime (switch from internal to system resolver and back).\n23. use_dns_failover use_dns_failover = on | off (default off)\n","wordCount":"1301","inLanguage":"en","image":"https://wdd.js.org/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","author":{"@type":"Person","name":"Eddie Wang"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://wdd.js.org/kamailio/56/dns-params/"},"publisher":{"@type":"Organization","name":"洞香春","logo":{"@type":"ImageObject","url":"https://wdd.js.org/cowboy.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://wdd.js.org/ accesskey=h title="洞香春 (Alt + H)"><img src=https://wdd.js.org/cowboy.ico alt aria-label=logo height=35>洞香春</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://wdd.js.org/books/ title=读书><span>读书</span></a></li><li><a href=https://wdd.js.org/freeswitch/ title=FreeSWITCH><span>FreeSWITCH</span></a></li><li><a href=https://wdd.js.org/kamailio/ title=Kamailio><span>Kamailio</span></a></li><li><a href=https://wdd.js.org/opensips/ title=OpenSIPS><span>OpenSIPS</span></a></li><li><a href=https://wdd.js.org/vim/ title=VIM><span>VIM</span></a></li><li><a href=https://wdd.js.org/categories/ title=分类><span>分类</span></a></li><li><a href=https://wdd.js.org/fe/ title=前端><span>前端</span></a></li><li><a href=https://wdd.js.org/search/ title=搜索><span>搜索</span></a></li><li><a href=https://wdd.js.org/tags/ title=标签><span>标签</span></a></li><li><a href=https://wdd.js.org/archives/ title=归档><span>归档</span></a></li><li><a href=https://wdd.js.org/about/ title=我><span>我</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://wdd.js.org/>Home</a>&nbsp;»&nbsp;<a href=https://wdd.js.org/kamailio/>新朋友 - kamailio学习笔记</a>&nbsp;»&nbsp;<a href=https://wdd.js.org/kamailio/56/>Kamailio 5.6 Wiki</a></div><h1 class="post-title entry-hint-parent">1.7 DNS 参数</h1><div class=post-meta>7 min&nbsp;·&nbsp;Eddie Wang&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/kamailio/56/dns-params/index.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#1-dns aria-label="1. dns">1. dns</a></li><li><a href=#2-rev_dns aria-label="2. rev_dns">2. rev_dns</a></li><li><a href=#3-dns_cache_del_nonexp aria-label="3. dns_cache_del_nonexp">3. dns_cache_del_nonexp</a></li><li><a href=#4-dns_cache_rec_pref aria-label="4. dns_cache_rec_pref">4. dns_cache_rec_pref</a></li><li><a href=#5-dns_cache_flags aria-label="5. dns_cache_flags">5. dns_cache_flags</a></li><li><a href=#6-dns_cache_gc_interval aria-label="6. dns_cache_gc_interval">6. dns_cache_gc_interval</a></li><li><a href=#7-dns_cache_init aria-label="7. dns_cache_init">7. dns_cache_init</a></li><li><a href=#8-dns_cache_max_ttl aria-label="8. dns_cache_max_ttl">8. dns_cache_max_ttl</a></li><li><a href=#9-dns_cache_mem aria-label="9. dns_cache_mem">9. dns_cache_mem</a></li><li><a href=#10-dns_cache_min_ttl aria-label="10. dns_cache_min_ttl">10. dns_cache_min_ttl</a></li><li><a href=#11-dns_cache_negative_ttl aria-label="11. dns_cache_negative_ttl">11. dns_cache_negative_ttl</a></li><li><a href=#12-dns_naptr_ignore_rfc aria-label="12. dns_naptr_ignore_rfc">12. dns_naptr_ignore_rfc</a></li><li><a href=#13-dns_retr_no aria-label="13. dns_retr_no">13. dns_retr_no</a></li><li><a href=#14-dns_retr_time aria-label="14. dns_retr_time">14. dns_retr_time</a></li><li><a href=#15-dns_search_full_match aria-label="15. dns_search_full_match">15. dns_search_full_match</a></li><li><a href=#16-dns_servers_no aria-label="16. dns_servers_no">16. dns_servers_no</a></li><li><a href=#17-dns_srv_lb aria-label="17. dns_srv_lb">17. dns_srv_lb</a></li><li><a href=#18-dns_try_ipv6 aria-label="18. dns_try_ipv6">18. dns_try_ipv6</a></li><li><a href=#19-dns_try_naptr aria-label="19. dns_try_naptr">19. dns_try_naptr</a></li><li><a href=#20-dns_sctp_pref-dns_tcp_pref-dns_tls_pref-dns_udp_pref aria-label="20. dns_sctp_pref, dns_tcp_pref, dns_tls_pref, dns_udp_pref">20. dns_sctp_pref, dns_tcp_pref, dns_tls_pref, dns_udp_pref</a></li><li><a href=#21-dns_use_search_list aria-label="21. dns_use_search_list">21. dns_use_search_list</a></li><li><a href=#22-use_dns_cache aria-label="22. use_dns_cache">22. use_dns_cache</a></li><li><a href=#23-use_dns_failover aria-label="23. use_dns_failover">23. use_dns_failover</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p>Note: See also file doc/tutorials/dns.txt for details about Kamailio&rsquo;s
DNS client.</p><p>Kamailio has an internal DNS resolver with caching capabilities. If this
caching resolver is activated (default setting) then the system&rsquo;s stub
resolver won&rsquo;t be used. Thus, also local name resolution configuration
like /etc/hosts entries will not be used. If the DNS cache is
deactivated (use_dns_cache=no), then system&rsquo;s resolver will be used. The
DNS failover functionality in the tm module references directly records
in the DNS cache (which saves a lot of memory) and hence DNS based
failover only works if the internal DNS cache is enabled.</p><table><thead><tr><th>DNS resolver comparison</th><th>internal resolver</th><th>system resolver</th></tr></thead><tbody><tr><td>Caching of resolved records</td><td>yes</td><td>no*</td></tr><tr><td>NAPTR/SRV lookups with correct weighting</td><td>yes</td><td>yes</td></tr><tr><td>DNS based failover</td><td>yes</td><td>no</td></tr></tbody></table><p>* Of course you can use the resolving name servers configured in
/etc/resolv.conf as caching nameservers.</p><p>If the internal resolver/cache is enabled you can add/remove records by
hand (using kamcmd or xmlrpc) using the DNS RPCs, e.g. dns.add_a,
dns.add_srv, dns.delete_a a.s.o. For more info on DNS RPCs see
<a href=http://www.kamailio.org/docs/docbooks/devel/rpc_list/rpc_list.html#dns.add_a>http://www.kamailio.org/docs/docbooks/devel/rpc_list/rpc_list.html#dns.add_a</a></p><p>Note: During startup of Kamailio, before the internal resolver is
loaded, the system resolver will be used (it will be used for queries
done from module register functions or modparams fixups, but not for
queries done from mod_init() or normal fixups).</p><p>Note: The dns cache uses the DNS servers configured on your server
(/etc/resolv.conf), therefore even if you use the internal resolver you
should have a working DNS resolving configuration on your server.</p><p>Kamailio also allows you to finetune the DNS resolver settings.</p><p>The maximum time a dns request can take (before failing) is (if
dns_try_ipv6 is yes, multiply it again by 2; if SRV and NAPTR lookups
are enabled, it can take even longer!):</p><pre><code>(dns_retr_time*(dns_retr_no+1)*dns_servers_no)*(search_list_domains)
</code></pre><p>Note: During DNS lookups, the process which performs the DNS lookup
blocks. To minimize the blocked time the following parameters can be
used (max 2s):</p><pre><code>dns_try_ipv6=no
dns_retr_time=1
dns_retr_no=1
dns_use_search_list=no
</code></pre><h1 id=1-dns>1. dns<a hidden class=anchor aria-hidden=true href=#1-dns>#</a></h1><p>This parameter controls if the SIP server will try doing a DNS lookup on
the address in the Via header of a received sip request to decide if
adding a received=&lt;src_ip> parameter to the Via is necessary. Note that
Vias containing DNS names (instead of IPs) should have received= added,
so turning dns to yes is not recommended.</p><p>Default is no.</p><h1 id=2-rev_dns>2. rev_dns<a hidden class=anchor aria-hidden=true href=#2-rev_dns>#</a></h1><p>This parameter controls if the SIP server will try doing a reverse DNS
lookup on the source IP of a sip request to decide if adding a
received=&lt;src_ip> parameter to the Via is necessary (if the Via
contains a DNS name instead of an IP address, the result of the reverse
dns on the source IP will be compared with the DNS name in the Via). See
also dns (the effect is cumulative, both can be turned on and in that
case if the DNS lookup test fails the reverse DNS test will be tried).
Note that Vias containing DNS names (instead of IPs) should have
received= added, so turning rev_dns to yes is not recommended.</p><p>Default is no.</p><h1 id=3-dns_cache_del_nonexp>3. dns_cache_del_nonexp<a hidden class=anchor aria-hidden=true href=#3-dns_cache_del_nonexp>#</a></h1><p><strong>Alias name:</strong> <strong>dns_cache_delete_nonexpired</strong></p><pre><code>dns_cache_del_nonexp = yes | no (default: no)
  allow deletion of non-expired records from the cache when there is no more space
  left for new ones. The last-recently used entries are deleted first.
</code></pre><h1 id=4-dns_cache_rec_pref>4. dns_cache_rec_pref<a hidden class=anchor aria-hidden=true href=#4-dns_cache_rec_pref>#</a></h1><pre><code>dns_cache_rec_pref = number (default 0)
  dns cache record preference, determines how new DNS records are stored internally in relation to existing entries.
  Possible values:
    0 - do not check duplicates
    1 - prefer old records
    2 - prefer new records
    3 - prefer records with longer lifetime
</code></pre><h1 id=5-dns_cache_flags>5. dns_cache_flags<a hidden class=anchor aria-hidden=true href=#5-dns_cache_flags>#</a></h1><pre><code>dns_cache_flags = number (default 0) -
  dns cache specific resolver flags, used for overriding the default behaviour (low level).
  Possible values:
    1 - ipv4 only: only DNS A requests are performed, even if Kamailio also listens on ipv6 addresses.
    2 - ipv6 only: only DNS AAAA requests are performed. Ignored if dns_try_ipv6 is off or Kamailio
        doesn't listen on any ipv6 address.
    4 - prefer ipv6: try first to resolve a host name to an ipv6 address (DNS AAAA request) and only
        if this fails try an ipv4 address (DNS A request). By default the ipv4 addresses are preferred.
</code></pre><h1 id=6-dns_cache_gc_interval>6. dns_cache_gc_interval<a hidden class=anchor aria-hidden=true href=#6-dns_cache_gc_interval>#</a></h1><p>Interval in seconds after which the dns cache is garbage collected
(default: 120 s)</p><pre><code>dns_cache_gc_interval = number
</code></pre><h1 id=7-dns_cache_init>7. dns_cache_init<a hidden class=anchor aria-hidden=true href=#7-dns_cache_init>#</a></h1><p>If off, the dns cache is not initialized at startup and cannot be
enabled at runtime, this saves some memory.</p><pre><code>dns_cache_init = on | off (default on)
</code></pre><h1 id=8-dns_cache_max_ttl>8. dns_cache_max_ttl<a hidden class=anchor aria-hidden=true href=#8-dns_cache_max_ttl>#</a></h1><pre><code>dns_cache_max_ttl = time in seconds (default MAXINT)
</code></pre><h1 id=9-dns_cache_mem>9. dns_cache_mem<a hidden class=anchor aria-hidden=true href=#9-dns_cache_mem>#</a></h1><p>Maximum memory used for the dns cache in KB (default 500 K)</p><pre><code>dns_cache_mem = number
</code></pre><h1 id=10-dns_cache_min_ttl>10. dns_cache_min_ttl<a hidden class=anchor aria-hidden=true href=#10-dns_cache_min_ttl>#</a></h1><pre><code>dns_cache_min_ttl = time in seconds (default 0)
</code></pre><h1 id=11-dns_cache_negative_ttl>11. dns_cache_negative_ttl<a hidden class=anchor aria-hidden=true href=#11-dns_cache_negative_ttl>#</a></h1><p>Tells how long to keep negative DNS responses in cache. If set to 0,
disables caching of negative responses. Default is 60 (seconds).</p><h1 id=12-dns_naptr_ignore_rfc>12. dns_naptr_ignore_rfc<a hidden class=anchor aria-hidden=true href=#12-dns_naptr_ignore_rfc>#</a></h1><p>If the DNS lookup should ignore the remote side&rsquo;s protocol preferences,
as indicated by the Order field in the NAPTR records and mandated by RFC
2915.</p><pre><code>  dns_naptr_ignore_rfc = yes | no (default yes)
</code></pre><h1 id=13-dns_retr_no>13. dns_retr_no<a hidden class=anchor aria-hidden=true href=#13-dns_retr_no>#</a></h1><p>Number of dns retransmissions before giving up. Default value is system
specific, depends also on the &lsquo;/etc/resolv.conf&rsquo; content (usually 4).</p><p>Example of usage:</p><pre><code>  dns_retr_no=3
</code></pre><h1 id=14-dns_retr_time>14. dns_retr_time<a hidden class=anchor aria-hidden=true href=#14-dns_retr_time>#</a></h1><p>Time in seconds before retrying a dns request. Default value is system
specific, depends also on the &lsquo;/etc/resolv.conf&rsquo; content (usually 5s).</p><p>Example of usage:</p><pre><code>  dns_retr_time=3
</code></pre><h1 id=15-dns_search_full_match>15. dns_search_full_match<a hidden class=anchor aria-hidden=true href=#15-dns_search_full_match>#</a></h1><p>When name was resolved using dns search list, check the domain added in
the answer matches with one from the search list (small performance hit,
but more safe)</p><pre><code>dns_search_full_match = yes | no (default yes)
</code></pre><h1 id=16-dns_servers_no>16. dns_servers_no<a hidden class=anchor aria-hidden=true href=#16-dns_servers_no>#</a></h1><p>How many dns servers from the ones defined in &lsquo;/etc/resolv.conf&rsquo; will be
used. Default value is to use all of them.</p><p>Example of usage:</p><pre><code>  dns_servers_no=2
</code></pre><h1 id=17-dns_srv_lb>17. dns_srv_lb<a hidden class=anchor aria-hidden=true href=#17-dns_srv_lb>#</a></h1><p><strong>Alias name:</strong> <strong>dns_srv_loadbalancing</strong></p><p>Enable dns srv weight based load balancing (see doc/tutorials/dns.txt)</p><pre><code>dns_srv_lb = yes | no (default no)
</code></pre><h1 id=18-dns_try_ipv6>18. dns_try_ipv6<a hidden class=anchor aria-hidden=true href=#18-dns_try_ipv6>#</a></h1><p>Can be &lsquo;yes&rsquo; or &rsquo;no&rsquo;. If it is set to &lsquo;yes&rsquo; and a DNS lookup fails, it
will retry it for ipv6 (AAAA record). Default value is &rsquo;no&rsquo;.</p><p>Note: If dns_try_ipv6 is off, no hostname resolving that would result in
an ipv6 address would succeed - it doesn&rsquo;t matter if an actual DNS
lookup is to be performed or the host is already an ip address. Thus, if
the proxy should forward requests to IPv6 targets, this option must be
turned on!</p><p>Example of usage:</p><pre><code>  dns_try_ipv6=yes
</code></pre><h1 id=19-dns_try_naptr>19. dns_try_naptr<a hidden class=anchor aria-hidden=true href=#19-dns_try_naptr>#</a></h1><p>Enable NAPTR support according to RFC 3263 (see doc/tutorials/dns.txt
for more info)</p><pre><code>dns_try_naptr = yes | no (default no)
</code></pre><h1 id=20-dns_sctp_pref-dns_tcp_pref-dns_tls_pref-dns_udp_pref>20. dns_sctp_pref, dns_tcp_pref, dns_tls_pref, dns_udp_pref<a hidden class=anchor aria-hidden=true href=#20-dns_sctp_pref-dns_tcp_pref-dns_tls_pref-dns_udp_pref>#</a></h1><p><strong>Alias name:</strong> <strong>dns_sctp_preference, dns_tcp_preference,
dns_tls_preference, dns_udp_preference</strong></p><p>Set preference for each protocol when doing naptr lookups. By default
dns_udp_pref=30, dns_tcp_pref=20, dns_tls_pref=10 and dns_sctp_pref=20.
To use the remote site preferences set all dns_*_pref to the same
positive value (e.g. dns_udp_pref=1, dns_tcp_pref=1, dns_tls_pref=1,
dns_sctp_pref=1). To completely ignore NAPTR records for a specific
protocol, set the corresponding protocol preference to -1 (or any other
negative number). (see doc/tutorials/dns.txt for more info)</p><pre><code>dns_{udp,tcp,tls,sctp}_pref = number
</code></pre><h1 id=21-dns_use_search_list>21. dns_use_search_list<a hidden class=anchor aria-hidden=true href=#21-dns_use_search_list>#</a></h1><p>Can be &lsquo;yes&rsquo; or &rsquo;no&rsquo;. If set to &rsquo;no&rsquo;, the search list in
&lsquo;/etc/resolv.conf&rsquo; will be ignored (=> fewer lookups => gives up
faster). Default value is &lsquo;yes&rsquo;.</p><p>HINT: even if you don&rsquo;t have a search list defined, setting this option
to &rsquo;no&rsquo; will still be &ldquo;faster&rdquo;, because an empty search list is in fact
search "" (so even if the search list is empty/missing there will still
be 2 dns queries, eg. foo+&rsquo;.&rsquo; and foo+""+&rsquo;.&rsquo;)</p><p>Example of usage:</p><pre><code>  dns_use_search_list=no
</code></pre><h1 id=22-use_dns_cache>22. use_dns_cache<a hidden class=anchor aria-hidden=true href=#22-use_dns_cache>#</a></h1><p>Tells if DNS responses are cached - this means that the internal DNS
resolver (instead of the system&rsquo;s stub resolver) will be used. If set to
&ldquo;off&rdquo;, disables caching of DNS responses and, as side effect, DNS
failover. Default is &ldquo;on&rdquo;. Settings can be changed also during runtime
(switch from internal to system resolver and back).</p><h1 id=23-use_dns_failover>23. use_dns_failover<a hidden class=anchor aria-hidden=true href=#23-use_dns_failover>#</a></h1><p>use_dns_failover = on | off (default off)</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://wdd.js.org/tags/all/>All</a></li></ul></footer><script src=https://giscus.app/client.js data-repo=wangduanduan/wangduanduan.github.io data-repo-id="MDEwOlJlcG9zaXRvcnkxMTkyMjMyNjA=" data-category=Announcements data-category-id=DIC_kwDOBxsz3M4CAjBq data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=zh-CN crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2025 <a href=https://wdd.js.org/>洞香春</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>