<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Sofia 模块全部配置 | 洞香春</title><meta name=keywords content="FreeSWITCH"><meta name=description content="About Sofia is a FreeSWITCH™ module (mod_sofia) that provides SIP connectivity to and from FreeSWITCH in the form of a User Agent. A &ldquo;User Agent&rdquo; (&ldquo;UA&rdquo;) is an application used for handling a certain network protocol; the network protocol in Sofia&rsquo;s case is SIP. Sofia is the general name of any User Agent in FreeSWITCH using the SIP network protocol. For example, Sofia receives calls sent to FreeSWITCH from other SIP User Agents (UAs), sends calls to other UAs, acts as a client to register FreeSWITCH with other UAs, lets clients register with FreeSWITCH, and connects calls (i."><meta name=author content="Eddie Wang"><link rel=canonical href=https://wdd.js.org/freeswitch/sofia-config/><link crossorigin=anonymous href=/assets/css/stylesheet.min.ceab085cbbf58c0ec96f6d415d51b3b44e204edfd71a45b4fa2d4aac13f119d0.css integrity="sha256-zqsIXLv1jA7Jb21BXVGztE4gTt/XGkW0+i1KrBPxGdA=" rel="preload stylesheet" as=style><link crossorigin=anonymous herf=/font-awesome/css/font-awesome.min.css rel=stylesheet type=text/css><link rel=preload href=/cowboy.ico as=image><script defer crossorigin=anonymous src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://wdd.js.org/cowboy.ico><link rel=icon type=image/png sizes=16x16 href=https://wdd.js.org/cowboy.ico><link rel=icon type=image/png sizes=32x32 href=https://wdd.js.org/cowboy.ico><link rel=apple-touch-icon href=https://wdd.js.org/cowboy.ico><link rel=mask-icon href=https://wdd.js.org/cowboy.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.117.0"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="Sofia 模块全部配置"><meta property="og:description" content="About Sofia is a FreeSWITCH™ module (mod_sofia) that provides SIP connectivity to and from FreeSWITCH in the form of a User Agent. A &ldquo;User Agent&rdquo; (&ldquo;UA&rdquo;) is an application used for handling a certain network protocol; the network protocol in Sofia&rsquo;s case is SIP. Sofia is the general name of any User Agent in FreeSWITCH using the SIP network protocol. For example, Sofia receives calls sent to FreeSWITCH from other SIP User Agents (UAs), sends calls to other UAs, acts as a client to register FreeSWITCH with other UAs, lets clients register with FreeSWITCH, and connects calls (i."><meta property="og:type" content="article"><meta property="og:url" content="https://wdd.js.org/freeswitch/sofia-config/"><meta property="og:image" content="https://wdd.js.org/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="freeswitch"><meta property="article:published_time" content="2022-05-28T14:57:59+08:00"><meta property="article:modified_time" content="2022-05-28T14:57:59+08:00"><meta property="og:site_name" content="洞香春"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://wdd.js.org/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Sofia 模块全部配置"><meta name=twitter:description content="About Sofia is a FreeSWITCH™ module (mod_sofia) that provides SIP connectivity to and from FreeSWITCH in the form of a User Agent. A &ldquo;User Agent&rdquo; (&ldquo;UA&rdquo;) is an application used for handling a certain network protocol; the network protocol in Sofia&rsquo;s case is SIP. Sofia is the general name of any User Agent in FreeSWITCH using the SIP network protocol. For example, Sofia receives calls sent to FreeSWITCH from other SIP User Agents (UAs), sends calls to other UAs, acts as a client to register FreeSWITCH with other UAs, lets clients register with FreeSWITCH, and connects calls (i."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"FreeSWITCH之路","item":"https://wdd.js.org/freeswitch/"},{"@type":"ListItem","position":3,"name":"Sofia 模块全部配置","item":"https://wdd.js.org/freeswitch/sofia-config/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Sofia 模块全部配置","name":"Sofia 模块全部配置","description":"About Sofia is a FreeSWITCH™ module (mod_sofia) that provides SIP connectivity to and from FreeSWITCH in the form of a User Agent. A \u0026ldquo;User Agent\u0026rdquo; (\u0026ldquo;UA\u0026rdquo;) is an application used for handling a certain network protocol; the network protocol in Sofia\u0026rsquo;s case is SIP. Sofia is the general name of any User Agent in FreeSWITCH using the SIP network protocol. For example, Sofia receives calls sent to FreeSWITCH from other SIP User Agents (UAs), sends calls to other UAs, acts as a client to register FreeSWITCH with other UAs, lets clients register with FreeSWITCH, and connects calls (i.","keywords":["FreeSWITCH"],"articleBody":"About Sofia is a FreeSWITCH™ module (mod_sofia) that provides SIP connectivity to and from FreeSWITCH in the form of a User Agent. A “User Agent” (“UA”) is an application used for handling a certain network protocol; the network protocol in Sofia’s case is SIP. Sofia is the general name of any User Agent in FreeSWITCH using the SIP network protocol. For example, Sofia receives calls sent to FreeSWITCH from other SIP User Agents (UAs), sends calls to other UAs, acts as a client to register FreeSWITCH with other UAs, lets clients register with FreeSWITCH, and connects calls (i.e., to local extensions). To add a SIP Provider (Sofia User Agent) to your FreeSWITCH, please see the Interoperability Examples and add the SIP Provider information in an .xml file stored under conf/sip_profiles/\nClick here to expand Table of Contents\nSofia allows for multiple User Agents A “User Agent” (“UA”) is an application used for running a certain network protocol, and a Sofia UA is the same thing but the protocol in that case is SIP. When FreeSWITCH starts, it reads the conf/autoload_configs/sofia.conf.xml file. That file contains a “X-PRE-PROCESS” directive which instructs FreeSWITCH to subsequently load and merge any conf/sip_profiles/*.xml files. Each *.xml file so loaded and merged should contain a complete description of one or more SIP Profiles. Each SIP Profile so loaded is part of a “User Agent” or “UA”; in FreeSWITCH terms, UA = User Agent = Sofia Profile = SIP Profile. Note that the individual UAs so loaded are all merged together by FreeSWITCH and must not interfere with each other: In particular, each UA must have its own unique port on which it accepts connections (the default port for SIP is 5060).\nMultiple User Agents (Profiles) and the Dialplan Why might you want to create multiple User Agents? Here’s an example. In my office, I use a firewall. This means that calls I make to locations outside the firewall must use a STUN server to transverse the NAT in the firewall, while calls within the office don’t need to use a STUN server. In order to accommodate these requirements, I’ve created two different UAs. One of them uses a STUN server and for that matter also connects up to the PSTN through a service provider. The other UA is purely for local SIP calls. Now I’ve got two UAs defined by my profiles, each of which can handle a call. When dialing a SIP address or telephone number, which UA is used? That determination is made in the dialplan. One syntax for making a call via Sofia in the dialplan is sofia/profile_name/destination\nSo, the task becomes rather straightforward. Dialplans use pattern matching and other tricks to determine how to handle a call. My dialplan examines what I’ve dialed and then determines what profile to use with that call. If I dial a telephone number, the dialplan selects the UA that connects up to the PSTN. If I dial a SIP address outside the firewall, the dialplan selects that same UA because it uses the STUN server. But if I dial a SIP address that’s inside the firewall, the dialplan selects the “local” UA. To understand how to write dialplans, use pattern matching, etc., see Dialplan\nThe Relationship Between SIP Profiles and Domains The following content was written in a mailing list thread by Anthony Minessale in response to questions about how SIP profiles relate to domain names in FreeSWITCH. The best thing to do is take a look at these things from a step back. The domains inside the XML registry are completely different from the domains on the internet and again completely different from domains in sip packets. The profiles are again entirely different from any of the above. Its up to you to align them if you so choose. The default configuration distributed with FreeSWITCH sets up the scenario most likely to load on any machine and work out of the box. That is the primary goal of that configuration, so, It sets the domain in both the directory, the global default domain variable and the name of the internal profile to be identical to the IP addr on the box that can reach the internet. Then it sets the sip to force everything to that value. When you want to detach from this behavior, you are probably on a venture to do some kind of multi-home setup. Aliases in the tag are a list of keys you want to use to use that lead to the current profile your are configuring. Think of it as the /etc/hosts file in Unix, only for profiles. When you define aliases to match all of the possible domains hosted on a particular profile, then when you try to take a user@host.com notation and decide which profile it came from, you can use the aliases to find it providing you have added to that profile. The tag is an indicator telling the profile to open the XML registry in FreeSWITCH and run through any domains defined therein. The 2 key attributes are: alias: [true/false] (automatically create an alias for this domain as mentioned above) parse: [true/false] (scan the domain for gateway entries and include them into this profile) name: [] (either the name of a specific domain or ‘all’ to denote parsing every domain in the directory)\nAs you showed in your question the default config has If you apply what you have learned above, it will scan for every domain (there is only one by default) and add an alias for it and not parse it for gateways. The default directory uses global config vars to set the domain to match the local IP addr on the box. So now you will have a domain in your config that is your IP addr, and the internal profile will attach to it and add an alias so that value expands to match it. This is explained in a comment at the top of directory/default.xml: FreeSWITCH works off the concept of users and domains just like email. You have users that are in domains for example 1000@domain.com.\nWhen freeswitch gets a register packet it looks for the user in the directory based on the from or to domain in the packet depending on how your sofia profile is configured. Out of the box the default domain will be the IP address of the machine running FreeSWITCH. This IP can be found by typing “sofia status” at the CLI. You will register your phones to the IP and not the hostname by default. If you wish to register using the domain please open vars.xml in the root conf directory and set the default domain to the hostname you desire. Then you would use the domain name in the client instead of the IP address to register with FreeSWITCH.\nSo having more than one profile with the default of is going to end up aliasing the same domains into all profiles who call it and cause an overwrite in the lookup table and probably an error in your logs somewhere. If you had parse=“true” on all of them, they would all try and register to the gateways in all of your domains. If you look at the stock config, external.xml is a good example of a secondary profile, it has so no aliases, and yes parse … the exact opposite of the internal so that all the gateways would register from external and internal would bind to the local IP addr. So, you probably want to use separate per domain per profile you want to bind it to in more complicated setups.\nStructure of a Profile Each profile may contain several different subsections. At the present time there’s no XSD or DTD for sofia.conf.xml — and any volunteer who can create one would be very welcome indeed.\nGateway Each profile can have several gateways: elements… elements… A gateway has an attribute “name” by which it can be referred. A gateway describes how to use a different UA to reach destinations. For example, the gateway may provide access to the PSTN, or to a private SIP network. The reason for defining a gateway, presumably, is because the gateway requires certain information before it will accept a call from the FreeSWITCH User Agent. Variables can be defined on a gateway. Inbound variables are set on the channel of a call received from a gateway, outbound variables are set on the channel of a call sent to a gateway. An example gateway configuration would be: To reach a particular gateway from the dial plan, use sofia/gateway//\nFreeSWITCH can also subscribe to receive notification of events from the gateway. For more information see Presence - Use FreeSWITCH as a Client\nParameters The following is a list of param elements that are children of a gateway element:\nNote: The username param for the gateway is not to be confused with the username param in the Profile settings config!\nNote: extension parameter influence the contents of channel variable Caller-Destination-Number and destination_number. If it is blank, Caller-Destination-Number will always be set to gateway’s username. If it has a value, Caller-Destination-Number will always be set to this value. If it has value auto_to_user, Caller-Destination-Number will be populated with value ${sip_to_user} which means the real dialled number in case of an inbound call.\nping-min means “how many successful pings we must have before declaring a gateway up”. The interval between ping-min and ping-max is the “safe area” where a gateway is marked as UP. So if we have, for example, min 3 and max 6, if the gateway is up and we move counter between 3,4,5,6 the gateway will be up. If from 6 we loose 4 (so counter == 2) pings in a row, the gateway will be declared down. Please note that on sofia startup the gateway is always started as UP, so it will be up even if ping-min is \u003e 1 . the “right” way starts when the gateway goes down.\nParam “register,” is used when this profile acts as a client to another UA. By registering, FreeSWITCH informs the other UA of its whereabouts. This is generally used when FreeSWITCH wants the other UA to send FreeSWITCH calls, and the other UA expects this sort of registration. If FreeSWITCH uses the other UA only as a gateway (e.g., to the PSTN), then registration is not generally required. Param “distinct-to” is used when you want FS to register using a distict AOR for header To. It requires proper setting of related parameters. For example if you want the REGISTER to go with: From: sip:someuser@somedomain.com To: sip:anotheruser@anotherdomain.com\nThen set the parameters as this: The latter param, “ping” is used to check gateway availability. By setting this option, FreeSWITCH will send SIP OPTIONS packets to gateway. If gateway responds with 200 or 404, gateway is pronounced up, otherwise down. [N.B. It appears that other error messages can be returned and still result in the gateway being marked as ‘up’?] If any call is routed to gateway with state down, FreeSWITCH will generate NETWORK_OUT_OF_ORDER hangup cause. Ping frequency is defined in seconds (value attribute) and has a minimum value of 5 seconds. Param “extension-in-contact” is used to force what the contact info will be in the registration. If you are having a problem with the default registering as gw+gateway_name@ip you can set this to true to use extension@ip. If extension is blank, it will use username@ip.\nif you need to insert the FROM digits to the Contact URI User Part when sending call to gateway BEFORE From: “8885551212” sip:88855512120@8.8.8.8 Contact: sip:gw+mygateway@7.7.7.7:7080 try adding these to gateway params\nThese channel variables will be set on all calls going through this gateway in the specified direction. However, see below for a special syntax to set profile variables rather than channel variables. Settings Settings include other, more general information about the profile, including whether or not STUN is in use. Each profile has its own settings element. Not only is this convenient — it’s possible to set up one profile to use STUN and another, with a different gateway or working behind the firewall, not needing STUN — but it’s also crucial. That’s because each profile defines a SIP User Agent, and each UA must have its own unique “sip-port.” By convention, 5060 is the default port, but it’s possible to make calls to, e.g., “foo@sip.example.com:5070”, and therefore you can define any port you please for each individual profile. The conf directory contains a complete sample sofia.conf.xml file, along with comments. See Git examples: Internal, External\nBasic settings alias This seems to make the SIP profile bind to this IP \u0026 port as well as your SIP / RTP IPs and ports. Anthony had this to say about aliases in a ML thread: Aliases in the tag are a list of keys you want to use to use that lead to the current profile your are configuring. Think of it as the /etc/hosts file in unix only for profiles. When you define aliases to match all of the possible domains hosted on a particular profile, then when you try to take a user@host.com notation and decide which profile it came from, you can use the aliases to find it providing you have added to that profile.\nshutdown-on-fail If set to true and the profile fails to load, FreeSWITCH will shut down. This is useful if you are running something like Pacemaker and OpenAIS which manage a pair of FreeSWITCH nodes and automatically monitor, start, stop, restart, and standby-on-fail the nodes. It will ensure that the specific node is not able to be used in a “partially up” situation.\nuser-agent-string This sets the User-Agent header in all SIP messages sent by your server. By default this could be something like “FreeSWITCH-mod_sofia/1.0.trunk-12805”. If you didn’t want to advertise detailed version information you could simply set this to “FreeSWITCH” or even “Asterisk PBX” as a joke. Take care when setting this value as certain characters such as ‘@’ could cause other SIP proxies could reject your messages as invalid.\nlog-level sip-trace context Dialplan context in which to dump calls that come in to this profile’s ip:port\nsip-port Port to bind to for SIP traffic:\nsip-ip IP address to bind to for SIP traffic. DO NOT USE HOSTNAMES, ONLY IP ADDRESSES\nrtp-ip IP address to bind to for RTP traffic. DO NOT USE HOSTNAMES, ONLY IP ADDRESSES Multiple rtp-ip support: if more rtp-ip parameters are added, they will be used in round-robin as new calls progress. IPv6 addresses are not supported under Windows at the time of writing. See FS-4445 ext-rtp-ip This is the IP behind which FreeSWITCH is seen from the Internet, so if FreeSWITCH is behind NAT, this is basically the public IP that should be used for RTP. Possible values are: Any variable from vars.xml, e.g. $${external_rtp_ip}:\n“specific IP address”\n“when used for LAN and WAN to avoid errors in the SIP CONTACT sent to LAN devices, use”\n“auto”: the guessed IP will be used (guessed by looking in the IP routing table which interface is the default route)\n“auto-nat”: FreeSWITCH will use uPNP or NAT-PMP to discover the public IP address it should use\n“stun:DNS name or IP address”: FreeSWITCH will use the STUN server of your choice to discover the public IP address\n“host:DNS name”: FreeSWITCH will resolve the DNS name as the public IP address, so you can use a dynamic DNS host\nATTENTION: AS OF 2012Q4, ’ext–’ prefixed params cited above when populated with to-be-resolved DNS strings – e.g. name=“ext–sip–ip” value=“stun:stun.freeswitch.org” or name=“ext‑rtp–ip” value=“host:mypublicIP.dyndns.org” – are resolved to IP addresses once only at FS load time and const thereafter. FS is blind to (unaware of) any subsequent changes in your environment’s IP address. Thus, these ext– vars may become functionally incompatible with the environment’s current IP addresses with unspecified results in call flow at the network layer. FS restart is required for FS to capture the now-current, working IP address(es).\next-sip-ip This is the IP behind which FreeSWITCH is seen from the Internet, so if FreeSWITCH is behind NAT, this is basically the public IP that should be used for SIP. Possibles values are the same as those for ext-rtp-ip, and it is usually set to the same value.\ntcp-keepalive Set this to interval (in milliseconds) to send keep alive packets to user agents (UAs) registered via TCP; do not set to disable.\ntcp-pingpong tcp-ping2pong dialplan The dialplan parameter is very powerful. In the simplest configuration, it will use the XML dialplan. This means that it will read data from mod_xml_curl XML dialplans (e.g., callback to your webserver), or failing that, from the XML files specified in freeswitch.xml dialplan section. (e.g. default_context.xml)\nYou can also add enum lookups into the picture (since mod_enum provides dialplan functionality), so enum lookups override the XML dialplan\nOr reverse the order to enum is only consulted if XML lookup fails\nIt is also possible to specify a specific enum root\nOr use XML on a custom file\nWhere it will first check the specific XML file, then hit normal XML which also do a mod_xml_curl lookup assuming you have that configured and working.\nMedia related options See also: Proxy Media\nresume-media-on-hold When calls are in no media this will bring them back to media when you press the hold button. To return the calls to bypass-media after the call is unheld, enable bypass-media-after-hold.\nbypass-media-after-att-xfer This will allow a call after an attended transfer go back to bypass media after an attended transfer. bypass-media-after-hold This will allow a call to go back to bypass media after a hold. This option can be enabled only if resume-media-on-hold is set. Available from git rev 8fa385b. inbound-bypass-media Uncomment to set all inbound calls to no media mode. It means that the FreeSWITCH server only keeps the SIP messages state, but have the RTP steam go directly from end-point to end-point\ninbound-proxy-media Uncomment to set all inbound calls to proxy media mode. This means the FreeSWITCH keeps both the SIP and RTP traffic on the server but does not interact with the RTP stream.\ndisable-rtp-auto-adjust ignore-183nosdp enable-soa Set the value to “false” to diable SIP SOA from sofia to tell sofia not to touch the exchange of SDP\nt38-passthru The following options are available\n’true’ enables t38 passthru ‘false’ disables t38 passthru ‘once’ enables t38 passthru, but sends t.38 re-invite only once (available since commit 08b25a8 from Nov. 9, 2011) Codecs related options Also see:\nCodec Negotiation Supported Codecs inbound-codec-prefs This parameter allows to change the allowed inbound codecs per profile. outbound-codec-prefs This parameter allows to change the outbound codecs per profile. codec-prefs This parameter allows to change both inbound-codec-prefs and outbound-codec-prefs at the same time. inbound-codec-negotiation set to ‘greedy’ if you want your codec list to take precedence if ‘greedy’ doesn’t work for you, try ‘scrooge’ which has been known to fix misreported ptime issues with DID providers such as CallCentric. A rule of thumb is:\n‘generous’ permits the remote codec list have precedence and ‘win’ the codec negotiation and selection process ‘greedy’ forces a win by the local FreeSWITCH preference list ‘scrooge’ takes ‘greedy’ a step further, so that the FreeSWITCH wins even when the far side lies about capabilities during the negotiation process sip_codec_negotiation is a channel variable version of this setting\ninbound-late-negotiation Uncomment to let calls hit the dialplan before you decide if the codec is OK. bitpacking This setting is for AAL2 bitpacking on G.726. disable-transcoding Uncomment if you want to force the outbound leg of a bridge to only offer the codec that the originator is using\nrenegotiate-codec-on-reinvite STUN If you need to use a STUN server, here are common working examples:\next-rtp-ip stun.fwdnet.net is a publicly-accessible STUN server.\next-sip-ip stun-enabled Simple traversal of UDP over NATs (STUN), is used to help resolve the problems associated with SIP clients, behind NAT, using private IP address space in their messaging. Use stun when specified (default is true).\nstun-auto-disable Set to true to have the profile determine stun is not useful and turn it off globally\nNATing apply-nat-acl When receiving a REGISTER or INVITE, enable NAT mode automatically if IP address in Contact header matches an entry defined in the RFC 1918 access list. “acl” is a misnomer in this case because access will not be denied if the user’s contact IP doesn’t match.\naggressive-nat-detection This will enable NAT mode if the network IP/port from which the request was received differs from the IP/Port combination in the SIP Via: header, or if the Via: header contains the received parameter (regardless of what it contains.) Note 2009-04-05: Someone please clarify when this would be useful. It seems to me if someone needed this feature, chances are that things are so broken that they would need to use NDLB-force-rport\nVAD and CNG VAD stands for Voice Activity Detector. FreeSWITCH is capable of detecting speech and can stop transmitting RTP packets when no voice is detected.\nvad suppress-cng Suppress Comfort Noise Generator (CNG) on this profile or per call with the ‘suppress_cng’ variable\nNDLB (A.K.A. No device left behind) NDLB-force-rport This will force FreeSWITCH to send SIP responses to the network port from which they were received. Use at your own risk! For more information see NAT Traversal.\nsafe = param that does force-rport behavior only on endpoints we know are safe to do so on. This is a dirty hack to try to work with certain endpoints behind sonicwall which does not use the same port when it does nat, when the devices do not support rport, while not breaking devices that acutally use different ports that force-rport will break NDLB-broken-auth-hash Used for when phones respond to a challenged ACK with method INVITE in the hash\nNDLB-received-in-nat-reg-contact add a ;received=\":\" to the contact when replying to register for nat handling\nNDLB-sendrecv-in-session By default, “a=sendrecv” is only included in the media portion of the SDP. While this is RFC-compliant, it may break functionality for some SIP devices. To also include “a=sendrecv” in the session portion of the SDP, set this parameter to true.\nNDLB-allow-bad-iananame Introduced in rev. 15401, this was enabled by default prior to new param. Will allow codecs to match respective name even if the given string is not correct. i.e., Linksys and Sipura phones will pass G.729a by default instead of G.729 as codec string therefore not matching. If you wish to allow bad IANA names to match respective codec string, add the following param to your SIP profile. Refer to RFC 3551, RFC 3555 and the IANA list(s) for SDP\nCall ID inbound-use-callid-as-uuid On inbound calls make the uuid of the session equal to the SIP call id of that call.\noutbound-use-uuid-as-callid On outbound calls set the callid to match the uuid of the session\nThis goes in the “..sip_profiles/external.xml” file.\nTLS Please make sure to read SIP TLS before enabling certain features below as they may not behave as expected.\ntls TLS: disabled by default, set to “true” to enable tls-only disabled by default, when enabled prevents sofia from listening on the unencrypted port for this connection. This can stop many generic brute force scripts and if all your clients connect over TLS then can help decrease the exposure of your FreeSWITCH server to the world. tls-bind-params additional bind parameters for TLS tls-sip-port Port to listen on for TLS requests. (5061 will be used if unspecified) tls-cert-dir Location of the agent.pem and cafile.pem ssl certificates (needed for TLS server) tls-version TLS version (“sslv2”, “sslv3”, “sslv23”, “tlsv1”, “tlsv1.1”, “tlsv1.2”). NOTE: Phones may not work with TLSv1 When not set defaults to: “tlsv1,tlsv1.1,tlsv1.2”\ntls-passphrase If your agent.pem is protected by a passphrase stick the passphrase here to enable FreeSWITCH to decrypt the key. tls-verify-date If the client/server certificate should have the date on it validated to ensure it is not expired and is currently active. tls-verify-policy This controls what, if any security checks are done against server/client certificates. Verification is generally checking certificates are valid against the cafile.pem. Set to ‘in’ to only verify incoming connections, ‘out’ to only verify outgoing connections, ‘all’ to verify all connections, also ‘subjects_in’, ‘subjects_out’ and ‘subjects_all’ for subject validation (subject validation for outgoing connections is against the hostname/ip connecting to). Multiple policies can be split with a ‘|’ pipe, for example ‘subjects_in|subjects_out’. Defaults to none. tls-verify-depth When certificate validation is enabled (tls-verify-policy) how deep should we try to verify a certificate up the chain again the cafile.pem file. By default only depth of 2. tls-verify-in-subjects If subject validation is enabled for incoming connections (tls-verify-policy set to ‘subjects_in’ or ‘subjects_all’) this is the list of subjects that are allowed (delimit with a ‘|’ pipe), note this only effects incoming connections for outgoing connections subjects are always checked against hostnames/ips. DTMF rfc2833-pt TODO RFC 2833 is obsoleted by RFC 4733.\ndtmf-duration dtmf-type TODO RFC 2833 is obsoleted by RFC 4733. Set the parameter in the SIP profile:\nor\nor\nOR set the variable in the SIP gateway or user profile (NOT in the channel, it must be before CS_INIT): Note the “_” instead of “-” in profile param (this is var set in dialplan). (24.10.2010: “both” don’t seem to me work in my tests, “outbound” does) Note: for inband DTMF, Misc. Dialplan Tools start_dtmf must be used in the dialplan. Also, to change the outgoing routing from info or rfc2833 to inband, use Misc._Dialplan_Tools_start_dtmf_generate RFC 2833\npass-rfc2833 TODO RFC 2833 is obsoleted by RFC 4733. Default: false If true, it passes RFC 2833 DTMF’s from one side of a bridge to the other, untouched. Otherwise, it decodes and re-encodes them before passing them on.\nliberal-dtmf TODO RFC 2833 is obsoleted by RFC 4733. Default: false For DTMF negotiation, use this parameter to just always offer 2833 and accept both 2833 and INFO. Use of this parameter is not recommended since its purpose is to try to cope with buggy SIP implementations.\nSIP Related options enable-timer This enables or disables support for RFC 4028 SIP Session Timers.\nNote: If your switch requires the timer option; for instance, Huawei SoftX3000, it needs this optional field and drops the calls with “Session Timer Check Message Failed”, then you may be able to revert back the commit that took away the Require: timer option which is an optional field by: git log -1 -p 58c3c3a049991fedd39f62008f8eb8fca047e7c5 libs/sofia-sip/libsofia-sip-ua | patch -p1 -R touch libs/sofia-sip/.update\nmake mod_sofia-clean make mod_sofia-install\nenable-100rel This enable support for 100rel (100% reliability - PRACK message as defined in RFC3262) This fixes a problem with SIP where provisional messages like “180 Ringing” are not ACK’d and therefore could be dropped over a poor connection without retransmission. 2009-07-08: Enabling this may cause FreeSWITCH to crash, see FSCORE-392.\nminimum-session-expires This sets the “Min-SE” value (in seconds) from RFC 4028. This value must not be less than 90 seconds.\nsip-options-respond-503-on-busy When set to true, this param will make FreeSWITCH respond to incoming SIP OPTIONS with 503 “Maximum Calls In Progress” when FS is paused or maximum sessions has been exceeded. When set to false or when not set at all (default behavior), SIP OPTIONS are always responded with 200 “OK”.\nSetting this param to true is especially useful if you’re using a proxy such as OpenSIPS or Kamailio with dispatcher module to probe your FreeSWITCH servers by sending SIP OPTIONS.\nsip-force-expires Setting this param overrides the expires value in the 200 OK in response to all inbound SIP REGISTERs towards this sip_profile. This param can be overridden per individual user by setting a sip-force-expires user directory variable.\nsip-expires-max-deviation Setting this param adds a random deviation to the expires value in the 200 OK in response to all inbound SIP REGISTERs towards this sip_profile. Result will be that clients will not re-register at the same time-interval thus spreading the load on your system. For example, if you set:\nthen the expires that is responded will be between 1800-600=1200 and 1800+600=2400 seconds. This param can be overridden per individual user by setting a sip-expires-max-deviation user directory variable.\noutbound-proxy Setting this param will send all outbound transactions to the value set by outbound-proxy. send-display-update Tells FreeSWITCH not to send display UPDATEs to the leg of the call. RTP Related options auto-jitterbuffer-msec Set this to the size of the jitterbuffer you would like to have on all calls coming through this profile.\nrtp-timer-name rtp-rewrite-timestamps If you don’t want to pass through timestamps from 1 RTP stream to another, rtp-rewrite-timestamps is a parameter you can set in a SIP Profile (on a per call basis with rtp_rewrite_timestamps chanvar in a dialplan). The result is that FreeSWITCH will regenerate and rewrite the timestamps in all the RTP streams going to an endpoint using this SIP Profile. This could be necessary to fix audio issues when sending calls to some paranoid and not RFC-compliant gateways (Cirpack is known to require this).\nmedia_timeout was: rtp-timeout-sec (deprecated) The number of seconds of RTP inactivity (media silence) before FreeSWITCH considers the call disconnected, and hangs up. It is recommended that you use session timers instead. If this setting is omitted, the default value is “0”, which disables the timeout.\nmedia_hold_timeout was: rtp-hold-timeout-sec (deprecated) The number of seconds of RTP inactivity (media silence) for a call placed on hold by an endpoint before FreeSWITCH considers the call disconnected, and hangs up. It is recommended that you use session timers instead. If this setting is omitted, the default value is “0”, which disables the timeout.\nrtp-autoflush-during-bridge Controls what happens if FreeSWITCH detects that it’s not keeping up with the RTP media (audio) stream on a bridged call. (This situation can happen if the FreeSWITCH server has insufficient CPU time available.) When set to “true” (the default), FreeSWITCH will notice when more than one RTP packet is waiting to be read in the incoming queue. If this condition persists for more than five seconds, RTP packets will be discarded to “catch up” with the audio stream. For example, if there are always five extra 20 ms packets in the queue, 100 ms of audio latency can be eliminated by discarding the packets. This will cause an audio glitch as some audio is discarded, but will improve the latency by 100 ms for the rest of the call. If rtp-autoflush-during-bridge is set to false, FreeSWITCH will instead preserve all RTP packets on bridged calls, even if it increases the latency or “lag” that callers hear.\nrtp-autoflush Has the same effect as “rtp-autoflush-during-bridge”, but affects NON-bridged calls (such as faxes, IVRs and the echo test). Unlike “rtp-autoflush-during-bridge”, the default is false, meaning that high-latency packets on non-bridged calls will not be discarded. This results in smoother audio at the possible expense of increasing audio latency (or “lag”). Setting “rtp-autoflush” to true will discard packets to minimize latency when possible. Doing so may cause errors in DTMF recognition, faxes, and other processes that rely on receiving all packets.\nAuth These settings deal with authentication: requirements for identifying SIP endpoints to FreeSWITCH.\nchallenge-realm Choose the realm challenge key. Default is auto_to if not set. auto_from - uses the from field as the value for the SIP realm. auto_to - uses the to field as the value for the SIP realm. - you can input any value to use for the SIP realm. If you want URL dialing to work you’ll want to set this to auto_from. If you use any other value besides auto_to or auto_from you’ll loose the ability to do multiple domains. Note: comment out to restore the behavior before 2008-09-29\naccept-blind-auth accept any authentication without actually checking (not a good feature for most people)\nauth-calls Users in the directory can have “auth-acl” parameters applied to them so as to restrict users access to a predefined ACL or a CIDR.\nValue can be “false” to disable authentication on this profile, meaning that when calls come in the profile will not send an auth challenge to the caller.\nlog-auth-failures Write log entries ( Warning ) on authentication failures ( Registration \u0026 Invite ). useful for users wishing to use fail2ban. note: Required SVN#15654 or higher\nauth-all-packets On authed calls, authenticate all the packets instead of only INVITE and REGISTER(Note: OPTIONS, SUBSCRIBE, INFO and MESSAGE are not authenticated even with this option set to true, see http://jira.freeswitch.org/browse/FS-2871)\nRegistration disable-register disable register which may be undesirable in a public switch\nmultiple-registrations Valid values for this parameter are “contact”, “true”, “false”. value=“true” is the most common use. Setting this value to “contact” will remove the old registration based on sip_user, sip_host and contact field as opposed to the call_id.\nmax-registrations-per-extension Defines the number of maximum registrations per extension. Valid value for this parameter is an integer greater than 0. Please note that setting this to 1 would counteract the usage of multiple-registrations. When an attempt to register an extension is made after the maximum value has been reached sofia will respond with 403. The following example will set maximum registrations to 2\ninbound-reg-force-matching-username Force the user and auth-user to match.\nforce-publish-expires Force custom presence update expires delta (-1 means endless)\nforce-register-domain all inbound registrations will look in this domain for the users. Comment out to use multiple domains\nforce-register-db-domain all inbound reg will stored in the db using this domain. Comment out to use multiple domains\nsend-message-query-on-register Can be set to ’true’, ‘false’ or ‘first-only’. If set to ’true’ (this is the default behavior), mod_sofia will send a message-query event upon registration. mod_voicemail uses this for counting messages.\nIf set to ‘first-only’, only the first REGISTER will trigger the message-query (it requires the UA to increment the NC on subsequent REGISTERs. Some phones, snom for instance, do not do this). The final effect of the message-query is to cause a NOTIFY MWI message to be sent to the registering UA (it is used to satisfy terminals that expect MWI without subscribing for it).\nunregister-on-options-fail If set to True with nat-options-ping the endpoint will be unregistered if no answer on OPTIONS packet.\nnat-options-ping With this option set FreeSWITCH will periodically send an OPTIONS packet to all NATed registered endpoints to keep alive connection. If set to True with unregister-on-options-fail the endpoint will be unregistered if no answer on OPTIONS packet.\nall-reg-options-ping With this option set FreeSWITCH will periodically send an OPTIONS packet to all registered endpoints to keep alive connection. If set to True with unregister-on-options-fail the endpoint will be unregistered if no answer on OPTIONS packet.\nregistration-thread-frequency Controls how often registrations in the FreeSWITCH are checked for expiration. ping-mean-interval Controls the mean interval FreeSWITCH™ will send OPTIONS packet to registered user, by default 30 seconds.\nSubscription force-subscription-expires force suscription expires to a lower value than requested\nforce-subscription-domain all inbound subscription will look in this domain for the users. Comment out to use multiple domains\nPresence manage-presence Enable presence. If you want to share your presence (see dbname and presence-hosts) set this to “true” on the first profile and enable the shared presence database. Then on subsequent profiles that share presence set this variable to “passive” and enable the shared presence database there as well.\ndbname Used to share presence info across sofia profiles Name of the db to use for this profile\npresence-hold-state By default when a call is placed on hold, monitoring extensions show that extension as ringing. You can change this behavior by specifying this parameter and one of the following values. Available as of commit 1145905 on April 13, 2012.\nconfirmed - Extension appears busy. early (default) - Extension appears to be ringing. terminated - Extension appears idle. presence-hosts A list of domains that have a shared presence in the database specified in dbname. People who use multiple domains per profile can’t use this feature anyway, so you’ll want to set it to something like “DISABLED” in this case to avoid getting users from similar domains all mashed together. For multiple domains also known as multi-tenant calling 1001 would call all matching users in all domains. Don’t use presence-hosts with multi-tenant.\npresence-privacy Optionally globally hide the caller ID from presence notes in distributed NOTIFY messages. For example, “Talk 1002” would be the presence note for extension 1001 while it is on a call with extension 1002. If the presence privacy tag is set to true, then it would distribute the presence note as “On The Phone” (without the extension to which it is connected). So any subscriber’s to 1001’s presence would not be able to see who he/she is talking to. http://jira.freeswitch.org/browse/FS-849 This also hides the number in the status “hold”, “ring”, “call” and perhaps others. http://jira.freeswitch.org/browse/FS-4420\nsend-presence-on-register Specify whether or not to send presence information when users register. Default is not to send presence information. Valid options:\nfalse true first-only CallerID Related options caller-id type choose one, can be overridden by inbound call type and/or sip_cid_type channel variable Remote-Party-ID header: P-*-Identity family of headers: neither one: pass-callee-id (defaults to true) Disable by setting it to false if you encounter something that your gateway for some reason hates X-headers that it is supposed to ignore\nOther (TO DO) hold-music disable-hold This allows to disable Music On Hold (added in GIT commit e5cc0539ffcbf660637198c698e90c2e30b05c2f, from Fri Apr 30 19:14:39 2010 -0500). This can be useful when the calling device intends to send its own MOH, but nevertheless sends a REINVITE to FreeSWITCH triggering its MOH. This can be done from dialplan also with rtp_disable_hold channel variable.\napply-inbound-acl set which access control lists, defined in acl.conf.xml, apply to this profile\napply-register-acl apply-proxy-acl This allows traffic to be sent to FreeSWITCH via one or more proxy servers. The proxy server should add a header named X-AUTH-IP containing the IP address of the client. FreeSWITCH trusts the proxy because its IP is listed in the proxy server ACL, and uses the value of the IP in this header as the client’s IP for ACL authentication (acl defined in apply-inbound-acl).\nrecord-template max-proceeding max number of open dialogs in proceeding\nbind-params if you want to send any special bind params of your own\ndisable-transfer disable transfer which may be undesirable in a public switch\nmanual-redirect enable-3pcc enable-3pcc determines if third party call control is allowed or not. Third party call control is useful in cases where the SIP invite doesn’t include a SDP (late media negotiation). enable-3pcc can be set to either ’true’ or ‘proxy’, true accepts the call right away, proxy waits until the call has been answered then sends accepts\nnonce-ttl TTL for nonce in sip auth\nThis parameter is set to 60 seconds if not set here. It’s used to determine how long to store the user registration record in the sip_authentication table. The expires field in the sip_authentication table is this value plus the expires set by the user agent.\nsql-in-transactions If set to true (default), it will instruct the profile to wait for 500 SQL statements to accumulate or 500ms to elapse and execute them in a transaction (to boost performance).\nodbc-dsn If you have ODBC support and a working dsn you can use it instead of SQLite\nmwi-use-reg-callid username If you wish to hide the fact that you are using FreeSWITCH in the SDP message (Specifically the o= and and s= fields) , then set the username param under the profile. This has no relation whatsoever with the username parameter when we’re dealing with gateways. If this value is left unset the system defaults using FreeSWITCH as the username parameter with the o= and s= fields.\nExample: . v=0. o=root 1346068950 1346068951 IN IP4 1.2.3.4. s=root. c=IN IP4 1.2.3.4. t=0 0. m=audio 26934 RTP/AVP 18 0 101 13. a=fmtp:18 annexb=no. a=rtpmap:101 telephone-event/8000. a=fmtp:101 0-16. a=ptime:20.\nwhen you set Directory of Users To allow users to register with the server, the user information must be specified in the conf/directory/default/*xml file. To dynamically specify what users can register, use Mod xml curl\nDefault Configuration File From the FreeSWITCH Github repository’s vanilla configurations ([conf/vanilla/autoload_configs/sofia.conf.xml](https://github.com/signalwire/freeswitch/blob/master/conf/vanilla/autoload_configs/sofia.conf.xml)): conf/autoload_configs/sofia.conf.xml \u003c!– the new format for HEPv2/v3 and capture ID protocol:host:port;hep=2;capture_id=200;\n–\u003e shutdown and restart FreeSWITCH (or) unload and load mod_sofia If you’ve only made changes to a particular profile, you may simply (WARNING: will drop all calls associated with this profile):\nsofia profile restart reloadxml Security Features SIP TLS for secure signaling. SRTP for secure media delivery. The Auth section above for authentication settings. 参考 https://freeswitch.org/confluence/display/FREESWITCH/Sofia+Configuration+Files ","wordCount":"6695","inLanguage":"en","datePublished":"2022-05-28T14:57:59+08:00","dateModified":"2022-05-28T14:57:59+08:00","author":{"@type":"Person","name":"Eddie Wang"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://wdd.js.org/freeswitch/sofia-config/"},"publisher":{"@type":"Organization","name":"洞香春","logo":{"@type":"ImageObject","url":"https://wdd.js.org/cowboy.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://wdd.js.org accesskey=h title="洞香春 (Alt + H)"><img src=/cowboy.ico alt=logo aria-label=logo height=35>洞香春</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://wdd.js.org/freeswitch/ title=FreeSWITCH><span>FreeSWITCH</span></a></li><li><a href=https://wdd.js.org/fe/ title=Frontend><span>Frontend</span></a></li><li><a href=https://wdd.js.org/golang/ title=Golang><span>Golang</span></a></li><li><a href=https://wdd.js.org/container/ title=k8s/docker><span>k8s/docker</span></a></li><li><a href=https://wdd.js.org/network/ title=Network><span>Network</span></a></li><li><a href=https://wdd.js.org/opensips/ title=OpenSIPS><span>OpenSIPS</span></a></li><li><a href=https://wdd.js.org/shell/ title=Shell><span>Shell</span></a></li><li><a href=https://wdd.js.org/vim/ title=VIM><span>VIM</span></a></li><li><a href=https://wdd.js.org/categories/ title=分类><span>分类</span></a></li><li><a href=https://wdd.js.org/search/ title=搜索><span>搜索</span></a></li><li><a href=https://wdd.js.org/tags/ title=标签><span>标签</span></a></li><li><a href=https://wdd.js.org/archives/ title=归档><span>归档</span></a></li><li><a href=https://wdd.js.org/about/ title=我><span>我</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://wdd.js.org>Home</a>&nbsp;»&nbsp;<a href=https://wdd.js.org/freeswitch/>FreeSWITCH之路</a></div><h1 class=post-title>Sofia 模块全部配置</h1><div class=post-meta><span title='2022-05-28 14:57:59 +0800 +0800'>2022-05-28 14:57:59</span>&nbsp;·&nbsp;32 min&nbsp;·&nbsp;Eddie Wang</div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#about aria-label=About>About</a><ul><li><a href=#sofia-allows-for-multiple-user-agents aria-label="Sofia allows for multiple User Agents">Sofia allows for multiple User Agents</a><ul><li><a href=#multiple-user-agents-profiles-and-the-dialplan aria-label="Multiple User Agents (Profiles) and the Dialplan">Multiple User Agents (Profiles) and the Dialplan</a></li><li><a href=#the-relationship-between-sip-profiles-and-domains aria-label="The Relationship Between SIP Profiles and Domains">The Relationship Between SIP Profiles and Domains</a></li></ul></li><li><a href=#structure-of-a-profile aria-label="Structure of a Profile">Structure of a Profile</a><ul><li><a href=#gateway aria-label=Gateway>Gateway</a><ul><li><a href=#parameters aria-label=Parameters>Parameters</a></li></ul></li><li><a href=#settings aria-label=Settings>Settings</a><ul><li><a href=#basic-settings aria-label="Basic settings">Basic settings</a><ul><li><a href=#alias aria-label=alias>alias</a></li><li><a href=#shutdown-on-fail aria-label=shutdown-on-fail>shutdown-on-fail</a></li><li><a href=#user-agent-string aria-label=user-agent-string>user-agent-string</a></li><li><a href=#log-level aria-label=log-level>log-level</a></li><li><a href=#sip-trace aria-label=sip-trace>sip-trace</a></li><li><a href=#context aria-label=context>context</a></li><li><a href=#sip-port aria-label=sip-port>sip-port</a></li><li><a href=#sip-ip aria-label=sip-ip>sip-ip</a></li><li><a href=#rtp-ip aria-label=rtp-ip>rtp-ip</a></li><li><a href=#ext-rtp-ip aria-label=ext-rtp-ip>ext-rtp-ip</a></li><li><a href=#ext-sip-ip aria-label=ext-sip-ip>ext-sip-ip</a></li><li><a href=#tcp-keepalive aria-label=tcp-keepalive>tcp-keepalive</a></li><li><a href=#tcp-pingpong aria-label=tcp-pingpong>tcp-pingpong</a></li><li><a href=#tcp-ping2pong aria-label=tcp-ping2pong>tcp-ping2pong</a></li><li><a href=#dialplan aria-label=dialplan>dialplan</a></li></ul></li><li><a href=#media-related-options aria-label="Media related options">Media related options</a><ul><li><a href=#resume-media-on-hold aria-label=resume-media-on-hold>resume-media-on-hold</a></li><li><a href=#bypass-media-after-att-xfer aria-label=bypass-media-after-att-xfer>bypass-media-after-att-xfer</a></li><li><a href=#bypass-media-after-hold aria-label=bypass-media-after-hold>bypass-media-after-hold</a></li><li><a href=#inbound-bypass-media aria-label=inbound-bypass-media>inbound-bypass-media</a></li><li><a href=#inbound-proxy-media aria-label=inbound-proxy-media>inbound-proxy-media</a></li><li><a href=#disable-rtp-auto-adjust aria-label=disable-rtp-auto-adjust>disable-rtp-auto-adjust</a></li><li><a href=#ignore-183nosdp aria-label=ignore-183nosdp>ignore-183nosdp</a></li><li><a href=#enable-soa aria-label=enable-soa>enable-soa</a></li><li><a href=#t38-passthru aria-label=t38-passthru>t38-passthru</a></li></ul></li><li><a href=#codecs-related-options aria-label="Codecs related options">Codecs related options</a><ul><li><a href=#inbound-codec-prefs aria-label=inbound-codec-prefs>inbound-codec-prefs</a></li><li><a href=#outbound-codec-prefs aria-label=outbound-codec-prefs>outbound-codec-prefs</a></li><li><a href=#codec-prefs aria-label=codec-prefs>codec-prefs</a></li><li><a href=#inbound-codec-negotiation aria-label=inbound-codec-negotiation>inbound-codec-negotiation</a></li><li><a href=#inbound-late-negotiation aria-label=inbound-late-negotiation>inbound-late-negotiation</a></li><li><a href=#bitpacking aria-label=bitpacking>bitpacking</a></li><li><a href=#disable-transcoding aria-label=disable-transcoding>disable-transcoding</a></li><li><a href=#renegotiate-codec-on-reinvite aria-label=renegotiate-codec-on-reinvite>renegotiate-codec-on-reinvite</a></li></ul></li><li><a href=#stun aria-label=STUN>STUN</a><ul><li><a href=#ext-rtp-ip-1 aria-label=ext-rtp-ip>ext-rtp-ip</a></li><li><a href=#ext-sip-ip-1 aria-label=ext-sip-ip>ext-sip-ip</a></li><li><a href=#stun-enabled aria-label=stun-enabled>stun-enabled</a></li><li><a href=#stun-auto-disable aria-label=stun-auto-disable>stun-auto-disable</a></li></ul></li><li><a href=#nating aria-label=NATing>NATing</a><ul><li><a href=#apply-nat-acl aria-label=apply-nat-acl>apply-nat-acl</a></li><li><a href=#aggressive-nat-detection aria-label=aggressive-nat-detection>aggressive-nat-detection</a></li></ul></li><li><a href=#vad-and-cng aria-label="VAD and CNG">VAD and CNG</a><ul><li><a href=#vad aria-label=vad>vad</a></li><li><a href=#suppress-cng aria-label=suppress-cng>suppress-cng</a></li></ul></li><li><a href=#ndlb-aka-no-device-left-behind aria-label="NDLB (A.K.A. No device left behind)">NDLB (A.K.A. No device left behind)</a><ul><li><a href=#ndlb-force-rport aria-label=NDLB-force-rport>NDLB-force-rport</a></li><li><a href=#ndlb-broken-auth-hash aria-label=NDLB-broken-auth-hash>NDLB-broken-auth-hash</a></li><li><a href=#ndlb-received-in-nat-reg-contact aria-label=NDLB-received-in-nat-reg-contact>NDLB-received-in-nat-reg-contact</a></li><li><a href=#ndlb-sendrecv-in-session aria-label=NDLB-sendrecv-in-session>NDLB-sendrecv-in-session</a></li><li><a href=#ndlb-allow-bad-iananame aria-label=NDLB-allow-bad-iananame>NDLB-allow-bad-iananame</a></li></ul></li><li><a href=#call-id aria-label="Call ID">Call ID</a><ul><li><a href=#inbound-use-callid-as-uuid aria-label=inbound-use-callid-as-uuid>inbound-use-callid-as-uuid</a></li><li><a href=#outbound-use-uuid-as-callid aria-label=outbound-use-uuid-as-callid>outbound-use-uuid-as-callid</a></li></ul></li><li><a href=#tls aria-label=TLS>TLS</a><ul><li><a href=#tls-1 aria-label=tls>tls</a></li><li><a href=#tls-only aria-label=tls-only>tls-only</a></li><li><a href=#tls-bind-params aria-label=tls-bind-params>tls-bind-params</a></li><li><a href=#tls-sip-port aria-label=tls-sip-port>tls-sip-port</a></li><li><a href=#tls-cert-dir aria-label=tls-cert-dir>tls-cert-dir</a></li><li><a href=#tls-version aria-label=tls-version>tls-version</a></li><li><a href=#tls-passphrase aria-label=tls-passphrase>tls-passphrase</a></li><li><a href=#tls-verify-date aria-label=tls-verify-date>tls-verify-date</a></li><li><a href=#tls-verify-policy aria-label=tls-verify-policy>tls-verify-policy</a></li><li><a href=#tls-verify-depth aria-label=tls-verify-depth>tls-verify-depth</a></li><li><a href=#tls-verify-in-subjects aria-label=tls-verify-in-subjects>tls-verify-in-subjects</a></li></ul></li><li><a href=#dtmf aria-label=DTMF>DTMF</a><ul><li><a href=#rfc2833-pt aria-label=rfc2833-pt>rfc2833-pt</a></li><li><a href=#dtmf-duration aria-label=dtmf-duration>dtmf-duration</a></li><li><a href=#dtmf-type aria-label=dtmf-type>dtmf-type</a></li><li><a href=#pass-rfc2833httpsfreeswitchorgconfluencedisplayfreeswitchpass_rfc2833 aria-label=pass-rfc2833><a href=https://freeswitch.org/confluence/display/FREESWITCH/pass_rfc2833>pass-rfc2833</a></a></li><li><a href=#liberal-dtmf aria-label=liberal-dtmf>liberal-dtmf</a></li></ul></li><li><a href=#sip-related-options aria-label="SIP Related options">SIP Related options</a><ul><li><a href=#enable-timer aria-label=enable-timer>enable-timer</a></li><li><a href=#enable-100rel aria-label=enable-100rel>enable-100rel</a></li><li><a href=#minimum-session-expires aria-label=minimum-session-expires>minimum-session-expires</a></li><li><a href=#sip-options-respond-503-on-busy aria-label=sip-options-respond-503-on-busy>sip-options-respond-503-on-busy</a></li><li><a href=#sip-force-expires aria-label=sip-force-expires>sip-force-expires</a></li><li><a href=#sip-expires-max-deviation aria-label=sip-expires-max-deviation>sip-expires-max-deviation</a></li><li><a href=#outbound-proxy aria-label=outbound-proxy>outbound-proxy</a></li><li><a href=#send-display-update aria-label=send-display-update>send-display-update</a></li></ul></li><li><a href=#rtp-related-options aria-label="RTP Related options">RTP Related options</a><ul><li><a href=#auto-jitterbuffer-msec aria-label=auto-jitterbuffer-msec>auto-jitterbuffer-msec</a></li><li><a href=#rtp-timer-name aria-label=rtp-timer-name>rtp-timer-name</a></li><li><a href=#rtp-rewrite-timestamps aria-label=rtp-rewrite-timestamps>rtp-rewrite-timestamps</a></li><li><a href=#media_timeout aria-label=media_timeout>media_timeout</a></li><li><a href=#media_hold_timeout aria-label=media_hold_timeout>media_hold_timeout</a></li><li><a href=#rtp-autoflush-during-bridge aria-label=rtp-autoflush-during-bridge>rtp-autoflush-during-bridge</a></li><li><a href=#rtp-autoflush aria-label=rtp-autoflush>rtp-autoflush</a></li></ul></li><li><a href=#auth aria-label=Auth>Auth</a><ul><li><a href=#challenge-realm aria-label=challenge-realm>challenge-realm</a></li><li><a href=#accept-blind-auth aria-label=accept-blind-auth>accept-blind-auth</a></li><li><a href=#auth-calls aria-label=auth-calls>auth-calls</a></li><li><a href=#log-auth-failures aria-label=log-auth-failures>log-auth-failures</a></li><li><a href=#auth-all-packets aria-label=auth-all-packets>auth-all-packets</a></li></ul></li><li><a href=#registration aria-label=Registration>Registration</a><ul><li><a href=#disable-register aria-label=disable-register>disable-register</a></li><li><a href=#multiple-registrations aria-label=multiple-registrations>multiple-registrations</a></li><li><a href=#max-registrations-per-extension aria-label=max-registrations-per-extension>max-registrations-per-extension</a></li><li><a href=#inbound-reg-force-matching-username aria-label=inbound-reg-force-matching-username>inbound-reg-force-matching-username</a></li><li><a href=#force-publish-expires aria-label=force-publish-expires>force-publish-expires</a></li><li><a href=#force-register-domain aria-label=force-register-domain>force-register-domain</a></li><li><a href=#force-register-db-domain aria-label=force-register-db-domain>force-register-db-domain</a></li><li><a href=#send-message-query-on-register aria-label=send-message-query-on-register>send-message-query-on-register</a></li><li><a href=#unregister-on-options-fail aria-label=unregister-on-options-fail>unregister-on-options-fail</a></li><li><a href=#nat-options-ping aria-label=nat-options-ping>nat-options-ping</a></li><li><a href=#all-reg-options-ping aria-label=all-reg-options-ping>all-reg-options-ping</a></li><li><a href=#registration-thread-frequency aria-label=registration-thread-frequency>registration-thread-frequency</a></li><li><a href=#ping-mean-interval aria-label=ping-mean-interval>ping-mean-interval</a></li></ul></li><li><a href=#subscription aria-label=Subscription>Subscription</a><ul><li><a href=#force-subscription-expires aria-label=force-subscription-expires>force-subscription-expires</a></li><li><a href=#force-subscription-domain aria-label=force-subscription-domain>force-subscription-domain</a></li></ul></li><li><a href=#presence aria-label=Presence>Presence</a><ul><li><a href=#manage-presence aria-label=manage-presence>manage-presence</a></li><li><a href=#dbname aria-label=dbname>dbname</a></li><li><a href=#presence-hold-state aria-label=presence-hold-state>presence-hold-state</a></li><li><a href=#presence-hosts aria-label=presence-hosts>presence-hosts</a></li><li><a href=#presence-privacy aria-label=presence-privacy>presence-privacy</a></li><li><a href=#send-presence-on-register aria-label=send-presence-on-register>send-presence-on-register</a></li></ul></li><li><a href=#callerid-related-options aria-label="CallerID Related options">CallerID Related options</a><ul><li><a href=#caller-id-type aria-label="caller-id type">caller-id type</a></li><li><a href=#pass-callee-id aria-label=pass-callee-id>pass-callee-id</a></li></ul></li><li><a href=#other-to-do aria-label="Other (TO DO)">Other (TO DO)</a><ul><li><a href=#hold-music aria-label=hold-music>hold-music</a></li><li><a href=#disable-hold aria-label=disable-hold>disable-hold</a></li><li><a href=#apply-inbound-acl aria-label=apply-inbound-acl>apply-inbound-acl</a></li><li><a href=#apply-register-acl aria-label=apply-register-acl>apply-register-acl</a></li><li><a href=#apply-proxy-acl aria-label=apply-proxy-acl>apply-proxy-acl</a></li><li><a href=#record-template aria-label=record-template>record-template</a></li><li><a href=#max-proceeding aria-label=max-proceeding>max-proceeding</a></li><li><a href=#bind-params aria-label=bind-params>bind-params</a></li><li><a href=#disable-transfer aria-label=disable-transfer>disable-transfer</a></li><li><a href=#manual-redirect aria-label=manual-redirect>manual-redirect</a></li><li><a href=#enable-3pcc aria-label=enable-3pcc>enable-3pcc</a></li><li><a href=#nonce-ttl aria-label=nonce-ttl>nonce-ttl</a></li><li><a href=#sql-in-transactions aria-label=sql-in-transactions>sql-in-transactions</a></li><li><a href=#odbc-dsn aria-label=odbc-dsn>odbc-dsn</a></li><li><a href=#mwi-use-reg-callid aria-label=mwi-use-reg-callid>mwi-use-reg-callid</a></li><li><a href=#username aria-label=username>username</a></li></ul></li></ul></li></ul></li><li><a href=#directory-of-users aria-label="Directory of Users">Directory of Users</a></li><li><a href=#default-configuration-file aria-label="Default Configuration File">Default Configuration File</a></li><li><a href=#security-features aria-label="Security Features">Security Features</a></li></ul></li><li><a href=#%e5%8f%82%e8%80%83 aria-label=参考>参考</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h1 id=about>About<a hidden class=anchor aria-hidden=true href=#about>#</a></h1><p>Sofia is a  FreeSWITCH™ module (<a href=https://freeswitch.org/confluence/display/FREESWITCH/mod_sofia>mod_sofia</a>) that provides SIP connectivity to and from FreeSWITCH in the form of a User Agent.
A &ldquo;User Agent&rdquo; (&ldquo;UA&rdquo;) is an application used for handling a certain network protocol; the network protocol in Sofia&rsquo;s case is SIP. Sofia is the general name of any User Agent in FreeSWITCH using the SIP network protocol.
For example, Sofia receives calls sent to FreeSWITCH from other SIP User Agents (UAs), sends calls to other UAs, acts as a client to register FreeSWITCH with other UAs, lets clients register with FreeSWITCH, and connects calls (i.e., to local extensions).
To add a SIP Provider (Sofia User Agent) to your FreeSWITCH, please see the <a href=https://freeswitch.org/confluence/display/FREESWITCH/Interoperability>Interoperability Examples</a> and add the SIP Provider information in an .xml file stored under conf/sip_profiles/</p><p>Click here to expand Table of Contents</p><h2 id=sofia-allows-for-multiple-user-agents>Sofia allows for multiple User Agents<a hidden class=anchor aria-hidden=true href=#sofia-allows-for-multiple-user-agents>#</a></h2><p>A &ldquo;User Agent&rdquo; (&ldquo;UA&rdquo;) is an application used for running a certain network protocol, and a Sofia UA is the same thing but the protocol in that case is SIP.
When FreeSWITCH starts, it reads the conf/autoload_configs/sofia.conf.xml file. That file contains a &ldquo;X-PRE-PROCESS&rdquo; directive which instructs FreeSWITCH to subsequently load and merge any conf/sip_profiles/*.xml files. Each *.xml file so loaded and merged should contain a complete description of one or more SIP Profiles. Each SIP Profile so loaded is part of a &ldquo;User Agent&rdquo; or &ldquo;UA&rdquo;; in FreeSWITCH terms, UA = User Agent = Sofia Profile = SIP Profile.
Note that the individual UAs so loaded are all merged together by FreeSWITCH and must not interfere with each other: In particular, <strong>each UA must have its own unique port on which it accepts connections</strong> (the default port for SIP is 5060).</p><h3 id=multiple-user-agents-profiles-and-the-dialplan>Multiple User Agents (Profiles) and the Dialplan<a hidden class=anchor aria-hidden=true href=#multiple-user-agents-profiles-and-the-dialplan>#</a></h3><p>Why might you want to create multiple User Agents? Here&rsquo;s an example.
In my office, I use a firewall. This means that calls I make to locations outside the firewall must use a STUN server to transverse the NAT in the firewall, while calls within the office don&rsquo;t need to use a STUN server. In order to accommodate these requirements, I&rsquo;ve created two different UAs. One of them uses a STUN server and for that matter also connects up to the PSTN through a service provider. The other UA is purely for local SIP calls.
Now I&rsquo;ve got two UAs defined by my profiles, each of which can handle a call. When dialing a SIP address or telephone number, which UA is used? That determination is made in the dialplan. One syntax for making a call via Sofia in the dialplan is
 sofia/<strong>profile_name</strong>/destination</p><p>So, the task becomes rather straightforward. Dialplans use pattern matching and other tricks to determine how to handle a call. My dialplan examines what I&rsquo;ve dialed and then determines what profile to use with that call. If I dial a telephone number, the dialplan selects the UA that connects up to the PSTN. If I dial a SIP address outside the firewall, the dialplan selects that same UA because it uses the STUN server. But if I dial a SIP address that&rsquo;s inside the firewall, the dialplan selects the &ldquo;local&rdquo; UA.
To understand how to write dialplans, use pattern matching, etc., see <a href=https://freeswitch.org/confluence/display/FREESWITCH/Dialplan>Dialplan</a></p><h3 id=the-relationship-between-sip-profiles-and-domains>The Relationship Between SIP Profiles and Domains<a hidden class=anchor aria-hidden=true href=#the-relationship-between-sip-profiles-and-domains>#</a></h3><p>The following content was written in a <a href=http://lists.freeswitch.org/pipermail/freeswitch-users/2012-November/089467.html>mailing list thread</a> by Anthony Minessale in response to questions about how SIP profiles relate to domain names in FreeSWITCH.
The best thing to do is take a look at these things from a step back.
The domains inside the XML registry are completely different from the domains on the internet and again completely different from domains in sip packets. The profiles are again entirely different from any of the above. Its up to you to align them if you so choose.
The default configuration distributed with FreeSWITCH sets up the scenario most likely to load on any machine and work out of the box. That is the primary goal of that configuration, so, It sets the domain in both the directory, the global default domain variable and the name of the internal profile to be identical to the IP addr on the box that can reach the internet. Then it sets the sip to force everything to that value. When you want to detach from this behavior, you are probably on a venture to do some kind of multi-home setup.
<strong>Aliases</strong> in the tag are a list of keys you want to use to use that lead to the current profile your are configuring. Think of it as the /etc/hosts file in Unix, only for profiles. When you define aliases to match all of the possible domains hosted on a particular profile, then when you try to take a <a href=mailto:user@host.com>user@host.com</a> notation and decide which profile it came from, you can use the aliases to find it providing you have added to that profile.
The tag is an indicator telling the profile to open the XML registry in FreeSWITCH and run through any domains defined therein. The 2 key attributes are:
alias: [true/false]  (automatically create an alias for this domain as mentioned above)
parse: [true/false] (scan the domain for gateway entries and include them into this profile)
name: [] (either the name of a specific domain or &lsquo;all&rsquo; to denote parsing every domain in the directory)</p><p>As you showed in your question the default config has</p><p>If you apply what you have learned above, it will scan for every domain (there is only one by default) and add an alias for it and not parse it for gateways. The default directory uses global config vars to set the domain to match the local IP addr on the box. So now you will have a domain in your config that is your IP addr, and the internal profile will attach to it and add an alias so that value expands to match it.
This is explained in a comment at the top of directory/default.xml:
    FreeSWITCH works off the concept of users and domains just like email.
    You have users that are in domains for example <a href=mailto:1000@domain.com>1000@domain.com</a>.</p><p>    When freeswitch gets a register packet it looks for the user in the directory
    based on the from or to domain in the packet depending on how your sofia profile
    is configured.  Out of the box the default domain will be the IP address of the
    machine running FreeSWITCH.  This IP can be found by typing &ldquo;sofia status&rdquo; at the
    CLI.  You will register your phones to the IP and not the hostname by default.
    If you wish to register using the domain please open vars.xml in the root conf
    directory and set the default domain to the hostname you desire.  Then you would
    use the domain name in the client instead of the IP address to register
    with FreeSWITCH.</p><p>So having more than one profile with the default of</p><p>is going to end up aliasing the same domains into all profiles who call it and cause an overwrite in the lookup table and probably an error in your logs somewhere. If you had parse=&ldquo;true&rdquo; on all of them, they would all try and register to the gateways in all of your domains.
If you look at the stock config, external.xml is a good example of a secondary profile, it has</p><p>so no aliases, and yes parse &mldr; the exact opposite of the internal so that all the gateways would register from external and internal would bind to the local IP addr.
So, you probably want to use separate per domain per profile you want to bind it to in more complicated setups.</p><h2 id=structure-of-a-profile>Structure of a Profile<a hidden class=anchor aria-hidden=true href=#structure-of-a-profile>#</a></h2><p>Each profile may contain several different subsections. At the present time there&rsquo;s no XSD or DTD for sofia.conf.xml — and any volunteer who can create one would be very welcome indeed.</p><h3 id=gateway>Gateway<a hidden class=anchor aria-hidden=true href=#gateway>#</a></h3><p>Each profile can have several gateways:
 
   <em>elements&mldr;</em>
 
 
   <em>elements&mldr;</em>
 </p><p>A gateway has an attribute &ldquo;name&rdquo; by which it can be referred. A gateway describes how to use a different UA to reach destinations. For example, the gateway may provide access to the PSTN, or to a private SIP network. The reason for defining a gateway, presumably, is because the gateway requires certain information before it will accept a call from the FreeSWITCH User Agent.
Variables can be defined on a gateway. Inbound variables are set on the channel of a call received from a gateway, outbound variables are set on the channel of a call sent to a gateway.
An example gateway configuration would be:
 
   
   
   
   
   
   
   
   
   
   
     
     
     
   
 </p><p>To reach a particular gateway from the dial plan, use
sofia/gateway/&lt;gateway_name>/</p><p>FreeSWITCH can also subscribe to receive notification of events from the gateway. For more information see <a href=https://freeswitch.org/confluence/display/FREESWITCH/Presence#Presence-UseFreeSWITCHasaclient>Presence - Use FreeSWITCH as a Client</a></p><h4 id=parameters>Parameters<a hidden class=anchor aria-hidden=true href=#parameters>#</a></h4><p>The following is a list of param elements that are children of a gateway element:</p><p>Note: The username param for the gateway is not to be confused with the username param in the Profile settings config!</p><p>Note: <em>extension</em> parameter influence the contents of channel variable <em>Caller-Destination-Number</em> and <em>destination_number</em>. If it is blank, <em>Caller-Destination-Number</em> will always be set to gateway&rsquo;s username. If it has a value, <em>Caller-Destination-Number</em> will always be set to this value. If it has value <em>auto_to_user</em>, <em>Caller-Destination-Number</em> will be populated with value <em>${sip_to_user}</em> which means the real dialled number in case of an inbound call.</p><p><strong>ping-min</strong> means &ldquo;how many successful pings we must have before declaring a gateway up&rdquo;.
The interval between <strong>ping-min</strong> and <strong>ping-max</strong> is the &ldquo;safe area&rdquo; where a gateway is marked as UP. So if we have, for example, min 3 and max 6, if the gateway is up and we move counter between 3,4,5,6 the gateway will be up.
If from 6 we loose 4 (so counter == 2) pings in a row, the gateway will be declared down.
Please note that on sofia startup the gateway is always started as UP, so it will be up even if ping-min is > 1 . the &ldquo;right&rdquo; way starts when the gateway goes down.</p><p>Param &ldquo;register,&rdquo; is used when this profile acts as a client to another UA. By registering, FreeSWITCH informs the other UA of its whereabouts. This is generally used when FreeSWITCH wants the other UA to send FreeSWITCH calls, and the other UA expects this sort of registration. If FreeSWITCH uses the other UA only as a gateway (e.g., to the PSTN), then registration is not generally required.
Param &ldquo;distinct-to&rdquo; is used when you want FS to register using a distict AOR for header To. It requires proper setting of related parameters. For example if you want the REGISTER to go with:
   From: <a href=sip:someuser@somedomain.com>sip:someuser@somedomain.com</a>
   To: <a href=sip:anotheruser@anotherdomain.com>sip:anotheruser@anotherdomain.com</a></p><p>Then set the parameters as this:
   
   
   
   
   
   
   </p><p>The latter param, &ldquo;ping&rdquo; is used to check gateway availability. By setting this option, FreeSWITCH will send SIP OPTIONS packets to gateway. If gateway responds with 200 or 404, gateway is pronounced up, otherwise down. [N.B. It appears that other error messages can be returned and still result in the gateway being marked as &lsquo;up&rsquo;?] If any call is routed to gateway with state down, FreeSWITCH will generate NETWORK_OUT_OF_ORDER hangup cause. Ping frequency is defined in seconds (value attribute) and has a minimum value of 5 seconds.
Param &ldquo;extension-in-contact&rdquo; is used to force what the contact info will be in the registration. If you are having a problem with the default registering as gw+gateway_name@ip you can set this to true to use extension@ip. If extension is blank, it will use username@ip.</p><p>if you need to insert the FROM digits to the Contact URI User Part when sending call to gateway
BEFORE
From: &ldquo;8885551212&rdquo; <a href=sip:88855512120@8.8.8.8>sip:88855512120@8.8.8.8</a>
Contact: <a href=sip:gw+mygateway@7.7.7.7:7080>sip:gw+mygateway@7.7.7.7:7080</a>
try adding these to gateway params</p><p>These channel variables will be set on all calls going through this gateway in the specified direction.
However, see below for a special syntax to set profile variables rather than channel variables.</p><h3 id=settings>Settings<a hidden class=anchor aria-hidden=true href=#settings>#</a></h3><p>Settings include other, more general information about the profile, including whether or not STUN is in use. Each profile has its own settings element. Not only is this convenient — it&rsquo;s possible to set up one profile to use STUN and another, with a different gateway or working behind the firewall, not needing STUN — but it&rsquo;s also crucial. That&rsquo;s because each profile defines a SIP User Agent, and each UA must have its own unique &ldquo;sip-port.&rdquo; By convention, 5060 is the default port, but it&rsquo;s possible to make calls to, e.g., &ldquo;foo@<a href=http://sip.example.com/>sip.example.com</a>:5070&rdquo;, and therefore you can define any port you please for each individual profile.
The conf directory contains a complete sample sofia.conf.xml file, along with comments. See Git examples: <a href=http://fisheye.freeswitch.org/browse/freeswitch.git/conf/sip_profiles/internal.xml>Internal</a>, <a href=http://fisheye.freeswitch.org/browse/freeswitch.git/conf/sip_profiles/external.xml>External</a></p><h4 id=basic-settings>Basic settings<a hidden class=anchor aria-hidden=true href=#basic-settings>#</a></h4><h5 id=alias>alias<a hidden class=anchor aria-hidden=true href=#alias>#</a></h5><p>This seems to make the SIP profile bind to this IP & port as well as your SIP / RTP IPs and ports.
Anthony had this to say about aliases in a <a href=http://lists.freeswitch.org/pipermail/freeswitch-users/2012-November/089467.html>ML thread</a>:
Aliases in the tag are a list of keys you want to use to use that lead 
to the current profile your are configuring.  Think of it as the /etc/hosts file 
in unix only for profiles.   When you define aliases to match all of the possible 
domains hosted on a particular profile, then when you try to take a <a href=mailto:user@host.com>user@host.com</a> 
notation and decide which profile it came from, you can use the aliases to find 
it providing you have added to that profile.</p><h5 id=shutdown-on-fail>shutdown-on-fail<a hidden class=anchor aria-hidden=true href=#shutdown-on-fail>#</a></h5><p>If set to true and the profile fails to load, FreeSWITCH will shut down. This is useful if you are running something like Pacemaker and OpenAIS which manage a pair of FreeSWITCH nodes and automatically monitor, start, stop, restart, and standby-on-fail the nodes. It will ensure that the specific node is not able to be used in a &ldquo;partially up&rdquo; situation.</p><h5 id=user-agent-string>user-agent-string<a hidden class=anchor aria-hidden=true href=#user-agent-string>#</a></h5><p>This sets the User-Agent header in all SIP messages sent by your server. By default this could be something like &ldquo;FreeSWITCH-mod_sofia/1.0.trunk-12805&rdquo;. If you didn&rsquo;t want to advertise detailed version information you could simply set this to &ldquo;FreeSWITCH&rdquo; or even &ldquo;Asterisk PBX&rdquo; as a joke.
Take care when setting this value as certain characters such as &lsquo;@&rsquo; could cause other SIP proxies could reject your messages as invalid.</p><h5 id=log-level>log-level<a hidden class=anchor aria-hidden=true href=#log-level>#</a></h5><h5 id=sip-trace>sip-trace<a hidden class=anchor aria-hidden=true href=#sip-trace>#</a></h5><h5 id=context>context<a hidden class=anchor aria-hidden=true href=#context>#</a></h5><p>Dialplan context in which to dump calls that come in to this profile&rsquo;s ip:port</p><h5 id=sip-port>sip-port<a hidden class=anchor aria-hidden=true href=#sip-port>#</a></h5><p>Port to bind to for SIP traffic:</p><h5 id=sip-ip>sip-ip<a hidden class=anchor aria-hidden=true href=#sip-ip>#</a></h5><p>IP address to bind to for SIP traffic. <strong>DO NOT USE HOSTNAMES, ONLY IP ADDRESSES</strong></p><h5 id=rtp-ip>rtp-ip<a hidden class=anchor aria-hidden=true href=#rtp-ip>#</a></h5><p>IP address to bind to for RTP traffic. <strong>DO NOT USE HOSTNAMES, ONLY IP ADDRESSES</strong>
 </p><ul><li>Multiple rtp-ip support: if more rtp-ip parameters are added, they will be used in round-robin as new calls progress.</li><li>IPv6 addresses <strong>are not supported</strong> under Windows at the time of writing. See <a href=http://jira.freeswitch.org/browse/FS-4445>FS-4445</a></li></ul><h5 id=ext-rtp-ip>ext-rtp-ip<a hidden class=anchor aria-hidden=true href=#ext-rtp-ip>#</a></h5><p>This is the IP behind which FreeSWITCH is seen from the Internet, so if FreeSWITCH is behind NAT, this is basically the public IP that should be used for RTP.
Possible values are:
Any variable from vars.xml, e.g. $${external_rtp_ip}:</p><p>&ldquo;specific IP address&rdquo;</p><p>&ldquo;when used for LAN and WAN to avoid errors in the SIP CONTACT sent to LAN devices, use&rdquo;</p><p>&ldquo;auto&rdquo;: the guessed IP will be used (guessed by looking in the IP routing table which interface is the default route)</p><p>&ldquo;auto-nat&rdquo;: FreeSWITCH will use uPNP or NAT-PMP to discover the public IP address it should use</p><p>&ldquo;stun:DNS name or IP address&rdquo;: FreeSWITCH will use the STUN server of your choice to discover the public IP address</p><p>&ldquo;host:DNS name&rdquo;: FreeSWITCH will resolve the DNS name as the public IP address, so you can use a dynamic DNS host</p><p>ATTENTION: AS OF 2012Q4, &rsquo;ext–&rsquo; prefixed params cited above when populated with to-be-resolved DNS strings &ndash; e.g. name=&ldquo;ext–sip–ip&rdquo; value=&ldquo;stun:<a href=http://stun.freeswitch.org/>stun.freeswitch.org</a>&rdquo; or name=&ldquo;ext‑rtp–ip&rdquo; value=&ldquo;host:<a href=http://mypublicip.dyndns.org/>mypublicIP.dyndns.org</a>&rdquo; &ndash; are resolved to IP addresses once only at FS load time and const thereafter. FS is blind to (unaware of) any subsequent changes in your environment&rsquo;s IP address. Thus, these ext– vars may become functionally incompatible with the environment&rsquo;s current IP addresses with <em>unspecified results</em> in call flow at the network layer. FS restart is <em><strong>required</strong></em> for FS to capture the now-current, working IP address(es).</p><h5 id=ext-sip-ip>ext-sip-ip<a hidden class=anchor aria-hidden=true href=#ext-sip-ip>#</a></h5><p>This is the IP behind which FreeSWITCH is seen from the Internet, so if FreeSWITCH is behind NAT, this is basically the public IP that should be used for SIP.
Possibles values are the same as those for ext-rtp-ip, and it is usually set to the same value.</p><h5 id=tcp-keepalive>tcp-keepalive<a hidden class=anchor aria-hidden=true href=#tcp-keepalive>#</a></h5><p>Set this to interval (in milliseconds) to send keep alive packets to user agents (UAs) registered via TCP; do not set to disable.</p><h5 id=tcp-pingpong>tcp-pingpong<a hidden class=anchor aria-hidden=true href=#tcp-pingpong>#</a></h5><h5 id=tcp-ping2pong>tcp-ping2pong<a hidden class=anchor aria-hidden=true href=#tcp-ping2pong>#</a></h5><h5 id=dialplan>dialplan<a hidden class=anchor aria-hidden=true href=#dialplan>#</a></h5><p>The dialplan parameter is very powerful.
In the simplest configuration, it will use the XML dialplan. This means that it will read data from <a href=https://wiki.freeswitch.org/wiki/Mod_xml_curl>mod_xml_curl</a> XML dialplans (e.g., callback to your webserver), or failing that, from the XML files specified in freeswitch.xml dialplan section. (e.g. default_context.xml)</p><p>You can also add enum lookups into the picture (since mod_enum provides dialplan functionality), so enum lookups override the XML dialplan</p><p>Or reverse the order to enum is only consulted if XML lookup fails</p><p>It is also possible to specify a specific enum root</p><p>Or use XML on a custom file</p><p>Where it will first check the specific XML file, then hit normal XML which also do a <a href=https://freeswitch.org/confluence/display/FREESWITCH/mod_xml_curl>mod_xml_curl</a> lookup assuming you have that configured and working.</p><h4 id=media-related-options>Media related options<a hidden class=anchor aria-hidden=true href=#media-related-options>#</a></h4><p>See also: <a href=https://freeswitch.org/confluence/display/FREESWITCH/Proxy+Media>Proxy Media</a></p><h5 id=resume-media-on-hold>resume-media-on-hold<a hidden class=anchor aria-hidden=true href=#resume-media-on-hold>#</a></h5><p>When calls are in no media this will bring them back to media when you press the hold button. To return the calls to bypass-media after the call is unheld, enable bypass-media-after-hold.</p><h5 id=bypass-media-after-att-xfer>bypass-media-after-att-xfer<a hidden class=anchor aria-hidden=true href=#bypass-media-after-att-xfer>#</a></h5><p>This will allow a call after an attended transfer go back to bypass media after an attended transfer.
 </p><h5 id=bypass-media-after-hold>bypass-media-after-hold<a hidden class=anchor aria-hidden=true href=#bypass-media-after-hold>#</a></h5><p>This will allow a call to go back to bypass media after a hold. This option can be enabled only if resume-media-on-hold is set. Available from git rev 8fa385b.
 </p><h5 id=inbound-bypass-media>inbound-bypass-media<a hidden class=anchor aria-hidden=true href=#inbound-bypass-media>#</a></h5><p>Uncomment to set all inbound calls to no media mode. It means that the FreeSWITCH server only keeps the SIP messages state, but have the RTP steam go directly from end-point to end-point</p><h5 id=inbound-proxy-media>inbound-proxy-media<a hidden class=anchor aria-hidden=true href=#inbound-proxy-media>#</a></h5><p>Uncomment to set all inbound calls to proxy media mode. This means the FreeSWITCH keeps both the SIP and RTP traffic on the server but does not interact with the RTP stream.</p><h5 id=disable-rtp-auto-adjust>disable-rtp-auto-adjust<a hidden class=anchor aria-hidden=true href=#disable-rtp-auto-adjust>#</a></h5><h5 id=ignore-183nosdp>ignore-183nosdp<a hidden class=anchor aria-hidden=true href=#ignore-183nosdp>#</a></h5><h5 id=enable-soa>enable-soa<a hidden class=anchor aria-hidden=true href=#enable-soa>#</a></h5><p>Set the value to &ldquo;false&rdquo; to diable SIP SOA from sofia to tell sofia not to touch the exchange of SDP</p><h5 id=t38-passthru>t38-passthru<a hidden class=anchor aria-hidden=true href=#t38-passthru>#</a></h5><p>The following options are available</p><ul><li>&rsquo;true&rsquo; enables t38 passthru</li><li>&lsquo;false&rsquo; disables t38 passthru</li><li>&lsquo;once&rsquo; enables t38 passthru, but sends t.38 re-invite only once (available since commit 08b25a8 from Nov. 9, 2011)</li></ul><h4 id=codecs-related-options>Codecs related options<a hidden class=anchor aria-hidden=true href=#codecs-related-options>#</a></h4><p>Also see:</p><ul><li><a href=https://freeswitch.org/confluence/display/FREESWITCH/Codec+Negotiation>Codec Negotiation</a></li><li><a href=https://freeswitch.org/confluence/display/FREESWITCH/Audio+Codecs>Supported Codecs</a></li></ul><h5 id=inbound-codec-prefs>inbound-codec-prefs<a hidden class=anchor aria-hidden=true href=#inbound-codec-prefs>#</a></h5><p>This parameter allows to change the allowed inbound codecs per profile.
 </p><h5 id=outbound-codec-prefs>outbound-codec-prefs<a hidden class=anchor aria-hidden=true href=#outbound-codec-prefs>#</a></h5><p>This parameter allows to change the outbound codecs per profile.
 </p><h5 id=codec-prefs>codec-prefs<a hidden class=anchor aria-hidden=true href=#codec-prefs>#</a></h5><p>This parameter allows to change both inbound-codec-prefs and outbound-codec-prefs at the same time.
 </p><h5 id=inbound-codec-negotiation>inbound-codec-negotiation<a hidden class=anchor aria-hidden=true href=#inbound-codec-negotiation>#</a></h5><p>set to &lsquo;greedy&rsquo; if you want your codec list to take precedence
 </p><p>if &lsquo;greedy&rsquo; doesn&rsquo;t work for you, try &lsquo;scrooge&rsquo; which has been known to fix misreported ptime issues with DID providers such as CallCentric.
A rule of thumb is:</p><ul><li>&lsquo;generous&rsquo; permits the remote codec list have precedence and &lsquo;win&rsquo; the codec negotiation and selection process</li><li>&lsquo;greedy&rsquo; forces a win by the local FreeSWITCH preference list</li><li>&lsquo;scrooge&rsquo; takes &lsquo;greedy&rsquo; a step further, so that the FreeSWITCH wins even when the far side lies about capabilities during the negotiation process</li></ul><p><a href=https://freeswitch.org/confluence/display/FREESWITCH/sip_codec_negotiation>sip_codec_negotiation</a> is a channel variable version of this setting</p><h5 id=inbound-late-negotiation>inbound-late-negotiation<a hidden class=anchor aria-hidden=true href=#inbound-late-negotiation>#</a></h5><p>Uncomment to let calls hit the dialplan <em>before</em> you decide if the codec is OK.
 </p><h5 id=bitpacking>bitpacking<a hidden class=anchor aria-hidden=true href=#bitpacking>#</a></h5><p>This setting is for AAL2 bitpacking on G.726.
 </p><h5 id=disable-transcoding>disable-transcoding<a hidden class=anchor aria-hidden=true href=#disable-transcoding>#</a></h5><p>Uncomment if you want to force the outbound leg of a bridge to only offer the codec that the originator is using</p><h5 id=renegotiate-codec-on-reinvite>renegotiate-codec-on-reinvite<a hidden class=anchor aria-hidden=true href=#renegotiate-codec-on-reinvite>#</a></h5><h4 id=stun>STUN<a hidden class=anchor aria-hidden=true href=#stun>#</a></h4><p>If you need to use a STUN server, here are common working examples:</p><h5 id=ext-rtp-ip-1>ext-rtp-ip<a hidden class=anchor aria-hidden=true href=#ext-rtp-ip-1>#</a></h5><p><a href=http://stun.fwdnet.net/>stun.fwdnet.net</a> is a publicly-accessible STUN server.</p><h5 id=ext-sip-ip-1>ext-sip-ip<a hidden class=anchor aria-hidden=true href=#ext-sip-ip-1>#</a></h5><h5 id=stun-enabled>stun-enabled<a hidden class=anchor aria-hidden=true href=#stun-enabled>#</a></h5><p>Simple traversal of UDP over NATs (STUN), is used to help resolve the problems associated with SIP clients, behind NAT, using private IP address space in their messaging. Use stun when specified (default is true).</p><h5 id=stun-auto-disable>stun-auto-disable<a hidden class=anchor aria-hidden=true href=#stun-auto-disable>#</a></h5><p>Set to true to have the profile determine stun is not useful and turn it off globally</p><h4 id=nating>NATing<a hidden class=anchor aria-hidden=true href=#nating>#</a></h4><h5 id=apply-nat-acl>apply-nat-acl<a hidden class=anchor aria-hidden=true href=#apply-nat-acl>#</a></h5><p>When receiving a REGISTER or INVITE, enable <a href=https://freeswitch.org/confluence/display/FREESWITCH/NAT>NAT mode</a> automatically if IP address in Contact header matches an entry defined in the <a href=https://tools.ietf.org/html/rfc1918>RFC 1918</a> <a href=https://wiki.freeswitch.org/wiki/ACL>access list</a>. &ldquo;acl&rdquo; is a misnomer in this case because access will not be denied if the user&rsquo;s contact IP doesn&rsquo;t match.</p><h5 id=aggressive-nat-detection>aggressive-nat-detection<a hidden class=anchor aria-hidden=true href=#aggressive-nat-detection>#</a></h5><p>This will enable NAT mode if the network IP/port from which the request was received differs from the IP/Port combination in the SIP Via: header, or if the Via: header contains the received parameter (regardless of what it contains.) <strong>Note 2009-04-05:</strong> Someone please clarify when this would be useful. It seems to me if someone needed this feature, chances are that things are so broken that they would need to use NDLB-force-rport</p><h4 id=vad-and-cng>VAD and CNG<a hidden class=anchor aria-hidden=true href=#vad-and-cng>#</a></h4><p>VAD stands for <a href=https://freeswitch.org/confluence/display/FREESWITCH/VAD+and+CNG>Voice Activity Detector</a>. FreeSWITCH is capable of detecting speech and can stop transmitting RTP packets when no voice is detected.</p><h5 id=vad>vad<a hidden class=anchor aria-hidden=true href=#vad>#</a></h5><h5 id=suppress-cng>suppress-cng<a hidden class=anchor aria-hidden=true href=#suppress-cng>#</a></h5><p>Suppress Comfort Noise Generator (CNG) on this profile or per call with the &lsquo;suppress_cng&rsquo; variable</p><h4 id=ndlb-aka-no-device-left-behind>NDLB (A.K.A. No device left behind)<a hidden class=anchor aria-hidden=true href=#ndlb-aka-no-device-left-behind>#</a></h4><h5 id=ndlb-force-rport>NDLB-force-rport<a hidden class=anchor aria-hidden=true href=#ndlb-force-rport>#</a></h5><p>This will force FreeSWITCH to send SIP responses to the network port from which they were received. <strong>Use at your own risk!</strong> For more information see <a href=https://freeswitch.org/confluence/display/FREESWITCH/NAT+Traversal>NAT Traversal</a>.</p><ul><li>safe = param that does force-rport behavior only on endpoints we know are safe to do so on. This is a dirty hack to try to work with certain endpoints behind sonicwall which does not use the same port when it does nat, when the devices do not support rport, while not breaking devices that acutally use different ports that force-rport will break</li></ul><h5 id=ndlb-broken-auth-hash>NDLB-broken-auth-hash<a hidden class=anchor aria-hidden=true href=#ndlb-broken-auth-hash>#</a></h5><p>Used for when phones respond to a challenged ACK with method INVITE in the hash</p><h5 id=ndlb-received-in-nat-reg-contact>NDLB-received-in-nat-reg-contact<a hidden class=anchor aria-hidden=true href=#ndlb-received-in-nat-reg-contact>#</a></h5><p>add a ;received=":" to the contact when replying to register for nat handling</p><h5 id=ndlb-sendrecv-in-session>NDLB-sendrecv-in-session<a hidden class=anchor aria-hidden=true href=#ndlb-sendrecv-in-session>#</a></h5><p>By default, &ldquo;a=sendrecv&rdquo; is only included in the media portion of the SDP. While this is RFC-compliant, it may break functionality for some SIP devices. To also include &ldquo;a=sendrecv&rdquo; in the session portion of the SDP, set this parameter to true.</p><h5 id=ndlb-allow-bad-iananame>NDLB-allow-bad-iananame<a hidden class=anchor aria-hidden=true href=#ndlb-allow-bad-iananame>#</a></h5><ul><li>Introduced in rev. 15401, this was enabled by default prior to new param.</li></ul><p>Will allow codecs to match respective name even if the given string is not correct.
i.e., Linksys and Sipura phones will pass G.729a by default instead of G.729 as codec string therefore not matching.
If you wish to allow bad IANA names to match respective codec string, add the following param to your SIP profile.
 </p><p>Refer to <a href=https://tools.ietf.org/html/rfc3551>RFC 3551</a>, <a href=https://tools.ietf.org/html/rfc3555>RFC 3555</a> and the IANA list(s) for SDP</p><h4 id=call-id>Call ID<a hidden class=anchor aria-hidden=true href=#call-id>#</a></h4><h5 id=inbound-use-callid-as-uuid>inbound-use-callid-as-uuid<a hidden class=anchor aria-hidden=true href=#inbound-use-callid-as-uuid>#</a></h5><p>On inbound calls make the uuid of the session equal to the SIP call id of that call.</p><h5 id=outbound-use-uuid-as-callid>outbound-use-uuid-as-callid<a hidden class=anchor aria-hidden=true href=#outbound-use-uuid-as-callid>#</a></h5><p>On outbound calls set the callid to match the uuid of the session</p><p>This goes in the &ldquo;..sip_profiles/external.xml&rdquo; file.</p><h4 id=tls>TLS<a hidden class=anchor aria-hidden=true href=#tls>#</a></h4><p>Please make sure to read <a href=https://freeswitch.org/confluence/display/FREESWITCH/SIP+TLS>SIP TLS</a> before enabling certain features below as they may not behave as expected.</p><h5 id=tls-1>tls<a hidden class=anchor aria-hidden=true href=#tls-1>#</a></h5><p>TLS: disabled by default, set to &ldquo;true&rdquo; to enable
   </p><h5 id=tls-only>tls-only<a hidden class=anchor aria-hidden=true href=#tls-only>#</a></h5><p>disabled by default, when enabled prevents sofia from listening on the unencrypted port for this connection. This can stop many generic brute force scripts and if all your clients connect over TLS then can help decrease the exposure of your FreeSWITCH server to the world.
   </p><h5 id=tls-bind-params>tls-bind-params<a hidden class=anchor aria-hidden=true href=#tls-bind-params>#</a></h5><p>additional bind parameters for TLS
   </p><h5 id=tls-sip-port>tls-sip-port<a hidden class=anchor aria-hidden=true href=#tls-sip-port>#</a></h5><p>Port to listen on for TLS requests. (5061 will be used if unspecified)
   </p><h5 id=tls-cert-dir>tls-cert-dir<a hidden class=anchor aria-hidden=true href=#tls-cert-dir>#</a></h5><p>Location of the agent.pem and cafile.pem ssl certificates (needed for TLS server)
   </p><h5 id=tls-version>tls-version<a hidden class=anchor aria-hidden=true href=#tls-version>#</a></h5><p>TLS version (&ldquo;sslv2&rdquo;, &ldquo;sslv3&rdquo;, &ldquo;sslv23&rdquo;, &ldquo;tlsv1&rdquo;, &ldquo;tlsv1.1&rdquo;, &ldquo;tlsv1.2&rdquo;). NOTE: Phones may not work with TLSv1
   </p><p>When not set defaults to: &ldquo;tlsv1,tlsv1.1,tlsv1.2&rdquo;</p><h5 id=tls-passphrase>tls-passphrase<a hidden class=anchor aria-hidden=true href=#tls-passphrase>#</a></h5><p>If your agent.pem is protected by a passphrase stick the passphrase here to enable FreeSWITCH to decrypt the key.
   </p><h5 id=tls-verify-date>tls-verify-date<a hidden class=anchor aria-hidden=true href=#tls-verify-date>#</a></h5><p>If the client/server certificate should have the date on it validated to ensure it is not expired and is currently active.
   </p><h5 id=tls-verify-policy>tls-verify-policy<a hidden class=anchor aria-hidden=true href=#tls-verify-policy>#</a></h5><p>This controls what, if any security checks are done against server/client certificates. Verification is generally checking certificates are valid against the cafile.pem. Set to &lsquo;in&rsquo; to only verify incoming connections, &lsquo;out&rsquo; to only verify outgoing connections, &lsquo;all&rsquo; to verify all connections, also &lsquo;subjects_in&rsquo;, &lsquo;subjects_out&rsquo; and &lsquo;subjects_all&rsquo; for subject validation (subject validation for outgoing connections is against the hostname/ip connecting to). Multiple policies can be split with a &lsquo;|&rsquo; pipe, for example &lsquo;subjects_in|subjects_out&rsquo;. Defaults to none.
   </p><h5 id=tls-verify-depth>tls-verify-depth<a hidden class=anchor aria-hidden=true href=#tls-verify-depth>#</a></h5><p>When certificate validation is enabled (tls-verify-policy) how deep should we try to verify a certificate up the chain again the cafile.pem file. By default only depth of 2.
   </p><h5 id=tls-verify-in-subjects>tls-verify-in-subjects<a hidden class=anchor aria-hidden=true href=#tls-verify-in-subjects>#</a></h5><p>If subject validation is enabled for incoming connections (tls-verify-policy set to &lsquo;subjects_in&rsquo; or &lsquo;subjects_all&rsquo;) this is the list of subjects that are allowed (delimit with a &lsquo;|&rsquo; pipe), note this only effects incoming connections for outgoing connections subjects are always checked against hostnames/ips.
   </p><h4 id=dtmf>DTMF<a hidden class=anchor aria-hidden=true href=#dtmf>#</a></h4><h5 id=rfc2833-pt>rfc2833-pt<a hidden class=anchor aria-hidden=true href=#rfc2833-pt>#</a></h5><p><strong>TODO</strong> <a href=https://tools.ietf.org/html/rfc2833>RFC 2833</a> is obsoleted by <a href=https://tools.ietf.org/html/rfc4733>RFC 4733</a>.</p><h5 id=dtmf-duration>dtmf-duration<a hidden class=anchor aria-hidden=true href=#dtmf-duration>#</a></h5><h5 id=dtmf-type>dtmf-type<a hidden class=anchor aria-hidden=true href=#dtmf-type>#</a></h5><p><strong>TODO</strong> <a href=https://tools.ietf.org/html/rfc2833>RFC 2833</a> is obsoleted by <a href=https://tools.ietf.org/html/rfc4733>RFC 4733</a>.
Set the parameter in the SIP profile:</p><p>or</p><p>or</p><p>OR set the variable in the SIP gateway or user profile (NOT in the channel, it must be before CS_INIT):
   </p><p>Note the &ldquo;_&rdquo; instead of &ldquo;-&rdquo; in profile param (this is var set in dialplan). (24.10.2010: &ldquo;both&rdquo; don&rsquo;t seem to me work in my tests, &ldquo;outbound&rdquo; does)
Note: for inband DTMF, <a href=https://freeswitch.org/confluence/display/FREESWITCH/mod_dptools%3A+start_dtmf>Misc. Dialplan Tools start_dtmf</a> must be used in the dialplan.
Also, to change the outgoing routing from info or rfc2833 to inband, use <a href=https://freeswitch.org/confluence/display/FREESWITCH/mod_dptools%3A+start_dtmf_generate>Misc._Dialplan_Tools_start_dtmf_generate</a>
<a href=http://tools.ietf.org/html/rfc2833>RFC 2833</a></p><h5 id=pass-rfc2833httpsfreeswitchorgconfluencedisplayfreeswitchpass_rfc2833><a href=https://freeswitch.org/confluence/display/FREESWITCH/pass_rfc2833>pass-rfc2833</a><a hidden class=anchor aria-hidden=true href=#pass-rfc2833httpsfreeswitchorgconfluencedisplayfreeswitchpass_rfc2833>#</a></h5><p><strong>TODO</strong> <a href=https://tools.ietf.org/html/rfc2833>RFC 2833</a> is obsoleted by <a href=https://tools.ietf.org/html/rfc4733>RFC 4733</a>.
<em>Default: false</em>
If true, it passes <a href=https://tools.ietf.org/html/rfc2833>RFC 2833</a> DTMF&rsquo;s from one side of a bridge to the other, untouched. Otherwise, it decodes and re-encodes them before passing them on.</p><h5 id=liberal-dtmf>liberal-dtmf<a hidden class=anchor aria-hidden=true href=#liberal-dtmf>#</a></h5><p><strong>TODO</strong> <a href=https://tools.ietf.org/html/rfc2833>RFC 2833</a> is obsoleted by <a href=https://tools.ietf.org/html/rfc4733>RFC 4733</a>.
<em>Default: false</em>
For DTMF negotiation, use this parameter to just always offer 2833 and accept both 2833 and INFO. Use of this parameter is not recommended since its purpose is to try to cope with buggy SIP implementations.</p><h4 id=sip-related-options>SIP Related options<a hidden class=anchor aria-hidden=true href=#sip-related-options>#</a></h4><h5 id=enable-timer>enable-timer<a hidden class=anchor aria-hidden=true href=#enable-timer>#</a></h5><p>This enables or disables support for <a href=http://tools.ietf.org/html/rfc4028>RFC 4028</a> SIP Session Timers.</p><p>Note: If your switch requires the timer option; for instance, Huawei SoftX3000, it needs this optional field and drops the calls with &ldquo;Session Timer Check Message Failed&rdquo;, then you may be able to revert back the commit that took away the Require: timer option which is an optional field by:
git log -1 -p 58c3c3a049991fedd39f62008f8eb8fca047e7c5 libs/sofia-sip/libsofia-sip-ua | patch -p1 -R
touch libs/sofia-sip/.update</p><p>make mod_sofia-clean
make mod_sofia-install</p><h5 id=enable-100rel>enable-100rel<a hidden class=anchor aria-hidden=true href=#enable-100rel>#</a></h5><p>This enable support for 100rel (100% reliability - PRACK message as defined in <a href=http://tools.ietf.org/html/rfc3262>RFC3262</a>) This fixes a problem with SIP where provisional messages like &ldquo;180 Ringing&rdquo; are not ACK&rsquo;d and therefore could be dropped over a poor connection without retransmission. <em>2009-07-08:</em> Enabling this may cause FreeSWITCH to crash, see <a href=http://jira.freeswitch.org/browse/FSCORE-392>FSCORE-392</a>.</p><h5 id=minimum-session-expires>minimum-session-expires<a hidden class=anchor aria-hidden=true href=#minimum-session-expires>#</a></h5><p>This sets the &ldquo;Min-SE&rdquo; value (in seconds) from <a href=http://tools.ietf.org/html/rfc4028>RFC 4028</a>. This value must not be less than 90 seconds.</p><h5 id=sip-options-respond-503-on-busy>sip-options-respond-503-on-busy<a hidden class=anchor aria-hidden=true href=#sip-options-respond-503-on-busy>#</a></h5><p>When set to true, this param will make FreeSWITCH respond to incoming SIP OPTIONS with 503 &ldquo;Maximum Calls In Progress&rdquo; when FS is paused or maximum sessions has been exceeded.
When set to false or when not set at all (default behavior), SIP OPTIONS are always responded with 200 &ldquo;OK&rdquo;.</p><p>Setting this param to true is especially useful if you&rsquo;re using a proxy such as OpenSIPS or Kamailio with dispatcher module to probe your FreeSWITCH servers by sending SIP OPTIONS.</p><h5 id=sip-force-expires>sip-force-expires<a hidden class=anchor aria-hidden=true href=#sip-force-expires>#</a></h5><p>Setting this param overrides the <em>expires</em> value in the 200 OK in response to all inbound SIP REGISTERs towards this sip_profile.
This param can be overridden per individual user by setting a <em>sip-force-expires</em> user directory variable.</p><h5 id=sip-expires-max-deviation>sip-expires-max-deviation<a hidden class=anchor aria-hidden=true href=#sip-expires-max-deviation>#</a></h5><p>Setting this param adds a random deviation to the <em>expires</em> value in the 200 OK in response to all inbound SIP REGISTERs towards this sip_profile.
Result will be that clients will not re-register at the same time-interval thus spreading the load on your system.
For example, if you set:</p><p>then the expires that is responded will be between 1800-600=1200 and 1800+600=2400 seconds.
This param can be overridden per individual user by setting a <em>sip-expires-max-deviation</em> user directory variable.</p><h5 id=outbound-proxy>outbound-proxy<a hidden class=anchor aria-hidden=true href=#outbound-proxy>#</a></h5><p>Setting this param will send all outbound transactions to the value set by outbound-proxy.
 </p><h5 id=send-display-update>send-display-update<a hidden class=anchor aria-hidden=true href=#send-display-update>#</a></h5><p>Tells FreeSWITCH not to send display UPDATEs to the leg of the call.
 </p><h4 id=rtp-related-options>RTP Related options<a hidden class=anchor aria-hidden=true href=#rtp-related-options>#</a></h4><h5 id=auto-jitterbuffer-msec>auto-jitterbuffer-msec<a hidden class=anchor aria-hidden=true href=#auto-jitterbuffer-msec>#</a></h5><p>Set this to the size of the <a href=https://freeswitch.org/confluence/display/FREESWITCH/JitterBuffer>jitterbuffer</a> you would like to have on all calls coming through this profile.</p><h5 id=rtp-timer-name>rtp-timer-name<a hidden class=anchor aria-hidden=true href=#rtp-timer-name>#</a></h5><h5 id=rtp-rewrite-timestamps>rtp-rewrite-timestamps<a hidden class=anchor aria-hidden=true href=#rtp-rewrite-timestamps>#</a></h5><p>If you don&rsquo;t want to pass through timestamps from 1 RTP stream to another, rtp-rewrite-timestamps is a parameter you can set in a SIP Profile (on a per call basis with rtp_rewrite_timestamps chanvar in a dialplan).
The result is that FreeSWITCH will regenerate and rewrite the timestamps in all the RTP streams going to an endpoint using this SIP Profile.
This could be necessary to fix audio issues when sending calls to some paranoid and not RFC-compliant gateways (Cirpack is known to require this).</p><h5 id=media_timeout>media_timeout<a hidden class=anchor aria-hidden=true href=#media_timeout>#</a></h5><p>was: rtp-timeout-sec (deprecated)
The number of seconds of RTP inactivity (media silence) before FreeSWITCH considers the call disconnected, and hangs up. It is recommended that you use session timers instead. If this setting is omitted, the default value is &ldquo;0&rdquo;, which disables the timeout.</p><h5 id=media_hold_timeout>media_hold_timeout<a hidden class=anchor aria-hidden=true href=#media_hold_timeout>#</a></h5><p>was: rtp-hold-timeout-sec (deprecated)
The number of seconds of RTP inactivity (media silence) for a call placed on hold by an endpoint before FreeSWITCH considers the call disconnected, and hangs up. It is recommended that you use session timers instead. If this setting is omitted, the default value is &ldquo;0&rdquo;, which disables the timeout.</p><h5 id=rtp-autoflush-during-bridge>rtp-autoflush-during-bridge<a hidden class=anchor aria-hidden=true href=#rtp-autoflush-during-bridge>#</a></h5><p>Controls what happens if FreeSWITCH detects that it&rsquo;s not keeping up with the RTP media (audio) stream on a bridged call. (This situation can happen if the FreeSWITCH server has insufficient CPU time available.)
When set to &ldquo;true&rdquo; (the default), FreeSWITCH will notice when more than one RTP packet is waiting to be read in the incoming queue. If this condition persists for more than five seconds, RTP packets will be discarded to &ldquo;catch up&rdquo; with the audio stream. For example, if there are always five extra 20 ms packets in the queue, 100 ms of audio latency can be eliminated by discarding the packets. This will cause an audio glitch as some audio is discarded, but will improve the latency by 100 ms for the rest of the call.
If rtp-autoflush-during-bridge is set to false, FreeSWITCH will instead preserve all RTP packets on bridged calls, even if it increases the latency or &ldquo;lag&rdquo; that callers hear.</p><h5 id=rtp-autoflush>rtp-autoflush<a hidden class=anchor aria-hidden=true href=#rtp-autoflush>#</a></h5><p>Has the same effect as &ldquo;rtp-autoflush-during-bridge&rdquo;, but affects NON-bridged calls (such as faxes, IVRs and the echo test).
Unlike &ldquo;rtp-autoflush-during-bridge&rdquo;, the default is false, meaning that high-latency packets on non-bridged calls will not be discarded. This results in smoother audio at the possible expense of increasing audio latency (or &ldquo;lag&rdquo;).
Setting &ldquo;rtp-autoflush&rdquo; to true will discard packets to minimize latency when possible. Doing so may cause errors in DTMF recognition, faxes, and other processes that rely on receiving all packets.</p><h4 id=auth>Auth<a hidden class=anchor aria-hidden=true href=#auth>#</a></h4><p>These settings deal with authentication: requirements for identifying SIP endpoints to FreeSWITCH.</p><h5 id=challenge-realm>challenge-realm<a hidden class=anchor aria-hidden=true href=#challenge-realm>#</a></h5><p>Choose the realm challenge key. Default is auto_to if not set.
auto_from - uses the from field as the value for the SIP realm. auto_to - uses the to field as the value for the SIP realm. - you can input any value to use for the SIP realm.
If you want URL dialing to work you&rsquo;ll want to set this to auto_from.
If you use any other value besides auto_to or auto_from you&rsquo;ll loose the ability to do multiple domains.
Note: comment out to restore the behavior before 2008-09-29</p><h5 id=accept-blind-auth>accept-blind-auth<a hidden class=anchor aria-hidden=true href=#accept-blind-auth>#</a></h5><p>accept any authentication without actually checking (not a good feature for most people)</p><h5 id=auth-calls>auth-calls<a hidden class=anchor aria-hidden=true href=#auth-calls>#</a></h5><p>Users in the directory can have &ldquo;auth-acl&rdquo; parameters applied to them so as to restrict users access to a predefined ACL or a CIDR.</p><p>Value can be &ldquo;false&rdquo; to disable authentication on this profile, meaning that when calls come in the profile will <em>not</em> send an auth challenge to the caller.</p><h5 id=log-auth-failures>log-auth-failures<a hidden class=anchor aria-hidden=true href=#log-auth-failures>#</a></h5><p>Write log entries ( Warning ) on authentication failures ( Registration & Invite ). useful for users wishing to use fail2ban. note: Required SVN#15654 or higher</p><h5 id=auth-all-packets>auth-all-packets<a hidden class=anchor aria-hidden=true href=#auth-all-packets>#</a></h5><p>On authed calls, authenticate <em>all</em> the packets instead of only INVITE and REGISTER(Note: OPTIONS, SUBSCRIBE, INFO and MESSAGE are not authenticated even with this option set to true, see <a href=http://jira.freeswitch.org/browse/FS-2871>http://jira.freeswitch.org/browse/FS-2871</a>)</p><h4 id=registration>Registration<a hidden class=anchor aria-hidden=true href=#registration>#</a></h4><h5 id=disable-register>disable-register<a hidden class=anchor aria-hidden=true href=#disable-register>#</a></h5><p>disable register which may be undesirable in a public switch</p><h5 id=multiple-registrations>multiple-registrations<a hidden class=anchor aria-hidden=true href=#multiple-registrations>#</a></h5><p>Valid values for this parameter are &ldquo;contact&rdquo;, &ldquo;true&rdquo;, &ldquo;false&rdquo;. value=&ldquo;true&rdquo; is the most common use. Setting this value to &ldquo;contact&rdquo; will remove the old registration based on sip_user, sip_host and contact field as opposed to the call_id.</p><h5 id=max-registrations-per-extension>max-registrations-per-extension<a hidden class=anchor aria-hidden=true href=#max-registrations-per-extension>#</a></h5><p>Defines the number of maximum registrations per extension. Valid value for this parameter is an integer greater than 0. Please note that setting this to 1 would counteract the usage of <strong>multiple-registrations</strong>. When an attempt to register an extension is made after the maximum value has been reached sofia will respond with 403. The following example will set maximum registrations to 2</p><h5 id=inbound-reg-force-matching-username>inbound-reg-force-matching-username<a hidden class=anchor aria-hidden=true href=#inbound-reg-force-matching-username>#</a></h5><p>Force the user and auth-user to match.</p><h5 id=force-publish-expires>force-publish-expires<a hidden class=anchor aria-hidden=true href=#force-publish-expires>#</a></h5><p>Force custom presence update expires delta (-1 means endless)</p><h5 id=force-register-domain>force-register-domain<a hidden class=anchor aria-hidden=true href=#force-register-domain>#</a></h5><p>all inbound registrations will look in this domain for the users. Comment out to use multiple domains</p><h5 id=force-register-db-domain>force-register-db-domain<a hidden class=anchor aria-hidden=true href=#force-register-db-domain>#</a></h5><p>all inbound reg will stored in the db using this domain. Comment out to use multiple domains</p><h5 id=send-message-query-on-register>send-message-query-on-register<a hidden class=anchor aria-hidden=true href=#send-message-query-on-register>#</a></h5><p>Can be set to &rsquo;true&rsquo;, &lsquo;false&rsquo; or &lsquo;first-only&rsquo;. If set to &rsquo;true&rsquo; (this is the default behavior), mod_sofia will send a message-query event upon registration. <a href=https://freeswitch.org/confluence/display/FREESWITCH/mod_voicemail>mod_voicemail</a> uses this for counting messages.</p><p>If set to &lsquo;first-only&rsquo;, only the first REGISTER will trigger the message-query (it requires the UA to increment the NC on subsequent REGISTERs. Some phones, snom for instance, do not do this).
The final effect of the message-query is to cause a NOTIFY MWI message to be sent to the registering UA (it is used to satisfy terminals that expect MWI without subscribing for it).</p><h5 id=unregister-on-options-fail>unregister-on-options-fail<a hidden class=anchor aria-hidden=true href=#unregister-on-options-fail>#</a></h5><p>If set to True with <a href=https://freeswitch.org/confluence/display/FREESWITCH/NAT+Traversal#NATTraversal-nat-options-ping>nat-options-ping</a> the endpoint will be unregistered if no answer on OPTIONS packet.</p><h5 id=nat-options-ping>nat-options-ping<a hidden class=anchor aria-hidden=true href=#nat-options-ping>#</a></h5><p>With this option set FreeSWITCH will periodically send an OPTIONS packet to all NATed registered endpoints to keep alive connection. If set to True with <a href=https://freeswitch.org/confluence/display/FREESWITCH/mod_sofia>unregister-on-options-fail</a> the endpoint will be unregistered if no answer on OPTIONS packet.</p><h5 id=all-reg-options-ping>all-reg-options-ping<a hidden class=anchor aria-hidden=true href=#all-reg-options-ping>#</a></h5><p>With this option set FreeSWITCH will periodically send an OPTIONS packet to all registered endpoints to keep alive connection. If set to True with <a href=https://freeswitch.org/confluence/display/FREESWITCH/mod_sofia>unregister-on-options-fail</a> the endpoint will be unregistered if no answer on OPTIONS packet.</p><h5 id=registration-thread-frequency>registration-thread-frequency<a hidden class=anchor aria-hidden=true href=#registration-thread-frequency>#</a></h5><p>Controls how often registrations in the FreeSWITCH are checked for expiration. </p><h5 id=ping-mean-interval>ping-mean-interval<a hidden class=anchor aria-hidden=true href=#ping-mean-interval>#</a></h5><p>Controls the mean interval  FreeSWITCH™ will send OPTIONS packet to registered user, by default 30 seconds.</p><h4 id=subscription>Subscription<a hidden class=anchor aria-hidden=true href=#subscription>#</a></h4><h5 id=force-subscription-expires>force-subscription-expires<a hidden class=anchor aria-hidden=true href=#force-subscription-expires>#</a></h5><p>force suscription expires to a lower value than requested</p><h5 id=force-subscription-domain>force-subscription-domain<a hidden class=anchor aria-hidden=true href=#force-subscription-domain>#</a></h5><p>all inbound subscription will look in this domain for the users. Comment out to use multiple domains</p><h4 id=presence>Presence<a hidden class=anchor aria-hidden=true href=#presence>#</a></h4><h5 id=manage-presence>manage-presence<a hidden class=anchor aria-hidden=true href=#manage-presence>#</a></h5><p>Enable presence.
If you want to share your presence (see dbname and presence-hosts) set this to &ldquo;true&rdquo; on the first profile and enable the shared presence database. Then on subsequent profiles that share presence set this variable to &ldquo;passive&rdquo; and enable the shared presence database there as well.</p><h5 id=dbname>dbname<a hidden class=anchor aria-hidden=true href=#dbname>#</a></h5><p>Used to share presence info across sofia profiles
Name of the db to use for this profile</p><h5 id=presence-hold-state>presence-hold-state<a hidden class=anchor aria-hidden=true href=#presence-hold-state>#</a></h5><p>By default when a call is placed on hold, monitoring extensions show that extension as ringing. You can change this behavior by specifying this parameter and one of the following values. Available as of commit 1145905 on April 13, 2012.</p><ul><li>confirmed - Extension appears busy.</li><li>early (default) - Extension appears to be ringing.</li><li>terminated - Extension appears idle.</li></ul><h5 id=presence-hosts>presence-hosts<a hidden class=anchor aria-hidden=true href=#presence-hosts>#</a></h5><p>A list of domains that have a shared presence in the database specified in dbname. People who use multiple domains per profile can&rsquo;t use this feature anyway, so you&rsquo;ll want to set it to something like &ldquo;<em>DISABLED</em>&rdquo; in this case to avoid getting users from similar domains all mashed together. For multiple domains also known as multi-tenant calling 1001 would call all matching users in all domains. Don&rsquo;t use presence-hosts with multi-tenant.</p><h5 id=presence-privacy>presence-privacy<a hidden class=anchor aria-hidden=true href=#presence-privacy>#</a></h5><p>Optionally globally hide the caller ID from presence notes in distributed NOTIFY messages. For example, &ldquo;Talk 1002&rdquo; would be the presence note for extension 1001 while it is on a call with extension 1002. If the presence privacy tag is set to true, then it would distribute the presence note as &ldquo;On The Phone&rdquo; (without the extension to which it is connected). So any subscriber&rsquo;s to 1001&rsquo;s presence would not be able to see who he/she is talking to. <a href=http://jira.freeswitch.org/browse/FS-849>http://jira.freeswitch.org/browse/FS-849</a> This also hides the number in the status &ldquo;hold&rdquo;, &ldquo;ring&rdquo;, &ldquo;call&rdquo; and perhaps others. <a href=http://jira.freeswitch.org/browse/FS-4420>http://jira.freeswitch.org/browse/FS-4420</a></p><h5 id=send-presence-on-register>send-presence-on-register<a hidden class=anchor aria-hidden=true href=#send-presence-on-register>#</a></h5><p>Specify whether or not to send presence information when users register. Default is not to send presence information. Valid options:</p><ul><li>false</li><li>true</li><li>first-only</li></ul><h4 id=callerid-related-options>CallerID Related options<a hidden class=anchor aria-hidden=true href=#callerid-related-options>#</a></h4><h5 id=caller-id-type>caller-id type<a hidden class=anchor aria-hidden=true href=#caller-id-type>#</a></h5><p>choose one, can be overridden by inbound call type and/or sip_cid_type channel variable
Remote-Party-ID header:
   </p><p>P-*-Identity family of headers:
   </p><p>neither one:
   </p><h5 id=pass-callee-id>pass-callee-id<a hidden class=anchor aria-hidden=true href=#pass-callee-id>#</a></h5><p>(defaults to true) Disable by setting it to false if you encounter something that your gateway for some reason hates X-headers that it is supposed to ignore</p><h4 id=other-to-do>Other (TO DO)<a hidden class=anchor aria-hidden=true href=#other-to-do>#</a></h4><h5 id=hold-music>hold-music<a hidden class=anchor aria-hidden=true href=#hold-music>#</a></h5><h5 id=disable-hold>disable-hold<a hidden class=anchor aria-hidden=true href=#disable-hold>#</a></h5><p>This allows to disable Music On Hold (added in GIT commit e5cc0539ffcbf660637198c698e90c2e30b05c2f, from Fri Apr 30 19:14:39 2010 -0500).
This can be useful when the calling device intends to send its own MOH, but nevertheless sends a REINVITE to FreeSWITCH triggering its MOH.
This can be done from dialplan also with rtp_disable_hold channel variable.</p><h5 id=apply-inbound-acl>apply-inbound-acl<a hidden class=anchor aria-hidden=true href=#apply-inbound-acl>#</a></h5><p>set which access control lists, defined in <a href=http://wiki.freeswitch.org/wiki/Acl.conf.xml>acl.conf.xml</a>, apply to this profile</p><h5 id=apply-register-acl>apply-register-acl<a hidden class=anchor aria-hidden=true href=#apply-register-acl>#</a></h5><h5 id=apply-proxy-acl>apply-proxy-acl<a hidden class=anchor aria-hidden=true href=#apply-proxy-acl>#</a></h5><p>This allows traffic to be sent to FreeSWITCH via one or more proxy servers.
The proxy server should add a header named X-AUTH-IP containing the IP address of the client. FreeSWITCH trusts the proxy because its IP is listed in the proxy server ACL, and uses the value of the IP in this header as the client&rsquo;s IP for ACL authentication (acl defined in apply-inbound-acl).</p><h5 id=record-template>record-template<a hidden class=anchor aria-hidden=true href=#record-template>#</a></h5><h5 id=max-proceeding>max-proceeding<a hidden class=anchor aria-hidden=true href=#max-proceeding>#</a></h5><p>max number of open dialogs in proceeding</p><h5 id=bind-params>bind-params<a hidden class=anchor aria-hidden=true href=#bind-params>#</a></h5><p>if you want to send any special bind params of your own</p><h5 id=disable-transfer>disable-transfer<a hidden class=anchor aria-hidden=true href=#disable-transfer>#</a></h5><p>disable transfer which may be undesirable in a public switch</p><h5 id=manual-redirect>manual-redirect<a hidden class=anchor aria-hidden=true href=#manual-redirect>#</a></h5><p> </p><h5 id=enable-3pcc>enable-3pcc<a hidden class=anchor aria-hidden=true href=#enable-3pcc>#</a></h5><p>enable-3pcc determines if third party call control is allowed or not. Third party call control is useful in cases where the SIP invite doesn&rsquo;t include a SDP (late media negotiation).
enable-3pcc can be set to either &rsquo;true&rsquo; or &lsquo;proxy&rsquo;, true accepts the call right away, proxy waits until the call has been answered then sends accepts</p><h5 id=nonce-ttl>nonce-ttl<a hidden class=anchor aria-hidden=true href=#nonce-ttl>#</a></h5><p>TTL for nonce in sip auth</p><p>This parameter is set to 60 seconds if not set here. It&rsquo;s used to determine how long to store the user registration record in the sip_authentication table. The expires field in the sip_authentication table is this value plus the expires set by the user agent.</p><h5 id=sql-in-transactions>sql-in-transactions<a hidden class=anchor aria-hidden=true href=#sql-in-transactions>#</a></h5><p>If set to true (default), it will instruct the profile to wait for 500 SQL statements to accumulate or 500ms to elapse and execute them in a transaction (to boost performance).</p><h5 id=odbc-dsn>odbc-dsn<a hidden class=anchor aria-hidden=true href=#odbc-dsn>#</a></h5><p>If you have <a href=https://wiki.freeswitch.org/wiki/Using_ODBC_in_the_core>ODBC</a> support and a working dsn you can use it instead of SQLite</p><h5 id=mwi-use-reg-callid>mwi-use-reg-callid<a hidden class=anchor aria-hidden=true href=#mwi-use-reg-callid>#</a></h5><h5 id=username>username<a hidden class=anchor aria-hidden=true href=#username>#</a></h5><p>If you wish to hide the fact that you are using FreeSWITCH in the SDP message (Specifically the o= and and s= fields) , then set the username param under the profile. This has no relation whatsoever with the username parameter when we&rsquo;re dealing with gateways. If this value is left unset the system defaults using FreeSWITCH as the username parameter with the o= and s= fields.</p><p>Example:
.
v=0.
o=root 1346068950 1346068951 IN IP4 1.2.3.4.
s=root.
c=IN IP4 1.2.3.4.
t=0 0.
m=audio 26934 RTP/AVP 18 0 101 13.
a=fmtp:18 annexb=no.
a=rtpmap:101 telephone-event/8000.
a=fmtp:101 0-16.
a=ptime:20.</p><p>when you set</p><h2 id=directory-of-users>Directory of Users<a hidden class=anchor aria-hidden=true href=#directory-of-users>#</a></h2><p>To allow users to register with the server, the user information must be specified in the conf/directory/default/*xml file. To dynamically specify what users can register, use <a href=https://wiki.freeswitch.org/wiki/Mod_xml_curl>Mod xml curl</a></p><h2 id=default-configuration-file>Default Configuration File<a hidden class=anchor aria-hidden=true href=#default-configuration-file>#</a></h2><p>From the FreeSWITCH Github repository&rsquo;s vanilla configurations (<code>[conf/vanilla/autoload_configs/sofia.conf.xml](https://github.com/signalwire/freeswitch/blob/master/conf/vanilla/autoload_configs/sofia.conf.xml)</code>):
<strong>conf/autoload_configs/sofia.conf.xml</strong></p><p>  &lt;global_settings>
   
   
   
   
   
    
    &lt;!&ndash; 
     the new format for HEPv2/v3 and capture ID    
 
 protocol:host:port;hep=2;capture_id=200;</p><p>    &ndash;>
    
   
  &lt;/global_settings></p><p> 
 
   
 </p><ul><li>shutdown and restart FreeSWITCH (or)</li><li>unload and load mod_sofia</li></ul><p>If you&rsquo;ve only made changes to a particular profile, you may simply (<strong>WARNING</strong>: will drop all calls associated with this profile):</p><ul><li>sofia profile restart reloadxml</li></ul><h2 id=security-features>Security Features<a hidden class=anchor aria-hidden=true href=#security-features>#</a></h2><ul><li><a href=https://freeswitch.org/confluence/display/FREESWITCH/SIP+TLS>SIP TLS</a> for secure signaling.</li><li><a href=https://wiki.freeswitch.org/wiki/SRTP>SRTP</a> for secure media delivery.</li><li>The Auth section above for authentication settings.</li></ul><h1 id=参考>参考<a hidden class=anchor aria-hidden=true href=#参考>#</a></h1><ul><li><a href=https://freeswitch.org/confluence/display/FREESWITCH/Sofia+Configuration+Files>https://freeswitch.org/confluence/display/FREESWITCH/Sofia+Configuration+Files</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://wdd.js.org/tags/freeswitch/>FreeSWITCH</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://wdd.js.org>洞香春</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>