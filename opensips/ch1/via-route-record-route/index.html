<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Via route Record-Route的区别 | 洞香春</title><meta name=keywords content><meta name=description content="sequenceDiagram title French Words I Know autonumber participant a participant p1 participant p2 participant p3 participant b a->>p1 : INVITE route: p1, via: a p1->>p2: INVITE via: a,p1, rr: p1 p2->>p3: INVITE via: a,p1,p2 rr: p1,p2 p3->>b: INVITE via: a,p1,p2,p3 rr: p1,p2,p3 b-->>p3: 180 via: a,p1,p2,p3 rr: p1,p2,p3 p3-->>p2: 180 via: a,p1,p2 rr: p1,p2,p3 p2-->>p1: 180 via: a,p1 rr: p1,p2,p3 p1-->>a: 180 via: a rr: p1,p2,p3 b-->>p3: 200 OK via: a,p1,p2,p3 rr: p1,p2,p3 p3-->>p2: 200 Ok via: a,p1,p2 rr: p1,p2,p3 p2-->>p1: 200 Ok via: a,p1 rr: p1,p2,p3 p1-->>a: 200 Ok via: a rr: p1,p2,p3 a->>p1 : ACK via: a, route: p1,p2,p3 p1->>p2: ACK via: a,p1, route: p2,p3 p2->>p3: ACK via: a,p1,p2 route: p3 p3->>b: ACK via: a,p1,p2,p3 rr代表record-route头。"><meta name=author content="Eddie Wang"><link rel=canonical href=https://wdd.js.org/opensips/ch1/via-route-record-route/><link crossorigin=anonymous href=/assets/css/stylesheet.min.ceab085cbbf58c0ec96f6d415d51b3b44e204edfd71a45b4fa2d4aac13f119d0.css integrity="sha256-zqsIXLv1jA7Jb21BXVGztE4gTt/XGkW0+i1KrBPxGdA=" rel="preload stylesheet" as=style><link crossorigin=anonymous herf=/font-awesome/css/font-awesome.min.css rel=stylesheet type=text/css><link rel=preload href=/cowboy.ico as=image><script defer crossorigin=anonymous src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://wdd.js.org/cowboy.ico><link rel=icon type=image/png sizes=16x16 href=https://wdd.js.org/cowboy.ico><link rel=icon type=image/png sizes=32x32 href=https://wdd.js.org/cowboy.ico><link rel=apple-touch-icon href=https://wdd.js.org/cowboy.ico><link rel=mask-icon href=https://wdd.js.org/cowboy.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.119.0"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="Via route Record-Route的区别"><meta property="og:description" content="sequenceDiagram title French Words I Know autonumber participant a participant p1 participant p2 participant p3 participant b a->>p1 : INVITE route: p1, via: a p1->>p2: INVITE via: a,p1, rr: p1 p2->>p3: INVITE via: a,p1,p2 rr: p1,p2 p3->>b: INVITE via: a,p1,p2,p3 rr: p1,p2,p3 b-->>p3: 180 via: a,p1,p2,p3 rr: p1,p2,p3 p3-->>p2: 180 via: a,p1,p2 rr: p1,p2,p3 p2-->>p1: 180 via: a,p1 rr: p1,p2,p3 p1-->>a: 180 via: a rr: p1,p2,p3 b-->>p3: 200 OK via: a,p1,p2,p3 rr: p1,p2,p3 p3-->>p2: 200 Ok via: a,p1,p2 rr: p1,p2,p3 p2-->>p1: 200 Ok via: a,p1 rr: p1,p2,p3 p1-->>a: 200 Ok via: a rr: p1,p2,p3 a->>p1 : ACK via: a, route: p1,p2,p3 p1->>p2: ACK via: a,p1, route: p2,p3 p2->>p3: ACK via: a,p1,p2 route: p3 p3->>b: ACK via: a,p1,p2,p3 rr代表record-route头。"><meta property="og:type" content="article"><meta property="og:url" content="https://wdd.js.org/opensips/ch1/via-route-record-route/"><meta property="og:image" content="https://wdd.js.org/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="opensips"><meta property="article:published_time" content="2022-09-03T02:00:00+08:00"><meta property="article:modified_time" content="2022-09-03T02:00:00+08:00"><meta property="og:site_name" content="洞香春"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://wdd.js.org/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Via route Record-Route的区别"><meta name=twitter:description content="sequenceDiagram title French Words I Know autonumber participant a participant p1 participant p2 participant p3 participant b a->>p1 : INVITE route: p1, via: a p1->>p2: INVITE via: a,p1, rr: p1 p2->>p3: INVITE via: a,p1,p2 rr: p1,p2 p3->>b: INVITE via: a,p1,p2,p3 rr: p1,p2,p3 b-->>p3: 180 via: a,p1,p2,p3 rr: p1,p2,p3 p3-->>p2: 180 via: a,p1,p2 rr: p1,p2,p3 p2-->>p1: 180 via: a,p1 rr: p1,p2,p3 p1-->>a: 180 via: a rr: p1,p2,p3 b-->>p3: 200 OK via: a,p1,p2,p3 rr: p1,p2,p3 p3-->>p2: 200 Ok via: a,p1,p2 rr: p1,p2,p3 p2-->>p1: 200 Ok via: a,p1 rr: p1,p2,p3 p1-->>a: 200 Ok via: a rr: p1,p2,p3 a->>p1 : ACK via: a, route: p1,p2,p3 p1->>p2: ACK via: a,p1, route: p2,p3 p2->>p3: ACK via: a,p1,p2 route: p3 p3->>b: ACK via: a,p1,p2,p3 rr代表record-route头。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"OpenSIPS2.4.X 中文实战系列","item":"https://wdd.js.org/opensips/"},{"@type":"ListItem","position":3,"name":"Via route Record-Route的区别","item":"https://wdd.js.org/opensips/ch1/via-route-record-route/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Via route Record-Route的区别","name":"Via route Record-Route的区别","description":"sequenceDiagram title French Words I Know autonumber participant a participant p1 participant p2 participant p3 participant b a-\u003e\u003ep1 : INVITE route: p1, via: a p1-\u003e\u003ep2: INVITE via: a,p1, rr: p1 p2-\u003e\u003ep3: INVITE via: a,p1,p2 rr: p1,p2 p3-\u003e\u003eb: INVITE via: a,p1,p2,p3 rr: p1,p2,p3 b--\u003e\u003ep3: 180 via: a,p1,p2,p3 rr: p1,p2,p3 p3--\u003e\u003ep2: 180 via: a,p1,p2 rr: p1,p2,p3 p2--\u003e\u003ep1: 180 via: a,p1 rr: p1,p2,p3 p1--\u003e\u003ea: 180 via: a rr: p1,p2,p3 b--\u003e\u003ep3: 200 OK via: a,p1,p2,p3 rr: p1,p2,p3 p3--\u003e\u003ep2: 200 Ok via: a,p1,p2 rr: p1,p2,p3 p2--\u003e\u003ep1: 200 Ok via: a,p1 rr: p1,p2,p3 p1--\u003e\u003ea: 200 Ok via: a rr: p1,p2,p3 a-\u003e\u003ep1 : ACK via: a, route: p1,p2,p3 p1-\u003e\u003ep2: ACK via: a,p1, route: p2,p3 p2-\u003e\u003ep3: ACK via: a,p1,p2 route: p3 p3-\u003e\u003eb: ACK via: a,p1,p2,p3 rr代表record-route头。","keywords":[],"articleBody":" sequenceDiagram title French Words I Know autonumber participant a participant p1 participant p2 participant p3 participant b a-\u003e\u003ep1 : INVITE route: p1, via: a p1-\u003e\u003ep2: INVITE via: a,p1, rr: p1 p2-\u003e\u003ep3: INVITE via: a,p1,p2 rr: p1,p2 p3-\u003e\u003eb: INVITE via: a,p1,p2,p3 rr: p1,p2,p3 b--\u003e\u003ep3: 180 via: a,p1,p2,p3 rr: p1,p2,p3 p3--\u003e\u003ep2: 180 via: a,p1,p2 rr: p1,p2,p3 p2--\u003e\u003ep1: 180 via: a,p1 rr: p1,p2,p3 p1--\u003e\u003ea: 180 via: a rr: p1,p2,p3 b--\u003e\u003ep3: 200 OK via: a,p1,p2,p3 rr: p1,p2,p3 p3--\u003e\u003ep2: 200 Ok via: a,p1,p2 rr: p1,p2,p3 p2--\u003e\u003ep1: 200 Ok via: a,p1 rr: p1,p2,p3 p1--\u003e\u003ea: 200 Ok via: a rr: p1,p2,p3 a-\u003e\u003ep1 : ACK via: a, route: p1,p2,p3 p1-\u003e\u003ep2: ACK via: a,p1, route: p2,p3 p2-\u003e\u003ep3: ACK via: a,p1,p2 route: p3 p3-\u003e\u003eb: ACK via: a,p1,p2,p3 rr代表record-route头。\nTip Via 何时添加: 除了目的地外，请求从ua发出去时 何时删除: 除了目的地外，请求从ua发出去时 作用: 除了目的地外，请求从ua发出去时 Via的作用是让sip消息能够按照原路返回 比喻: 第一次离开家的人，只有每次经过一个地方，就记下地名。那么在回家的时候，他才能按照原来的路径返回。 Tip route 何时添加: 当请求从uac发出去时 何时删除: 请求离开ua时 作用: route的作用是指明下一站的目的地。虽然route请求是在请求发送出去时就添加，但是可以进添加一个。 比喻: 第一次离开家的人，可能并不知道如何到达海南，但是他知道如何到达自己的省会。这个省会就是sip终端配置的外呼代理。每次经过一个站点时，就把这个站点记录到record-route中。record-route会在180或者183，或200ok时，发送给主叫的话机。 Tip record-route 何时添加: 当请求从uas发出去时 何时删除: 为dialog中的后续请求，指明到达目的地的路径 作用: 为dialog中的后续请求，指明到达目的地的路径 比喻: 当一个uac收到180之后，这个180中带有了record-route，例如p1,p2,p3。那么后续的ACK请求，就可以理由record-route来生成route: p1, p2, p3。 Address-of-Record: An address-of-record (AOR) is a SIP or SIPS URI that points to a domain with a location service that can map the URI to another URI where the user might be available. Typically, the location service is populated through registrations. An AOR is frequently thought of as the “public address” of the user. – rfc3261\nThe difference between a contact address and an address-of-record is like the difference between a device and its user. While there is no formal distinction in the syntax of these two forms of addresses, contact addresses are associated with a particular device, and may have a very device-specific form (like sip:10.0.0.1, or sip:edgar@ua21.example.com). An address-of-record, however, represents an identity of the user, generally a long-term identity, and it does not have a dependency on any device; users can move between devices or even be associated with multiple devices at one time while retaining the same address-of-record. A simple URI, generally of the form ‘sip:egdar@example.com’, is used for an address-of-record. –rfc3764\n1. Record-route写法 u1 -\u003e p1 -\u003e p2 -\u003e p3 -\u003e p4,\n最后经过的排在最上面或者最前面。\n多行写法\nINVITE sip:callee@u2.domain.com SIP/2.0 Contact: sip:caller@u1.example.com Record-Route: Record-Route: Record-Route: Record-Route: Record-Route记录的是从主叫到被叫的过程，其中Record-Route的顺序非常重要。因为这个顺序会影响Route字段的顺序。\n因为loose_route是从最上面的route字段来决定下一条的地址。\n所以，对于主叫来说，route的顺序和Record-Router相反。对于被叫来说，route字段和Record-Route字段相同。\n对于某些使用不同协议对接的不同代理的时候，会一次性的增加两次Record-Route。\n例如下面的，AB直接是tcp的，BC之间是udp的。那么INVITE从A到C之后，会在最上面增加两个。 A –tcp– B –udp– C\nRecord-Route: Record-Route: 单行写法\nINVITE sip:callee@u2.domain.com SIP/2.0 Contact: sip:caller@u1.example.com Record-Route: ,,, 2. Via 写法 最新的排在最上面 ","wordCount":"370","inLanguage":"en","datePublished":"2022-09-03T02:00:00+08:00","dateModified":"2022-09-03T02:00:00+08:00","author":{"@type":"Person","name":"Eddie Wang"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://wdd.js.org/opensips/ch1/via-route-record-route/"},"publisher":{"@type":"Organization","name":"洞香春","logo":{"@type":"ImageObject","url":"https://wdd.js.org/cowboy.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://wdd.js.org accesskey=h title="洞香春 (Alt + H)"><img src=/cowboy.ico alt=logo aria-label=logo height=35>洞香春</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://wdd.js.org/freeswitch/ title=FreeSWITCH><span>FreeSWITCH</span></a></li><li><a href=https://wdd.js.org/fe/ title=Frontend><span>Frontend</span></a></li><li><a href=https://wdd.js.org/golang/ title=Golang><span>Golang</span></a></li><li><a href=https://wdd.js.org/container/ title=k8s/docker><span>k8s/docker</span></a></li><li><a href=https://wdd.js.org/network/ title=Network><span>Network</span></a></li><li><a href=https://wdd.js.org/opensips/ title=OpenSIPS><span>OpenSIPS</span></a></li><li><a href=https://wdd.js.org/shell/ title=Shell><span>Shell</span></a></li><li><a href=https://wdd.js.org/vim/ title=VIM><span>VIM</span></a></li><li><a href=https://wdd.js.org/categories/ title=分类><span>分类</span></a></li><li><a href=https://wdd.js.org/search/ title=搜索><span>搜索</span></a></li><li><a href=https://wdd.js.org/tags/ title=标签><span>标签</span></a></li><li><a href=https://wdd.js.org/archives/ title=归档><span>归档</span></a></li><li><a href=https://wdd.js.org/about/ title=我><span>我</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://wdd.js.org>Home</a>&nbsp;»&nbsp;<a href=https://wdd.js.org/opensips/>OpenSIPS2.4.X 中文实战系列</a></div><h1 class=post-title>Via route Record-Route的区别</h1><div class=post-meta><span title='2022-09-03 02:00:00 +0800 CST'>2022-09-03 02:00:00</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;Eddie Wang</div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#1-record-route%e5%86%99%e6%b3%95 aria-label="1. Record-route写法">1. Record-route写法</a></li><li><a href=#2-via-%e5%86%99%e6%b3%95 aria-label="2. Via 写法">2. Via 写法</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><script async type=application/javascript src=/js/mermaid.min.js>var config={startOnLoad:!0,theme:"neutral",align:"left"};mermaid.initialize(config)</script><div class=mermaid>sequenceDiagram
title French Words I Know
autonumber
participant a
participant p1
participant p2
participant p3
participant b
a->>p1 : INVITE route: p1, via: a
p1->>p2: INVITE via: a,p1, rr: p1
p2->>p3: INVITE via: a,p1,p2 rr: p1,p2
p3->>b: INVITE via: a,p1,p2,p3 rr: p1,p2,p3
b-->>p3: 180 via: a,p1,p2,p3 rr: p1,p2,p3
p3-->>p2: 180 via: a,p1,p2 rr: p1,p2,p3
p2-->>p1: 180 via: a,p1 rr: p1,p2,p3
p1-->>a: 180 via: a rr: p1,p2,p3
b-->>p3: 200 OK via: a,p1,p2,p3 rr: p1,p2,p3
p3-->>p2: 200 Ok via: a,p1,p2 rr: p1,p2,p3
p2-->>p1: 200 Ok via: a,p1 rr: p1,p2,p3
p1-->>a: 200 Ok via: a rr: p1,p2,p3
a->>p1 : ACK via: a, route: p1,p2,p3
p1->>p2: ACK via: a,p1, route: p2,p3
p2->>p3: ACK via: a,p1,p2 route: p3
p3->>b: ACK via: a,p1,p2,p3</div><p>rr代表record-route头。</p><div class="notice tip"><div class=notice-title><i class="fa fa-lightbulb-o" aria-hidden=true></i>Tip</div><div class=notice-content><ul><li><strong>Via</strong><ul><li>何时添加: 除了目的地外，请求从ua发出去时</li><li>何时删除: 除了目的地外，请求从ua发出去时</li><li>作用: 除了目的地外，请求从ua发出去时 Via的作用是让sip消息能够按照原路返回</li><li>比喻: 第一次离开家的人，只有每次经过一个地方，就记下地名。那么在回家的时候，他才能按照原来的路径返回。</li></ul></li></ul></div></div><div class="notice tip"><div class=notice-title><i class="fa fa-lightbulb-o" aria-hidden=true></i>Tip</div><div class=notice-content><ul><li><strong>route</strong><ul><li>何时添加: 当请求从uac发出去时</li><li>何时删除: 请求离开ua时</li><li>作用: route的作用是指明下一站的目的地。虽然route请求是在请求发送出去时就添加，但是可以进添加一个。</li><li>比喻: 第一次离开家的人，可能并不知道如何到达海南，但是他知道如何到达自己的省会。这个省会就是sip终端配置的外呼代理。每次经过一个站点时，就把这个站点记录到record-route中。record-route会在180或者183，或200ok时，发送给主叫的话机。</li></ul></li></ul></div></div><div class="notice tip"><div class=notice-title><i class="fa fa-lightbulb-o" aria-hidden=true></i>Tip</div><div class=notice-content><ul><li><strong>record-route</strong><ul><li>何时添加: 当请求从uas发出去时</li><li>何时删除: 为dialog中的后续请求，指明到达目的地的路径</li><li>作用: 为dialog中的后续请求，指明到达目的地的路径</li><li>比喻: 当一个uac收到180之后，这个180中带有了record-route，例如p1,p2,p3。那么后续的ACK请求，就可以理由record-route来生成route: p1, p2, p3。</li></ul></li></ul></div></div><blockquote><p>Address-of-Record: An address-of-record (AOR) is a SIP or SIPS URI that points to a domain with a location service that can map the URI to another URI where the user might be available. Typically, the location service is populated through registrations. An AOR is frequently thought of as the &ldquo;public address&rdquo; of the user. &ndash; rfc3261</p></blockquote><blockquote><p>The difference between a contact address and an address-of-record is like <strong>the difference between a device and its user</strong>. While there is no formal distinction in the syntax of these two forms of addresses, contact addresses are associated with a particular device, and may have a very device-specific form (like sip:10.0.0.1, or sip:edgar@ua21.example.com). An address-of-record, however, represents an identity of the user, generally a long-term identity, and it does not have a dependency on any device; users can move between devices or even be associated with multiple devices at one time while retaining the same address-of-record. A simple URI, generally of the form &lsquo;sip:egdar@example.com&rsquo;, is used for an address-of-record. &ndash;rfc3764</p></blockquote><h1 id=1-record-route写法>1. Record-route写法<a hidden class=anchor aria-hidden=true href=#1-record-route写法>#</a></h1><p>u1 -> p1 -> p2 -> p3 -> p4,</p><p>最后经过的排在最上面或者最前面。</p><p>多行写法</p><pre tabindex=0><code>INVITE sip:callee@u2.domain.com SIP/2.0
Contact: sip:caller@u1.example.com
Record-Route: &lt;sip:p4.domain.com;lr&gt;
Record-Route: &lt;sip:p3.middle.com&gt;
Record-Route: &lt;sip:p2.example.com;lr&gt;
Record-Route: &lt;sip:p1.example.com;lr&gt;
</code></pre><p>Record-Route记录的是从主叫到被叫的过程，其中Record-Route的顺序非常重要。因为这个顺序会影响Route字段的顺序。</p><p>因为loose_route是从最上面的route字段来决定下一条的地址。</p><p>所以，对于主叫来说，route的顺序和Record-Router相反。对于被叫来说，route字段和Record-Route字段相同。</p><p>对于某些使用不同协议对接的不同代理的时候，会一次性的增加两次Record-Route。</p><p>例如下面的，AB直接是tcp的，BC之间是udp的。那么INVITE从A到C之后，会在最上面增加两个。
A &ndash;tcp&ndash; B &ndash;udp&ndash; C</p><pre tabindex=0><code>Record-Route: &lt;sip:B_ip;transport=udp&gt;
Record-Route: &lt;sip:B_ip;transport=tcp&gt;
</code></pre><p>单行写法</p><pre tabindex=0><code>INVITE sip:callee@u2.domain.com SIP/2.0
Contact: sip:caller@u1.example.com
Record-Route: &lt;sip:p4.domain.com;lr&gt;,&lt;sip:p3.middle.com&gt;,&lt;sip:p2.example.com;lr&gt;,&lt;sip:p1.example.com;lr&gt;
</code></pre><h1 id=2-via-写法>2. Via 写法<a hidden class=anchor aria-hidden=true href=#2-via-写法>#</a></h1><ul><li>最新的排在最上面</li></ul></div><footer class=post-footer></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://wdd.js.org>洞香春</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>