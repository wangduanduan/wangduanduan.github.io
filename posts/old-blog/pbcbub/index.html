<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>s | 洞香春</title><meta name=keywords content><meta name=description content="思考题：当你用ssh登录到一个linux机器，并且执行了某个hello.sh之后，有哪些进程参与了该过程?
linux系统架构 kernel mode user mode 内核态和用户态的区别 什么是进程 进程是运行的程序 process 是对 processor 虚拟化，通过时间片 进程都有uid nginx访问某个目录，Permission denied
进程都有pid $$ 进程都有父进程 准确来说，除了pid为0的进程之外，其他进程都有父进程 有时候，你用kill命令杀死了一个进程，但是立马你就发现这个进程又起来了。你就要看看，这个进程是不是有个非init进程的父进程。一般这个进程负责监控子进程，一旦子进程挂掉，就会去重新创建一个进程。所以你需要找到这个父进程的Id，先把父进程kill掉，然后在kill子进程。 进程是一棵树 #!/bin/bash echo &#34;pid is $$&#34; times=0 while true do sleep 2s; let times++; echo $times hello; done ➜ ~ pstree 24601 sshd─┬─3*[sshd───zsh] ├─sshd───zsh───pstree └─sshd───zsh───world.sh───sleep 进程都有生命周期 创建 销毁 进程都有状态 runing 进程占用CPU, 正在执行指令 ready 进程所有需要的资源都已经就绪，等待进入CPU执行 blocked 进程被某些事件阻断，例如IO。 进程的状态转移图
进程都有打开的文件描述符 使用lsof命令，可以查看某个进程所打开的文件描述符
/proc/pid/fd/目录下也有文件描述符
lsof -c 进程名lsof -p 进程号lsof filename # 查看某个文件被哪个进程打开**
[root@localhost ~]# lsof -c rtpproxy COMMAND PID USER FD TYPE DEVICE SIZE/OFF NODE NAME rtpproxy 2073 root cwd DIR 253,0 4096 128 / rtpproxy 2073 root rtd DIR 253,0 4096 128 / rtpproxy 2073 root txt REG 253,0 933247 18295252 /usr/local/bin/rtpproxy rtpproxy 2073 root mem REG 253,0 2127336 33617010 /usr/lib64/libc-2."><meta name=author content="王端端"><link rel=canonical href=https://wdd.js.org/posts/old-blog/pbcbub/><meta name=google-site-verification content="G-SGW660ZWKM"><link crossorigin=anonymous href=/assets/css/stylesheet.min.ceab085cbbf58c0ec96f6d415d51b3b44e204edfd71a45b4fa2d4aac13f119d0.css integrity="sha256-zqsIXLv1jA7Jb21BXVGztE4gTt/XGkW0+i1KrBPxGdA=" rel="preload stylesheet" as=style><link crossorigin=anonymous herf=/font-awesome/css/font-awesome.min.css rel=stylesheet type=text/css><link rel=preload href=/cowboy.ico as=image><script defer crossorigin=anonymous src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://wdd.js.org/cowboy.ico><link rel=icon type=image/png sizes=16x16 href=https://wdd.js.org/cowboy.ico><link rel=icon type=image/png sizes=32x32 href=https://wdd.js.org/cowboy.ico><link rel=apple-touch-icon href=https://wdd.js.org/cowboy.ico><link rel=mask-icon href=https://wdd.js.org/cowboy.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.106.0"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-SGW660ZWKM"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-SGW660ZWKM",{anonymize_ip:!1})}</script><meta property="og:title" content="s"><meta property="og:description" content="思考题：当你用ssh登录到一个linux机器，并且执行了某个hello.sh之后，有哪些进程参与了该过程?
linux系统架构 kernel mode user mode 内核态和用户态的区别 什么是进程 进程是运行的程序 process 是对 processor 虚拟化，通过时间片 进程都有uid nginx访问某个目录，Permission denied
进程都有pid $$ 进程都有父进程 准确来说，除了pid为0的进程之外，其他进程都有父进程 有时候，你用kill命令杀死了一个进程，但是立马你就发现这个进程又起来了。你就要看看，这个进程是不是有个非init进程的父进程。一般这个进程负责监控子进程，一旦子进程挂掉，就会去重新创建一个进程。所以你需要找到这个父进程的Id，先把父进程kill掉，然后在kill子进程。 进程是一棵树 #!/bin/bash echo &#34;pid is $$&#34; times=0 while true do sleep 2s; let times++; echo $times hello; done ➜ ~ pstree 24601 sshd─┬─3*[sshd───zsh] ├─sshd───zsh───pstree └─sshd───zsh───world.sh───sleep 进程都有生命周期 创建 销毁 进程都有状态 runing 进程占用CPU, 正在执行指令 ready 进程所有需要的资源都已经就绪，等待进入CPU执行 blocked 进程被某些事件阻断，例如IO。 进程的状态转移图
进程都有打开的文件描述符 使用lsof命令，可以查看某个进程所打开的文件描述符
/proc/pid/fd/目录下也有文件描述符
lsof -c 进程名lsof -p 进程号lsof filename # 查看某个文件被哪个进程打开**
[root@localhost ~]# lsof -c rtpproxy COMMAND PID USER FD TYPE DEVICE SIZE/OFF NODE NAME rtpproxy 2073 root cwd DIR 253,0 4096 128 / rtpproxy 2073 root rtd DIR 253,0 4096 128 / rtpproxy 2073 root txt REG 253,0 933247 18295252 /usr/local/bin/rtpproxy rtpproxy 2073 root mem REG 253,0 2127336 33617010 /usr/lib64/libc-2."><meta property="og:type" content="article"><meta property="og:url" content="https://wdd.js.org/posts/old-blog/pbcbub/"><meta property="og:image" content="https://wdd.js.org/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-04-25T20:30:18+08:00"><meta property="article:modified_time" content="2020-04-25T20:30:18+08:00"><meta property="og:site_name" content="洞香春"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://wdd.js.org/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="s"><meta name=twitter:description content="思考题：当你用ssh登录到一个linux机器，并且执行了某个hello.sh之后，有哪些进程参与了该过程?
linux系统架构 kernel mode user mode 内核态和用户态的区别 什么是进程 进程是运行的程序 process 是对 processor 虚拟化，通过时间片 进程都有uid nginx访问某个目录，Permission denied
进程都有pid $$ 进程都有父进程 准确来说，除了pid为0的进程之外，其他进程都有父进程 有时候，你用kill命令杀死了一个进程，但是立马你就发现这个进程又起来了。你就要看看，这个进程是不是有个非init进程的父进程。一般这个进程负责监控子进程，一旦子进程挂掉，就会去重新创建一个进程。所以你需要找到这个父进程的Id，先把父进程kill掉，然后在kill子进程。 进程是一棵树 #!/bin/bash echo &#34;pid is $$&#34; times=0 while true do sleep 2s; let times++; echo $times hello; done ➜ ~ pstree 24601 sshd─┬─3*[sshd───zsh] ├─sshd───zsh───pstree └─sshd───zsh───world.sh───sleep 进程都有生命周期 创建 销毁 进程都有状态 runing 进程占用CPU, 正在执行指令 ready 进程所有需要的资源都已经就绪，等待进入CPU执行 blocked 进程被某些事件阻断，例如IO。 进程的状态转移图
进程都有打开的文件描述符 使用lsof命令，可以查看某个进程所打开的文件描述符
/proc/pid/fd/目录下也有文件描述符
lsof -c 进程名lsof -p 进程号lsof filename # 查看某个文件被哪个进程打开**
[root@localhost ~]# lsof -c rtpproxy COMMAND PID USER FD TYPE DEVICE SIZE/OFF NODE NAME rtpproxy 2073 root cwd DIR 253,0 4096 128 / rtpproxy 2073 root rtd DIR 253,0 4096 128 / rtpproxy 2073 root txt REG 253,0 933247 18295252 /usr/local/bin/rtpproxy rtpproxy 2073 root mem REG 253,0 2127336 33617010 /usr/lib64/libc-2."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://wdd.js.org/posts/"},{"@type":"ListItem","position":3,"name":"s","item":"https://wdd.js.org/posts/old-blog/pbcbub/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"s","name":"s","description":"思考题：当你用ssh登录到一个linux机器，并且执行了某个hello.sh之后，有哪些进程参与了该过程?\nlinux系统架构 kernel mode user mode 内核态和用户态的区别 什么是进程 进程是运行的程序 process 是对 processor 虚拟化，通过时间片 进程都有uid nginx访问某个目录，Permission denied\n进程都有pid $$ 进程都有父进程 准确来说，除了pid为0的进程之外，其他进程都有父进程 有时候，你用kill命令杀死了一个进程，但是立马你就发现这个进程又起来了。你就要看看，这个进程是不是有个非init进程的父进程。一般这个进程负责监控子进程，一旦子进程挂掉，就会去重新创建一个进程。所以你需要找到这个父进程的Id，先把父进程kill掉，然后在kill子进程。 进程是一棵树 #!/bin/bash echo \u0026#34;pid is $$\u0026#34; times=0 while true do sleep 2s; let times++; echo $times hello; done ➜ ~ pstree 24601 sshd─┬─3*[sshd───zsh] ├─sshd───zsh───pstree └─sshd───zsh───world.sh───sleep 进程都有生命周期 创建 销毁 进程都有状态 runing 进程占用CPU, 正在执行指令 ready 进程所有需要的资源都已经就绪，等待进入CPU执行 blocked 进程被某些事件阻断，例如IO。 进程的状态转移图\n进程都有打开的文件描述符 使用lsof命令，可以查看某个进程所打开的文件描述符\n/proc/pid/fd/目录下也有文件描述符\nlsof -c 进程名lsof -p 进程号lsof filename # 查看某个文件被哪个进程打开**\n[root@localhost ~]# lsof -c rtpproxy COMMAND PID USER FD TYPE DEVICE SIZE/OFF NODE NAME rtpproxy 2073 root cwd DIR 253,0 4096 128 / rtpproxy 2073 root rtd DIR 253,0 4096 128 / rtpproxy 2073 root txt REG 253,0 933247 18295252 /usr/local/bin/rtpproxy rtpproxy 2073 root mem REG 253,0 2127336 33617010 /usr/lib64/libc-2.","keywords":[],"articleBody":"思考题：当你用ssh登录到一个linux机器，并且执行了某个hello.sh之后，有哪些进程参与了该过程?\nlinux系统架构 kernel mode user mode 内核态和用户态的区别 什么是进程 进程是运行的程序 process 是对 processor 虚拟化，通过时间片 进程都有uid nginx访问某个目录，Permission denied\n进程都有pid $$ 进程都有父进程 准确来说，除了pid为0的进程之外，其他进程都有父进程 有时候，你用kill命令杀死了一个进程，但是立马你就发现这个进程又起来了。你就要看看，这个进程是不是有个非init进程的父进程。一般这个进程负责监控子进程，一旦子进程挂掉，就会去重新创建一个进程。所以你需要找到这个父进程的Id，先把父进程kill掉，然后在kill子进程。 进程是一棵树 #!/bin/bash echo \"pid is $$\" times=0 while true do sleep 2s; let times++; echo $times hello; done ➜ ~ pstree 24601 sshd─┬─3*[sshd───zsh] ├─sshd───zsh───pstree └─sshd───zsh───world.sh───sleep 进程都有生命周期 创建 销毁 进程都有状态 runing 进程占用CPU, 正在执行指令 ready 进程所有需要的资源都已经就绪，等待进入CPU执行 blocked 进程被某些事件阻断，例如IO。 进程的状态转移图\n进程都有打开的文件描述符 使用lsof命令，可以查看某个进程所打开的文件描述符\n/proc/pid/fd/目录下也有文件描述符\nlsof -c 进程名lsof -p 进程号lsof filename # 查看某个文件被哪个进程打开**\n[root@localhost ~]# lsof -c rtpproxy COMMAND PID USER FD TYPE DEVICE SIZE/OFF NODE NAME rtpproxy 2073 root cwd DIR 253,0 4096 128 / rtpproxy 2073 root rtd DIR 253,0 4096 128 / rtpproxy 2073 root txt REG 253,0 933247 18295252 /usr/local/bin/rtpproxy rtpproxy 2073 root mem REG 253,0 2127336 33617010 /usr/lib64/libc-2.17.so rtpproxy 2073 root mem REG 253,0 44448 33617041 /usr/lib64/librt-2.17.so rtpproxy 2073 root mem REG 253,0 19776 34757658 /usr/lib64/libdl-2.17.so rtpproxy 2073 root mem REG 253,0 1139680 34757660 /usr/lib64/libm-2.17.so rtpproxy 2073 root mem REG 253,0 144792 33617035 /usr/lib64/libpthread-2.17.so rtpproxy 2073 root mem REG 253,0 164112 33595530 /usr/lib64/ld-2.17.so rtpproxy 2073 root 0u CHR 1,3 0t0 1028 /dev/null rtpproxy 2073 root 1u CHR 1,3 0t0 1028 /dev/null rtpproxy 2073 root 2u CHR 1,3 0t0 1028 /dev/null rtpproxy 2073 root 3u IPv4 17641 0t0 UDP 192.168.40.100:7890 rtpproxy 2073 root 4u unix 0xffff880079260000 0t0 17642 socket rtpproxy 2073 root 8u IPv4 72592335 0t0 UDP 192.168.40.100:25257 进程都有资源限制 /proc/pid/limits\n以rtpproxy为例子，rtpproxy的pid为2073, /proc/pid/limits文件记录进程的资源限制\n进程都有环境变量 /proc/pid/environ\n进程都有参数 /proc/pid/cmdline\nrtpproxy-A192.168.40.100-l192.168.40.100-sudp:192.168.40.1007890-F-m20000-M40000-L20000-dDBUG[root@localhost 2073]# 进程都有名字 /proc/2073/status\nName:\trtpproxy State:\tS (sleeping) Tgid:\t2073 Ngid:\t0 Pid:\t2073 PPid:\t1 TracerPid:\t0 Uid:\t0\t0\t0\t0 Gid:\t0\t0\t0\t0 进程皆有退出码 非0的退出码一般是异常退出 $? [root@localhost 2073]# cat \"test\" [root@localhost 2073]# echo $? 1 [root@localhost 2073]# echo $? 0 进程可以fork 孤儿进程 孤儿进程：一个父进程退出，而它的一个或多个子进程还在运行，那么那些子进程将成为孤儿进程。孤儿进程将被init进程(进程号为1)所收养，并由init进程对它们完成状态收集工作。\n僵尸进程 僵尸进程：一个进程使用fork创建子进程，如果子进程退出，而父进程并没有调用wait或waitpid获取子进程的状态信息，那么子进程的进程描述符仍然保存在系统中。这种进程称之为僵死进程。 僵尸进程占用进程描述符，无法释放，会导致系统无法正常的创建进程。\n\u003e cat /proc/sys/kernel/pid_max 32768 进程间通信 进程之间的所有资源都是完全隔离的，所以进程之间如何通信呢？\n在liunx底层，有个套接字API\nSOCKET socket (int domain, int type, int protocol) domain 表示域，一般由两个值 AF_INET 即因特网 AF_LOCAL 用于同一台机器上的进程间通信 type 表示类型 SOCK_STREAM 提供可靠的、全双工、面向链接的字节流，一般就是TCP SOCK_DGRAM 提供不可靠、尽力而为的数据报服务，一般就是UDP SOCK_RAW 允许直接访问IP层原生的数据报 也就是说，进程间通信，实际上也是用的socket\n守护进程 守护进程一般是后台运行的进程，例如sshd, mysqld, dockerd等等，他们的特点就是他们的ppid是1， 也就是说，守护进程也是孤儿进程的一种。\nroot 9696 1 0 Oct06 ? 00:05:16 /usr/sbin/sshd -D idle进程与init进程 Linux下有3个特殊的进程**，idle进程(PID = 0), init进程(PID = 1)和kthreadd(PID = 2)**\nidle进程由系统自动创建, 运行在内核态。idle进程其pid=0，其前身是系统创建的第一个进程，也是唯一一个没有通过fork或者kernel_thread产生的进程。完成加载系统后，演变为进程调度、交换 init进程由idle通过kernel_thread创建，在内核空间完成初始化后, 加载init程序, 并最终用户空间。由0进程创建，完成系统的初始化. 是系统中所有其它用户进程的祖先进程 Linux中的所有进程都是有init进程创建并运行的。首先Linux内核启动，然后在用户空间中启动init进程，再启动其他系统进程。在系统启动完成完成后，init将变为守护进程监视系统其他进程。 kthreadd进程由idle通过kernel_thread创建，并始终运行在内核空间, 负责所有内核线程的调度和管理 参考：https://blog.csdn.net/gatieme/article/details/51484562\n线程 ps -m可以在进程之后显示线程。线程的tid也会占用一个/proc/tid目录，和进程的/proc/pid 目录没什么区别。\n只不过进程的Tgid(线程组Id)是自己的pid, 而其他线程的Tgid是主线程的pid。\nps -em -o pid,tid,command | grep rtpproxy -A10 2112 - rtpproxy -l 192.168.40.101 -s udp:192.168.40.101 7890 -F -m 20000 -M 40000 -L 20000 -d DBUG - 2112 - - 2113 - - 2114 - - 2115 - - 2116 - - 2117 - - 2118 - 进程与线程的区别 关于/proc目录 proc目录是一个虚拟的文件系统，实际上是内核的数据结构的映射。里面的大部分的文件都是只读的，只有少部分是可写的。\n关于进程运行时信息，都可以在这个目录找到。\n下面的链接详细的介绍了每个目录的作用。\nhttps://www.linux.com/news/discover-possibilities-proc-directory/\nhttps://www.tldp.org/LDP/sag/html/proc-fs.html\nhttp://man7.org/linux/man-pages/man5/proc.5.html\n思考\n如何获取某个执行进程的可执行文件的路径？ proc目录下的文件有何特点？ 以下的几个文件是比较重要的，着重说明一下。\ncmdline 执行参数 environ 环境变量 ** exe -\u003e /usr/local/bin/rtpproxy 可执行文件位置** ** fd 文件描述符信息** ** limits 资源限制** oom killer机制：杀掉最胖的那个进程 oom_adj oom_score oom_score_adj status 状态信息 dr-xr-xr-x. 2 root root 0 Jan 14 15:56 attr -rw-r--r--. 1 root root 0 Jan 14 15:56 autogroup -r--------. 1 root root 0 Jan 14 15:56 auxv -r--r--r--. 1 root root 0 Nov 6 17:59 cgroup --w-------. 1 root root 0 Jan 14 15:56 clear_refs -r--r--r--. 1 root root 0 Nov 6 10:26 cmdline -rw-r--r--. 1 root root 0 Nov 6 17:59 comm -rw-r--r--. 1 root root 0 Jan 14 15:56 coredump_filter -r--r--r--. 1 root root 0 Jan 14 15:56 cpuset lrwxrwxrwx. 1 root root 0 Jan 14 15:56 cwd -\u003e / -r--------. 1 root root 0 Jan 14 15:56 environ lrwxrwxrwx. 1 root root 0 Nov 6 17:59 exe -\u003e /usr/local/bin/rtpproxy dr-x------. 2 root root 0 Jan 14 15:56 fd dr-x------. 2 root root 0 Jan 14 15:56 fdinfo -rw-r--r--. 1 root root 0 Jan 14 15:56 gid_map -r--------. 1 root root 0 Jan 14 15:56 io -r--r--r--. 1 root root 0 Jan 14 15:56 limits -rw-r--r--. 1 root root 0 Nov 6 17:59 loginuid dr-x------. 2 root root 0 Jan 14 15:56 map_files -r--r--r--. 1 root root 0 Jan 14 15:56 maps -rw-------. 1 root root 0 Jan 14 15:56 mem -r--r--r--. 1 root root 0 Jan 14 15:56 mountinfo -r--r--r--. 1 root root 0 Jan 14 15:56 mounts -r--------. 1 root root 0 Jan 14 15:56 mountstats dr-xr-xr-x. 5 root root 0 Jan 14 15:56 net dr-x--x--x. 2 root root 0 Jan 14 15:56 ns -r--r--r--. 1 root root 0 Jan 14 15:56 numa_maps -rw-r--r--. 1 root root 0 Jan 14 15:56 oom_adj -r--r--r--. 1 root root 0 Jan 14 15:56 oom_score -rw-r--r--. 1 root root 0 Jan 14 15:56 oom_score_adj -r--r--r--. 1 root root 0 Jan 14 15:56 pagemap -r--r--r--. 1 root root 0 Jan 14 15:56 personality -rw-r--r--. 1 root root 0 Jan 14 15:56 projid_map lrwxrwxrwx. 1 root root 0 Jan 14 15:56 root -\u003e / -rw-r--r--. 1 root root 0 Jan 14 15:56 sched -r--r--r--. 1 root root 0 Nov 6 17:59 sessionid -rw-r--r--. 1 root root 0 Jan 14 15:56 setgroups -r--r--r--. 1 root root 0 Jan 14 15:56 smaps -r--r--r--. 1 root root 0 Jan 14 15:56 stack -r--r--r--. 1 root root 0 Jan 14 15:56 stat -r--r--r--. 1 root root 0 Jan 14 15:56 statm -r--r--r--. 1 root root 0 Nov 6 10:26 status -r--r--r--. 1 root root 0 Jan 14 15:56 syscall dr-xr-xr-x. 9 root root 0 Jan 14 15:56 task -r--r--r--. 1 root root 0 Jan 14 15:56 timers -rw-r--r--. 1 root root 0 Jan 14 15:56 uid_map -r--r--r--. 1 root root 0 Jan 14 15:56 wchan 工具简介 ps ps有三种风格的使用方式，我们一般使用前两种\nUnix风格 参数以-开头，如-a BSD风格，直接用参数 如a GUN风格，以–开头 常用的有\nps -ef ps aux VSZ 虚拟内存，单位kb RSS 物理内存，单位kb ➜ 2112 ps -ef | head UID PID PPID C STIME TTY TIME CMD root 1 0 0 2018 ? 01:57:34 /usr/lib/systemd/systemd --system --deserialize 23 root 2 0 0 2018 ? 00:00:44 [kthreadd] root 3 2 0 2018 ? 00:05:44 [ksoftirqd/0] root 7 2 0 2018 ? 00:08:04 [migration/0] root 8 2 0 2018 ? 00:00:00 [rcu_bh] root 9 2 0 2018 ? 00:00:00 [rcuob/0] root 10 2 0 2018 ? 00:00:00 [rcuob/1] root 11 2 0 2018 ? 00:00:00 [rcuob/2] root 12 2 0 2018 ? 00:00:00 [rcuob/3] ➜ 2112 ps aux | head USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND root 1 0.0 0.0 193524 3572 ? Ss 2018 117:34 /usr/lib/systemd/systemd --system --deserialize 23 root 2 0.0 0.0 0 0 ? S 2018 0:44 [kthreadd] root 3 0.0 0.0 0 0 ? S 2018 5:44 [ksoftirqd/0] root 7 0.0 0.0 0 0 ? S 2018 8:04 [migration/0] root 8 0.0 0.0 0 0 ? S 2018 0:00 [rcu_bh] root 9 0.0 0.0 0 0 ? S 2018 0:00 [rcuob/0] root 10 0.0 0.0 0 0 ? S 2018 0:00 [rcuob/1] root 11 0.0 0.0 0 0 ? S 2018 0:00 [rcuob/2] root 12 0.0 0.0 0 0 ? S 2018 0:00 [rcuob/3] ps 查看线程\n➜ 2118 ps -em -o pid,tid,command | grep rtpproxy -A 10 2112 - rtpproxy -l 192.168.40.101 -s udp:192.168.40.101 7890 -F -m 20000 -M 40000 -L 20000 -d DBUG - 2112 - - 2113 - - 2114 - - 2115 - - 2116 - - 2117 - - 2118 - cat /proc/2112/status Name:\trtpproxy State:\tS (sleeping) Tgid:\t2112 Ngid:\t0 Pid:\t2112 PPid:\t1 TracerPid:\t0 Uid:\t0\t0\t0\t0 Gid:\t0\t0\t0\t0 FDSize:\t16384 Groups:\t0 VmPeak:\t390896 kB VmSize:\t259824 kB VmLck:\t0 kB VmPin:\t0 kB VmHWM:\t121708 kB VmRSS:\t3532 kB VmData:\t246120 kB VmStk:\t136 kB VmExe:\t176 kB VmLib:\t3092 kB VmPTE:\t316 kB VmSwap:\t2272 kB Threads:\t7 SigQ:\t2/15086 SigPnd:\t0000000000000000 ShdPnd:\t0000000000000000 SigBlk:\t0000000000000000 SigIgn:\t0000000000001000 SigCgt:\t0000000187804a03 CapInh:\t0000000000000000 CapPrm:\t0000001fffffffff CapEff:\t0000001fffffffff CapBnd:\t0000001fffffffff Seccomp:\t0 Cpus_allowed:\tf Cpus_allowed_list:\t0-3 Mems_allowed:\t00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000001 Mems_allowed_list:\t0 voluntary_ctxt_switches:\t259223710 nonvoluntary_ctxt_switches:\t2216 nestat netstat -nulp netstat -ntulp netstat -nap lsof Linux下所有信息都是文件，那么查看打开文件就比较重要了。 lisf open file, 查看打开的文件\nlsof -c processName 按照进程名查看 lsof -c pid 按照pid查看 lsof file 查看文件被哪些进程打开 losf -i:8080 查看8080被那个进程占用 top top 1 P M 参考 http://turnoff.us/geek/inside-the-linux-kernel/ 《How Linux Works》 《Operating Systems there easy pieces》 讲虚拟化、并发、持久化三块 《理解Unix进程》 《Linux Shell Script cookbook》 https://www.internalpointers.com/post/gentle-introduction-multithreading https://dev.to/rrampage/surviving-the-linux-oom-killer-2ki9 附件书籍 proc(5) - Linux manual page.pdfCommand Line Text Processing - Sundeep Agarwal.pdfHow Linux Works _ What Every Superuser Sho - Brian Ward(Author).pdfOperating Systems three easy pieces - Unknown.pdf[Sarath Lakshman] Linux Shell Scripting Co - Unknown.pdftcp_ipGao Xiao Bian Cheng __Gai Shan Wang - Unknown.pdf\n","wordCount":"1328","inLanguage":"en","datePublished":"2020-04-25T20:30:18+08:00","dateModified":"2020-04-25T20:30:18+08:00","author":{"@type":"Person","name":"王端端"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://wdd.js.org/posts/old-blog/pbcbub/"},"publisher":{"@type":"Organization","name":"洞香春","logo":{"@type":"ImageObject","url":"https://wdd.js.org/cowboy.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://wdd.js.org accesskey=h title="洞香春 (Alt + H)"><img src=/cowboy.ico alt=logo aria-label=logo height=35>洞香春</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://wdd.js.org/freeswitch/ title=FreeSWITCH><span>FreeSWITCH</span></a></li><li><a href=https://wdd.js.org/fe/ title=Frontend><span>Frontend</span></a></li><li><a href=https://wdd.js.org/golang/ title=Golang><span>Golang</span></a></li><li><a href=https://wdd.js.org/container/ title=k8s/docker><span>k8s/docker</span></a></li><li><a href=https://wdd.js.org/network/ title=Network><span>Network</span></a></li><li><a href=https://wdd.js.org/opensips/ title=OpenSIPS><span>OpenSIPS</span></a></li><li><a href=https://wdd.js.org/shell/ title=Shell><span>Shell</span></a></li><li><a href=https://wdd.js.org/vim/ title=VIM><span>VIM</span></a></li><li><a href=https://wdd.js.org/categories/ title=分类><span>分类</span></a></li><li><a href=https://wdd.js.org/search/ title=搜索><span>搜索</span></a></li><li><a href=https://wdd.js.org/tags/ title=标签><span>标签</span></a></li><li><a href=https://wdd.js.org/archives/ title=归档><span>归档</span></a></li><li><a href=https://wdd.js.org/about/ title=我><span>我</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://wdd.js.org>Home</a>&nbsp;»&nbsp;<a href=https://wdd.js.org/posts/>Posts</a></div><h1 class=post-title>s</h1><div class=post-meta><span title='2020-04-25 20:30:18 +0800 CST'>2020-04-25 20:30:18</span>&nbsp;·&nbsp;7 min&nbsp;·&nbsp;王端端&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/posts/old-blog/pbcbub/index.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#linux%e7%b3%bb%e7%bb%9f%e6%9e%b6%e6%9e%84 aria-label=linux系统架构>linux系统架构</a></li><li><a href=#%e4%bb%80%e4%b9%88%e6%98%af%e8%bf%9b%e7%a8%8b aria-label=什么是进程>什么是进程</a></li><li><a href=#%e8%bf%9b%e7%a8%8b%e9%83%bd%e6%9c%89uid aria-label=进程都有uid>进程都有uid</a></li><li><a href=#%e8%bf%9b%e7%a8%8b%e9%83%bd%e6%9c%89pid aria-label=进程都有pid>进程都有pid</a></li><li><a href=#%e8%bf%9b%e7%a8%8b%e9%83%bd%e6%9c%89%e7%88%b6%e8%bf%9b%e7%a8%8b aria-label=进程都有父进程>进程都有父进程</a></li><li><a href=#%e8%bf%9b%e7%a8%8b%e6%98%af%e4%b8%80%e6%a3%b5%e6%a0%91 aria-label=进程是一棵树>进程是一棵树</a></li><li><a href=#%e8%bf%9b%e7%a8%8b%e9%83%bd%e6%9c%89%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f aria-label=进程都有生命周期>进程都有生命周期</a></li><li><a href=#%e8%bf%9b%e7%a8%8b%e9%83%bd%e6%9c%89%e7%8a%b6%e6%80%81 aria-label=进程都有状态>进程都有状态</a></li><li><a href=#%e8%bf%9b%e7%a8%8b%e9%83%bd%e6%9c%89%e6%89%93%e5%bc%80%e7%9a%84%e6%96%87%e4%bb%b6%e6%8f%8f%e8%bf%b0%e7%ac%a6 aria-label=进程都有打开的文件描述符>进程都有打开的文件描述符</a></li><li><a href=#%e8%bf%9b%e7%a8%8b%e9%83%bd%e6%9c%89%e8%b5%84%e6%ba%90%e9%99%90%e5%88%b6 aria-label=进程都有资源限制>进程都有资源限制</a></li><li><a href=#%e8%bf%9b%e7%a8%8b%e9%83%bd%e6%9c%89%e7%8e%af%e5%a2%83%e5%8f%98%e9%87%8f aria-label=进程都有环境变量>进程都有环境变量</a></li><li><a href=#%e8%bf%9b%e7%a8%8b%e9%83%bd%e6%9c%89%e5%8f%82%e6%95%b0 aria-label=进程都有参数>进程都有参数</a></li><li><a href=#%e8%bf%9b%e7%a8%8b%e9%83%bd%e6%9c%89%e5%90%8d%e5%ad%97 aria-label=进程都有名字>进程都有名字</a></li><li><a href=#%e8%bf%9b%e7%a8%8b%e7%9a%86%e6%9c%89%e9%80%80%e5%87%ba%e7%a0%81 aria-label=进程皆有退出码>进程皆有退出码</a></li><li><a href=#%e8%bf%9b%e7%a8%8b%e5%8f%af%e4%bb%a5fork aria-label=进程可以fork>进程可以fork</a></li><li><a href=#%e5%ad%a4%e5%84%bf%e8%bf%9b%e7%a8%8b aria-label=孤儿进程>孤儿进程</a></li><li><a href=#%e5%83%b5%e5%b0%b8%e8%bf%9b%e7%a8%8b aria-label=僵尸进程>僵尸进程</a></li><li><a href=#%e8%bf%9b%e7%a8%8b%e9%97%b4%e9%80%9a%e4%bf%a1 aria-label=进程间通信>进程间通信</a></li><li><a href=#%e5%ae%88%e6%8a%a4%e8%bf%9b%e7%a8%8b aria-label=守护进程>守护进程</a></li><li><a href=#idle%e8%bf%9b%e7%a8%8b%e4%b8%8einit%e8%bf%9b%e7%a8%8b aria-label=idle进程与init进程>idle进程与init进程</a></li><li><a href=#%e7%ba%bf%e7%a8%8b aria-label=线程>线程</a></li><li><a href=#%e8%bf%9b%e7%a8%8b%e4%b8%8e%e7%ba%bf%e7%a8%8b%e7%9a%84%e5%8c%ba%e5%88%ab aria-label=进程与线程的区别>进程与线程的区别</a></li><li><a href=#%e5%85%b3%e4%ba%8eproc%e7%9b%ae%e5%bd%95 aria-label=关于/proc目录>关于/proc目录</a></li><li><a href=#%e5%b7%a5%e5%85%b7%e7%ae%80%e4%bb%8b aria-label=工具简介>工具简介</a><ul><li><a href=#ps aria-label=ps>ps</a></li><li><a href=#nestat aria-label=nestat>nestat</a></li><li><a href=#lsof aria-label=lsof>lsof</a></li><li><a href=#top aria-label=top>top</a></li></ul></li><li><a href=#%e5%8f%82%e8%80%83 aria-label=参考>参考</a></li><li><a href=#%e9%99%84%e4%bb%b6%e4%b9%a6%e7%b1%8d aria-label=附件书籍>附件书籍</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p>思考题：当你用ssh登录到一个linux机器，并且执行了某个hello.sh之后，有哪些进程参与了该过程?</p><h1 id=linux系统架构>linux系统架构<a hidden class=anchor aria-hidden=true href=#linux系统架构>#</a></h1><ul><li>kernel mode</li><li>user mode</li><li>内核态和用户态的区别</li></ul><p><img loading=lazy src=2022-10-29-20-27-18.png alt></p><p><img loading=lazy src=2022-10-29-20-27-24.png alt></p><h1 id=heading><a hidden class=anchor aria-hidden=true href=#heading>#</a></h1><h1 id=什么是进程>什么是进程<a hidden class=anchor aria-hidden=true href=#什么是进程>#</a></h1><ul><li>进程是运行的程序</li><li>process 是对 processor 虚拟化，通过时间片</li></ul><p><img loading=lazy src=2022-10-29-20-27-31.png alt></p><h1 id=进程都有uid>进程都有uid<a hidden class=anchor aria-hidden=true href=#进程都有uid>#</a></h1><p>nginx访问某个目录，<strong>Permission denied</strong></p><p><img loading=lazy src=2022-10-29-20-27-41.png alt></p><h1 id=进程都有pid>进程都有pid<a hidden class=anchor aria-hidden=true href=#进程都有pid>#</a></h1><ul><li>$$</li></ul><p><img loading=lazy src=2022-10-29-20-27-52.png alt></p><h1 id=进程都有父进程>进程都有父进程<a hidden class=anchor aria-hidden=true href=#进程都有父进程>#</a></h1><ul><li>准确来说，除了pid为0的进程之外，其他进程都有父进程</li><li>有时候，你用kill命令杀死了一个进程，但是立马你就发现这个进程又起来了。你就要看看，这个进程是不是有个非init进程的父进程。一般这个进程负责监控子进程，一旦子进程挂掉，就会去重新创建一个进程。所以你需要找到这个父进程的Id，先把父进程kill掉，然后在kill子进程。</li></ul><p><img loading=lazy src=2022-10-29-20-27-58.png alt></p><h1 id=进程是一棵树>进程是一棵树<a hidden class=anchor aria-hidden=true href=#进程是一棵树>#</a></h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>echo <span style=color:#e6db74>&#34;pid is </span>$$<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>times<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> true
</span></span><span style=display:flex><span><span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>	sleep 2s;
</span></span><span style=display:flex><span>	let times++;
</span></span><span style=display:flex><span>	echo $times hello;
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>➜  ~ pstree <span style=color:#ae81ff>24601</span>
</span></span><span style=display:flex><span>sshd─┬─3*<span style=color:#f92672>[</span>sshd───zsh<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>     ├─sshd───zsh───pstree
</span></span><span style=display:flex><span>     └─sshd───zsh───world.sh───sleep
</span></span></code></pre></div><h1 id=进程都有生命周期>进程都有生命周期<a hidden class=anchor aria-hidden=true href=#进程都有生命周期>#</a></h1><ul><li>创建</li><li>销毁</li></ul><h1 id=进程都有状态>进程都有状态<a hidden class=anchor aria-hidden=true href=#进程都有状态>#</a></h1><ul><li>runing 进程占用CPU, 正在执行指令</li><li>ready 进程所有需要的资源都已经就绪，等待进入CPU执行</li><li>blocked 进程被某些事件阻断，例如IO。</li></ul><p>进程的状态转移图</p><p><img loading=lazy src=2022-10-29-20-28-09.png alt></p><h1 id=进程都有打开的文件描述符>进程都有打开的文件描述符<a hidden class=anchor aria-hidden=true href=#进程都有打开的文件描述符>#</a></h1><p>使用lsof命令，可以查看某个进程所打开的文件描述符</p><p><strong>/proc/pid/fd/目录下也有文件描述符</strong></p><p><strong>lsof -c 进程名</strong><strong>lsof -p 进程号</strong><strong>lsof filename # 查看某个文件被哪个进程打开</strong>**</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost ~<span style=color:#f92672>]</span><span style=color:#75715e># lsof -c rtpproxy</span>
</span></span><span style=display:flex><span>COMMAND   PID USER   FD   TYPE             DEVICE SIZE/OFF     NODE NAME
</span></span><span style=display:flex><span>rtpproxy <span style=color:#ae81ff>2073</span> root  cwd    DIR              253,0     <span style=color:#ae81ff>4096</span>      <span style=color:#ae81ff>128</span> /
</span></span><span style=display:flex><span>rtpproxy <span style=color:#ae81ff>2073</span> root  rtd    DIR              253,0     <span style=color:#ae81ff>4096</span>      <span style=color:#ae81ff>128</span> /
</span></span><span style=display:flex><span>rtpproxy <span style=color:#ae81ff>2073</span> root  txt    REG              253,0   <span style=color:#ae81ff>933247</span> <span style=color:#ae81ff>18295252</span> /usr/local/bin/rtpproxy
</span></span><span style=display:flex><span>rtpproxy <span style=color:#ae81ff>2073</span> root  mem    REG              253,0  <span style=color:#ae81ff>2127336</span> <span style=color:#ae81ff>33617010</span> /usr/lib64/libc-2.17.so
</span></span><span style=display:flex><span>rtpproxy <span style=color:#ae81ff>2073</span> root  mem    REG              253,0    <span style=color:#ae81ff>44448</span> <span style=color:#ae81ff>33617041</span> /usr/lib64/librt-2.17.so
</span></span><span style=display:flex><span>rtpproxy <span style=color:#ae81ff>2073</span> root  mem    REG              253,0    <span style=color:#ae81ff>19776</span> <span style=color:#ae81ff>34757658</span> /usr/lib64/libdl-2.17.so
</span></span><span style=display:flex><span>rtpproxy <span style=color:#ae81ff>2073</span> root  mem    REG              253,0  <span style=color:#ae81ff>1139680</span> <span style=color:#ae81ff>34757660</span> /usr/lib64/libm-2.17.so
</span></span><span style=display:flex><span>rtpproxy <span style=color:#ae81ff>2073</span> root  mem    REG              253,0   <span style=color:#ae81ff>144792</span> <span style=color:#ae81ff>33617035</span> /usr/lib64/libpthread-2.17.so
</span></span><span style=display:flex><span>rtpproxy <span style=color:#ae81ff>2073</span> root  mem    REG              253,0   <span style=color:#ae81ff>164112</span> <span style=color:#ae81ff>33595530</span> /usr/lib64/ld-2.17.so
</span></span><span style=display:flex><span>rtpproxy <span style=color:#ae81ff>2073</span> root    0u   CHR                1,3      0t0     <span style=color:#ae81ff>1028</span> /dev/null
</span></span><span style=display:flex><span>rtpproxy <span style=color:#ae81ff>2073</span> root    1u   CHR                1,3      0t0     <span style=color:#ae81ff>1028</span> /dev/null
</span></span><span style=display:flex><span>rtpproxy <span style=color:#ae81ff>2073</span> root    2u   CHR                1,3      0t0     <span style=color:#ae81ff>1028</span> /dev/null
</span></span><span style=display:flex><span>rtpproxy <span style=color:#ae81ff>2073</span> root    3u  IPv4              <span style=color:#ae81ff>17641</span>      0t0      UDP 192.168.40.100:7890
</span></span><span style=display:flex><span>rtpproxy <span style=color:#ae81ff>2073</span> root    4u  unix 0xffff880079260000      0t0    <span style=color:#ae81ff>17642</span> socket
</span></span><span style=display:flex><span>rtpproxy <span style=color:#ae81ff>2073</span> root    8u  IPv4           <span style=color:#ae81ff>72592335</span>      0t0      UDP 192.168.40.100:25257
</span></span></code></pre></div><h1 id=进程都有资源限制>进程都有资源限制<a hidden class=anchor aria-hidden=true href=#进程都有资源限制>#</a></h1><p>/proc/pid/limits</p><p>以rtpproxy为例子，rtpproxy的pid为2073, /proc/pid/limits文件记录进程的资源限制</p><p><img loading=lazy src=2022-10-29-20-28-17.png alt></p><h1 id=进程都有环境变量>进程都有环境变量<a hidden class=anchor aria-hidden=true href=#进程都有环境变量>#</a></h1><p><strong>/proc/pid/environ</strong></p><p><img loading=lazy src=2022-10-29-20-28-25.png alt></p><h1 id=进程都有参数>进程都有参数<a hidden class=anchor aria-hidden=true href=#进程都有参数>#</a></h1><p><strong>/proc/pid/cmdline</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>rtpproxy-A192.168.40.100-l192.168.40.100-sudp:192.168.40.1007890-F-m20000-M40000-L20000-dDBUG<span style=color:#f92672>[</span>root@localhost 2073<span style=color:#f92672>]</span><span style=color:#75715e>#</span>
</span></span></code></pre></div><h1 id=进程都有名字>进程都有名字<a hidden class=anchor aria-hidden=true href=#进程都有名字>#</a></h1><p><strong>/proc/2073/status</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Name:	rtpproxy
</span></span><span style=display:flex><span>State:	S <span style=color:#f92672>(</span>sleeping<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Tgid:	<span style=color:#ae81ff>2073</span>
</span></span><span style=display:flex><span>Ngid:	<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>Pid:	<span style=color:#ae81ff>2073</span>
</span></span><span style=display:flex><span>PPid:	<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>TracerPid:	<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>Uid:	0	0	0	<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>Gid:	0	0	0	<span style=color:#ae81ff>0</span>
</span></span></code></pre></div><h1 id=进程皆有退出码>进程皆有退出码<a hidden class=anchor aria-hidden=true href=#进程皆有退出码>#</a></h1><ul><li>非0的退出码一般是异常退出</li><li>$?</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost 2073<span style=color:#f92672>]</span><span style=color:#75715e># cat &#34;test&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost 2073<span style=color:#f92672>]</span><span style=color:#75715e># echo $?</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost 2073<span style=color:#f92672>]</span><span style=color:#75715e># echo $?</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span>
</span></span></code></pre></div><h1 id=进程可以fork>进程可以fork<a hidden class=anchor aria-hidden=true href=#进程可以fork>#</a></h1><p><img loading=lazy src=2022-10-29-20-28-33.png alt></p><h1 id=孤儿进程>孤儿进程<a hidden class=anchor aria-hidden=true href=#孤儿进程>#</a></h1><p>孤儿进程：一个父进程退出，而它的一个或多个子进程还在运行，那么那些子进程将成为孤儿进程。孤儿进程将被init进程(进程号为1)所收养，并由init进程对它们完成状态收集工作。</p><h1 id=僵尸进程>僵尸进程<a hidden class=anchor aria-hidden=true href=#僵尸进程>#</a></h1><p> 僵尸进程：一个进程使用fork创建子进程，如果子进程退出，而父进程并没有调用wait或waitpid获取子进程的状态信息，那么子进程的进程描述符仍然保存在系统中。这种进程称之为僵死进程。 僵尸进程占用进程描述符，无法释放，会导致系统无法正常的创建进程。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>&gt; cat /proc/sys/kernel/pid_max
</span></span><span style=display:flex><span><span style=color:#ae81ff>32768</span>
</span></span></code></pre></div><h1 id=进程间通信>进程间通信<a hidden class=anchor aria-hidden=true href=#进程间通信>#</a></h1><p>进程之间的所有资源都是完全隔离的，所以进程之间如何通信呢？</p><p>在liunx底层，有个套接字API</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>SOCKET socket <span style=color:#f92672>(</span>int domain, int type, int protocol<span style=color:#f92672>)</span>
</span></span></code></pre></div><ul><li>domain 表示域，一般由两个值<ul><li>AF_INET 即因特网</li><li>AF_LOCAL 用于同一台机器上的进程间通信</li></ul></li><li>type 表示类型<ul><li>SOCK_STREAM 提供可靠的、全双工、面向链接的字节流，一般就是TCP</li><li>SOCK_DGRAM 提供不可靠、尽力而为的数据报服务，一般就是UDP</li><li>SOCK_RAW 允许直接访问IP层原生的数据报</li></ul></li></ul><p>也就是说，进程间通信，实际上也是用的socket</p><h1 id=守护进程>守护进程<a hidden class=anchor aria-hidden=true href=#守护进程>#</a></h1><p>守护进程一般是后台运行的进程，例如sshd, mysqld, dockerd等等，他们的特点就是他们的ppid是1， 也就是说，守护进程也是孤儿进程的一种。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root      <span style=color:#ae81ff>9696</span>     <span style=color:#ae81ff>1</span>  <span style=color:#ae81ff>0</span> Oct06 ?        00:05:16 /usr/sbin/sshd -D
</span></span></code></pre></div><h1 id=idle进程与init进程>idle进程与init进程<a hidden class=anchor aria-hidden=true href=#idle进程与init进程>#</a></h1><p>Linux下有3个特殊的进程**，idle进程(PID = 0), init进程(PID = 1)和kthreadd(PID = 2)**</p><ul><li>idle进程由系统自动创建, 运行在内核态。idle进程其pid=0，其前身是系统创建的第一个进程，也是唯一一个没有通过fork或者kernel_thread产生的进程。完成加载系统后，演变为进程调度、交换</li><li>init进程由idle通过kernel_thread创建，在内核空间完成初始化后, 加载init程序, 并最终用户空间。由0进程创建，完成系统的初始化. 是系统中所有其它用户进程的祖先进程</li><li>Linux中的所有进程都是有init进程创建并运行的。首先Linux内核启动，然后在用户空间中启动init进程，再启动其他系统进程。在系统启动完成完成后，init将变为守护进程监视系统其他进程。</li><li>kthreadd进程由idle通过kernel_thread创建，并始终运行在内核空间, 负责所有内核线程的调度和管理</li></ul><p>参考：<a href=https://blog.csdn.net/gatieme/article/details/51484562>https://blog.csdn.net/gatieme/article/details/51484562</a></p><h1 id=线程>线程<a hidden class=anchor aria-hidden=true href=#线程>#</a></h1><p>ps -m可以在进程之后显示线程。线程的tid也会占用一个/proc/tid目录，和进程的/proc/pid 目录没什么区别。</p><p>只不过进程的Tgid(线程组Id)是自己的pid, 而其他线程的Tgid是主线程的pid。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>ps -em -o pid,tid,command | grep rtpproxy -A10
</span></span><span style=display:flex><span> <span style=color:#ae81ff>2112</span>     - rtpproxy -l 192.168.40.101 -s udp:192.168.40.101 <span style=color:#ae81ff>7890</span> -F -m <span style=color:#ae81ff>20000</span> -M <span style=color:#ae81ff>40000</span> -L <span style=color:#ae81ff>20000</span> -d DBUG
</span></span><span style=display:flex><span>    -  <span style=color:#ae81ff>2112</span> -
</span></span><span style=display:flex><span>    -  <span style=color:#ae81ff>2113</span> -
</span></span><span style=display:flex><span>    -  <span style=color:#ae81ff>2114</span> -
</span></span><span style=display:flex><span>    -  <span style=color:#ae81ff>2115</span> -
</span></span><span style=display:flex><span>    -  <span style=color:#ae81ff>2116</span> -
</span></span><span style=display:flex><span>    -  <span style=color:#ae81ff>2117</span> -
</span></span><span style=display:flex><span>    -  <span style=color:#ae81ff>2118</span> -
</span></span></code></pre></div><p><img loading=lazy src=2022-10-29-20-28-54.png alt></p><h1 id=进程与线程的区别>进程与线程的区别<a hidden class=anchor aria-hidden=true href=#进程与线程的区别>#</a></h1><p><img loading=lazy src=2022-10-29-20-29-01.png alt></p><h1 id=关于proc目录>关于/proc目录<a hidden class=anchor aria-hidden=true href=#关于proc目录>#</a></h1><p>proc目录是一个虚拟的文件系统，实际上是内核的数据结构的映射。里面的大部分的文件都是只读的，只有少部分是可写的。</p><p>关于进程运行时信息，都可以在这个目录找到。</p><p>下面的链接详细的介绍了每个目录的作用。</p><ul><li><p><a href=https://www.linux.com/news/discover-possibilities-proc-directory/>https://www.linux.com/news/discover-possibilities-proc-directory/</a></p></li><li><p><a href=https://www.tldp.org/LDP/sag/html/proc-fs.html>https://www.tldp.org/LDP/sag/html/proc-fs.html</a></p></li><li><p><a href=http://man7.org/linux/man-pages/man5/proc.5.html>http://man7.org/linux/man-pages/man5/proc.5.html</a></p></li><li><p>思考</p><ul><li>如何获取某个执行进程的可执行文件的路径？</li><li>proc目录下的文件有何特点？</li></ul></li></ul><p>以下的几个文件是比较重要的，着重说明一下。</p><ul><li><strong>cmdline 执行参数</strong></li><li><strong>environ 环境变量</strong></li><li>** exe -> /usr/local/bin/rtpproxy  可执行文件位置**</li><li>** fd 文件描述符信息**</li><li>** limits 资源限制**</li><li><strong>oom killer机制：杀掉最胖的那个进程</strong><ul><li><strong>oom_adj</strong></li><li><strong>oom_score</strong></li><li><strong>oom_score_adj</strong></li></ul></li><li><strong>status 状态信息</strong></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>dr-xr-xr-x. <span style=color:#ae81ff>2</span> root root <span style=color:#ae81ff>0</span> Jan <span style=color:#ae81ff>14</span> 15:56 attr
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Jan <span style=color:#ae81ff>14</span> 15:56 autogroup
</span></span><span style=display:flex><span>-r--------. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Jan <span style=color:#ae81ff>14</span> 15:56 auxv
</span></span><span style=display:flex><span>-r--r--r--. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Nov  <span style=color:#ae81ff>6</span> 17:59 cgroup
</span></span><span style=display:flex><span>--w-------. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Jan <span style=color:#ae81ff>14</span> 15:56 clear_refs
</span></span><span style=display:flex><span>-r--r--r--. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Nov  <span style=color:#ae81ff>6</span> 10:26 cmdline
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Nov  <span style=color:#ae81ff>6</span> 17:59 comm
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Jan <span style=color:#ae81ff>14</span> 15:56 coredump_filter
</span></span><span style=display:flex><span>-r--r--r--. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Jan <span style=color:#ae81ff>14</span> 15:56 cpuset
</span></span><span style=display:flex><span>lrwxrwxrwx. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Jan <span style=color:#ae81ff>14</span> 15:56 cwd -&gt; /
</span></span><span style=display:flex><span>-r--------. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Jan <span style=color:#ae81ff>14</span> 15:56 environ
</span></span><span style=display:flex><span>lrwxrwxrwx. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Nov  <span style=color:#ae81ff>6</span> 17:59 exe -&gt; /usr/local/bin/rtpproxy
</span></span><span style=display:flex><span>dr-x------. <span style=color:#ae81ff>2</span> root root <span style=color:#ae81ff>0</span> Jan <span style=color:#ae81ff>14</span> 15:56 fd
</span></span><span style=display:flex><span>dr-x------. <span style=color:#ae81ff>2</span> root root <span style=color:#ae81ff>0</span> Jan <span style=color:#ae81ff>14</span> 15:56 fdinfo
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Jan <span style=color:#ae81ff>14</span> 15:56 gid_map
</span></span><span style=display:flex><span>-r--------. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Jan <span style=color:#ae81ff>14</span> 15:56 io
</span></span><span style=display:flex><span>-r--r--r--. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Jan <span style=color:#ae81ff>14</span> 15:56 limits
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Nov  <span style=color:#ae81ff>6</span> 17:59 loginuid
</span></span><span style=display:flex><span>dr-x------. <span style=color:#ae81ff>2</span> root root <span style=color:#ae81ff>0</span> Jan <span style=color:#ae81ff>14</span> 15:56 map_files
</span></span><span style=display:flex><span>-r--r--r--. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Jan <span style=color:#ae81ff>14</span> 15:56 maps
</span></span><span style=display:flex><span>-rw-------. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Jan <span style=color:#ae81ff>14</span> 15:56 mem
</span></span><span style=display:flex><span>-r--r--r--. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Jan <span style=color:#ae81ff>14</span> 15:56 mountinfo
</span></span><span style=display:flex><span>-r--r--r--. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Jan <span style=color:#ae81ff>14</span> 15:56 mounts
</span></span><span style=display:flex><span>-r--------. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Jan <span style=color:#ae81ff>14</span> 15:56 mountstats
</span></span><span style=display:flex><span>dr-xr-xr-x. <span style=color:#ae81ff>5</span> root root <span style=color:#ae81ff>0</span> Jan <span style=color:#ae81ff>14</span> 15:56 net
</span></span><span style=display:flex><span>dr-x--x--x. <span style=color:#ae81ff>2</span> root root <span style=color:#ae81ff>0</span> Jan <span style=color:#ae81ff>14</span> 15:56 ns
</span></span><span style=display:flex><span>-r--r--r--. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Jan <span style=color:#ae81ff>14</span> 15:56 numa_maps
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Jan <span style=color:#ae81ff>14</span> 15:56 oom_adj
</span></span><span style=display:flex><span>-r--r--r--. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Jan <span style=color:#ae81ff>14</span> 15:56 oom_score
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Jan <span style=color:#ae81ff>14</span> 15:56 oom_score_adj
</span></span><span style=display:flex><span>-r--r--r--. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Jan <span style=color:#ae81ff>14</span> 15:56 pagemap
</span></span><span style=display:flex><span>-r--r--r--. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Jan <span style=color:#ae81ff>14</span> 15:56 personality
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Jan <span style=color:#ae81ff>14</span> 15:56 projid_map
</span></span><span style=display:flex><span>lrwxrwxrwx. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Jan <span style=color:#ae81ff>14</span> 15:56 root -&gt; /
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Jan <span style=color:#ae81ff>14</span> 15:56 sched
</span></span><span style=display:flex><span>-r--r--r--. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Nov  <span style=color:#ae81ff>6</span> 17:59 sessionid
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Jan <span style=color:#ae81ff>14</span> 15:56 setgroups
</span></span><span style=display:flex><span>-r--r--r--. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Jan <span style=color:#ae81ff>14</span> 15:56 smaps
</span></span><span style=display:flex><span>-r--r--r--. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Jan <span style=color:#ae81ff>14</span> 15:56 stack
</span></span><span style=display:flex><span>-r--r--r--. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Jan <span style=color:#ae81ff>14</span> 15:56 stat
</span></span><span style=display:flex><span>-r--r--r--. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Jan <span style=color:#ae81ff>14</span> 15:56 statm
</span></span><span style=display:flex><span>-r--r--r--. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Nov  <span style=color:#ae81ff>6</span> 10:26 status
</span></span><span style=display:flex><span>-r--r--r--. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Jan <span style=color:#ae81ff>14</span> 15:56 syscall
</span></span><span style=display:flex><span>dr-xr-xr-x. <span style=color:#ae81ff>9</span> root root <span style=color:#ae81ff>0</span> Jan <span style=color:#ae81ff>14</span> 15:56 task
</span></span><span style=display:flex><span>-r--r--r--. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Jan <span style=color:#ae81ff>14</span> 15:56 timers
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Jan <span style=color:#ae81ff>14</span> 15:56 uid_map
</span></span><span style=display:flex><span>-r--r--r--. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>0</span> Jan <span style=color:#ae81ff>14</span> 15:56 wchan
</span></span></code></pre></div><h1 id=工具简介>工具简介<a hidden class=anchor aria-hidden=true href=#工具简介>#</a></h1><h2 id=ps>ps<a hidden class=anchor aria-hidden=true href=#ps>#</a></h2><p>ps有三种风格的使用方式，我们一般使用前两种</p><ul><li>Unix风格 参数以-开头，如-a</li><li>BSD风格，直接用参数 如a</li><li>GUN风格，以&ndash;开头</li></ul><p>常用的有</p><ul><li>ps -ef</li><li>ps aux<ul><li>VSZ 虚拟内存，单位kb</li><li>RSS 物理内存，单位kb</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>➜  <span style=color:#ae81ff>2112</span> ps -ef | head
</span></span><span style=display:flex><span>UID        PID  PPID  C STIME TTY          TIME CMD
</span></span><span style=display:flex><span>root         <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>0</span>  <span style=color:#ae81ff>0</span>  <span style=color:#ae81ff>2018</span> ?        01:57:34 /usr/lib/systemd/systemd --system --deserialize <span style=color:#ae81ff>23</span>
</span></span><span style=display:flex><span>root         <span style=color:#ae81ff>2</span>     <span style=color:#ae81ff>0</span>  <span style=color:#ae81ff>0</span>  <span style=color:#ae81ff>2018</span> ?        00:00:44 <span style=color:#f92672>[</span>kthreadd<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>root         <span style=color:#ae81ff>3</span>     <span style=color:#ae81ff>2</span>  <span style=color:#ae81ff>0</span>  <span style=color:#ae81ff>2018</span> ?        00:05:44 <span style=color:#f92672>[</span>ksoftirqd/0<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>root         <span style=color:#ae81ff>7</span>     <span style=color:#ae81ff>2</span>  <span style=color:#ae81ff>0</span>  <span style=color:#ae81ff>2018</span> ?        00:08:04 <span style=color:#f92672>[</span>migration/0<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>root         <span style=color:#ae81ff>8</span>     <span style=color:#ae81ff>2</span>  <span style=color:#ae81ff>0</span>  <span style=color:#ae81ff>2018</span> ?        00:00:00 <span style=color:#f92672>[</span>rcu_bh<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>root         <span style=color:#ae81ff>9</span>     <span style=color:#ae81ff>2</span>  <span style=color:#ae81ff>0</span>  <span style=color:#ae81ff>2018</span> ?        00:00:00 <span style=color:#f92672>[</span>rcuob/0<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>root        <span style=color:#ae81ff>10</span>     <span style=color:#ae81ff>2</span>  <span style=color:#ae81ff>0</span>  <span style=color:#ae81ff>2018</span> ?        00:00:00 <span style=color:#f92672>[</span>rcuob/1<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>root        <span style=color:#ae81ff>11</span>     <span style=color:#ae81ff>2</span>  <span style=color:#ae81ff>0</span>  <span style=color:#ae81ff>2018</span> ?        00:00:00 <span style=color:#f92672>[</span>rcuob/2<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>root        <span style=color:#ae81ff>12</span>     <span style=color:#ae81ff>2</span>  <span style=color:#ae81ff>0</span>  <span style=color:#ae81ff>2018</span> ?        00:00:00 <span style=color:#f92672>[</span>rcuob/3<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>➜  <span style=color:#ae81ff>2112</span> ps aux | head
</span></span><span style=display:flex><span>USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
</span></span><span style=display:flex><span>root         <span style=color:#ae81ff>1</span>  0.0  0.0 <span style=color:#ae81ff>193524</span>  <span style=color:#ae81ff>3572</span> ?        Ss    <span style=color:#ae81ff>2018</span> 117:34 /usr/lib/systemd/systemd --system --deserialize <span style=color:#ae81ff>23</span>
</span></span><span style=display:flex><span>root         <span style=color:#ae81ff>2</span>  0.0  0.0      <span style=color:#ae81ff>0</span>     <span style=color:#ae81ff>0</span> ?        S     <span style=color:#ae81ff>2018</span>   0:44 <span style=color:#f92672>[</span>kthreadd<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>root         <span style=color:#ae81ff>3</span>  0.0  0.0      <span style=color:#ae81ff>0</span>     <span style=color:#ae81ff>0</span> ?        S     <span style=color:#ae81ff>2018</span>   5:44 <span style=color:#f92672>[</span>ksoftirqd/0<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>root         <span style=color:#ae81ff>7</span>  0.0  0.0      <span style=color:#ae81ff>0</span>     <span style=color:#ae81ff>0</span> ?        S     <span style=color:#ae81ff>2018</span>   8:04 <span style=color:#f92672>[</span>migration/0<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>root         <span style=color:#ae81ff>8</span>  0.0  0.0      <span style=color:#ae81ff>0</span>     <span style=color:#ae81ff>0</span> ?        S     <span style=color:#ae81ff>2018</span>   0:00 <span style=color:#f92672>[</span>rcu_bh<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>root         <span style=color:#ae81ff>9</span>  0.0  0.0      <span style=color:#ae81ff>0</span>     <span style=color:#ae81ff>0</span> ?        S     <span style=color:#ae81ff>2018</span>   0:00 <span style=color:#f92672>[</span>rcuob/0<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>root        <span style=color:#ae81ff>10</span>  0.0  0.0      <span style=color:#ae81ff>0</span>     <span style=color:#ae81ff>0</span> ?        S     <span style=color:#ae81ff>2018</span>   0:00 <span style=color:#f92672>[</span>rcuob/1<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>root        <span style=color:#ae81ff>11</span>  0.0  0.0      <span style=color:#ae81ff>0</span>     <span style=color:#ae81ff>0</span> ?        S     <span style=color:#ae81ff>2018</span>   0:00 <span style=color:#f92672>[</span>rcuob/2<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>root        <span style=color:#ae81ff>12</span>  0.0  0.0      <span style=color:#ae81ff>0</span>     <span style=color:#ae81ff>0</span> ?        S     <span style=color:#ae81ff>2018</span>   0:00 <span style=color:#f92672>[</span>rcuob/3<span style=color:#f92672>]</span>
</span></span></code></pre></div><p>ps 查看线程</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>➜  <span style=color:#ae81ff>2118</span> ps -em -o pid,tid,command  | grep rtpproxy -A <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span> <span style=color:#ae81ff>2112</span>     - rtpproxy -l 192.168.40.101 -s udp:192.168.40.101 <span style=color:#ae81ff>7890</span> -F -m <span style=color:#ae81ff>20000</span> -M <span style=color:#ae81ff>40000</span> -L <span style=color:#ae81ff>20000</span> -d DBUG
</span></span><span style=display:flex><span>    -  <span style=color:#ae81ff>2112</span> -
</span></span><span style=display:flex><span>    -  <span style=color:#ae81ff>2113</span> -
</span></span><span style=display:flex><span>    -  <span style=color:#ae81ff>2114</span> -
</span></span><span style=display:flex><span>    -  <span style=color:#ae81ff>2115</span> -
</span></span><span style=display:flex><span>    -  <span style=color:#ae81ff>2116</span> -
</span></span><span style=display:flex><span>    -  <span style=color:#ae81ff>2117</span> -
</span></span><span style=display:flex><span>    -  <span style=color:#ae81ff>2118</span> -
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cat /proc/2112/status
</span></span><span style=display:flex><span>Name:	rtpproxy
</span></span><span style=display:flex><span>State:	S <span style=color:#f92672>(</span>sleeping<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Tgid:	<span style=color:#ae81ff>2112</span>
</span></span><span style=display:flex><span>Ngid:	<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>Pid:	<span style=color:#ae81ff>2112</span>
</span></span><span style=display:flex><span>PPid:	<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>TracerPid:	<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>Uid:	0	0	0	<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>Gid:	0	0	0	<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>FDSize:	<span style=color:#ae81ff>16384</span>
</span></span><span style=display:flex><span>Groups:	<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>VmPeak:	  <span style=color:#ae81ff>390896</span> kB
</span></span><span style=display:flex><span>VmSize:	  <span style=color:#ae81ff>259824</span> kB
</span></span><span style=display:flex><span>VmLck:	       <span style=color:#ae81ff>0</span> kB
</span></span><span style=display:flex><span>VmPin:	       <span style=color:#ae81ff>0</span> kB
</span></span><span style=display:flex><span>VmHWM:	  <span style=color:#ae81ff>121708</span> kB
</span></span><span style=display:flex><span>VmRSS:	    <span style=color:#ae81ff>3532</span> kB
</span></span><span style=display:flex><span>VmData:	  <span style=color:#ae81ff>246120</span> kB
</span></span><span style=display:flex><span>VmStk:	     <span style=color:#ae81ff>136</span> kB
</span></span><span style=display:flex><span>VmExe:	     <span style=color:#ae81ff>176</span> kB
</span></span><span style=display:flex><span>VmLib:	    <span style=color:#ae81ff>3092</span> kB
</span></span><span style=display:flex><span>VmPTE:	     <span style=color:#ae81ff>316</span> kB
</span></span><span style=display:flex><span>VmSwap:	    <span style=color:#ae81ff>2272</span> kB
</span></span><span style=display:flex><span>Threads:	<span style=color:#ae81ff>7</span>
</span></span><span style=display:flex><span>SigQ:	2/15086
</span></span><span style=display:flex><span>SigPnd:	<span style=color:#ae81ff>0000000000000000</span>
</span></span><span style=display:flex><span>ShdPnd:	<span style=color:#ae81ff>0000000000000000</span>
</span></span><span style=display:flex><span>SigBlk:	<span style=color:#ae81ff>0000000000000000</span>
</span></span><span style=display:flex><span>SigIgn:	<span style=color:#ae81ff>0000000000001000</span>
</span></span><span style=display:flex><span>SigCgt:	0000000187804a03
</span></span><span style=display:flex><span>CapInh:	<span style=color:#ae81ff>0000000000000000</span>
</span></span><span style=display:flex><span>CapPrm:	0000001fffffffff
</span></span><span style=display:flex><span>CapEff:	0000001fffffffff
</span></span><span style=display:flex><span>CapBnd:	0000001fffffffff
</span></span><span style=display:flex><span>Seccomp:	<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>Cpus_allowed:	f
</span></span><span style=display:flex><span>Cpus_allowed_list:	0-3
</span></span><span style=display:flex><span>Mems_allowed:	00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000001
</span></span><span style=display:flex><span>Mems_allowed_list:	<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>voluntary_ctxt_switches:	<span style=color:#ae81ff>259223710</span>
</span></span><span style=display:flex><span>nonvoluntary_ctxt_switches:	<span style=color:#ae81ff>2216</span>
</span></span></code></pre></div><h2 id=nestat>nestat<a hidden class=anchor aria-hidden=true href=#nestat>#</a></h2><ul><li>netstat -nulp </li><li>netstat -ntulp</li><li>netstat -nap</li></ul><h2 id=lsof>lsof<a hidden class=anchor aria-hidden=true href=#lsof>#</a></h2><p>Linux下所有信息都是文件，那么查看打开文件就比较重要了。 lisf open file, 查看打开的文件</p><ul><li>lsof -c processName  按照进程名查看</li><li>lsof -c pid  按照pid查看</li><li>lsof file  查看文件被哪些进程打开</li><li>losf -i:8080 查看8080被那个进程占用</li></ul><h2 id=top>top<a hidden class=anchor aria-hidden=true href=#top>#</a></h2><ul><li>top</li><li>1</li><li>P</li><li>M</li></ul><h1 id=参考>参考<a hidden class=anchor aria-hidden=true href=#参考>#</a></h1><ul><li><a href=http://turnoff.us/geek/inside-the-linux-kernel/>http://turnoff.us/geek/inside-the-linux-kernel/</a></li><li>《How Linux Works》</li><li>《Operating Systems there easy pieces》 讲虚拟化、并发、持久化三块</li><li>《理解Unix进程》</li><li>《Linux Shell Script cookbook》</li><li><a href=https://www.internalpointers.com/post/gentle-introduction-multithreading>https://www.internalpointers.com/post/gentle-introduction-multithreading</a></li><li><a href=https://dev.to/rrampage/surviving-the-linux-oom-killer-2ki9>https://dev.to/rrampage/surviving-the-linux-oom-killer-2ki9</a></li></ul><h1 id=附件书籍>附件书籍<a hidden class=anchor aria-hidden=true href=#附件书籍>#</a></h1><p><a href="https://www.yuque.com/attachments/yuque/0/2020/pdf/280451/1587817845090-09fbe306-7379-476f-ad01-a15a15f35fac.pdf?_lake_card=%7B%22uid%22%3A%221579238860200-0%22%2C%22src%22%3A%22https%3A%2F%2Fwww.yuque.com%2Fattachments%2Fyuque%2F0%2F2020%2Fpdf%2F280451%2F1587817845090-09fbe306-7379-476f-ad01-a15a15f35fac.pdf%22%2C%22name%22%3A%22proc(5)%20-%20Linux%20manual%20page.pdf%22%2C%22size%22%3A525962%2C%22type%22%3A%22application%2Fpdf%22%2C%22ext%22%3A%22pdf%22%2C%22progress%22%3A%7B%22percent%22%3A99%7D%2C%22status%22%3A%22done%22%2C%22percent%22%3A0%2C%22id%22%3A%22UBGZL%22%2C%22refSrc%22%3A%22https%3A%2F%2Fwww.yuque.com%2Fattachments%2Fyuque%2F0%2F2020%2Fpdf%2F280451%2F1579238862829-00c99636-edcb-468d-a426-11f0af5f122b.pdf%22%2C%22card%22%3A%22file%22%7D">proc(5) - Linux manual page.pdf</a><a href="https://www.yuque.com/attachments/yuque/0/2020/pdf/280451/1587817845069-c2bbf9f7-f50f-4415-ba82-a8096425d7bb.pdf?_lake_card=%7B%22uid%22%3A%221579238878151-0%22%2C%22src%22%3A%22https%3A%2F%2Fwww.yuque.com%2Fattachments%2Fyuque%2F0%2F2020%2Fpdf%2F280451%2F1587817845069-c2bbf9f7-f50f-4415-ba82-a8096425d7bb.pdf%22%2C%22name%22%3A%22Command%20Line%20Text%20Processing%20-%20Sundeep%20Agarwal.pdf%22%2C%22size%22%3A1624036%2C%22type%22%3A%22application%2Fpdf%22%2C%22ext%22%3A%22pdf%22%2C%22progress%22%3A%7B%22percent%22%3A99%7D%2C%22status%22%3A%22done%22%2C%22percent%22%3A0%2C%22id%22%3A%22xde8k%22%2C%22refSrc%22%3A%22https%3A%2F%2Fwww.yuque.com%2Fattachments%2Fyuque%2F0%2F2020%2Fpdf%2F280451%2F1579238880104-cea1391b-c420-46f0-9695-37f86beb0ad5.pdf%22%2C%22card%22%3A%22file%22%7D">Command Line Text Processing - Sundeep Agarwal.pdf</a><a href="https://www.yuque.com/attachments/yuque/0/2020/pdf/280451/1587817845076-a9f5c105-d678-4490-9300-331841deb5e7.pdf?_lake_card=%7B%22uid%22%3A%221579238892903-0%22%2C%22src%22%3A%22https%3A%2F%2Fwww.yuque.com%2Fattachments%2Fyuque%2F0%2F2020%2Fpdf%2F280451%2F1587817845076-a9f5c105-d678-4490-9300-331841deb5e7.pdf%22%2C%22name%22%3A%22How%20Linux%20Works%20_%20What%20Every%20Superuser%20Sho%20-%20Brian%20Ward(Author).pdf%22%2C%22size%22%3A5743040%2C%22type%22%3A%22application%2Fpdf%22%2C%22ext%22%3A%22pdf%22%2C%22progress%22%3A%7B%22percent%22%3A99%7D%2C%22status%22%3A%22done%22%2C%22percent%22%3A0%2C%22id%22%3A%22BHZtT%22%2C%22refSrc%22%3A%22https%3A%2F%2Fwww.yuque.com%2Fattachments%2Fyuque%2F0%2F2020%2Fpdf%2F280451%2F1579238898990-c17ce880-3ef6-49ff-92cf-f03897e0978c.pdf%22%2C%22card%22%3A%22file%22%7D">How Linux Works _ What Every Superuser Sho - Brian Ward(Author).pdf</a><a href="https://www.yuque.com/attachments/yuque/0/2020/pdf/280451/1587817845072-7d1f36b7-59ea-4168-890e-7cfbf0f7f38b.pdf?_lake_card=%7B%22uid%22%3A%221579238910772-0%22%2C%22src%22%3A%22https%3A%2F%2Fwww.yuque.com%2Fattachments%2Fyuque%2F0%2F2020%2Fpdf%2F280451%2F1587817845072-7d1f36b7-59ea-4168-890e-7cfbf0f7f38b.pdf%22%2C%22name%22%3A%22Operating%20Systems%20three%20easy%20pieces%20-%20Unknown.pdf%22%2C%22size%22%3A4423091%2C%22type%22%3A%22application%2Fpdf%22%2C%22ext%22%3A%22pdf%22%2C%22progress%22%3A%7B%22percent%22%3A99%7D%2C%22status%22%3A%22done%22%2C%22percent%22%3A0%2C%22id%22%3A%22jd13F%22%2C%22refSrc%22%3A%22https%3A%2F%2Fwww.yuque.com%2Fattachments%2Fyuque%2F0%2F2020%2Fpdf%2F280451%2F1579238920174-b3646f53-7e2c-4c08-879c-c042ceb75b94.pdf%22%2C%22card%22%3A%22file%22%7D">Operating Systems three easy pieces - Unknown.pdf</a><a href="https://www.yuque.com/attachments/yuque/0/2020/pdf/280451/1587817845085-902ac099-f656-4e98-9740-d4d1e0ac6c95.pdf?_lake_card=%7B%22uid%22%3A%221579238945590-0%22%2C%22src%22%3A%22https%3A%2F%2Fwww.yuque.com%2Fattachments%2Fyuque%2F0%2F2020%2Fpdf%2F280451%2F1587817845085-902ac099-f656-4e98-9740-d4d1e0ac6c95.pdf%22%2C%22name%22%3A%22%5BSarath%20Lakshman%5D%20Linux%20Shell%20Scripting%20Co%20-%20Unknown.pdf%22%2C%22size%22%3A13062238%2C%22type%22%3A%22application%2Fpdf%22%2C%22ext%22%3A%22pdf%22%2C%22progress%22%3A%7B%22percent%22%3A99%7D%2C%22status%22%3A%22done%22%2C%22percent%22%3A0%2C%22id%22%3A%22OTOfx%22%2C%22refSrc%22%3A%22https%3A%2F%2Fwww.yuque.com%2Fattachments%2Fyuque%2F0%2F2020%2Fpdf%2F280451%2F1579238957575-3e61dc3f-0917-4f45-b8b1-84369a64f2a4.pdf%22%2C%22card%22%3A%22file%22%7D">[Sarath Lakshman] Linux Shell Scripting Co - Unknown.pdf</a><a href="https://www.yuque.com/attachments/yuque/0/2020/pdf/280451/1587817845091-b47dbe1f-46d5-4a81-a48e-6970938587b4.pdf?_lake_card=%7B%22uid%22%3A%221579239137673-0%22%2C%22src%22%3A%22https%3A%2F%2Fwww.yuque.com%2Fattachments%2Fyuque%2F0%2F2020%2Fpdf%2F280451%2F1587817845091-b47dbe1f-46d5-4a81-a48e-6970938587b4.pdf%22%2C%22name%22%3A%22tcp_ipGao%20Xiao%20Bian%20Cheng%20__Gai%20Shan%20Wang%20-%20Unknown.pdf%22%2C%22size%22%3A26474025%2C%22type%22%3A%22application%2Fpdf%22%2C%22ext%22%3A%22pdf%22%2C%22progress%22%3A%7B%22percent%22%3A99%7D%2C%22status%22%3A%22done%22%2C%22percent%22%3A0%2C%22id%22%3A%220szKj%22%2C%22refSrc%22%3A%22https%3A%2F%2Fwww.yuque.com%2Fattachments%2Fyuque%2F0%2F2020%2Fpdf%2F280451%2F1579239166937-7f9747ee-e2f9-4e77-9c96-f5e6255e13e1.pdf%22%2C%22card%22%3A%22file%22%7D">tcp_ipGao Xiao Bian Cheng __Gai Shan Wang - Unknown.pdf</a></p></div><footer class=post-footer><nav class=paginav><a class=prev href=https://wdd.js.org/posts/old-blog/ih9pz2/><span class=title>« Prev Page</span><br><span>自动IP拦截工具fail2ban使用教程</span></a>
<a class=next href=https://wdd.js.org/posts/old-blog/ysx4gz/><span class=title>Next Page »</span><br><span>老年生活</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://wdd.js.org>洞香春</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>