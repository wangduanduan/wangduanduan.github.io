<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>自动IP拦截工具fail2ban使用教程 | 洞香春</title><meta name=keywords content><meta name=description content="简介 如果你的主机在公网上有端口暴露出去，那么总会有一些不怀好意的家伙，会尝试通过各种方式攻击你的机器。常见的服务例如ssh, nginx都会有类似的威胁。
手工将某个ip加入黑名单，这种操作太麻烦，而且效率低。而fail2ban就是一种自动化的解决方案。
fail2ban工作原理 fail2ban的工作原理是监控某个日志文件，然后根据某些关键词，提取出攻击方的IP地址，然后将其加入到黑名单。
fail2ban安装 yum install fail2ban -y # 如果找不到fail2ban包，就执行下面的命令 yum install epel-release # 安装fail2ban 完成后 systemctl enable fail2ban # 设置fail2ban开机启动 systemctl start fail2ban # 启动fail2ban systemctl status fail2ban # 查看fail2ban的运行状态 用fail2ban保护ssh fail2ban的配置文件位于/etc/fail2ban目录下。
在该目录下建立一个文件 jail.local, 内容如下
bantime 持续禁止多久 maxretry 最大多少次尝试 banaction 拦截后的操作 findtime 查找时间 看下下面的操作的意思是：监控sshd服务的最近10分钟的日志，如果某个ip在10分钟之内，有2次登录失败，就把这个ip加入黑名单, 24小时之后，这个ip才会被从黑名单中移除。
[DEFAULT] bantime = 24h banaction = iptables-multiport maxretry = 2 findtime = 10m [sshd] enabled = true 然后重启fail2ban, systemctl restart fail2ban fail2ban提供管理工具fail2ban-client"><meta name=author content="王端端"><link rel=canonical href=https://wdd.js.org/posts/old-blog/ih9pz2/><meta name=google-site-verification content="G-SGW660ZWKM"><link crossorigin=anonymous href=/assets/css/stylesheet.min.ceab085cbbf58c0ec96f6d415d51b3b44e204edfd71a45b4fa2d4aac13f119d0.css integrity="sha256-zqsIXLv1jA7Jb21BXVGztE4gTt/XGkW0+i1KrBPxGdA=" rel="preload stylesheet" as=style><link crossorigin=anonymous herf=/font-awesome/css/font-awesome.min.css rel=stylesheet type=text/css><link rel=preload href=/cowboy.ico as=image><script defer crossorigin=anonymous src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://wdd.js.org/cowboy.ico><link rel=icon type=image/png sizes=16x16 href=https://wdd.js.org/cowboy.ico><link rel=icon type=image/png sizes=32x32 href=https://wdd.js.org/cowboy.ico><link rel=apple-touch-icon href=https://wdd.js.org/cowboy.ico><link rel=mask-icon href=https://wdd.js.org/cowboy.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.107.0"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-SGW660ZWKM"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-SGW660ZWKM",{anonymize_ip:!1})}</script><meta property="og:title" content="自动IP拦截工具fail2ban使用教程"><meta property="og:description" content="简介 如果你的主机在公网上有端口暴露出去，那么总会有一些不怀好意的家伙，会尝试通过各种方式攻击你的机器。常见的服务例如ssh, nginx都会有类似的威胁。
手工将某个ip加入黑名单，这种操作太麻烦，而且效率低。而fail2ban就是一种自动化的解决方案。
fail2ban工作原理 fail2ban的工作原理是监控某个日志文件，然后根据某些关键词，提取出攻击方的IP地址，然后将其加入到黑名单。
fail2ban安装 yum install fail2ban -y # 如果找不到fail2ban包，就执行下面的命令 yum install epel-release # 安装fail2ban 完成后 systemctl enable fail2ban # 设置fail2ban开机启动 systemctl start fail2ban # 启动fail2ban systemctl status fail2ban # 查看fail2ban的运行状态 用fail2ban保护ssh fail2ban的配置文件位于/etc/fail2ban目录下。
在该目录下建立一个文件 jail.local, 内容如下
bantime 持续禁止多久 maxretry 最大多少次尝试 banaction 拦截后的操作 findtime 查找时间 看下下面的操作的意思是：监控sshd服务的最近10分钟的日志，如果某个ip在10分钟之内，有2次登录失败，就把这个ip加入黑名单, 24小时之后，这个ip才会被从黑名单中移除。
[DEFAULT] bantime = 24h banaction = iptables-multiport maxretry = 2 findtime = 10m [sshd] enabled = true 然后重启fail2ban, systemctl restart fail2ban fail2ban提供管理工具fail2ban-client"><meta property="og:type" content="article"><meta property="og:url" content="https://wdd.js.org/posts/old-blog/ih9pz2/"><meta property="og:image" content="https://wdd.js.org/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-04-28T08:48:11+08:00"><meta property="article:modified_time" content="2020-04-28T08:48:11+08:00"><meta property="og:site_name" content="洞香春"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://wdd.js.org/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="自动IP拦截工具fail2ban使用教程"><meta name=twitter:description content="简介 如果你的主机在公网上有端口暴露出去，那么总会有一些不怀好意的家伙，会尝试通过各种方式攻击你的机器。常见的服务例如ssh, nginx都会有类似的威胁。
手工将某个ip加入黑名单，这种操作太麻烦，而且效率低。而fail2ban就是一种自动化的解决方案。
fail2ban工作原理 fail2ban的工作原理是监控某个日志文件，然后根据某些关键词，提取出攻击方的IP地址，然后将其加入到黑名单。
fail2ban安装 yum install fail2ban -y # 如果找不到fail2ban包，就执行下面的命令 yum install epel-release # 安装fail2ban 完成后 systemctl enable fail2ban # 设置fail2ban开机启动 systemctl start fail2ban # 启动fail2ban systemctl status fail2ban # 查看fail2ban的运行状态 用fail2ban保护ssh fail2ban的配置文件位于/etc/fail2ban目录下。
在该目录下建立一个文件 jail.local, 内容如下
bantime 持续禁止多久 maxretry 最大多少次尝试 banaction 拦截后的操作 findtime 查找时间 看下下面的操作的意思是：监控sshd服务的最近10分钟的日志，如果某个ip在10分钟之内，有2次登录失败，就把这个ip加入黑名单, 24小时之后，这个ip才会被从黑名单中移除。
[DEFAULT] bantime = 24h banaction = iptables-multiport maxretry = 2 findtime = 10m [sshd] enabled = true 然后重启fail2ban, systemctl restart fail2ban fail2ban提供管理工具fail2ban-client"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://wdd.js.org/posts/"},{"@type":"ListItem","position":3,"name":"自动IP拦截工具fail2ban使用教程","item":"https://wdd.js.org/posts/old-blog/ih9pz2/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"自动IP拦截工具fail2ban使用教程","name":"自动IP拦截工具fail2ban使用教程","description":"简介 如果你的主机在公网上有端口暴露出去，那么总会有一些不怀好意的家伙，会尝试通过各种方式攻击你的机器。常见的服务例如ssh, nginx都会有类似的威胁。\n手工将某个ip加入黑名单，这种操作太麻烦，而且效率低。而fail2ban就是一种自动化的解决方案。\nfail2ban工作原理 fail2ban的工作原理是监控某个日志文件，然后根据某些关键词，提取出攻击方的IP地址，然后将其加入到黑名单。\nfail2ban安装 yum install fail2ban -y # 如果找不到fail2ban包，就执行下面的命令 yum install epel-release # 安装fail2ban 完成后 systemctl enable fail2ban # 设置fail2ban开机启动 systemctl start fail2ban # 启动fail2ban systemctl status fail2ban # 查看fail2ban的运行状态 用fail2ban保护ssh fail2ban的配置文件位于/etc/fail2ban目录下。\n在该目录下建立一个文件 jail.local, 内容如下\nbantime 持续禁止多久 maxretry 最大多少次尝试 banaction 拦截后的操作 findtime 查找时间 看下下面的操作的意思是：监控sshd服务的最近10分钟的日志，如果某个ip在10分钟之内，有2次登录失败，就把这个ip加入黑名单, 24小时之后，这个ip才会被从黑名单中移除。\n[DEFAULT] bantime = 24h banaction = iptables-multiport maxretry = 2 findtime = 10m [sshd] enabled = true 然后重启fail2ban, systemctl restart fail2ban fail2ban提供管理工具fail2ban-client","keywords":[],"articleBody":"简介 如果你的主机在公网上有端口暴露出去，那么总会有一些不怀好意的家伙，会尝试通过各种方式攻击你的机器。常见的服务例如ssh, nginx都会有类似的威胁。\n手工将某个ip加入黑名单，这种操作太麻烦，而且效率低。而fail2ban就是一种自动化的解决方案。\nfail2ban工作原理 fail2ban的工作原理是监控某个日志文件，然后根据某些关键词，提取出攻击方的IP地址，然后将其加入到黑名单。\nfail2ban安装 yum install fail2ban -y # 如果找不到fail2ban包，就执行下面的命令 yum install epel-release # 安装fail2ban 完成后 systemctl enable fail2ban # 设置fail2ban开机启动 systemctl start fail2ban # 启动fail2ban systemctl status fail2ban # 查看fail2ban的运行状态 用fail2ban保护ssh fail2ban的配置文件位于/etc/fail2ban目录下。\n在该目录下建立一个文件 jail.local, 内容如下\nbantime 持续禁止多久 maxretry 最大多少次尝试 banaction 拦截后的操作 findtime 查找时间 看下下面的操作的意思是：监控sshd服务的最近10分钟的日志，如果某个ip在10分钟之内，有2次登录失败，就把这个ip加入黑名单, 24小时之后，这个ip才会被从黑名单中移除。\n[DEFAULT] bantime = 24h banaction = iptables-multiport maxretry = 2 findtime = 10m [sshd] enabled = true 然后重启fail2ban, systemctl restart fail2ban fail2ban提供管理工具fail2ban-client\n**fail2ban-client status **显示fail2ban的状态 **fail2ban-client status sshd **显示某个监狱的配置。从下文的输出来看可以看出来fail2ban已经拦截了一些IP地址了 \u003e fail2ban-client status Status |- Number of jail:\t1 `- Jail list:\tsshd \u003e fail2ban-client status sshd Status for the jail: sshd |- Filter | |- Currently failed:\t2 | |- Total failed:\t23289 | `- Journal matches:\t_SYSTEMD_UNIT=sshd.service + _COMM=sshd `- Actions |- Currently banned:\t9 |- Total banned:\t1270 `- Banned IP list:\t93.174.93.10 165.22.238.92 23.231.25.234 134.255.219.207 77.202.192.113 120.224.47.86 144.91.70.139 90.3.194.84 217.182.89.87 fail2ban保护sshd的原理 fail2ban的配置文件目录下有个filter.d目录，该目录下有个sshd.conf的文件，这个文件就是对于sshd日志的过滤规则，里面有些正常时用来提取出恶意家伙的IP地址。\n配置配置文件很长，我们只看其中一段， 其中**\u003c****HOST\u003e**是个非常重要的关键词，是用来提取出远程的IP地址的。\ncmnfailre = ^[aA]uthentication (?:failure|error|failed) for .* from ( via \\S+)?%(__suff)s$ ^User not known to the underlying authentication module for .* from %(__suff)s$ ^Failed publickey for invalid user (?P\\S+)|(?:(?! from ).)*? from %(__on_port_opt)s(?: ssh\\d*)?(?(cond_us 实战：如何自定义一个过滤规则 我的nginx服务器，几乎每隔2-3秒就会收到下面的一个请求。\n下面我就写个过滤规则，将类似请求的IP加入黑名单。\n165.22.225.238 - - [28/Apr/2020:08:19:38 +0800] \"POST /ws/v1/cluster/apps/new-application HTTP/1.1\" 502 11 \"-\" \"python-requests/2.6.0 CPython/2.7.5 Linux/3.10.0-957.27.2.el7.x86_64\" \"-\" 165.22.225.238 - - [28/Apr/2020:08:22:48 +0800] \"POST /ws/v1/cluster/apps/new-application HTTP/1.1\" 502 11 \"-\" \"python-requests/2.6.0 CPython/2.7.5 Linux/3.10.0-957.27.2.el7.x86_64\" \"-\" 165.22.225.238 - - [28/Apr/2020:08:24:08 +0800] \"POST /ws/v1/cluster/apps/new-application HTTP/1.1\" 502 11 \"-\" \"python-requests/2.6.0 CPython/2.7.5 Linux/3.10.0-957.27.2.el7.x86_64\" \"-\" 165.22.225.238 - - [28/Apr/2020:08:25:45 +0800] \"POST /ws/v1/cluster/apps/new-application HTTP/1.1\" 502 11 \"-\" \"python-requests/2.6.0 CPython/2.7.5 Linux/3.10.0-957.27.2.el7.x86_64\" \"-\" 165.22.225.238 - - [28/Apr/2020:08:28:01 +0800] \"POST /ws/v1/cluster/apps/new-application HTTP/1.1\" 502 11 \"-\" \"python-requests/2.6.0 CPython/2.7.5 Linux/3.10.0-957.27.2.el7.x86_64\" \"-\" step1: 分析日志规则 165.22.225.238 - - [28/Apr/2020:08:19:38 +0800] \"POST /ws/v1/cluster/apps/new-application HTTP/1.1\" 502 11 \"-\" \"python-requests/2.6.0 CPython/2.7.5 Linux/3.10.0-957.27.2.el7.x86_64\" \"-\" HOST - - .*\" 502 .* step2: 写规则文件 在filter.d目录下新建文件 banit.conf\n[INCLUDES] [Definition] failregex = - - .*\" 502 .* ignoreregex = step3: 修改jail.local [DEFAULT] bantime = 24h banaction = iptables-multiport maxretry = 2 findtime = 10m [sshd] enabled = true [banit] enabled = true action = iptables-allports[name=banit, protocol=all] logpath = /var/log/nginx/access.log step4: 重启fail2ban fail2ban-client restart**\nstep5: 查看效果 可以看出banit的这个监狱，已经加入了一个165.22.225.238这个ip，这个流氓不会在骚扰我们的主机了。\n\u003e fail2ban fail2ban-client status banit Status for the jail: banit |- Filter | |- Currently failed:\t1 | |- Total failed:\t5 | `- File list:\t/var/log/nginx/access.log `- Actions |- Currently banned:\t1 |- Total banned:\t1 `- Banned IP list:\t165.22.225.238 **\nfail2ban-client 常用操作 重启: **fail2ban systemctl restart fail2ban ** 查看fail2ban opensips运行状态: **fail2ban-client status opensips ** 黑名单操作 (注意，黑名单测试时，不要把自己的IP加到黑名单里做测试，否则就连不上机器了) IP加入黑名单：**fail2ban-client set opensips banip 192.168.1.8 ** IP解锁：fail2ban-client set opensips unbanip 192.168.1.8 白名单操作 IP加入白名单：fail2ban-client set opensips addignoreip 192.168.1.8 IP从白名单中移除：fail2ban-client set opensips delignoreip 192.168.1.8 在所有监狱中加入IP白名单：fail2ban-clien unban 192.168.1.8 fail2ban的拦截是基于jail, 如果一个ip在某个jail中，但是不在其他jail中，那么这个ip也是无法访问主机。如果想在所有jail中加入一个白名单，需要fail2ban-client unban ip。\n**\nfail2ban-client帮助文档 Usage: fail2ban-client [OPTIONS] Fail2Ban v0.10.5 reads log file that contains password failure report and bans the corresponding IP addresses using firewall rules. Options: -c configuration directory -s socket path -p pidfile path --loglevel logging level --logtarget logging target, use file-name or stdout, stderr, syslog or sysout. --syslogsocket auto| -d dump configuration. For debugging --dp, --dump-pretty dump the configuration using more human readable representation -t, --test test configuration (can be also specified with start parameters) -i interactive mode -v increase verbosity -q decrease verbosity -x force execution of the server (remove socket file) -b start server in background (default) -f start server in foreground --async start server in async mode (for internal usage only, don't read configuration) --timeout timeout to wait for the server (for internal usage only, don't read configuration) --str2sec convert time abbreviation format to seconds -h, --help display this help message -V, --version print the version (-V returns machine-readable short format) Command: BASIC start starts the server and the jails restart restarts the server restart [--unban] [--if-exists] restarts the jail (alias for 'reload --restart ... ') reload [--restart] [--unban] [--all] reloads the configuration without restarting of the server, the option '--restart' activates completely restarting of affected jails, thereby can unban IP addresses (if option '--unban' specified) reload [--restart] [--unban] [--if-exists] reloads the jail , or restarts it (if option '--restart' specified) stop stops all jails and terminate the server unban --all unbans all IP addresses (in all jails and database) unban ... unbans (in all jails and database) status gets the current status of the server ping tests if the server is alive echo for internal usage, returns back and outputs a given string help return this output version return the server version LOGGING set loglevel sets logging level to . Levels: CRITICAL, ERROR, WARNING, NOTICE, INFO, DEBUG, TRACEDEBUG, HEAVYDEBUG or corresponding numeric value (50-5) get loglevel gets the logging level set logtarget sets logging target to . Can be STDOUT, STDERR, SYSLOG or a file get logtarget gets logging target set syslogsocket auto| sets the syslog socket path to auto or . Only used if logtarget is SYSLOG get syslogsocket gets syslog socket path flushlogs flushes the logtarget if a file and reopens it. For log rotation. DATABASE set dbfile set the location of fail2ban persistent datastore. Set to \"None\" to disable get dbfile get the location of fail2ban persistent datastore set dbmaxmatches sets the max number of matches stored in database per ticket get dbmaxmatches gets the max number of matches stored in database per ticket set dbpurgeage sets the max age in that history of bans will be kept get dbpurgeage gets the max age in seconds that history of bans will be kept JAIL CONTROL add creates using start starts the jail stop stops the jail . The jail is removed status [FLAVOR] gets the current status of , with optional flavor or extended info JAIL CONFIGURATION set idle on|off sets the idle state of set ignoreself true|false allows the ignoring of own IP addresses set addignoreip adds to the ignore list of set delignoreip removes from the ignore list of set ignorecommand sets ignorecommand of set ignorecache sets ignorecache of set addlogpath ['tail'] adds to the monitoring list of , optionally starting at the 'tail' of the file (default 'head'). set dellogpath removes from the monitoring list of set logencoding sets the of the log files for set addjournalmatch adds to the journal filter of set deljournalmatch removes from the journal filter of set addfailregex adds the regular expression which must match failures for set delfailregex removes the regular expression at for failregex set addignoreregex adds the regular expression which should match pattern to exclude for set delignoreregex removes the regular expression at for ignoreregex set findtime sets the number of seconds for which the filter will look back for set bantime sets the number of seconds a host will be banned for set datepattern sets the used to match date/times for set usedns sets the usedns mode for set attempt [ ... ] manually notify about failure set banip ... manually Ban for set unbanip [--report-absent] ... manually Unban in set maxretry sets the number of failures before banning the host for set maxmatches sets the max number of matches stored in memory per ticket in set maxlines sets the number of to buffer for regex search for set addaction [ ] adds a new action named for . Optionally for a Python based action, a and can be specified, else will be a Command Action set delaction removes the action from COMMAND ACTION CONFIGURATION set action actionstart sets the start command of the action for set action actionstop sets the stop command of the action for set action actioncheck sets the check command of the action for set action actionban sets the ban command of the action for set action actionunban sets the unban command of the action for set action timeout sets as the command timeout in seconds for the action for GENERAL ACTION CONFIGURATION set action sets the of for the action for set action [ ] calls the with for the action for JAIL INFORMATION get logpath gets the list of the monitored files for get logencoding gets the encoding of the log files for get journalmatch gets the journal filter match for get ignoreself gets the current value of the ignoring the own IP addresses get ignoreip gets the list of ignored IP addresses for get ignorecommand gets ignorecommand of get failregex gets the list of regular expressions which matches the failures for get ignoreregex gets the list of regular expressions which matches patterns to ignore for get findtime gets the time for which the filter will look back for failures for get bantime gets the time a host is banned for get datepattern gets the patern used to match date/times for get usedns gets the usedns setting for get maxretry gets the number of failures allowed for get maxmatches gets the max number of matches stored in memory per ticket in get maxlines gets the number of lines to buffer for get actions gets a list of actions for COMMAND ACTION INFORMATION get action actionstart gets the start command for the action for get action actionstop gets the stop command for the action for get action actioncheck gets the check command for the action for get action actionban gets the ban command for the action for get action actionunban gets the unban command for the action for get action timeout gets the command timeout in seconds for the action for GENERAL ACTION INFORMATION get actionproperties gets a list of properties for the action for get actionmethods gets a list of methods for the action for get action gets the value of for the action for Report bugs to https://github.com/fail2ban/fail2ban/issues Report bugs to https://github.com/fail2ban/fail2ban/issues\n","wordCount":"1804","inLanguage":"en","datePublished":"2020-04-28T08:48:11+08:00","dateModified":"2020-04-28T08:48:11+08:00","author":{"@type":"Person","name":"王端端"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://wdd.js.org/posts/old-blog/ih9pz2/"},"publisher":{"@type":"Organization","name":"洞香春","logo":{"@type":"ImageObject","url":"https://wdd.js.org/cowboy.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://wdd.js.org accesskey=h title="洞香春 (Alt + H)"><img src=/cowboy.ico alt=logo aria-label=logo height=35>洞香春</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://wdd.js.org/freeswitch/ title=FreeSWITCH><span>FreeSWITCH</span></a></li><li><a href=https://wdd.js.org/fe/ title=Frontend><span>Frontend</span></a></li><li><a href=https://wdd.js.org/golang/ title=Golang><span>Golang</span></a></li><li><a href=https://wdd.js.org/container/ title=k8s/docker><span>k8s/docker</span></a></li><li><a href=https://wdd.js.org/network/ title=Network><span>Network</span></a></li><li><a href=https://wdd.js.org/opensips/ title=OpenSIPS><span>OpenSIPS</span></a></li><li><a href=https://wdd.js.org/shell/ title=Shell><span>Shell</span></a></li><li><a href=https://wdd.js.org/vim/ title=VIM><span>VIM</span></a></li><li><a href=https://wdd.js.org/categories/ title=分类><span>分类</span></a></li><li><a href=https://wdd.js.org/search/ title=搜索><span>搜索</span></a></li><li><a href=https://wdd.js.org/tags/ title=标签><span>标签</span></a></li><li><a href=https://wdd.js.org/archives/ title=归档><span>归档</span></a></li><li><a href=https://wdd.js.org/about/ title=我><span>我</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://wdd.js.org>Home</a>&nbsp;»&nbsp;<a href=https://wdd.js.org/posts/>Posts</a></div><h1 class=post-title>自动IP拦截工具fail2ban使用教程</h1><div class=post-meta><span title='2020-04-28 08:48:11 +0800 CST'>2020-04-28 08:48:11</span>&nbsp;·&nbsp;9 min&nbsp;·&nbsp;王端端&nbsp;&nbsp;| 本文总阅读量<span id=busuanzi_value_page_pv></span>次</div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e7%ae%80%e4%bb%8b aria-label=简介>简介</a></li><li><a href=#fail2ban%e5%b7%a5%e4%bd%9c%e5%8e%9f%e7%90%86 aria-label=fail2ban工作原理>fail2ban工作原理</a></li><li><a href=#fail2ban%e5%ae%89%e8%a3%85 aria-label=fail2ban安装>fail2ban安装</a></li><li><a href=#%e7%94%a8fail2ban%e4%bf%9d%e6%8a%a4ssh aria-label=用fail2ban保护ssh>用fail2ban保护ssh</a></li><li><a href=#fail2ban%e4%bf%9d%e6%8a%a4sshd%e7%9a%84%e5%8e%9f%e7%90%86 aria-label=fail2ban保护sshd的原理>fail2ban保护sshd的原理</a></li><li><a href=#%e5%ae%9e%e6%88%98%e5%a6%82%e4%bd%95%e8%87%aa%e5%ae%9a%e4%b9%89%e4%b8%80%e4%b8%aa%e8%bf%87%e6%bb%a4%e8%a7%84%e5%88%99 aria-label=实战：如何自定义一个过滤规则>实战：如何自定义一个过滤规则</a><ul><li><a href=#step1-%e5%88%86%e6%9e%90%e6%97%a5%e5%bf%97%e8%a7%84%e5%88%99 aria-label="step1: 分析日志规则">step1: 分析日志规则</a></li><li><a href=#step2-%e5%86%99%e8%a7%84%e5%88%99%e6%96%87%e4%bb%b6 aria-label="step2: 写规则文件">step2: 写规则文件</a></li><li><a href=#step3-%e4%bf%ae%e6%94%b9jaillocal aria-label="step3: 修改jail.local">step3: 修改jail.local</a></li><li><a href=#step4-%e9%87%8d%e5%90%affail2ban aria-label="step4: 重启fail2ban">step4: 重启fail2ban</a></li><li><a href=#step5-%e6%9f%a5%e7%9c%8b%e6%95%88%e6%9e%9c aria-label="step5: 查看效果">step5: 查看效果</a></li></ul></li><li><a href=#fail2ban-client-%e5%b8%b8%e7%94%a8%e6%93%8d%e4%bd%9c aria-label="fail2ban-client 常用操作">fail2ban-client 常用操作</a></li><li><a href=#fail2ban-client%e5%b8%ae%e5%8a%a9%e6%96%87%e6%a1%a3 aria-label=fail2ban-client帮助文档>fail2ban-client帮助文档</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h1 id=简介>简介<a hidden class=anchor aria-hidden=true href=#简介>#</a></h1><p>如果你的主机在公网上有端口暴露出去，那么总会有一些不怀好意的家伙，会尝试通过各种方式攻击你的机器。常见的服务例如ssh, nginx都会有类似的威胁。</p><p>手工将某个ip加入黑名单，这种操作太麻烦，而且效率低。而fail2ban就是一种自动化的解决方案。</p><h1 id=fail2ban工作原理>fail2ban工作原理<a hidden class=anchor aria-hidden=true href=#fail2ban工作原理>#</a></h1><p>fail2ban的工作原理是监控某个日志文件，然后根据某些关键词，提取出攻击方的IP地址，然后将其加入到黑名单。</p><h1 id=fail2ban安装>fail2ban安装<a hidden class=anchor aria-hidden=true href=#fail2ban安装>#</a></h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>yum</span> <span style=color:#a6e22e>install</span> <span style=color:#a6e22e>fail2ban</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>y</span> 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#a6e22e>如果找不到fail2ban包</span><span style=color:#960050;background-color:#1e0010>，</span><span style=color:#a6e22e>就执行下面的命令</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>yum</span> <span style=color:#a6e22e>install</span> <span style=color:#a6e22e>epel</span><span style=color:#f92672>-</span><span style=color:#a6e22e>release</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#a6e22e>安装fail2ban</span> <span style=color:#a6e22e>完成后</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>systemctl</span> <span style=color:#a6e22e>enable</span> <span style=color:#a6e22e>fail2ban</span> <span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#a6e22e>设置fail2ban开机启动</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>systemctl</span> <span style=color:#a6e22e>start</span> <span style=color:#a6e22e>fail2ban</span> <span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#a6e22e>启动fail2ban</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>systemctl</span> <span style=color:#a6e22e>status</span> <span style=color:#a6e22e>fail2ban</span> <span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#a6e22e>查看fail2ban的运行状态</span>
</span></span></code></pre></div><h1 id=用fail2ban保护ssh>用fail2ban保护ssh<a hidden class=anchor aria-hidden=true href=#用fail2ban保护ssh>#</a></h1><p>fail2ban的配置文件位于/etc/fail2ban目录下。</p><p>在该目录下建立一个文件 jail.local, 内容如下</p><ul><li>bantime 持续禁止多久</li><li>maxretry 最大多少次尝试</li><li>banaction 拦截后的操作</li><li>findtime 查找时间</li></ul><p>看下下面的操作的意思是：监控sshd服务的最近10分钟的日志，如果某个ip在10分钟之内，有2次登录失败，就把这个ip加入黑名单, 24小时之后，这个ip才会被从黑名单中移除。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>[<span style=color:#a6e22e>DEFAULT</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>bantime</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>24</span><span style=color:#a6e22e>h</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>banaction</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>iptables</span><span style=color:#f92672>-</span><span style=color:#a6e22e>multiport</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>maxretry</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>findtime</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span><span style=color:#a6e22e>m</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[<span style=color:#a6e22e>sshd</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>enabled</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>
</span></span></code></pre></div><p>然后重启fail2ban, <code>systemctl restart fail2ban</code> </p><p>fail2ban提供管理工具fail2ban-client</p><ul><li>**fail2ban-client status **显示fail2ban的状态</li><li>**fail2ban-client status sshd **显示某个监狱的配置。从下文的输出来看可以看出来fail2ban已经拦截了一些IP地址了</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>&gt; fail2ban-client status
</span></span><span style=display:flex><span>Status
</span></span><span style=display:flex><span>|- Number of jail:	<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>`</span>- Jail list:	sshd
</span></span><span style=display:flex><span>&gt; fail2ban-client status sshd
</span></span><span style=display:flex><span>Status <span style=color:#66d9ef>for</span> the jail: sshd
</span></span><span style=display:flex><span>|- Filter
</span></span><span style=display:flex><span>|  |- Currently failed:	<span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>|  |- Total failed:	<span style=color:#ae81ff>23289</span>
</span></span><span style=display:flex><span>|  <span style=color:#e6db74>`</span>- Journal matches:	_SYSTEMD_UNIT<span style=color:#f92672>=</span>sshd.service + _COMM<span style=color:#f92672>=</span>sshd
</span></span><span style=display:flex><span><span style=color:#e6db74>`</span>- Actions
</span></span><span style=display:flex><span>   |- Currently banned:	<span style=color:#ae81ff>9</span>
</span></span><span style=display:flex><span>   |- Total banned:	<span style=color:#ae81ff>1270</span>
</span></span><span style=display:flex><span>   <span style=color:#e6db74>`</span>- Banned IP list:	93.174.93.10 165.22.238.92 23.231.25.234 134.255.219.207 77.202.192.113 120.224.47.86 144.91.70.139 90.3.194.84 217.182.89.87
</span></span></code></pre></div><h1 id=fail2ban保护sshd的原理>fail2ban保护sshd的原理<a hidden class=anchor aria-hidden=true href=#fail2ban保护sshd的原理>#</a></h1><p>fail2ban的配置文件目录下有个filter.d目录，该目录下有个sshd.conf的文件，这个文件就是对于sshd日志的过滤规则，里面有些正常时用来提取出恶意家伙的IP地址。</p><p>配置配置文件很长，我们只看其中一段， 其中**&lt;****HOST>**是个非常重要的关键词，是用来提取出远程的IP地址的。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cmnfailre <span style=color:#f92672>=</span> ^<span style=color:#f92672>[</span>aA<span style=color:#f92672>]</span>uthentication <span style=color:#f92672>(</span>?:failure|error|failed<span style=color:#f92672>)</span> <span style=color:#66d9ef>for</span> &lt;F-USER&gt;.*&lt;/F-USER&gt; from &lt;HOST&gt;<span style=color:#f92672>(</span> via <span style=color:#ae81ff>\S</span>+<span style=color:#f92672>)</span>?%<span style=color:#f92672>(</span>__suff<span style=color:#f92672>)</span>s$
</span></span><span style=display:flex><span>            ^User not known to the underlying authentication module <span style=color:#66d9ef>for</span> &lt;F-USER&gt;.*&lt;/F-USER&gt; from &lt;HOST&gt;%<span style=color:#f92672>(</span>__suff<span style=color:#f92672>)</span>s$
</span></span><span style=display:flex><span>            ^Failed publickey <span style=color:#66d9ef>for</span> invalid user &lt;F-USER&gt;<span style=color:#f92672>(</span>?P&lt;cond_user&gt;<span style=color:#ae81ff>\S</span>+<span style=color:#f92672>)</span>|<span style=color:#f92672>(</span>?:<span style=color:#f92672>(</span>?! from <span style=color:#f92672>)</span>.<span style=color:#f92672>)</span>*?&lt;/F-USER&gt; from &lt;HOST&gt;%<span style=color:#f92672>(</span>__on_port_opt<span style=color:#f92672>)</span>s<span style=color:#f92672>(</span>?: ssh<span style=color:#ae81ff>\d</span>*<span style=color:#f92672>)</span>?<span style=color:#f92672>(</span>?<span style=color:#f92672>(</span>cond_us
</span></span></code></pre></div><h1 id=实战如何自定义一个过滤规则>实战：如何自定义一个过滤规则<a hidden class=anchor aria-hidden=true href=#实战如何自定义一个过滤规则>#</a></h1><p>我的nginx服务器，几乎每隔2-3秒就会收到下面的一个请求。</p><p>下面我就写个过滤规则，将类似请求的IP加入黑名单。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>165.22.225.238 - - <span style=color:#f92672>[</span>28/Apr/2020:08:19:38 +0800<span style=color:#f92672>]</span> <span style=color:#e6db74>&#34;POST /ws/v1/cluster/apps/new-application HTTP/1.1&#34;</span> <span style=color:#ae81ff>502</span> <span style=color:#ae81ff>11</span> <span style=color:#e6db74>&#34;-&#34;</span> <span style=color:#e6db74>&#34;python-requests/2.6.0 CPython/2.7.5 Linux/3.10.0-957.27.2.el7.x86_64&#34;</span> <span style=color:#e6db74>&#34;-&#34;</span>
</span></span><span style=display:flex><span>165.22.225.238 - - <span style=color:#f92672>[</span>28/Apr/2020:08:22:48 +0800<span style=color:#f92672>]</span> <span style=color:#e6db74>&#34;POST /ws/v1/cluster/apps/new-application HTTP/1.1&#34;</span> <span style=color:#ae81ff>502</span> <span style=color:#ae81ff>11</span> <span style=color:#e6db74>&#34;-&#34;</span> <span style=color:#e6db74>&#34;python-requests/2.6.0 CPython/2.7.5 Linux/3.10.0-957.27.2.el7.x86_64&#34;</span> <span style=color:#e6db74>&#34;-&#34;</span>
</span></span><span style=display:flex><span>165.22.225.238 - - <span style=color:#f92672>[</span>28/Apr/2020:08:24:08 +0800<span style=color:#f92672>]</span> <span style=color:#e6db74>&#34;POST /ws/v1/cluster/apps/new-application HTTP/1.1&#34;</span> <span style=color:#ae81ff>502</span> <span style=color:#ae81ff>11</span> <span style=color:#e6db74>&#34;-&#34;</span> <span style=color:#e6db74>&#34;python-requests/2.6.0 CPython/2.7.5 Linux/3.10.0-957.27.2.el7.x86_64&#34;</span> <span style=color:#e6db74>&#34;-&#34;</span>
</span></span><span style=display:flex><span>165.22.225.238 - - <span style=color:#f92672>[</span>28/Apr/2020:08:25:45 +0800<span style=color:#f92672>]</span> <span style=color:#e6db74>&#34;POST /ws/v1/cluster/apps/new-application HTTP/1.1&#34;</span> <span style=color:#ae81ff>502</span> <span style=color:#ae81ff>11</span> <span style=color:#e6db74>&#34;-&#34;</span> <span style=color:#e6db74>&#34;python-requests/2.6.0 CPython/2.7.5 Linux/3.10.0-957.27.2.el7.x86_64&#34;</span> <span style=color:#e6db74>&#34;-&#34;</span>
</span></span><span style=display:flex><span>165.22.225.238 - - <span style=color:#f92672>[</span>28/Apr/2020:08:28:01 +0800<span style=color:#f92672>]</span> <span style=color:#e6db74>&#34;POST /ws/v1/cluster/apps/new-application HTTP/1.1&#34;</span> <span style=color:#ae81ff>502</span> <span style=color:#ae81ff>11</span> <span style=color:#e6db74>&#34;-&#34;</span> <span style=color:#e6db74>&#34;python-requests/2.6.0 CPython/2.7.5 Linux/3.10.0-957.27.2.el7.x86_64&#34;</span> <span style=color:#e6db74>&#34;-&#34;</span>
</span></span></code></pre></div><h2 id=step1-分析日志规则>step1: 分析日志规则<a hidden class=anchor aria-hidden=true href=#step1-分析日志规则>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>165.22.225.238 - - <span style=color:#f92672>[</span>28/Apr/2020:08:19:38 +0800<span style=color:#f92672>]</span> <span style=color:#e6db74>&#34;POST /ws/v1/cluster/apps/new-application HTTP/1.1&#34;</span> <span style=color:#ae81ff>502</span> <span style=color:#ae81ff>11</span> <span style=color:#e6db74>&#34;-&#34;</span> <span style=color:#e6db74>&#34;python-requests/2.6.0 CPython/2.7.5 Linux/3.10.0-957.27.2.el7.x86_64&#34;</span> <span style=color:#e6db74>&#34;-&#34;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>HOST - - .*<span style=color:#e6db74>&#34; 502 .*
</span></span></span></code></pre></div><h2 id=step2-写规则文件>step2: 写规则文件<a hidden class=anchor aria-hidden=true href=#step2-写规则文件>#</a></h2><p>在filter.d目录下新建文件 banit.conf</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>INCLUDES<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Definition<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>failregex <span style=color:#f92672>=</span> &lt;HOST&gt; - - .*<span style=color:#e6db74>&#34; 502 .*
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ignoreregex =
</span></span></span></code></pre></div><h2 id=step3-修改jaillocal>step3: 修改jail.local<a hidden class=anchor aria-hidden=true href=#step3-修改jaillocal>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>DEFAULT<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>bantime <span style=color:#f92672>=</span> 24h
</span></span><span style=display:flex><span>banaction <span style=color:#f92672>=</span> iptables-multiport
</span></span><span style=display:flex><span>maxretry <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>findtime <span style=color:#f92672>=</span> 10m
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>sshd<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>enabled <span style=color:#f92672>=</span> true
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>banit<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>enabled <span style=color:#f92672>=</span> true
</span></span><span style=display:flex><span>action   <span style=color:#f92672>=</span> iptables-allports<span style=color:#f92672>[</span>name<span style=color:#f92672>=</span>banit, protocol<span style=color:#f92672>=</span>all<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>logpath <span style=color:#f92672>=</span> /var/log/nginx/access.log
</span></span></code></pre></div><h2 id=step4-重启fail2ban>step4: 重启fail2ban<a hidden class=anchor aria-hidden=true href=#step4-重启fail2ban>#</a></h2><p><strong>fail2ban-client restart</strong>**</p><h2 id=step5-查看效果>step5: 查看效果<a hidden class=anchor aria-hidden=true href=#step5-查看效果>#</a></h2><p>可以看出banit的这个监狱，已经加入了一个<strong>165.22.225.238</strong>这个ip，这个流氓不会在骚扰我们的主机了。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>&gt; fail2ban fail2ban-client status banit
</span></span><span style=display:flex><span>Status <span style=color:#66d9ef>for</span> the jail: banit
</span></span><span style=display:flex><span>|- Filter
</span></span><span style=display:flex><span>|  |- Currently failed:	<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>|  |- Total failed:	<span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>|  <span style=color:#e6db74>`</span>- File list:	/var/log/nginx/access.log
</span></span><span style=display:flex><span><span style=color:#e6db74>`</span>- Actions
</span></span><span style=display:flex><span>   |- Currently banned:	<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>   |- Total banned:	<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>   <span style=color:#e6db74>`</span>- Banned IP list:	165.22.225.238
</span></span></code></pre></div><p>**</p><h1 id=fail2ban-client-常用操作>fail2ban-client 常用操作<a hidden class=anchor aria-hidden=true href=#fail2ban-client-常用操作>#</a></h1><ul><li><strong>重启</strong>: **fail2ban systemctl restart fail2ban **</li><li><strong>查看fail2ban opensips运行状态</strong>: **fail2ban-client status opensips **</li><li><strong>黑名单操作</strong> (<strong>注意，黑名单测试时，不要把自己的IP加到黑名单里做测试，否则就连不上机器了</strong>)<ul><li>IP加入黑名单：**fail2ban-client set opensips banip 192.168.1.8 **</li><li>IP解锁：<strong>fail2ban-client set opensips unbanip 192.168.1.8</strong></li></ul></li><li><strong>白名单操作</strong><ul><li>IP加入白名单：<strong>fail2ban-client set opensips addignoreip 192.168.1.8</strong></li><li>IP从白名单中移除：<strong>fail2ban-client set opensips delignoreip 192.168.1.8</strong></li><li>在所有监狱中加入IP白名单：<strong>fail2ban-clien unban 192.168.1.8</strong></li></ul></li></ul><p><strong><strong>fail2ban的拦截是基于jail, 如果一个ip在某个jail中，但是不在其他jail中，那么这个ip也是无法访问主机。</strong></strong><strong>如果想在所有jail中加入一个白名单，需要fail2ban-client unban ip。</strong></p><p>**</p><h1 id=fail2ban-client帮助文档>fail2ban-client帮助文档<a hidden class=anchor aria-hidden=true href=#fail2ban-client帮助文档>#</a></h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Usage: fail2ban-client <span style=color:#f92672>[</span>OPTIONS<span style=color:#f92672>]</span> &lt;COMMAND&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Fail2Ban v0.10.5 reads log file that contains password failure report
</span></span><span style=display:flex><span>and bans the corresponding IP addresses using firewall rules.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Options:
</span></span><span style=display:flex><span>    -c &lt;DIR&gt;                configuration directory
</span></span><span style=display:flex><span>    -s &lt;FILE&gt;               socket path
</span></span><span style=display:flex><span>    -p &lt;FILE&gt;               pidfile path
</span></span><span style=display:flex><span>    --loglevel &lt;LEVEL&gt;      logging level
</span></span><span style=display:flex><span>    --logtarget &lt;TARGET&gt;    logging target, use file-name or stdout, stderr, syslog or sysout.
</span></span><span style=display:flex><span>    --syslogsocket auto|&lt;FILE&gt;
</span></span><span style=display:flex><span>    -d                      dump configuration. For debugging
</span></span><span style=display:flex><span>    --dp, --dump-pretty     dump the configuration using more human readable representation
</span></span><span style=display:flex><span>    -t, --test              test configuration <span style=color:#f92672>(</span>can be also specified with start parameters<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    -i                      interactive mode
</span></span><span style=display:flex><span>    -v                      increase verbosity
</span></span><span style=display:flex><span>    -q                      decrease verbosity
</span></span><span style=display:flex><span>    -x                      force execution of the server <span style=color:#f92672>(</span>remove socket file<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    -b                      start server in background <span style=color:#f92672>(</span>default<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    -f                      start server in foreground
</span></span><span style=display:flex><span>    --async                 start server in async mode <span style=color:#f92672>(</span><span style=color:#66d9ef>for</span> internal usage only, don<span style=color:#e6db74>&#39;t read configuration)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    --timeout               timeout to wait for the server (for internal usage only, don&#39;</span>t read configuration<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    --str2sec &lt;STRING&gt;      convert time abbreviation format to seconds
</span></span><span style=display:flex><span>    -h, --help              display this help message
</span></span><span style=display:flex><span>    -V, --version           print the version <span style=color:#f92672>(</span>-V returns machine-readable short format<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Command:
</span></span><span style=display:flex><span>                                             BASIC
</span></span><span style=display:flex><span>    start                                    starts the server and the jails
</span></span><span style=display:flex><span>    restart                                  restarts the server
</span></span><span style=display:flex><span>    restart <span style=color:#f92672>[</span>--unban<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--if-exists<span style=color:#f92672>]</span> &lt;JAIL&gt;   restarts the jail &lt;JAIL&gt; <span style=color:#f92672>(</span>alias
</span></span><span style=display:flex><span>                                             <span style=color:#66d9ef>for</span> <span style=color:#e6db74>&#39;reload --restart ... &lt;JAIL&gt;&#39;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    reload <span style=color:#f92672>[</span>--restart<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--unban<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--all<span style=color:#f92672>]</span>     reloads the configuration without
</span></span><span style=display:flex><span>                                             restarting of the server, the
</span></span><span style=display:flex><span>                                             option <span style=color:#e6db74>&#39;--restart&#39;</span> activates
</span></span><span style=display:flex><span>                                             completely restarting of affected
</span></span><span style=display:flex><span>                                             jails, thereby can unban IP
</span></span><span style=display:flex><span>                                             addresses <span style=color:#f92672>(</span><span style=color:#66d9ef>if</span> option <span style=color:#e6db74>&#39;--unban&#39;</span>
</span></span><span style=display:flex><span>                                             specified<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    reload <span style=color:#f92672>[</span>--restart<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--unban<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--if-exists<span style=color:#f92672>]</span> &lt;JAIL&gt;
</span></span><span style=display:flex><span>                                             reloads the jail &lt;JAIL&gt;, or
</span></span><span style=display:flex><span>                                             restarts it <span style=color:#f92672>(</span><span style=color:#66d9ef>if</span> option <span style=color:#e6db74>&#39;--restart&#39;</span>
</span></span><span style=display:flex><span>                                             specified<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    stop                                     stops all jails and terminate the
</span></span><span style=display:flex><span>                                             server
</span></span><span style=display:flex><span>    unban --all                              unbans all IP addresses <span style=color:#f92672>(</span>in all
</span></span><span style=display:flex><span>                                             jails and database<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    unban &lt;IP&gt; ... &lt;IP&gt;                      unbans &lt;IP&gt; <span style=color:#f92672>(</span>in all jails and
</span></span><span style=display:flex><span>                                             database<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    status                                   gets the current status of the
</span></span><span style=display:flex><span>                                             server
</span></span><span style=display:flex><span>    ping                                     tests <span style=color:#66d9ef>if</span> the server is alive
</span></span><span style=display:flex><span>    echo                                     <span style=color:#66d9ef>for</span> internal usage, returns back
</span></span><span style=display:flex><span>                                             and outputs a given string
</span></span><span style=display:flex><span>    help                                     <span style=color:#66d9ef>return</span> this output
</span></span><span style=display:flex><span>    version                                  <span style=color:#66d9ef>return</span> the server version
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                                             LOGGING
</span></span><span style=display:flex><span>    set loglevel &lt;LEVEL&gt;                     sets logging level to &lt;LEVEL&gt;.
</span></span><span style=display:flex><span>                                             Levels: CRITICAL, ERROR, WARNING,
</span></span><span style=display:flex><span>                                             NOTICE, INFO, DEBUG, TRACEDEBUG,
</span></span><span style=display:flex><span>                                             HEAVYDEBUG or corresponding
</span></span><span style=display:flex><span>                                             numeric value <span style=color:#f92672>(</span>50-5<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    get loglevel                             gets the logging level
</span></span><span style=display:flex><span>    set logtarget &lt;TARGET&gt;                   sets logging target to &lt;TARGET&gt;.
</span></span><span style=display:flex><span>                                             Can be STDOUT, STDERR, SYSLOG or a
</span></span><span style=display:flex><span>                                             file
</span></span><span style=display:flex><span>    get logtarget                            gets logging target
</span></span><span style=display:flex><span>    set syslogsocket auto|&lt;SOCKET&gt;           sets the syslog socket path to
</span></span><span style=display:flex><span>                                             auto or &lt;SOCKET&gt;. Only used <span style=color:#66d9ef>if</span>
</span></span><span style=display:flex><span>                                             logtarget is SYSLOG
</span></span><span style=display:flex><span>    get syslogsocket                         gets syslog socket path
</span></span><span style=display:flex><span>    flushlogs                                flushes the logtarget <span style=color:#66d9ef>if</span> a file
</span></span><span style=display:flex><span>                                             and reopens it. For log rotation.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                                             DATABASE
</span></span><span style=display:flex><span>    set dbfile &lt;FILE&gt;                        set the location of fail2ban
</span></span><span style=display:flex><span>                                             persistent datastore. Set to
</span></span><span style=display:flex><span>                                             <span style=color:#e6db74>&#34;None&#34;</span> to disable
</span></span><span style=display:flex><span>    get dbfile                               get the location of fail2ban
</span></span><span style=display:flex><span>                                             persistent datastore
</span></span><span style=display:flex><span>    set dbmaxmatches &lt;INT&gt;                   sets the max number of matches
</span></span><span style=display:flex><span>                                             stored in database per ticket
</span></span><span style=display:flex><span>    get dbmaxmatches                         gets the max number of matches
</span></span><span style=display:flex><span>                                             stored in database per ticket
</span></span><span style=display:flex><span>    set dbpurgeage &lt;SECONDS&gt;                 sets the max age in &lt;SECONDS&gt; that
</span></span><span style=display:flex><span>                                             history of bans will be kept
</span></span><span style=display:flex><span>    get dbpurgeage                           gets the max age in seconds that
</span></span><span style=display:flex><span>                                             history of bans will be kept
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                                             JAIL CONTROL
</span></span><span style=display:flex><span>    add &lt;JAIL&gt; &lt;BACKEND&gt;                     creates &lt;JAIL&gt; using &lt;BACKEND&gt;
</span></span><span style=display:flex><span>    start &lt;JAIL&gt;                             starts the jail &lt;JAIL&gt;
</span></span><span style=display:flex><span>    stop &lt;JAIL&gt;                              stops the jail &lt;JAIL&gt;. The jail is
</span></span><span style=display:flex><span>                                             removed
</span></span><span style=display:flex><span>    status &lt;JAIL&gt; <span style=color:#f92672>[</span>FLAVOR<span style=color:#f92672>]</span>                   gets the current status of &lt;JAIL&gt;,
</span></span><span style=display:flex><span>                                             with optional flavor or extended
</span></span><span style=display:flex><span>                                             info
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                                             JAIL CONFIGURATION
</span></span><span style=display:flex><span>    set &lt;JAIL&gt; idle on|off                   sets the idle state of &lt;JAIL&gt;
</span></span><span style=display:flex><span>    set &lt;JAIL&gt; ignoreself true|false         allows the ignoring of own IP
</span></span><span style=display:flex><span>                                             addresses
</span></span><span style=display:flex><span>    set &lt;JAIL&gt; addignoreip &lt;IP&gt;              adds &lt;IP&gt; to the ignore list of
</span></span><span style=display:flex><span>                                             &lt;JAIL&gt;
</span></span><span style=display:flex><span>    set &lt;JAIL&gt; delignoreip &lt;IP&gt;              removes &lt;IP&gt; from the ignore list
</span></span><span style=display:flex><span>                                             of &lt;JAIL&gt;
</span></span><span style=display:flex><span>    set &lt;JAIL&gt; ignorecommand &lt;VALUE&gt;         sets ignorecommand of &lt;JAIL&gt;
</span></span><span style=display:flex><span>    set &lt;JAIL&gt; ignorecache &lt;VALUE&gt;           sets ignorecache of &lt;JAIL&gt;
</span></span><span style=display:flex><span>    set &lt;JAIL&gt; addlogpath &lt;FILE&gt; <span style=color:#f92672>[</span><span style=color:#e6db74>&#39;tail&#39;</span><span style=color:#f92672>]</span>    adds &lt;FILE&gt; to the monitoring list
</span></span><span style=display:flex><span>                                             of &lt;JAIL&gt;, optionally starting at
</span></span><span style=display:flex><span>                                             the <span style=color:#e6db74>&#39;tail&#39;</span> of the file <span style=color:#f92672>(</span>default
</span></span><span style=display:flex><span>                                             <span style=color:#e6db74>&#39;head&#39;</span><span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>    set &lt;JAIL&gt; dellogpath &lt;FILE&gt;             removes &lt;FILE&gt; from the monitoring
</span></span><span style=display:flex><span>                                             list of &lt;JAIL&gt;
</span></span><span style=display:flex><span>    set &lt;JAIL&gt; logencoding &lt;ENCODING&gt;        sets the &lt;ENCODING&gt; of the log
</span></span><span style=display:flex><span>                                             files <span style=color:#66d9ef>for</span> &lt;JAIL&gt;
</span></span><span style=display:flex><span>    set &lt;JAIL&gt; addjournalmatch &lt;MATCH&gt;       adds &lt;MATCH&gt; to the journal filter
</span></span><span style=display:flex><span>                                             of &lt;JAIL&gt;
</span></span><span style=display:flex><span>    set &lt;JAIL&gt; deljournalmatch &lt;MATCH&gt;       removes &lt;MATCH&gt; from the journal
</span></span><span style=display:flex><span>                                             filter of &lt;JAIL&gt;
</span></span><span style=display:flex><span>    set &lt;JAIL&gt; addfailregex &lt;REGEX&gt;          adds the regular expression
</span></span><span style=display:flex><span>                                             &lt;REGEX&gt; which must match failures
</span></span><span style=display:flex><span>                                             <span style=color:#66d9ef>for</span> &lt;JAIL&gt;
</span></span><span style=display:flex><span>    set &lt;JAIL&gt; delfailregex &lt;INDEX&gt;          removes the regular expression at
</span></span><span style=display:flex><span>                                             &lt;INDEX&gt; <span style=color:#66d9ef>for</span> failregex
</span></span><span style=display:flex><span>    set &lt;JAIL&gt; addignoreregex &lt;REGEX&gt;        adds the regular expression
</span></span><span style=display:flex><span>                                             &lt;REGEX&gt; which should match pattern
</span></span><span style=display:flex><span>                                             to exclude <span style=color:#66d9ef>for</span> &lt;JAIL&gt;
</span></span><span style=display:flex><span>    set &lt;JAIL&gt; delignoreregex &lt;INDEX&gt;        removes the regular expression at
</span></span><span style=display:flex><span>                                             &lt;INDEX&gt; <span style=color:#66d9ef>for</span> ignoreregex
</span></span><span style=display:flex><span>    set &lt;JAIL&gt; findtime &lt;TIME&gt;               sets the number of seconds &lt;TIME&gt;
</span></span><span style=display:flex><span>                                             <span style=color:#66d9ef>for</span> which the filter will look
</span></span><span style=display:flex><span>                                             back <span style=color:#66d9ef>for</span> &lt;JAIL&gt;
</span></span><span style=display:flex><span>    set &lt;JAIL&gt; bantime &lt;TIME&gt;                sets the number of seconds &lt;TIME&gt;
</span></span><span style=display:flex><span>                                             a host will be banned <span style=color:#66d9ef>for</span> &lt;JAIL&gt;
</span></span><span style=display:flex><span>    set &lt;JAIL&gt; datepattern &lt;PATTERN&gt;         sets the &lt;PATTERN&gt; used to match
</span></span><span style=display:flex><span>                                             date/times <span style=color:#66d9ef>for</span> &lt;JAIL&gt;
</span></span><span style=display:flex><span>    set &lt;JAIL&gt; usedns &lt;VALUE&gt;                sets the usedns mode <span style=color:#66d9ef>for</span> &lt;JAIL&gt;
</span></span><span style=display:flex><span>    set &lt;JAIL&gt; attempt &lt;IP&gt; <span style=color:#f92672>[</span>&lt;failure1&gt; ... &lt;failureN&gt;<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>                                             manually notify about &lt;IP&gt; failure
</span></span><span style=display:flex><span>    set &lt;JAIL&gt; banip &lt;IP&gt; ... &lt;IP&gt;           manually Ban &lt;IP&gt; <span style=color:#66d9ef>for</span> &lt;JAIL&gt;
</span></span><span style=display:flex><span>    set &lt;JAIL&gt; unbanip <span style=color:#f92672>[</span>--report-absent<span style=color:#f92672>]</span> &lt;IP&gt; ... &lt;IP&gt;
</span></span><span style=display:flex><span>                                             manually Unban &lt;IP&gt; in &lt;JAIL&gt;
</span></span><span style=display:flex><span>    set &lt;JAIL&gt; maxretry &lt;RETRY&gt;              sets the number of failures
</span></span><span style=display:flex><span>                                             &lt;RETRY&gt; before banning the host
</span></span><span style=display:flex><span>                                             <span style=color:#66d9ef>for</span> &lt;JAIL&gt;
</span></span><span style=display:flex><span>    set &lt;JAIL&gt; maxmatches &lt;INT&gt;              sets the max number of matches
</span></span><span style=display:flex><span>                                             stored in memory per ticket in
</span></span><span style=display:flex><span>                                             &lt;JAIL&gt;
</span></span><span style=display:flex><span>    set &lt;JAIL&gt; maxlines &lt;LINES&gt;              sets the number of &lt;LINES&gt; to
</span></span><span style=display:flex><span>                                             buffer <span style=color:#66d9ef>for</span> regex search <span style=color:#66d9ef>for</span> &lt;JAIL&gt;
</span></span><span style=display:flex><span>    set &lt;JAIL&gt; addaction &lt;ACT&gt;<span style=color:#f92672>[</span> &lt;PYTHONFILE&gt; &lt;JSONKWARGS&gt;<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>                                             adds a new action named &lt;ACT&gt; <span style=color:#66d9ef>for</span>
</span></span><span style=display:flex><span>                                             &lt;JAIL&gt;. Optionally <span style=color:#66d9ef>for</span> a Python
</span></span><span style=display:flex><span>                                             based action, a &lt;PYTHONFILE&gt; and
</span></span><span style=display:flex><span>                                             &lt;JSONKWARGS&gt; can be specified,
</span></span><span style=display:flex><span>                                             <span style=color:#66d9ef>else</span> will be a Command Action
</span></span><span style=display:flex><span>    set &lt;JAIL&gt; delaction &lt;ACT&gt;               removes the action &lt;ACT&gt; from
</span></span><span style=display:flex><span>                                             &lt;JAIL&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                                             COMMAND ACTION CONFIGURATION
</span></span><span style=display:flex><span>    set &lt;JAIL&gt; action &lt;ACT&gt; actionstart &lt;CMD&gt;
</span></span><span style=display:flex><span>                                             sets the start command &lt;CMD&gt; of
</span></span><span style=display:flex><span>                                             the action &lt;ACT&gt; <span style=color:#66d9ef>for</span> &lt;JAIL&gt;
</span></span><span style=display:flex><span>    set &lt;JAIL&gt; action &lt;ACT&gt; actionstop &lt;CMD&gt; sets the stop command &lt;CMD&gt; of the
</span></span><span style=display:flex><span>                                             action &lt;ACT&gt; <span style=color:#66d9ef>for</span> &lt;JAIL&gt;
</span></span><span style=display:flex><span>    set &lt;JAIL&gt; action &lt;ACT&gt; actioncheck &lt;CMD&gt;
</span></span><span style=display:flex><span>                                             sets the check command &lt;CMD&gt; of
</span></span><span style=display:flex><span>                                             the action &lt;ACT&gt; <span style=color:#66d9ef>for</span> &lt;JAIL&gt;
</span></span><span style=display:flex><span>    set &lt;JAIL&gt; action &lt;ACT&gt; actionban &lt;CMD&gt;  sets the ban command &lt;CMD&gt; of the
</span></span><span style=display:flex><span>                                             action &lt;ACT&gt; <span style=color:#66d9ef>for</span> &lt;JAIL&gt;
</span></span><span style=display:flex><span>    set &lt;JAIL&gt; action &lt;ACT&gt; actionunban &lt;CMD&gt;
</span></span><span style=display:flex><span>                                             sets the unban command &lt;CMD&gt; of
</span></span><span style=display:flex><span>                                             the action &lt;ACT&gt; <span style=color:#66d9ef>for</span> &lt;JAIL&gt;
</span></span><span style=display:flex><span>    set &lt;JAIL&gt; action &lt;ACT&gt; timeout &lt;TIMEOUT&gt;
</span></span><span style=display:flex><span>                                             sets &lt;TIMEOUT&gt; as the command
</span></span><span style=display:flex><span>                                             timeout in seconds <span style=color:#66d9ef>for</span> the action
</span></span><span style=display:flex><span>                                             &lt;ACT&gt; <span style=color:#66d9ef>for</span> &lt;JAIL&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                                             GENERAL ACTION CONFIGURATION
</span></span><span style=display:flex><span>    set &lt;JAIL&gt; action &lt;ACT&gt; &lt;PROPERTY&gt; &lt;VALUE&gt;
</span></span><span style=display:flex><span>                                             sets the &lt;VALUE&gt; of &lt;PROPERTY&gt; <span style=color:#66d9ef>for</span>
</span></span><span style=display:flex><span>                                             the action &lt;ACT&gt; <span style=color:#66d9ef>for</span> &lt;JAIL&gt;
</span></span><span style=display:flex><span>    set &lt;JAIL&gt; action &lt;ACT&gt; &lt;METHOD&gt;<span style=color:#f92672>[</span> &lt;JSONKWARGS&gt;<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>                                             calls the &lt;METHOD&gt; with
</span></span><span style=display:flex><span>                                             &lt;JSONKWARGS&gt; <span style=color:#66d9ef>for</span> the action &lt;ACT&gt;
</span></span><span style=display:flex><span>                                             <span style=color:#66d9ef>for</span> &lt;JAIL&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                                             JAIL INFORMATION
</span></span><span style=display:flex><span>    get &lt;JAIL&gt; logpath                       gets the list of the monitored
</span></span><span style=display:flex><span>                                             files <span style=color:#66d9ef>for</span> &lt;JAIL&gt;
</span></span><span style=display:flex><span>    get &lt;JAIL&gt; logencoding                   gets the encoding of the log files
</span></span><span style=display:flex><span>                                             <span style=color:#66d9ef>for</span> &lt;JAIL&gt;
</span></span><span style=display:flex><span>    get &lt;JAIL&gt; journalmatch                  gets the journal filter match <span style=color:#66d9ef>for</span>
</span></span><span style=display:flex><span>                                             &lt;JAIL&gt;
</span></span><span style=display:flex><span>    get &lt;JAIL&gt; ignoreself                    gets the current value of the
</span></span><span style=display:flex><span>                                             ignoring the own IP addresses
</span></span><span style=display:flex><span>    get &lt;JAIL&gt; ignoreip                      gets the list of ignored IP
</span></span><span style=display:flex><span>                                             addresses <span style=color:#66d9ef>for</span> &lt;JAIL&gt;
</span></span><span style=display:flex><span>    get &lt;JAIL&gt; ignorecommand                 gets ignorecommand of &lt;JAIL&gt;
</span></span><span style=display:flex><span>    get &lt;JAIL&gt; failregex                     gets the list of regular
</span></span><span style=display:flex><span>                                             expressions which matches the
</span></span><span style=display:flex><span>                                             failures <span style=color:#66d9ef>for</span> &lt;JAIL&gt;
</span></span><span style=display:flex><span>    get &lt;JAIL&gt; ignoreregex                   gets the list of regular
</span></span><span style=display:flex><span>                                             expressions which matches patterns
</span></span><span style=display:flex><span>                                             to ignore <span style=color:#66d9ef>for</span> &lt;JAIL&gt;
</span></span><span style=display:flex><span>    get &lt;JAIL&gt; findtime                      gets the time <span style=color:#66d9ef>for</span> which the filter
</span></span><span style=display:flex><span>                                             will look back <span style=color:#66d9ef>for</span> failures <span style=color:#66d9ef>for</span>
</span></span><span style=display:flex><span>                                             &lt;JAIL&gt;
</span></span><span style=display:flex><span>    get &lt;JAIL&gt; bantime                       gets the time a host is banned <span style=color:#66d9ef>for</span>
</span></span><span style=display:flex><span>                                             &lt;JAIL&gt;
</span></span><span style=display:flex><span>    get &lt;JAIL&gt; datepattern                   gets the patern used to match
</span></span><span style=display:flex><span>                                             date/times <span style=color:#66d9ef>for</span> &lt;JAIL&gt;
</span></span><span style=display:flex><span>    get &lt;JAIL&gt; usedns                        gets the usedns setting <span style=color:#66d9ef>for</span> &lt;JAIL&gt;
</span></span><span style=display:flex><span>    get &lt;JAIL&gt; maxretry                      gets the number of failures
</span></span><span style=display:flex><span>                                             allowed <span style=color:#66d9ef>for</span> &lt;JAIL&gt;
</span></span><span style=display:flex><span>    get &lt;JAIL&gt; maxmatches                    gets the max number of matches
</span></span><span style=display:flex><span>                                             stored in memory per ticket in
</span></span><span style=display:flex><span>                                             &lt;JAIL&gt;
</span></span><span style=display:flex><span>    get &lt;JAIL&gt; maxlines                      gets the number of lines to buffer
</span></span><span style=display:flex><span>                                             <span style=color:#66d9ef>for</span> &lt;JAIL&gt;
</span></span><span style=display:flex><span>    get &lt;JAIL&gt; actions                       gets a list of actions <span style=color:#66d9ef>for</span> &lt;JAIL&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                                             COMMAND ACTION INFORMATION
</span></span><span style=display:flex><span>    get &lt;JAIL&gt; action &lt;ACT&gt; actionstart      gets the start command <span style=color:#66d9ef>for</span> the
</span></span><span style=display:flex><span>                                             action &lt;ACT&gt; <span style=color:#66d9ef>for</span> &lt;JAIL&gt;
</span></span><span style=display:flex><span>    get &lt;JAIL&gt; action &lt;ACT&gt; actionstop       gets the stop command <span style=color:#66d9ef>for</span> the
</span></span><span style=display:flex><span>                                             action &lt;ACT&gt; <span style=color:#66d9ef>for</span> &lt;JAIL&gt;
</span></span><span style=display:flex><span>    get &lt;JAIL&gt; action &lt;ACT&gt; actioncheck      gets the check command <span style=color:#66d9ef>for</span> the
</span></span><span style=display:flex><span>                                             action &lt;ACT&gt; <span style=color:#66d9ef>for</span> &lt;JAIL&gt;
</span></span><span style=display:flex><span>    get &lt;JAIL&gt; action &lt;ACT&gt; actionban        gets the ban command <span style=color:#66d9ef>for</span> the
</span></span><span style=display:flex><span>                                             action &lt;ACT&gt; <span style=color:#66d9ef>for</span> &lt;JAIL&gt;
</span></span><span style=display:flex><span>    get &lt;JAIL&gt; action &lt;ACT&gt; actionunban      gets the unban command <span style=color:#66d9ef>for</span> the
</span></span><span style=display:flex><span>                                             action &lt;ACT&gt; <span style=color:#66d9ef>for</span> &lt;JAIL&gt;
</span></span><span style=display:flex><span>    get &lt;JAIL&gt; action &lt;ACT&gt; timeout          gets the command timeout in
</span></span><span style=display:flex><span>                                             seconds <span style=color:#66d9ef>for</span> the action &lt;ACT&gt; <span style=color:#66d9ef>for</span>
</span></span><span style=display:flex><span>                                             &lt;JAIL&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                                             GENERAL ACTION INFORMATION
</span></span><span style=display:flex><span>    get &lt;JAIL&gt; actionproperties &lt;ACT&gt;        gets a list of properties <span style=color:#66d9ef>for</span> the
</span></span><span style=display:flex><span>                                             action &lt;ACT&gt; <span style=color:#66d9ef>for</span> &lt;JAIL&gt;
</span></span><span style=display:flex><span>    get &lt;JAIL&gt; actionmethods &lt;ACT&gt;           gets a list of methods <span style=color:#66d9ef>for</span> the
</span></span><span style=display:flex><span>                                             action &lt;ACT&gt; <span style=color:#66d9ef>for</span> &lt;JAIL&gt;
</span></span><span style=display:flex><span>    get &lt;JAIL&gt; action &lt;ACT&gt; &lt;PROPERTY&gt;       gets the value of &lt;PROPERTY&gt; <span style=color:#66d9ef>for</span>
</span></span><span style=display:flex><span>                                             the action &lt;ACT&gt; <span style=color:#66d9ef>for</span> &lt;JAIL&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Report bugs to https://github.com/fail2ban/fail2ban/issues
</span></span></code></pre></div><p>Report bugs to <a href=https://github.com/fail2ban/fail2ban/issues>https://github.com/fail2ban/fail2ban/issues</a></p></div><footer class=post-footer><nav class=paginav><a class=prev href=https://wdd.js.org/posts/old-blog/uffptn/><span class=title>« Prev Page</span><br><span>娱乐智障</span></a>
<a class=next href=https://wdd.js.org/posts/old-blog/pbcbub/><span class=title>Next Page »</span><br><span>s</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://wdd.js.org>洞香春</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span>
<span id=busuanzi_container_site_pv>本站访问量：<span id=busuanzi_value_site_pv></span>次</span>
&nbsp;
<span id=busuanzi_container_site_uv>您是本站第 <span id=busuanzi_value_site_uv></span> 位访问者</span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>