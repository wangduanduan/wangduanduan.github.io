<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>基于 WebRTC 构建 Web SIP Phone | 洞香春</title><meta name=keywords content="webrtc,sip"><meta name=description content="0 阅前须知 本文并不是教程，只是实现方案 我只是从WEB端考虑这个问题，实际还需要后端sip服务器的配合 jsSIP有个非常不错的在线demo, 可以去哪里玩耍，很好玩呢 try jssip 1. 技术简介 WebRTC: WebRTC，名称源自网页即时通信（英语：Web Real-Time Communication）的缩写，是一个支持网页浏览器进行实时语音对话或视频对话的API。它于2011年6月1日开源并在Google、Mozilla、Opera支持下被纳入万维网联盟的W3C推荐标准 SIP: 会话发起协议（Session Initiation Protocol，缩写SIP）是一个由IETF MMUSIC工作组开发的协议，作为标准被提议用于创建，修改和终止包括视频，语音，即时通信，在线游戏和虚拟现实等多种多媒体元素在内的交互式用户会话。2000年11月，SIP被正式批准成为3GPP信号协议之一，并成为IMS体系结构的一个永久单元。SIP与H.323一样，是用于VoIP最主要的信令协议之一。 一般来说，要么使用实体话机，要么在系统上安装基于sip的客户端程序。实体话机硬件成本高，基于sip的客户端往往兼容性差，无法跨平台，易被杀毒软件查杀。
而WebRTC或许是更好的解决方案，只要一个浏览器就可以实时语音视频通话，这是很不错的解决方案。WebSocket可以用来传递sip信令，而WebRTC用来实时传输语音视频流。
2. 前端WebRTC实现方案 其实我们不需要去自己处理WebRTC的相关方法，或者去处理视频或者媒体流。市面上已经有不错的模块可供选择。
2.1 jsSIP jsSIP是JavaScript SIP 库
功能特点如下：
可以在浏览器或者Nodejs中运行 使用WebSocket传递SIP协议 视频音频实时消息使用WebRTC 非常轻量 100%纯JavaScript 使用简单并且具有强大的Api 服务端支持 OverSIP, Kamailio, Asterisk, OfficeSIP，reSIProcate，Frafos ABC SBC，TekSIP 是RFC 7118 and OverSIP的作者写的 下面是使用JsSIP打电话的例子，非常简单吧
// Create our JsSIP instance and run it: var socket = new JsSIP.WebSocketInterface('wss://sip.myhost.com'); var configuration = { sockets : [ socket ], uri : 'sip:alice@example."><meta name=author content="王端端"><link rel=canonical href=https://wdd.js.org/posts/2018/webrtc-web-sip-phone/><meta name=google-site-verification content="G-SGW660ZWKM"><link crossorigin=anonymous href=/assets/css/stylesheet.min.6aef73bcd11b501f30d40511dda695ff4635a6911499b91e84cfbca3c398c0e8.css integrity="sha256-au9zvNEbUB8w1AUR3aaV/0Y1ppEUmbkehM+8o8OYwOg=" rel="preload stylesheet" as=style><link crossorigin=anonymous herf=/font-awesome/css/font-awesome.min.css rel=stylesheet type=text/css><link rel=preload href=/yellowstone.ico as=image><script defer crossorigin=anonymous src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://wdd.js.org/yellowstone.ico><link rel=icon type=image/png sizes=16x16 href=https://wdd.js.org/yellowstone.ico><link rel=icon type=image/png sizes=32x32 href=https://wdd.js.org/yellowstone.ico><link rel=apple-touch-icon href=https://wdd.js.org/yellowstone.ico><link rel=mask-icon href=https://wdd.js.org/yellowstone.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.102.3"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-SGW660ZWKM"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-SGW660ZWKM",{anonymize_ip:!1})}</script><meta property="og:title" content="基于 WebRTC 构建 Web SIP Phone"><meta property="og:description" content="0 阅前须知 本文并不是教程，只是实现方案 我只是从WEB端考虑这个问题，实际还需要后端sip服务器的配合 jsSIP有个非常不错的在线demo, 可以去哪里玩耍，很好玩呢 try jssip 1. 技术简介 WebRTC: WebRTC，名称源自网页即时通信（英语：Web Real-Time Communication）的缩写，是一个支持网页浏览器进行实时语音对话或视频对话的API。它于2011年6月1日开源并在Google、Mozilla、Opera支持下被纳入万维网联盟的W3C推荐标准 SIP: 会话发起协议（Session Initiation Protocol，缩写SIP）是一个由IETF MMUSIC工作组开发的协议，作为标准被提议用于创建，修改和终止包括视频，语音，即时通信，在线游戏和虚拟现实等多种多媒体元素在内的交互式用户会话。2000年11月，SIP被正式批准成为3GPP信号协议之一，并成为IMS体系结构的一个永久单元。SIP与H.323一样，是用于VoIP最主要的信令协议之一。 一般来说，要么使用实体话机，要么在系统上安装基于sip的客户端程序。实体话机硬件成本高，基于sip的客户端往往兼容性差，无法跨平台，易被杀毒软件查杀。
而WebRTC或许是更好的解决方案，只要一个浏览器就可以实时语音视频通话，这是很不错的解决方案。WebSocket可以用来传递sip信令，而WebRTC用来实时传输语音视频流。
2. 前端WebRTC实现方案 其实我们不需要去自己处理WebRTC的相关方法，或者去处理视频或者媒体流。市面上已经有不错的模块可供选择。
2.1 jsSIP jsSIP是JavaScript SIP 库
功能特点如下：
可以在浏览器或者Nodejs中运行 使用WebSocket传递SIP协议 视频音频实时消息使用WebRTC 非常轻量 100%纯JavaScript 使用简单并且具有强大的Api 服务端支持 OverSIP, Kamailio, Asterisk, OfficeSIP，reSIProcate，Frafos ABC SBC，TekSIP 是RFC 7118 and OverSIP的作者写的 下面是使用JsSIP打电话的例子，非常简单吧
// Create our JsSIP instance and run it: var socket = new JsSIP.WebSocketInterface('wss://sip.myhost.com'); var configuration = { sockets : [ socket ], uri : 'sip:alice@example."><meta property="og:type" content="article"><meta property="og:url" content="https://wdd.js.org/posts/2018/webrtc-web-sip-phone/"><meta property="og:image" content="https://wdd.js.org/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-02-11T14:44:58+08:00"><meta property="article:modified_time" content="2018-02-11T14:44:58+08:00"><meta property="og:site_name" content="洞香春"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://wdd.js.org/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="基于 WebRTC 构建 Web SIP Phone"><meta name=twitter:description content="0 阅前须知 本文并不是教程，只是实现方案 我只是从WEB端考虑这个问题，实际还需要后端sip服务器的配合 jsSIP有个非常不错的在线demo, 可以去哪里玩耍，很好玩呢 try jssip 1. 技术简介 WebRTC: WebRTC，名称源自网页即时通信（英语：Web Real-Time Communication）的缩写，是一个支持网页浏览器进行实时语音对话或视频对话的API。它于2011年6月1日开源并在Google、Mozilla、Opera支持下被纳入万维网联盟的W3C推荐标准 SIP: 会话发起协议（Session Initiation Protocol，缩写SIP）是一个由IETF MMUSIC工作组开发的协议，作为标准被提议用于创建，修改和终止包括视频，语音，即时通信，在线游戏和虚拟现实等多种多媒体元素在内的交互式用户会话。2000年11月，SIP被正式批准成为3GPP信号协议之一，并成为IMS体系结构的一个永久单元。SIP与H.323一样，是用于VoIP最主要的信令协议之一。 一般来说，要么使用实体话机，要么在系统上安装基于sip的客户端程序。实体话机硬件成本高，基于sip的客户端往往兼容性差，无法跨平台，易被杀毒软件查杀。
而WebRTC或许是更好的解决方案，只要一个浏览器就可以实时语音视频通话，这是很不错的解决方案。WebSocket可以用来传递sip信令，而WebRTC用来实时传输语音视频流。
2. 前端WebRTC实现方案 其实我们不需要去自己处理WebRTC的相关方法，或者去处理视频或者媒体流。市面上已经有不错的模块可供选择。
2.1 jsSIP jsSIP是JavaScript SIP 库
功能特点如下：
可以在浏览器或者Nodejs中运行 使用WebSocket传递SIP协议 视频音频实时消息使用WebRTC 非常轻量 100%纯JavaScript 使用简单并且具有强大的Api 服务端支持 OverSIP, Kamailio, Asterisk, OfficeSIP，reSIProcate，Frafos ABC SBC，TekSIP 是RFC 7118 and OverSIP的作者写的 下面是使用JsSIP打电话的例子，非常简单吧
// Create our JsSIP instance and run it: var socket = new JsSIP.WebSocketInterface('wss://sip.myhost.com'); var configuration = { sockets : [ socket ], uri : 'sip:alice@example."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://wdd.js.org/posts/"},{"@type":"ListItem","position":3,"name":"基于 WebRTC 构建 Web SIP Phone","item":"https://wdd.js.org/posts/2018/webrtc-web-sip-phone/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"基于 WebRTC 构建 Web SIP Phone","name":"基于 WebRTC 构建 Web SIP Phone","description":"0 阅前须知 本文并不是教程，只是实现方案 我只是从WEB端考虑这个问题，实际还需要后端sip服务器的配合 jsSIP有个非常不错的在线demo, 可以去哪里玩耍，很好玩呢 try jssip 1. 技术简介 WebRTC: WebRTC，名称源自网页即时通信（英语：Web Real-Time Communication）的缩写，是一个支持网页浏览器进行实时语音对话或视频对话的API。它于2011年6月1日开源并在Google、Mozilla、Opera支持下被纳入万维网联盟的W3C推荐标准 SIP: 会话发起协议（Session Initiation Protocol，缩写SIP）是一个由IETF MMUSIC工作组开发的协议，作为标准被提议用于创建，修改和终止包括视频，语音，即时通信，在线游戏和虚拟现实等多种多媒体元素在内的交互式用户会话。2000年11月，SIP被正式批准成为3GPP信号协议之一，并成为IMS体系结构的一个永久单元。SIP与H.323一样，是用于VoIP最主要的信令协议之一。 一般来说，要么使用实体话机，要么在系统上安装基于sip的客户端程序。实体话机硬件成本高，基于sip的客户端往往兼容性差，无法跨平台，易被杀毒软件查杀。\n而WebRTC或许是更好的解决方案，只要一个浏览器就可以实时语音视频通话，这是很不错的解决方案。WebSocket可以用来传递sip信令，而WebRTC用来实时传输语音视频流。\n2. 前端WebRTC实现方案 其实我们不需要去自己处理WebRTC的相关方法，或者去处理视频或者媒体流。市面上已经有不错的模块可供选择。\n2.1 jsSIP jsSIP是JavaScript SIP 库\n功能特点如下：\n可以在浏览器或者Nodejs中运行 使用WebSocket传递SIP协议 视频音频实时消息使用WebRTC 非常轻量 100%纯JavaScript 使用简单并且具有强大的Api 服务端支持 OverSIP, Kamailio, Asterisk, OfficeSIP，reSIProcate，Frafos ABC SBC，TekSIP 是RFC 7118 and OverSIP的作者写的 下面是使用JsSIP打电话的例子，非常简单吧\n// Create our JsSIP instance and run it: var socket = new JsSIP.WebSocketInterface(\u0026#39;wss://sip.myhost.com\u0026#39;); var configuration = { sockets : [ socket ], uri : \u0026#39;sip:alice@example.","keywords":["webrtc","sip"],"articleBody":"0 阅前须知 本文并不是教程，只是实现方案 我只是从WEB端考虑这个问题，实际还需要后端sip服务器的配合 jsSIP有个非常不错的在线demo, 可以去哪里玩耍，很好玩呢 try jssip 1. 技术简介 WebRTC: WebRTC，名称源自网页即时通信（英语：Web Real-Time Communication）的缩写，是一个支持网页浏览器进行实时语音对话或视频对话的API。它于2011年6月1日开源并在Google、Mozilla、Opera支持下被纳入万维网联盟的W3C推荐标准 SIP: 会话发起协议（Session Initiation Protocol，缩写SIP）是一个由IETF MMUSIC工作组开发的协议，作为标准被提议用于创建，修改和终止包括视频，语音，即时通信，在线游戏和虚拟现实等多种多媒体元素在内的交互式用户会话。2000年11月，SIP被正式批准成为3GPP信号协议之一，并成为IMS体系结构的一个永久单元。SIP与H.323一样，是用于VoIP最主要的信令协议之一。 一般来说，要么使用实体话机，要么在系统上安装基于sip的客户端程序。实体话机硬件成本高，基于sip的客户端往往兼容性差，无法跨平台，易被杀毒软件查杀。\n而WebRTC或许是更好的解决方案，只要一个浏览器就可以实时语音视频通话，这是很不错的解决方案。WebSocket可以用来传递sip信令，而WebRTC用来实时传输语音视频流。\n2. 前端WebRTC实现方案 其实我们不需要去自己处理WebRTC的相关方法，或者去处理视频或者媒体流。市面上已经有不错的模块可供选择。\n2.1 jsSIP jsSIP是JavaScript SIP 库\n功能特点如下：\n可以在浏览器或者Nodejs中运行 使用WebSocket传递SIP协议 视频音频实时消息使用WebRTC 非常轻量 100%纯JavaScript 使用简单并且具有强大的Api 服务端支持 OverSIP, Kamailio, Asterisk, OfficeSIP，reSIProcate，Frafos ABC SBC，TekSIP 是RFC 7118 and OverSIP的作者写的 下面是使用JsSIP打电话的例子，非常简单吧\n// Create our JsSIP instance and run it: var socket = new JsSIP.WebSocketInterface('wss://sip.myhost.com'); var configuration = { sockets : [ socket ], uri : 'sip:alice@example.com', password : 'superpassword' }; var ua = new JsSIP.UA(configuration); ua.start(); // Register callbacks to desired call events var eventHandlers = { 'progress': function(e) { console.log('call is in progress'); }, 'failed': function(e) { console.log('call failed with cause: '+ e.data.cause); }, 'ended': function(e) { console.log('call ended with cause: '+ e.data.cause); }, 'confirmed': function(e) { console.log('call confirmed'); } }; var options = { 'eventHandlers' : eventHandlers, 'mediaConstraints' : { 'audio': true, 'video': true } }; var session = ua.call('sip:bob@example.com', options); 2.2 SIP.js sip.js项目实际是fork自jsSIP的，这里主要介绍它的服务端支持情况。其他接口自己自行查阅\nFreeSWITCH Asterisk OnSIP FreeSWITCH Legacy 3. 平台考量 由于WebRTC对浏览器有较高的要求，你可以看看下图，哪些浏览器支持WebRTC, 所有IE浏览器都不行，chrome系支持情况不错。\n3.1 考量标准 跨平台 兼容性 体积 集成性 硬件要求 开发成本 3.2 考量表格 种类 适用平台 优点 缺点 基于electron开发的桌面客户端 window, mac, linux 跨平台，兼容好 要下载安装，体积大（压缩后至少48MB），对电脑性能有要求 开发js sdk 现代浏览器 体积小，容易第三方集成 兼容差(因为涉及到webRTC, IE11以及以都不行，对宿主环境要求高)，客户集成需要开发量 开发谷歌浏览器扩展 谷歌浏览器 体积小 兼容差（仅限类chrome浏览器） 4 参考文档 and 延伸阅读 and 动手实践 Js SIP Getting Started 120行代码实现 浏览器WebRTC视频聊天 SIP协议状态码： 5 常见问题 422: “Session Interval Too Small” jsSIP默认携带Session-Expires: 90的头部信息，如果这个超时字段小于服务端的设定值，那么就会得到如下422的响应。参见SIP协议状态码：, 可以在call请求中设置sessionTimersExpires, 使其超过服务端的设定值即可\ncall(targer, options ) option.sessionTimersExpires Number (in seconds) for the default Session Timers interval (default value is 90, do not set a lower value). 6 最后，你我共勉 ","wordCount":"241","inLanguage":"en","datePublished":"2018-02-11T14:44:58+08:00","dateModified":"2018-02-11T14:44:58+08:00","author":{"@type":"Person","name":"王端端"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://wdd.js.org/posts/2018/webrtc-web-sip-phone/"},"publisher":{"@type":"Organization","name":"洞香春","logo":{"@type":"ImageObject","url":"https://wdd.js.org/yellowstone.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://wdd.js.org accesskey=h title="洞香春 (Alt + H)"><img src=/yellowstone.ico alt=logo aria-label=logo height=35>洞香春</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://wdd.js.org/freeswitch/ title=FreeSWITCH><span>FreeSWITCH</span></a></li><li><a href=https://wdd.js.org/golang/ title=Golang><span>Golang</span></a></li><li><a href=https://wdd.js.org/network/ title=Network><span>Network</span></a></li><li><a href=https://wdd.js.org/opensips/ title=OpenSIPS><span>OpenSIPS</span></a></li><li><a href=https://wdd.js.org/shell/ title=Shell><span>Shell</span></a></li><li><a href=https://wdd.js.org/vim/ title=VIM><span>VIM</span></a></li><li><a href=https://wdd.js.org/categories/ title=分类><span>分类</span></a></li><li><a href=https://wdd.js.org/search/ title=搜索><span>搜索</span></a></li><li><a href=https://wdd.js.org/tags/ title=标签><span>标签</span></a></li><li><a href=https://wdd.js.org/archives/ title=归档><span>归档</span></a></li><li><a href=https://wdd.js.org/about/ title=我><span>我</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://wdd.js.org>Home</a>&nbsp;»&nbsp;<a href=https://wdd.js.org/posts/>Posts</a></div><h1 class=post-title>基于 WebRTC 构建 Web SIP Phone</h1><div class=post-meta><span title='2018-02-11 14:44:58 +0800 CST'>2018-02-11 14:44:58</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;王端端&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/posts/2018/webrtc-web-sip-phone.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#0-%e9%98%85%e5%89%8d%e9%a1%bb%e7%9f%a5 aria-label="0 阅前须知">0 阅前须知</a></li><li><a href=#1-%e6%8a%80%e6%9c%af%e7%ae%80%e4%bb%8b aria-label="1. 技术简介">1. 技术简介</a></li><li><a href=#2-%e5%89%8d%e7%ab%afwebrtc%e5%ae%9e%e7%8e%b0%e6%96%b9%e6%a1%88 aria-label="2. 前端WebRTC实现方案">2. 前端WebRTC实现方案</a><ul><li><a href=#21-jssiphttpjssipnet aria-label="2.1 jsSIP">2.1 <a href=http://jssip.net/>jsSIP</a></a></li><li><a href=#22-sipjshttpssipjscom aria-label="2.2 SIP.js">2.2 <a href=https://sipjs.com/>SIP.js</a></a></li></ul></li><li><a href=#3-%e5%b9%b3%e5%8f%b0%e8%80%83%e9%87%8f aria-label="3. 平台考量">3. 平台考量</a><ul><li><a href=#31-%e8%80%83%e9%87%8f%e6%a0%87%e5%87%86 aria-label="3.1 考量标准">3.1 考量标准</a></li><li><a href=#32-%e8%80%83%e9%87%8f%e8%a1%a8%e6%a0%bc aria-label="3.2 考量表格">3.2 考量表格</a></li></ul></li><li><a href=#4-%e5%8f%82%e8%80%83%e6%96%87%e6%a1%a3-and-%e5%bb%b6%e4%bc%b8%e9%98%85%e8%af%bb-and-%e5%8a%a8%e6%89%8b%e5%ae%9e%e8%b7%b5 aria-label="4 参考文档 and 延伸阅读 and 动手实践">4 参考文档 and 延伸阅读 and 动手实践</a></li><li><a href=#5-%e5%b8%b8%e8%a7%81%e9%97%ae%e9%a2%98 aria-label="5 常见问题">5 常见问题</a><ul><li><a href=#422-session-interval-too-small aria-label="422: &amp;ldquo;Session Interval Too Small&amp;rdquo;">422: &ldquo;Session Interval Too Small&rdquo;</a></li></ul></li><li><a href=#6-%e6%9c%80%e5%90%8e%e4%bd%a0%e6%88%91%e5%85%b1%e5%8b%89 aria-label="6 最后，你我共勉">6 最后，你我共勉</a></li></ul></div></details></div><div class=post-content><h1 id=0-阅前须知>0 阅前须知<a hidden class=anchor aria-hidden=true href=#0-阅前须知>#</a></h1><ul><li>本文并不是教程，只是实现方案</li><li>我只是从WEB端考虑这个问题，实际还需要后端sip服务器的配合</li><li>jsSIP有个非常不错的在线demo, 可以去哪里玩耍，很好玩呢 <a href=https://tryit.jssip.net/>try jssip</a></li></ul><p><img loading=lazy src=https://wdd.js.org/img/images/20180211144554_nUwjgc_Screenshot.jpeg alt></p><h1 id=1-技术简介>1. 技术简介<a hidden class=anchor aria-hidden=true href=#1-技术简介>#</a></h1><blockquote><ul><li><code>WebRTC</code>: WebRTC，名称源自<code>网页即时通信</code>（英语：Web Real-Time Communication）的缩写，是一个支持网页浏览器进行实时语音对话或视频对话的API。它于2011年6月1日开源并在Google、Mozilla、Opera支持下被纳入万维网联盟的W3C推荐标准</li></ul></blockquote><blockquote><ul><li><code>SIP</code>: <code>会话发起协议</code>（Session Initiation Protocol，缩写SIP）是一个由IETF MMUSIC工作组开发的协议，作为标准被提议用于创建，修改和终止包括视频，语音，即时通信，在线游戏和虚拟现实等多种多媒体元素在内的交互式用户会话。2000年11月，SIP被正式批准成为3GPP信号协议之一，并成为IMS体系结构的一个永久单元。SIP与H.323一样，是用于VoIP最主要的信令协议之一。</li></ul></blockquote><p><img loading=lazy src=https://wdd.js.org/img/images/20180211144604_Zdxh2x_Screenshot.jpeg alt></p><p>一般来说，要么使用实体话机，要么在系统上安装基于sip的客户端程序。实体话机硬件成本高，基于sip的客户端往往兼容性差，无法跨平台，易被杀毒软件查杀。</p><p>而<code>WebRTC</code>或许是更好的解决方案，只要一个浏览器就可以实时语音视频通话，这是很不错的解决方案。WebSocket可以用来传递sip信令，而WebRTC用来实时传输语音视频流。</p><h1 id=2-前端webrtc实现方案>2. 前端WebRTC实现方案<a hidden class=anchor aria-hidden=true href=#2-前端webrtc实现方案>#</a></h1><p>其实我们不需要去自己处理WebRTC的相关方法，或者去处理视频或者媒体流。市面上已经有不错的模块可供选择。</p><h2 id=21-jssiphttpjssipnet>2.1 <a href=http://jssip.net/>jsSIP</a><a hidden class=anchor aria-hidden=true href=#21-jssiphttpjssipnet>#</a></h2><p><code>jsSIP是JavaScript SIP 库</code></p><p><img loading=lazy src=https://wdd.js.org/img/images/20180211144616_7c5Pf0_Screenshot.jpeg alt></p><p>功能特点如下：</p><ul><li>可以在浏览器或者Nodejs中运行</li><li>使用WebSocket传递SIP协议</li><li>视频音频实时消息使用WebRTC</li><li>非常轻量</li><li>100%纯JavaScript</li><li>使用简单并且具有强大的Api</li><li>服务端支持 OverSIP, Kamailio, Asterisk, OfficeSIP，reSIProcate，Frafos ABC SBC，TekSIP</li><li>是RFC 7118 and OverSIP的作者写的</li></ul><p>下面是使用JsSIP打电话的例子，非常简单吧</p><pre tabindex=0><code>// Create our JsSIP instance and run it:

var socket = new JsSIP.WebSocketInterface(&#39;wss://sip.myhost.com&#39;);
var configuration = {
  sockets  : [ socket ],
  uri      : &#39;sip:alice@example.com&#39;,
  password : &#39;superpassword&#39;
};

var ua = new JsSIP.UA(configuration);

ua.start();

// Register callbacks to desired call events
var eventHandlers = {
  &#39;progress&#39;: function(e) {
    console.log(&#39;call is in progress&#39;);
  },
  &#39;failed&#39;: function(e) {
    console.log(&#39;call failed with cause: &#39;+ e.data.cause);
  },
  &#39;ended&#39;: function(e) {
    console.log(&#39;call ended with cause: &#39;+ e.data.cause);
  },
  &#39;confirmed&#39;: function(e) {
    console.log(&#39;call confirmed&#39;);
  }
};

var options = {
  &#39;eventHandlers&#39;    : eventHandlers,
  &#39;mediaConstraints&#39; : { &#39;audio&#39;: true, &#39;video&#39;: true }
};

var session = ua.call(&#39;sip:bob@example.com&#39;, options);
</code></pre><h2 id=22-sipjshttpssipjscom>2.2 <a href=https://sipjs.com/>SIP.js</a><a hidden class=anchor aria-hidden=true href=#22-sipjshttpssipjscom>#</a></h2><p>sip.js项目实际是fork自jsSIP的，这里主要介绍它的服务端支持情况。其他接口自己自行查阅</p><p><img loading=lazy src=https://wdd.js.org/img/images/20180211144630_24V1u8_Screenshot.jpeg alt></p><ul><li>FreeSWITCH</li><li>Asterisk</li><li>OnSIP</li><li>FreeSWITCH Legacy</li></ul><h1 id=3-平台考量>3. 平台考量<a hidden class=anchor aria-hidden=true href=#3-平台考量>#</a></h1><p><img loading=lazy src=https://wdd.js.org/img/images/20180211144642_my1Cbb_Screenshot.jpeg alt></p><p>由于WebRTC对浏览器有较高的要求，你可以看看下图，哪些浏览器支持WebRTC, 所有IE浏览器都不行，chrome系支持情况不错。</p><h2 id=31-考量标准>3.1 考量标准<a hidden class=anchor aria-hidden=true href=#31-考量标准>#</a></h2><ul><li>跨平台</li><li>兼容性</li><li>体积</li><li>集成性</li><li>硬件要求</li><li>开发成本</li></ul><h2 id=32-考量表格>3.2 考量表格<a hidden class=anchor aria-hidden=true href=#32-考量表格>#</a></h2><table><thead><tr><th>种类</th><th>适用平台</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>基于electron开发的桌面客户端</td><td>window, mac, linux</td><td>跨平台，兼容好</td><td>要下载安装，体积大（压缩后至少48MB），对电脑性能有要求</td></tr><tr><td>开发js sdk</td><td>现代浏览器</td><td>体积小，容易第三方集成</td><td>兼容差(因为涉及到webRTC, IE11以及以都不行，对宿主环境要求高)，客户集成需要开发量</td></tr><tr><td>开发谷歌浏览器扩展</td><td>谷歌浏览器</td><td>体积小</td><td>兼容差（仅限类chrome浏览器）</td></tr></tbody></table><h1 id=4-参考文档-and-延伸阅读-and-动手实践>4 参考文档 and 延伸阅读 and 动手实践<a hidden class=anchor aria-hidden=true href=#4-参考文档-and-延伸阅读-and-动手实践>#</a></h1><ul><li><a href=http://jssip.net/documentation/3.1.x/getting_started/>Js SIP Getting Started</a></li><li><a href=https://segmentfault.com/a/1190000011848805>120行代码实现 浏览器WebRTC视频聊天</a></li><li><a href=https://en.wikipedia.org/wiki/List_of_SIP_response_codes#4xx%E2%80%94Client_Failure_Responses>SIP协议状态码：</a></li></ul><h1 id=5-常见问题>5 常见问题<a hidden class=anchor aria-hidden=true href=#5-常见问题>#</a></h1><h2 id=422-session-interval-too-small>422: &ldquo;Session Interval Too Small&rdquo;<a hidden class=anchor aria-hidden=true href=#422-session-interval-too-small>#</a></h2><p>jsSIP默认携带<code>Session-Expires: 90</code>的头部信息，如果这个超时字段小于服务端的设定值，那么就会得到如下422的响应。参见<a href=https://en.wikipedia.org/wiki/List_of_SIP_response_codes#4xx%E2%80%94Client_Failure_Responses>SIP协议状态码：</a>, 可以在call请求中设置<code>sessionTimersExpires</code>, 使其超过服务端的设定值即可</p><pre tabindex=0><code>call(targer, options
)
option.sessionTimersExpires
Number (in seconds) for the default Session Timers interval (default value is 90, do not set a lower value).
</code></pre><h1 id=6-最后你我共勉>6 最后，你我共勉<a hidden class=anchor aria-hidden=true href=#6-最后你我共勉>#</a></h1><p><img loading=lazy src=https://i.imgur.com/ZKAN9K7.gif alt=clipboard.png></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://wdd.js.org/tags/webrtc/>WebRTC</a></li><li><a href=https://wdd.js.org/tags/sip/>sip</a></li></ul><nav class=paginav><a class=prev href=https://wdd.js.org/posts/2018/small-is-better-than-big/><span class=title>« Prev Page</span><br><span>small is better than big 我的读书方法论</span></a>
<a class=next href=https://wdd.js.org/posts/2018/useful-browser-events/><span class=title>Next Page »</span><br><span>不常用却很有妙用的事件及方法</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://wdd.js.org>洞香春</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>