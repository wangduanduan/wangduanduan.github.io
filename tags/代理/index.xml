<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>代理 on 洞香春</title>
    <link>https://wdd.js.org/tags/%E4%BB%A3%E7%90%86/</link>
    <description>Recent content in 代理 on 洞香春</description>
    <image>
      <url>https://wdd.js.org/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E</url>
      <link>https://wdd.js.org/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E</link>
    </image>
    <generator>Hugo -- gohugo.io</generator>
    <lastBuildDate>Fri, 09 Feb 2018 13:24:35 +0000</lastBuildDate><atom:link href="https://wdd.js.org/tags/%E4%BB%A3%E7%90%86/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>手写可配置的express &amp; nodejs的代理</title>
      <link>https://wdd.js.org/posts/2018/write-configurable-nodejs-http-proxy/</link>
      <pubDate>Fri, 09 Feb 2018 13:24:35 +0000</pubDate>
      
      <guid>https://wdd.js.org/posts/2018/write-configurable-nodejs-http-proxy/</guid>
      <description>注意：该文章中设置代理的方法存在很大的问题，请不要在使用。这里只作为记录。 非常推荐你使用http-proxy-middleware，作为生产环境代理的包。你可以看我的这篇文章，里面有一个非常小巧的写法，可以实现各种代理的方法，Express 代理中间件的写法 关于该文章中设置代理会产生的问题，在这篇文章中我会做详细的说明, TCP链接高Recv-Q的原因以及解决方法
nodejs比较好的代理包有：node-http-proxy和http-proxy-middleware。这两个我都用过，它们的优点自不用说，只说说缺点：它们不能从配置文件里读取代理配置。每添加一个拦截路径都需要多加一个接口调用。
所以，我需要自己写一个http代理，要包含一下功能：
从配置文件里读取代理配置 可以路径重写 这样做的好处是：新增服务只需要在配置文件上加上该服务，无需修改业务逻辑
1. /config/default.js module.exports = { &amp;#34;ENV&amp;#34;:&amp;#34;dev&amp;#34;, &amp;#34;PORT&amp;#34;:&amp;#34;8088&amp;#34;, &amp;#34;maxAge&amp;#34;: 10, &amp;#34;proxy&amp;#34;:{ &amp;#34;olap&amp;#34;:{ &amp;#34;host&amp;#34;:&amp;#34;172.16.200.225&amp;#34;, &amp;#34;port&amp;#34;:&amp;#34;8092&amp;#34;, &amp;#34;form&amp;#34;:&amp;#34;&amp;#34;, &amp;#34;to&amp;#34;:&amp;#34;&amp;#34; }, &amp;#34;qc&amp;#34;:{ &amp;#34;host&amp;#34;:&amp;#34;192.168.40.231&amp;#34;, &amp;#34;port&amp;#34;:&amp;#34;30088&amp;#34; }, &amp;#34;api&amp;#34;:{ &amp;#34;host&amp;#34;:&amp;#34;192.168.40.231&amp;#34;, &amp;#34;port&amp;#34;:&amp;#34;30412&amp;#34; }, &amp;#34;ocm&amp;#34;:{ &amp;#34;host&amp;#34;: process.env.ocm_host || &amp;#34;192.168.40.119&amp;#34;, &amp;#34;port&amp;#34;: process.env.ocm_port || &amp;#34;31003&amp;#34; } } } 2. /app.js 将所有要走代理的路径前必需加上 /p, 这个是我的个人配置，当然也可以是其他的名字。
var express = require(&amp;#39;express&amp;#39;); var compression = require(&amp;#39;compression&amp;#39;); var path = require(&amp;#39;path&amp;#39;); var config = require(&amp;#39;config&amp;#39;); var log4js = require(&amp;#39;log4js&amp;#39;); var wsProxyConfig = config.</description>
    </item>
    
  </channel>
</rss>
