<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Node.js读取wav文件 | 洞香春</title><meta name=keywords content><meta name=description content="相比于普通的文件，二进制的文件略显神秘。本次就为大家揭开二进制文件的面纱。
WAV文件的格式 下图是一个普通的wav文件的格式。其中除了最后的data部分，其他的每个格子都占用了固定大小的字节数。
知道字节数之后，就需要按照正确的字节序读区。字节序读反了，可能读出一堆乱码。 关于字节序，可以参考阮一峰老师写的理解字节序这篇文章。
step1: 读取文件 const fs = require('fs') const path = require('path') const file = fs.readFileSync(path.join(__dirname, './a.wav')) console.log(file) 原始的打印，二进制以16进制的方式显示。看不出其中有何含义。
node main.js <Buffer 52 49 46 46 a4 23 48 00 57 41 56 45 66 6d 74 20 10 00 00 00 01 00 02 00 40 1f 00 00 00 7d 00 00 04 00 10 00 64 61 74 61 80 23 48 00 00 00 00 00 00 00 ."><meta name=author content="Eddie Wang"><link rel=canonical href=https://wdd.js.org/fe/nodejs-read-wav-file/><link crossorigin=anonymous href=/assets/css/stylesheet.6d3944e058d85363bbe8a792a9b5f40002bca80be859dc19c466dd8de223973e.css integrity="sha256-bTlE4FjYU2O76KeSqbX0AAK8qAvoWdwZxGbdjeIjlz4=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://wdd.js.org/cowboy.ico><link rel=icon type=image/png sizes=16x16 href=https://wdd.js.org/cowboy.ico><link rel=icon type=image/png sizes=32x32 href=https://wdd.js.org/cowboy.ico><link rel=apple-touch-icon href=https://wdd.js.org/cowboy.ico><link rel=mask-icon href=https://wdd.js.org/cowboy.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="Node.js读取wav文件"><meta property="og:description" content="相比于普通的文件，二进制的文件略显神秘。本次就为大家揭开二进制文件的面纱。
WAV文件的格式 下图是一个普通的wav文件的格式。其中除了最后的data部分，其他的每个格子都占用了固定大小的字节数。
知道字节数之后，就需要按照正确的字节序读区。字节序读反了，可能读出一堆乱码。 关于字节序，可以参考阮一峰老师写的理解字节序这篇文章。
step1: 读取文件 const fs = require('fs') const path = require('path') const file = fs.readFileSync(path.join(__dirname, './a.wav')) console.log(file) 原始的打印，二进制以16进制的方式显示。看不出其中有何含义。
node main.js <Buffer 52 49 46 46 a4 23 48 00 57 41 56 45 66 6d 74 20 10 00 00 00 01 00 02 00 40 1f 00 00 00 7d 00 00 04 00 10 00 64 61 74 61 80 23 48 00 00 00 00 00 00 00 ."><meta property="og:type" content="article"><meta property="og:url" content="https://wdd.js.org/fe/nodejs-read-wav-file/"><meta property="og:image" content="https://wdd.js.org/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="fe"><meta property="article:published_time" content="2022-10-29T11:32:32+08:00"><meta property="article:modified_time" content="2022-10-29T11:32:32+08:00"><meta property="og:site_name" content="洞香春"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://wdd.js.org/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Node.js读取wav文件"><meta name=twitter:description content="相比于普通的文件，二进制的文件略显神秘。本次就为大家揭开二进制文件的面纱。
WAV文件的格式 下图是一个普通的wav文件的格式。其中除了最后的data部分，其他的每个格子都占用了固定大小的字节数。
知道字节数之后，就需要按照正确的字节序读区。字节序读反了，可能读出一堆乱码。 关于字节序，可以参考阮一峰老师写的理解字节序这篇文章。
step1: 读取文件 const fs = require('fs') const path = require('path') const file = fs.readFileSync(path.join(__dirname, './a.wav')) console.log(file) 原始的打印，二进制以16进制的方式显示。看不出其中有何含义。
node main.js <Buffer 52 49 46 46 a4 23 48 00 57 41 56 45 66 6d 74 20 10 00 00 00 01 00 02 00 40 1f 00 00 00 7d 00 00 04 00 10 00 64 61 74 61 80 23 48 00 00 00 00 00 00 00 ."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"前端之路","item":"https://wdd.js.org/fe/"},{"@type":"ListItem","position":3,"name":"Node.js读取wav文件","item":"https://wdd.js.org/fe/nodejs-read-wav-file/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Node.js读取wav文件","name":"Node.js读取wav文件","description":"相比于普通的文件，二进制的文件略显神秘。本次就为大家揭开二进制文件的面纱。\nWAV文件的格式 下图是一个普通的wav文件的格式。其中除了最后的data部分，其他的每个格子都占用了固定大小的字节数。\n知道字节数之后，就需要按照正确的字节序读区。字节序读反了，可能读出一堆乱码。 关于字节序，可以参考阮一峰老师写的理解字节序这篇文章。\nstep1: 读取文件 const fs = require(\u0026#39;fs\u0026#39;) const path = require(\u0026#39;path\u0026#39;) const file = fs.readFileSync(path.join(__dirname, \u0026#39;./a.wav\u0026#39;)) console.log(file) 原始的打印，二进制以16进制的方式显示。看不出其中有何含义。\nnode main.js \u0026lt;Buffer 52 49 46 46 a4 23 48 00 57 41 56 45 66 6d 74 20 10 00 00 00 01 00 02 00 40 1f 00 00 00 7d 00 00 04 00 10 00 64 61 74 61 80 23 48 00 00 00 00 00 00 00 .","keywords":[],"articleBody":"相比于普通的文件，二进制的文件略显神秘。本次就为大家揭开二进制文件的面纱。\nWAV文件的格式 下图是一个普通的wav文件的格式。其中除了最后的data部分，其他的每个格子都占用了固定大小的字节数。\n知道字节数之后，就需要按照正确的字节序读区。字节序读反了，可能读出一堆乱码。 关于字节序，可以参考阮一峰老师写的理解字节序这篇文章。\nstep1: 读取文件 const fs = require('fs') const path = require('path') const file = fs.readFileSync(path.join(__dirname, './a.wav')) console.log(file) 原始的打印，二进制以16进制的方式显示。看不出其中有何含义。\nnode main.js \u003cBuffer 52 49 46 46 a4 23 48 00 57 41 56 45 66 6d 74 20 10 00 00 00 01 00 02 00 40 1f 00 00 00 7d 00 00 04 00 10 00 64 61 74 61 80 23 48 00 00 00 00 00 00 00 ... 4727674 more bytes\u003e step2: 工具函数 // 将buf转为字符串 function buffer2String (buf) { let int = [] for (let i=0; i\u003cbuf.length; i++) { int.push(buf.readUInt8(i)) } return String.fromCharCode(...int) } // 对读区的头字段的值进行校验 // 实际上头字段之间是存在一定的关系的 function validWav (wav, fileSize) { //20 2 AudioFormat PCM = 1 (i.e. Linear quantization) // Values other than 1 indicate some // form of compression. // 22 2 NumChannels Mono = 1, Stereo = 2, etc. // 24 4 SampleRate 8000, 44100, etc. // 28 4 ByteRate == SampleRate * NumChannels * BitsPerSample/8 // 32 2 BlockAlign == NumChannels * BitsPerSample/8 // The number of bytes for one sample including // all channels. I wonder what happens when // this number isn't an integer? // 34 2 BitsPerSample 8 bits = 8, 16 bits = 16, etc. if (wav.AudioFormat !== 1) { return 1 } if (![1,2].includes(wav.NumChannels)){ return 2 } if (![8000,44100].includes(wav.SampleRate)){ return 3 } if (![8,16].includes(wav.BitsPerSample)){ return 4 } if (wav.ByteRate !== wav.SampleRate * wav.NumChannels * wav.BitsPerSample / 8){ return 5 } if (wav.BlockAlign !== wav.NumChannels * wav.BitsPerSample / 8 ){ return 6 } if (wav.ChunkSize + 8 !== fileSize) { return 7 } return 0 } class ByteWalk { constructor(buf){ // 记录当前读过的字节数 this.current = 0 // 记录整个buf this.buf = buf } // 用来指定要读取的字节数，以及它的格式 step(s, f){ if (this.current === this.buf.length) { return } let bf if (arguments.length === 0) { s = this.buf.length - this.current } if (this.current + s \u003e= this.buf.length) { bf = this.buf.slice(this.current, this.buf.length) this.current = this.buf.length } else { bf = this.buf.slice(this.current, this.current + s) this.current += s } // 一个特殊的标记，用来标记按照字符串的方式读取buf if (f === 'readStringBE') { return buffer2String(bf) } if (!f) { return bf } return bf[f](); } } function readData (buf, step, read) { let data = [] for (let i=0; i\u003cbuf.length; i += step) { data.push(buf[read](i)) } return data } module.exports = { buffer2String, // validFile, ByteWalk, validWav, readData } step3: main函数 const fs = require('fs') const path = require('path') const { ByteWalk, validWav, readData } = require('./util') const file = fs.readFileSync(path.join(__dirname, './a.wav')) const B = new ByteWalk(file) // 按照固定的字节数读取 let friendData = { ChunkID: B.step(4,'readStringBE'), ChunkSize: B.step(4, 'readUInt32LE'), Format: B.step(4, 'readStringBE'), Subchunk1ID: B.step(4, 'readStringBE'), Subchunk1Size: B.step(4, 'readUInt32LE'), AudioFormat: B.step(2, 'readUInt16LE'), NumChannels: B.step(2, 'readUInt16LE'), SampleRate: B.step(4, 'readUInt32LE'), ByteRate: B.step(4, 'readUInt32LE'), BlockAlign: B.step(2, 'readUInt16LE'), BitsPerSample: B.step(2, 'readUInt16LE'), Subchunk2ID: B.step(4, 'readStringBE'), Subchunk2Size: B.step(4, 'readUInt32LE'), Data: B.step() } // var data = readData(friendData.Data, friendData.BlockAlign, 'readInt16LE') console.log(validWav(friendData, file.length)) console.log(friendData, friendData.Data.length) // console.log(data) 从输出的内容可以看到，个个头字段基本上都读取出来了。\n0 { ChunkID: 'RIFF', ChunkSize: 4727716, Format: 'WAVE', Subchunk1ID: 'fmt ', Subchunk1Size: 16, AudioFormat: 1, NumChannels: 2, SampleRate: 8000, ByteRate: 32000, BlockAlign: 4, BitsPerSample: 16, Subchunk2ID: 'data', Subchunk2Size: 4727680, Data: \u003cBuffer 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ... 4727630 more bytes\u003e } 4727680 想要深入理解wav文件格式的，可以看下最后的参考资料。\n之后大家可以从做一些有趣的事情，例如双声道的声音做声道分离，或者说双声道合并成单声道等等。\n参考资料 http://soundfile.sapp.org/doc/WaveFormat/ ","wordCount":"563","inLanguage":"en","datePublished":"2022-10-29T11:32:32+08:00","dateModified":"2022-10-29T11:32:32+08:00","author":{"@type":"Person","name":"Eddie Wang"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://wdd.js.org/fe/nodejs-read-wav-file/"},"publisher":{"@type":"Organization","name":"洞香春","logo":{"@type":"ImageObject","url":"https://wdd.js.org/cowboy.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://wdd.js.org accesskey=h title="洞香春 (Alt + H)"><img src=https://wdd.js.org/cowboy.ico alt aria-label=logo height=35>洞香春</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://wdd.js.org/freeswitch/ title=FreeSWITCH><span>FreeSWITCH</span></a></li><li><a href=https://wdd.js.org/fe/ title=Frontend><span>Frontend</span></a></li><li><a href=https://wdd.js.org/golang/ title=Golang><span>Golang</span></a></li><li><a href=https://wdd.js.org/container/ title=k8s/docker><span>k8s/docker</span></a></li><li><a href=https://wdd.js.org/network/ title=Network><span>Network</span></a></li><li><a href=https://wdd.js.org/opensips/ title=OpenSIPS><span>OpenSIPS</span></a></li><li><a href=https://wdd.js.org/shell/ title=Shell><span>Shell</span></a></li><li><a href=https://wdd.js.org/vim/ title=VIM><span>VIM</span></a></li><li><a href=https://wdd.js.org/categories/ title=分类><span>分类</span></a></li><li><a href=https://wdd.js.org/search/ title=搜索><span>搜索</span></a></li><li><a href=https://wdd.js.org/tags/ title=标签><span>标签</span></a></li><li><a href=https://wdd.js.org/archives/ title=归档><span>归档</span></a></li><li><a href=https://wdd.js.org/about/ title=我><span>我</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://wdd.js.org>Home</a>&nbsp;»&nbsp;<a href=https://wdd.js.org/fe/>前端之路</a></div><h1 class=post-title>Node.js读取wav文件</h1><div class=post-meta><span title='2022-10-29 11:32:32 +0800 CST'>2022-10-29 11:32:32</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;Eddie Wang&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/fe/nodejs-read-wav-file/index.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#wav%e6%96%87%e4%bb%b6%e7%9a%84%e6%a0%bc%e5%bc%8f aria-label=WAV文件的格式>WAV文件的格式</a></li><li><a href=#step1-%e8%af%bb%e5%8f%96%e6%96%87%e4%bb%b6 aria-label="step1: 读取文件">step1: 读取文件</a></li><li><a href=#step2-%e5%b7%a5%e5%85%b7%e5%87%bd%e6%95%b0 aria-label="step2: 工具函数">step2: 工具函数</a></li><li><a href=#step3-main%e5%87%bd%e6%95%b0 aria-label="step3: main函数">step3: main函数</a></li><li><a href=#%e5%8f%82%e8%80%83%e8%b5%84%e6%96%99 aria-label=参考资料>参考资料</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p>相比于普通的文件，二进制的文件略显神秘。本次就为大家揭开二进制文件的面纱。</p><h1 id=wav文件的格式>WAV文件的格式<a hidden class=anchor aria-hidden=true href=#wav文件的格式>#</a></h1><p>下图是一个普通的wav文件的格式。其中除了最后的data部分，其他的每个格子都占用了固定大小的字节数。</p><p>知道字节数之后，就需要按照正确的字节序读区。字节序读反了，可能读出一堆乱码。 关于字节序，可以参考阮一峰老师写的<a href=https://www.ruanyifeng.com/blog/2016/11/byte-order.html>理解字节序</a>这篇文章。</p><p><img loading=lazy src=2022-10-29-11-33-26.png alt></p><h1 id=step1-读取文件>step1: 读取文件<a hidden class=anchor aria-hidden=true href=#step1-读取文件>#</a></h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>fs</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;fs&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>path</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;path&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>file</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>readFileSync</span>(<span style=color:#a6e22e>path</span>.<span style=color:#a6e22e>join</span>(<span style=color:#a6e22e>__dirname</span>, <span style=color:#e6db74>&#39;./a.wav&#39;</span>))
</span></span><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>file</span>)
</span></span></code></pre></div><p>原始的打印，二进制以16进制的方式显示。看不出其中有何含义。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>node</span> <span style=color:#a6e22e>main</span>.<span style=color:#a6e22e>js</span> 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>Buffer</span> <span style=color:#ae81ff>52</span> <span style=color:#ae81ff>49</span> <span style=color:#ae81ff>46</span> <span style=color:#ae81ff>46</span> <span style=color:#a6e22e>a4</span> <span style=color:#ae81ff>23</span> <span style=color:#ae81ff>48</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>57</span> <span style=color:#ae81ff>41</span> <span style=color:#ae81ff>56</span> <span style=color:#ae81ff>45</span> <span style=color:#ae81ff>66</span> <span style=color:#ae81ff>6</span><span style=color:#a6e22e>d</span> <span style=color:#ae81ff>74</span> <span style=color:#ae81ff>20</span> <span style=color:#ae81ff>10</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>02</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>40</span> <span style=color:#ae81ff>1</span><span style=color:#a6e22e>f</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>7</span><span style=color:#a6e22e>d</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>04</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>10</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>64</span> <span style=color:#ae81ff>61</span> <span style=color:#ae81ff>74</span> <span style=color:#ae81ff>61</span> <span style=color:#ae81ff>80</span> <span style=color:#ae81ff>23</span> <span style=color:#ae81ff>48</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> ... <span style=color:#ae81ff>4727674</span> <span style=color:#a6e22e>more</span> <span style=color:#a6e22e>bytes</span><span style=color:#f92672>&gt;</span>
</span></span></code></pre></div><h1 id=step2-工具函数>step2: 工具函数<a hidden class=anchor aria-hidden=true href=#step2-工具函数>#</a></h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// 将buf转为字符串
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>buffer2String</span> (<span style=color:#a6e22e>buf</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>int</span> <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span><span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>buf</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>       <span style=color:#66d9ef>int</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>buf</span>.<span style=color:#a6e22e>readUInt8</span>(<span style=color:#a6e22e>i</span>))
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> String.<span style=color:#a6e22e>fromCharCode</span>(...<span style=color:#66d9ef>int</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 对读区的头字段的值进行校验
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 实际上头字段之间是存在一定的关系的
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span>  <span style=color:#a6e22e>validWav</span> (<span style=color:#a6e22e>wav</span>, <span style=color:#a6e22e>fileSize</span>) {
</span></span><span style=display:flex><span><span style=color:#75715e>//20        2   AudioFormat      PCM = 1 (i.e. Linear quantization)
</span></span></span><span style=display:flex><span><span style=color:#75715e>//                                Values other than 1 indicate some 
</span></span></span><span style=display:flex><span><span style=color:#75715e>//                                form of compression.
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 22        2   NumChannels      Mono = 1, Stereo = 2, etc.
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 24        4   SampleRate       8000, 44100, etc.
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 28        4   ByteRate         == SampleRate * NumChannels * BitsPerSample/8
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 32        2   BlockAlign       == NumChannels * BitsPerSample/8
</span></span></span><span style=display:flex><span><span style=color:#75715e>//                                The number of bytes for one sample including
</span></span></span><span style=display:flex><span><span style=color:#75715e>//                                all channels. I wonder what happens when
</span></span></span><span style=display:flex><span><span style=color:#75715e>//                                this number isn&#39;t an integer?
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 34        2   BitsPerSample    8 bits = 8, 16 bits = 16, etc.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>wav</span>.<span style=color:#a6e22e>AudioFormat</span> <span style=color:#f92672>!==</span> <span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>[<span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>2</span>].<span style=color:#a6e22e>includes</span>(<span style=color:#a6e22e>wav</span>.<span style=color:#a6e22e>NumChannels</span>)){
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>[<span style=color:#ae81ff>8000</span>,<span style=color:#ae81ff>44100</span>].<span style=color:#a6e22e>includes</span>(<span style=color:#a6e22e>wav</span>.<span style=color:#a6e22e>SampleRate</span>)){
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>[<span style=color:#ae81ff>8</span>,<span style=color:#ae81ff>16</span>].<span style=color:#a6e22e>includes</span>(<span style=color:#a6e22e>wav</span>.<span style=color:#a6e22e>BitsPerSample</span>)){
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>wav</span>.<span style=color:#a6e22e>ByteRate</span>  <span style=color:#f92672>!==</span> <span style=color:#a6e22e>wav</span>.<span style=color:#a6e22e>SampleRate</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>wav</span>.<span style=color:#a6e22e>NumChannels</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>wav</span>.<span style=color:#a6e22e>BitsPerSample</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>8</span>){
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>wav</span>.<span style=color:#a6e22e>BlockAlign</span>  <span style=color:#f92672>!==</span> <span style=color:#a6e22e>wav</span>.<span style=color:#a6e22e>NumChannels</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>wav</span>.<span style=color:#a6e22e>BitsPerSample</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>8</span> ){
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>6</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>wav</span>.<span style=color:#a6e22e>ChunkSize</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>8</span> <span style=color:#f92672>!==</span> <span style=color:#a6e22e>fileSize</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>7</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ByteWalk</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>constructor</span>(<span style=color:#a6e22e>buf</span>){
</span></span><span style=display:flex><span>      	<span style=color:#75715e>// 记录当前读过的字节数
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>current</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>      	<span style=color:#75715e>// 记录整个buf
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>buf</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>buf</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>		
</span></span><span style=display:flex><span>  	<span style=color:#75715e>// 用来指定要读取的字节数，以及它的格式
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>step</span>(<span style=color:#a6e22e>s</span>, <span style=color:#a6e22e>f</span>){
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>current</span> <span style=color:#f92672>===</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>buf</span>.<span style=color:#a6e22e>length</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>bf</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>arguments</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>s</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>buf</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>-</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>current</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>current</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>s</span> <span style=color:#f92672>&gt;=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>buf</span>.<span style=color:#a6e22e>length</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>bf</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>buf</span>.<span style=color:#a6e22e>slice</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>current</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>buf</span>.<span style=color:#a6e22e>length</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>current</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>buf</span>.<span style=color:#a6e22e>length</span>
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>bf</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>buf</span>.<span style=color:#a6e22e>slice</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>current</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>current</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>s</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>current</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>s</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>				<span style=color:#75715e>// 一个特殊的标记，用来标记按照字符串的方式读取buf
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>f</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;readStringBE&#39;</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>buffer2String</span>(<span style=color:#a6e22e>bf</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>f</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>bf</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>bf</span>[<span style=color:#a6e22e>f</span>]();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>readData</span> (<span style=color:#a6e22e>buf</span>, <span style=color:#a6e22e>step</span>, <span style=color:#a6e22e>read</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span><span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>buf</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>step</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>buf</span>[<span style=color:#a6e22e>read</span>](<span style=color:#a6e22e>i</span>))
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>data</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>module</span>.<span style=color:#a6e22e>exports</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>buffer2String</span>,
</span></span><span style=display:flex><span>    <span style=color:#75715e>// validFile,
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>ByteWalk</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>validWav</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>readData</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=step3-main函数>step3: main函数<a hidden class=anchor aria-hidden=true href=#step3-main函数>#</a></h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>fs</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;fs&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>path</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;path&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ByteWalk</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>validWav</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>readData</span>
</span></span><span style=display:flex><span>} <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;./util&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>file</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>readFileSync</span>(<span style=color:#a6e22e>path</span>.<span style=color:#a6e22e>join</span>(<span style=color:#a6e22e>__dirname</span>, <span style=color:#e6db74>&#39;./a.wav&#39;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>B</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>ByteWalk</span>(<span style=color:#a6e22e>file</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 按照固定的字节数读取
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>friendData</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ChunkID</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>step</span>(<span style=color:#ae81ff>4</span>,<span style=color:#e6db74>&#39;readStringBE&#39;</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ChunkSize</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>step</span>(<span style=color:#ae81ff>4</span>, <span style=color:#e6db74>&#39;readUInt32LE&#39;</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Format</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>step</span>(<span style=color:#ae81ff>4</span>, <span style=color:#e6db74>&#39;readStringBE&#39;</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Subchunk1ID</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>step</span>(<span style=color:#ae81ff>4</span>, <span style=color:#e6db74>&#39;readStringBE&#39;</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Subchunk1Size</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>step</span>(<span style=color:#ae81ff>4</span>, <span style=color:#e6db74>&#39;readUInt32LE&#39;</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>AudioFormat</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>step</span>(<span style=color:#ae81ff>2</span>, <span style=color:#e6db74>&#39;readUInt16LE&#39;</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>NumChannels</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>step</span>(<span style=color:#ae81ff>2</span>, <span style=color:#e6db74>&#39;readUInt16LE&#39;</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>SampleRate</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>step</span>(<span style=color:#ae81ff>4</span>, <span style=color:#e6db74>&#39;readUInt32LE&#39;</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ByteRate</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>step</span>(<span style=color:#ae81ff>4</span>, <span style=color:#e6db74>&#39;readUInt32LE&#39;</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>BlockAlign</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>step</span>(<span style=color:#ae81ff>2</span>, <span style=color:#e6db74>&#39;readUInt16LE&#39;</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>BitsPerSample</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>step</span>(<span style=color:#ae81ff>2</span>, <span style=color:#e6db74>&#39;readUInt16LE&#39;</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Subchunk2ID</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>step</span>(<span style=color:#ae81ff>4</span>, <span style=color:#e6db74>&#39;readStringBE&#39;</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Subchunk2Size</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>step</span>(<span style=color:#ae81ff>4</span>, <span style=color:#e6db74>&#39;readUInt32LE&#39;</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Data</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>step</span>()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// var data = readData(friendData.Data, friendData.BlockAlign, &#39;readInt16LE&#39;)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>validWav</span>(<span style=color:#a6e22e>friendData</span>, <span style=color:#a6e22e>file</span>.<span style=color:#a6e22e>length</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>friendData</span>, <span style=color:#a6e22e>friendData</span>.<span style=color:#a6e22e>Data</span>.<span style=color:#a6e22e>length</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// console.log(data)
</span></span></span></code></pre></div><p>从输出的内容可以看到，个个头字段基本上都读取出来了。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ChunkID</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;RIFF&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ChunkSize</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>4727716</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>Format</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;WAVE&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>Subchunk1ID</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;fmt &#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>Subchunk1Size</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>16</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>AudioFormat</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>NumChannels</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>2</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>SampleRate</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>8000</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ByteRate</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>32000</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>BlockAlign</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>4</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>BitsPerSample</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>16</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>Subchunk2ID</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;data&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>Subchunk2Size</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>4727680</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>Data</span><span style=color:#f92672>:</span> <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>Buffer</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> ... <span style=color:#ae81ff>4727630</span> <span style=color:#a6e22e>more</span> <span style=color:#a6e22e>bytes</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>} <span style=color:#ae81ff>4727680</span>
</span></span></code></pre></div><p>想要深入理解wav文件格式的，可以看下最后的参考资料。</p><p>之后大家可以从做一些有趣的事情，例如双声道的声音做声道分离，或者说双声道合并成单声道等等。</p><h1 id=参考资料>参考资料<a hidden class=anchor aria-hidden=true href=#参考资料>#</a></h1><ul><li><a href=http://soundfile.sapp.org/doc/WaveFormat/>http://soundfile.sapp.org/doc/WaveFormat/</a></li></ul></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://wdd.js.org>洞香春</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>